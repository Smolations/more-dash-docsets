<!DOCTYPE html><html><head><title> Multi-Machine - Vagrant Documentation</title><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link href="./../../stylesheets/bootstrap-2bdef9a2.css" media=screen rel=stylesheet /><link href="./../../stylesheets/vagrantup-d5d54c59.css" media=screen rel=stylesheet /><script src="./../../javascripts/jquery-08c11650.js"></script><script src="./../../javascripts/modernizr-84c0465a.js"></script><script src="./../../javascripts/bootstrap.min-98cc7a22.js"></script><script src="./../../javascripts/backstretch-3d1212ad.js"></script><script src="./../../javascripts/vagrantup-03aae2a8.js"></script><link href='//fonts.googleapis.com/css?family=Inconsolata' rel=stylesheet><script src="//use.typekit.net/xfs6zus.js"></script><script>try{Typekit.load();}catch(e){}</script></head><body><div class=wrapper><nav class=docs><a class=vagrant-docs-logo href="/">Vagrant Documentation</a><ul class="pull-right unstyled"><li><a href="//www.vagrantup.com/">Home</a></li></ul></nav><div class="page docs docs-home"><div class=container><div class=row><div class="sidebar span3"><aside class=sidebar-nav><div class="toggle hidden-desktop"><div class="open-close open"></div><a href="#">Contents</a></div><ul class=unstyled><li><a href="./../../v2/">Overview</a></li><li><a href="./../../v2/why-vagrant/index.html">Why Vagrant?</a></li><li><a href="./../../v2/installation/index.html">Installation</a></li><li><a href="./../../v2/getting-started/index.html">Getting Started</a></li><li><a href="./../../v2/cli/index.html">Command-Line Interface</a></li><li><a href="./../../v2/vagrantfile/index.html">Vagrantfile</a></li><li><a href="./../../v2/boxes.html">Boxes</a></li><li><a href="./../../v2/provisioning/index.html">Provisioning</a></li><li><a href="./../../v2/networking/index.html">Networking</a></li><li><a href="./../../v2/synced-folders/index.html">Synced Folders</a></li><li class=current><a href="./../../v2/multi-machine/index.html">Multi-Machine</a></li><li><a href="./../../v2/providers/index.html">Providers</a></li><li><a href="./../../v2/virtualbox/index.html">VirtualBox</a></li><li><a href="./../../v2/vmware/index.html">VMware</a></li><li><a href="./../../v2/plugins/index.html">Plugins</a></li><li><a href="./../../v2/debugging.html">Debugging</a></li></ul></aside></div><div class="page-contents span9"><div class=page-background></div><div class=row><div class="span8 offset1"><h1>Multi-Machine</h1><p>Vagrant is able to define and control multiple guest machines per Vagrantfile. This is known as a &quot;multi-machine&quot; environment.</p><p>These machines are generally able to work together or are somehow associated with each other. Here are some use-cases people are using multi-machine environments for today:</p><ul><li>Accurately modeling a multi-server production topology, such as separating a web and database server.</li><li>Modeling a distributed system and how they interact with each other.</li><li>Testing an interface, such as an API to a service component.</li><li>Disaster-case testing: machines dying, network partitions, slow networks, inconsistent world views, etc.</li></ul><p>Historically, running complex environments such as these was done by flattening them onto a single machine. The problem with that is that it is an inaccurate model of the production setup, which can behave far differently.</p><p>Using the multi-machine feature of Vagrant, these environments can be modeled in the context of a single Vagrant environment without losing any of the benefits of Vagrant.</p><h2>Defining Multiple Machines</h2><p>Multiple machines are defined within the same project <a href="./../../v2/vagrantfile/">Vagrantfile</a> using the <code>config.vm.define</code> method call. This configuration directive is a little funny, because it creates a Vagrant configuration within a configuration. An example shows this best:</p><pre><code class="ruby">Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.provision &quot;shell&quot;, inline: &quot;echo Hello&quot;

  config.vm.define &quot;web&quot; do |web|
    web.vm.box = &quot;apache&quot;
  end

  config.vm.define &quot;db&quot; do |db|
    db.vm.box = &quot;mysql&quot;
  end
end
</code></pre><p>As you can see, <code>config.vm.define</code> takes a block with another variable. This variable, such as <code>web</code> above, is the <em>exact</em> same as the <code>config</code> variable, except any configuration of the inner variable applies only to the machine being defined. Therefore, any configuration on <code>web</code> will only affect the <code>web</code> machine.</p><p>And importantly, you can continue to use the <code>config</code> object as well. The configuration object is loaded and merged before the machine-specific configuration, just like other Vagrantfiles within the <a href="./../../v2/vagrantfile/index.html#load-order">Vagrantfile load order</a>.</p><p>If you&#39;re familiar with programming, this is similar to how languages have different variable scopes.</p><h2>Controlling Multiple Machines</h2><p>The moment more than one machine is defined within a Vagrantfile, the usage of the various <code>vagrant</code> commands changes slightly. The change should be mostly intuitive.</p><p>Most commands, such as <code>vagrant up</code>, begin requiring the name of the machine to control. Using the example above, you could say <code>vagrant up web</code>, or <code>vagrant up db</code>. If no name is specified, it is assumed you mean to perform that operation on every machine. Therefore, <code>vagrant up</code> alone will bring up both the web and DB machine.</p><p>Additionally, you can specify a regular expression for matching only certain machines. This is useful in some cases where you specify many similar machines, for example if you&#39;re testing a distributed service you may have a <code>master</code> machine as well as a <code>slave0</code>, <code>slave1</code>, <code>slave2</code>, etc. If you want to bring up all the slaves but not the master, you can just do <code>vagrant up /slave[0-9]/</code>. If Vagrant sees a machine name within forward slashes, it assumes you&#39;re using a regular expression.</p><h2>Communication Between Machines</h2><p>In order to faciliate communication within machines in a multi-machine setup, the various <a href="./../../v2/networking/">networking</a> options should be used. In particular, the <a href="./../../v2/networking/private_network.html">private network</a> can be used to make a private network between multiple machines and the host.</p><h2>Specifying a Primary Machine</h2><p>You can also specify a <em>primary machine</em>. The primary machine will be the default machine used when a specific machine in a multi-machine environment is not specified.</p><p>To specify a default, machine, just mark it primary when defining it. Only one primary machine may be specified.</p><pre><code class="ruby">config.vm.define &quot;web&quot;, primary: true do |web|
  # ...
end
</code></pre></div></div></div></div></div></div><footer><div class=container><div class=row><div class=span12><ul class="unstyled footer-nav"><li><a href="//docs.vagrantup.com/">Documentation</a></li><li><a href="//www.vagrantup.com/about">About</a></li><li><a href="//www.vagrantup.com/support">Support</a></li><a href="//downloads.vagrantup.com/"><li class="button inline-button">Download</li></a></ul><ul class="unstyled logos"><a href="//www.vagrantup.com"><li class=vagrant-logo-monochrome></li></a><li><span>by</span></li><a href="//www.hashicorp.com"><li class="hashi-logo-monochrome "></li></a></ul></div></div><div class=row><h6 class=legal> &#169; 2013 HashiCorp </h6></div></div></footer></div><script>
			$(".big-background").backstretch("assets/photos/full_width.jpg");
		</script></body></html>
