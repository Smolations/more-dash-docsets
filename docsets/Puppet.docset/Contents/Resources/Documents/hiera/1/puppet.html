<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" xml:lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  	<title>Hiera 1: Using Hiera With Puppet &#8212; Documentation &#8212; Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom" />
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/" />
    <link rel="index" title="Puppet Labs Documentation" href="http://docs.puppetlabs.com" />
    <link rel="icon" href="./../../favicon.ico" />


  <meta name="description" content="Puppet can use Hiera to look up data. This helps you disentangle site-specific data from Puppet code, for easier code re-use and easier management ..." />



    <!-- FIXME: absolute paths -->

    <script type="text/javascript" src="./../../files/javascripts/html5.js"></script>
    <script type="text/javascript" src="./../../files/javascripts/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="./../../files/javascripts/drop_down.js"></script>
    <script type="text/javascript" src="./../../files/javascripts/cufon-yui.js"></script>
    <script type="text/javascript" src="./../../files/fonts/Klavika_400-Klavika_600.font.js"></script>
    <script type="text/javascript" src="./../../files/javascripts/ampersands.js"></script>
    <script type="text/javascript" src="./../../files/javascripts/navigation-accordion.js"></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/hiera/1/puppet.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/style.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/syntax.css" media="screen" /> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/adbanner.css" media="screen" />

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    

  	<script type="text/javascript"><![CDATA[
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	]]></script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css"><![CDATA[h1, h2{ visibility : hidden }]]></style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups &amp; DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          </li><li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class="children">
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Hiera 1: Using Hiera With Puppet</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Hiera 1: Using Hiera With Puppet</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#enabling-and-configuring-hiera-for-puppet">Enabling and Configuring Hiera for Puppet</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#puppet-3-and-newer">Puppet 3 and Newer</a></li>
   <li class="toc-lv3"><a href="#puppet-27">Puppet 2.7</a></li>
   <li class="toc-lv3"><a href="#older-versions">Older Versions</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-variables-passed-to-hiera">Puppet Variables Passed to Hiera</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#special-pseudo-variables">Special Pseudo-Variables</a></li>
   <li class="toc-lv3"><a href="#best-practices">Best Practices</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#automatic-parameter-lookup">Automatic Parameter Lookup</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#why">Why</a></li>
   <li class="toc-lv3"><a href="#limitations">Limitations</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#hiera-lookup-functions">Hiera Lookup Functions</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#using-the-lookup-functions-from-templates">Using the Lookup Functions From Templates</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#interacting-with-structured-data-from-hiera">Interacting With Structured Data from Hiera</a></li>
  <li class="toc-lv2"><a href="#assigning-classes-to-nodes-with-hiera-hierainclude">Assigning Classes to Nodes With Hiera (hiera_include)</a></li>
</ol></nav>

<p>Puppet can use Hiera to look up data. This helps you disentangle site-specific data from Puppet code, for easier code re-use and easier management of data that needs to differ across your node population.</p>

<h2 id="enabling-and-configuring-hiera-for-puppet">Enabling and Configuring Hiera for Puppet</h2>

<h3 id="puppet-3-and-newer">Puppet 3 and Newer</h3>

<p>Puppet 3.x and later ship with Hiera support already enabled. You don&#8217;t need to do anything extra. Hiera data should live on the puppet master(s).</p>

<ul>
  <li>Puppet expects to find the <a href="./configuring.html">hiera.yaml file</a> at <a href="./../../references/latest/configuration.html#confdir"><code>$confdir</code></a><code>/hiera.yaml</code> (usually <code>/etc/puppet/hiera.yaml</code>); you can change this with the <a href="./../../references/latest/configuration.html#hieraconfig"><code>hiera_config</code></a> setting.</li>
  <li>Remember to set the <a href="./configuring.html#datadir"><code>:datadir</code></a> setting for any backends you are using. It&#8217;s generally best to use something within the <code>/etc/puppet/</code> directory, so that the data is in the first place your fellow admins expect it.</li>
</ul>

<h3 id="puppet-27">Puppet 2.7</h3>

<p>You must install both Hiera and the <code>hiera-puppet</code> package on your puppet master(s) before using Hiera with Puppet. Hiera data should live on the puppet master(s).</p>

<ul>
  <li>Puppet expects to find the <a href="./configuring.html">hiera.yaml file</a> at <a href="./../../references/latest/configuration.html#confdir"><code>$confdir</code></a><code>/hiera.yaml</code> (usually <code>/etc/puppet/hiera.yaml</code>). This is not configurable in 2.7.</li>
  <li>Remember to set the <a href="./configuring.html#datadir"><code>:datadir</code></a> setting for any backends you are using. It&#8217;s generally best to use something within the <code>/etc/puppet/</code> directory, so that the data is in the first place your fellow admins expect it.</li>
</ul>

<h3 id="older-versions">Older Versions</h3>

<p>Hiera is not supported with older versions, but you may be able to make it work similarly to Puppet 2.7.</p>

<h2 id="puppet-variables-passed-to-hiera">Puppet Variables Passed to Hiera</h2>

<p>Whenever a Hiera lookup is triggered from Puppet, Hiera receives a copy of <strong>all</strong> of the variables currently available to Puppet, including both top scope and local variables.</p>

<p>Hiera can then use any of these variables in the <a href="./variables.html">variable interpolation tokens</a> scattered throughout its <a href="./hierarchy.html">hierarchy</a> and <a href="data_sources.html">data sources</a>. You can enable more flexible hierarchies by creating <a href="./../../guides/custom_facts.html">custom facts</a> for things like datacenter location and server purpose.</p>

<h3 id="special-pseudo-variables">Special Pseudo-Variables</h3>

<p>When doing any Hiera lookup, with both automatic parameter lookup and the Hiera functions, Puppet sets two variables that aren&#8217;t available in regular Puppet manifests:</p>

<ul>
  <li><code>calling_module</code> &#8212; The module in which the lookup is written. This has the same value as the <a href="./../../puppet/latest/reference/lang_variables.html#parser-set-variables">Puppet <code>$module_name</code> variable.</a></li>
  <li><code>calling_class</code> &#8212; The class in which the lookup is evaluated. If the lookup is written in a defined type, this is the class in which the current instance of the defined type is declared.</li>
</ul>

<blockquote>
  <p><strong>Note:</strong> These variables were broken in some versions of Puppet.</p>

  <ul>
    <li>Puppet 2.7.x: <strong>Good</strong></li>
    <li>Puppet 3.0.x and 3.1.x: <strong>Bad</strong></li>
    <li>Puppet 3.2.x and later: <strong>Good</strong></li>
  </ul>
</blockquote>

<h3 id="best-practices">Best Practices</h3>

<p><strong>Do not use local Puppet variables</strong> in Hiera&#8217;s hierarchy or data sources. Only use <a href="./../../puppet/latest/reference/lang_variables.html#facts-and-built-in-variables"><strong>facts</strong></a> and <strong>ENC-set top-scope variables.</strong> Use <a href="./../../puppet/latest/reference/lang_variables.html#accessing-out-of-scope-variables">absolute top-scope notation</a> (i.e. <code>%{::clientcert}</code> instead of <code>%{clientcert}</code>) in Hiera&#8217;s config files to avoid accidentally using a local variable instead of a top-scope one.</p>

<p>This is not a hard and fast rule, and there are some exceptions, but you&#8217;ll almost always regret breaking it. This is because the point of Hiera is to <strong>disentangle data from code,</strong> and enable node-specific hierarchical data that doesn&#8217;t rely on Puppet&#8217;s parse order.</p>

<p>If Hiera only relies on variables that are set <strong>before Puppet starts to parse its manifests,</strong> its data will be node-specific but static and reliable. This is good! It frees you from weird parse-order dependent bugs, makes it easier to test your data, and makes it easier to tell exactly what&#8217;s going to happen by looking at a given section of Puppet code.</p>

<p>On the other hand, making Hiera rely on local variables set by Puppet&#8217;s parser means you&#8217;re still fundamentally embedding data in your code, and will still have all of the problems Hiera is meant to solve.</p>

<p>Again, there are sometimes exceptions, but tread carefully.</p>

<h2 id="automatic-parameter-lookup">Automatic Parameter Lookup</h2>

<p>Puppet will automatically retrieve class parameters from Hiera, using lookup keys like <code>myclass::parameter_one</code>.</p>

<blockquote>
  <p><strong>Note:</strong> This feature only exists in Puppet 3 and later.</p>
</blockquote>

<p>Puppet <a href="./../../puppet/latest/reference/lang_classes.html">classes</a> can optionally include <a href="./../../puppet/latest/reference/lang_classes.html#class-parameters-and-variables">parameters</a> in their definition. This lets the class ask for data to be passed in at the time that it&#8217;s declared, and it can use that data as normal variables throughout its definition.</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># In this example, $parameter's value gets set when `myclass` is eventually declared.</span>
    <span class="c1"># Class definition:</span>
    <span class="k">class</span> <span class="n">myclass</span> <span class="p">(</span><span class="vg">$parameter_one</span> <span class="o">=</span> <span class="s2">"default text"</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">file</span> <span class="p">{</span><span class="s1">'/tmp/foo'</span><span class="p">:</span>
        <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="n">content</span> <span class="o">=&gt;</span> <span class="vg">$parameter_one</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Parameters can be set several ways, and Puppet will try each of these ways in order when the class is <a href="./../../puppet/latest/reference/lang_classes.html#declaring-classes">declared</a> or <a href="./../../puppet/latest/reference/lang_classes.html#assigning-classes-from-an-enc">assigned by an ENC</a>:</p>

<ol>
  <li>If it was a <a href="./../../puppet/latest/reference/lang_classes.html#using-resource-like-declarations">resource-like declaration/assignment</a>, Puppet will use any parameters that were explicitly set. These always win if they exist.</li>
  <li><strong>Puppet will automatically look up parameters in Hiera,</strong> using <code>&lt;CLASS NAME&gt;::&lt;PARAMETER NAME&gt;</code> as the lookup key. (E.g. <code>myclass::parameter_one</code> in the example above.)</li>
  <li>If 1 and 2 didn&#8217;t result in a value, Puppet will use the default value from the class&#8217;s <a href="./../../puppet/latest/reference/lang_classes.html#defining-classes">definition</a>. (E.g. <code>"default text"</code> in the example above.)</li>
  <li>If 1 through 3 didn&#8217;t result in a value, fail compilation with an error.</li>
</ol>

<p>Step 2 interests us most here. Because Puppet will always look for parameters in Hiera, you can safely declare <strong>any</strong> class with <code>include</code>, even classes with parameters. (This wasn&#8217;t the case in earlier Puppet versions.) Using the example above, you could have something like the following in your Hiera data:</p>

<div class="highlight"><pre><code class="yaml">    <span class="c1"># /etc/puppet/hieradata/web01.example.com.yaml</span>
    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">myclass::parameter_one</span><span class="p-Indicator">:</span> <span class="s">"This</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">special,</span><span class="nv"> </span><span class="s">so</span><span class="nv"> </span><span class="s">we're</span><span class="nv"> </span><span class="s">overriding</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">common</span><span class="nv"> </span><span class="s">configuration</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">nodes</span><span class="nv"> </span><span class="s">use."</span>

    <span class="c1"># /etc/puppet/hieradata/common.yaml</span>
    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">myclass::parameter_one</span><span class="p-Indicator">:</span> <span class="s">"This</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">standard</span><span class="nv"> </span><span class="s">configuration."</span>
</code></pre>
</div>

<p>You could then say <code>include myclass</code> for every node, and each node would get its own appropriate data for the class.</p>

<h3 id="why">Why</h3>

<p>Automatic parameter lookup is good for writing reusable code because it is <strong>regular and predictable.</strong> Anyone downloading your module can look at the first line of each manifest and easily see which keys they need to set in their own Hiera data. If you use the Hiera functions in the body of a class instead, you will need to clearly document which keys the user needs to set.</p>

<h3 id="limitations">Limitations</h3>

<h4 id="priority-only">Priority Only</h4>

<p>Automatic parameter lookup can only use the <a href="./lookup_types.html#priority-default">priority</a> lookup method.</p>

<p>This means that, although it <strong>can</strong> receive any type of data from Hiera (strings, arrays, hashes), it <strong>cannot</strong> merge values from multiple hierarchy levels; you will only get the value from the most-specific hierarchy level.</p>

<p>If you need to merge arrays or merge hashes from multiple hierarchy levels, you will have to use the <code>hiera_array</code> or <code>hiera_hash</code> functions in the body of your classes.</p>

<h4 id="no-puppet-27-support">No Puppet 2.7 Support</h4>

<p>Relying on automatic parameter lookup means writing code for Puppet 3 and later only.</p>

<p>You can, however, mimic Puppet 3 behavior in 2.7 by combining parameter defaults and Hiera function calls:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">myclass</span> <span class="p">(</span>
      <span class="vg">$parameter_one</span> <span class="o">=</span> <span class="n">hiera</span><span class="p">(</span><span class="s1">'myclass::parameter_one'</span><span class="p">,</span> <span class="s1">'default text'</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="c1"># ...</span>
    <span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>This pattern requires that 2.7 users have Hiera installed; it will fail compilation if the Hiera functions aren&#8217;t present.</li>
  <li>Since all of your parameters will have defaults, your class will be safely declarable with <code>include</code>, even in 2.7.</li>
  <li>Puppet 2.7 will do Hiera lookups for the same keys that Puppet 3 automatically looks up.</li>
  <li>Note that this carries a performance penalty, since Puppet 3 will end up doing two Hiera calls for each parameter instead of one.</li>
</ul>

<h2 id="hiera-lookup-functions">Hiera Lookup Functions</h2>

<p>Puppet has three lookup functions for retrieving data from Hiera. All of these functions return a single value (though note that this value may be an arbitrarily complex nested data structure), and can be used anywhere that Puppet accepts values of that type. (Resource attributes, resource titles, the values of variables, etc.)</p>

<dl>
  <dt><code>hiera</code></dt>
  <dd>Standard priority lookup. Gets the most specific value for a given key. This can retrieve values of any data type (strings, arrays, hashes) from Hiera.</dd>
  <dt><code>hiera_array</code></dt>
  <dd>Uses an <a href="./lookup_types.html#array-merge">array merge lookup</a>. Gets all of the string or array values in the hierarchy for a given key, then flattens them into a single array of unique values.</dd>
  <dt><code>hiera_hash</code></dt>
  <dd>Uses a <a href="./lookup_types.html#hash-merge">hash merge lookup</a>. Expects every value in the hierarchy for a given key to be a hash, and merges the top-level keys in each hash into a single hash. Note that this does not do a deep-merge in the case of nested structures.</dd>
</dl>

<p>Each of these functions takes three arguments. In order:</p>

<ol>
  <li>Key (required): the key to look up in Hiera.</li>
  <li>Default (optional): a fallback value to use if Hiera doesn&#8217;t find anything for that key. If this isn&#8217;t provided, a lookup failure will cause a compilation failure.</li>
  <li>Override (optional): the name of an arbitrary <a href="./hierarchy.html">hierarchy level</a> to insert at the top of the hierarchy. This lets you use a temporary modified hierarchy for a single lookup. (E.g., instead of a hierarchy of <code>$clientcert -&gt; $osfamily -&gt; common</code>, a lookup would use <code>specialvalues -&gt; $clientcert -&gt; $osfamily -&gt; common</code>; you would need to be sure to have <code>specialvalues.yaml</code> or whatever in your Hiera data.)</li>
</ol>

<h3 id="using-the-lookup-functions-from-templates">Using the Lookup Functions From Templates</h3>

<p>In general, don&#8217;t use the Hiera functions from templates. That pattern is too obscure, and will hurt your code&#8217;s maintainability &#8212; if a co-author of your code needs to change the Hiera invocations and is searching <code>.pp</code> files for them, they might miss the extra invocations in the template. Even if only one person is maintaining this code, they&#8217;re likely to make similar mistakes after a few months have passed.</p>

<p>It&#8217;s much better to use the lookup functions in a Puppet manifest, assign their value to a local variable, and then reference the variable from the template. This keeps the function calls isolated in one layer of your code, where they&#8217;ll be easy to find if you need to modify them later or document them for other users.</p>

<p>Nevertheless, you can, of course, <a href="./../../guides/templating.html#using-functions-within-templates">use the <code>scope.function_</code> prefix</a> to call any of the Hiera functions from a template.</p>

<h2 id="interacting-with-structured-data-from-hiera">Interacting With Structured Data from Hiera</h2>

<p>The lookup functions and the automatic parameter lookup always return the values of <strong>top-level keys</strong> in your Hiera data &#8212; they cannot descend into deeply nested data structures and return only a portion of them. To do this, you need to first store the whole structure as a variable, then index into the structure from your Puppet code or template.</p>

<p>Example:</p>

<div class="highlight"><pre><code class="yaml">    <span class="c1"># /etc/puppet/hieradata/appservers.yaml</span>
    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">proxies</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hostname</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lb01.example.com</span>
        <span class="l-Scalar-Plain">ipaddress</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">192.168.22.21</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hostname</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lb02.example.com</span>
        <span class="l-Scalar-Plain">ipaddress</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">192.168.22.28</span>
</code></pre>
</div>

<p>Good:</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># Get the structured data:</span>
    <span class="vg">$proxies</span> <span class="o">=</span> <span class="n">hiera</span><span class="p">(</span><span class="s1">'proxies'</span><span class="p">)</span>
    <span class="c1"># Index into the structure:</span>
    <span class="vg">$use_ip</span> <span class="o">=</span> <span class="vg">$proxies</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="s1">'ipaddress'</span><span class="o">]</span> <span class="c1"># will be 192.168.22.28</span>
</code></pre>
</div>

<p>Bad:</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># Try to skip a step, and give Hiera something it doesn't understand:</span>
    <span class="vg">$use_ip</span> <span class="o">=</span> <span class="n">hiera</span><span class="p">(</span> <span class="s1">'proxies'</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="s1">'ipaddress'</span><span class="o">]</span> <span class="p">)</span> <span class="c1"># will explode</span>
</code></pre>
</div>

<h2 id="assigning-classes-to-nodes-with-hiera-hierainclude">Assigning Classes to Nodes With Hiera (<code>hiera_include</code>)</h2>

<p>You can use Hiera to assign classes to nodes with the special <code>hiera_include</code> function. This lets you assign classes in great detail without repeating yourself &#8212; it&#8217;s essentially what people have traditionally tried and failed to use node inheritance for. It can get you the benefits of a rudimentary <a href="./../../guides/external_nodes.html">external node classifier</a> without having to write an actual ENC.</p>

<ol>
  <li>Choose a key name to use for classes. Below, we assume you&#8217;re just using <code>classes</code>.</li>
  <li>In your <a href="./../../puppet/latest/reference/lang_summary.html#files"><code>/etc/puppet/manifests/site.pp</code></a> file, write the line <code>hiera_include('classes')</code>. Put this <strong>outside any <a href="./../../puppet/latest/reference/lang_node_definitions.html">node definition</a>,</strong> and below any top-scope variables that you might be relying on for Hiera lookups.</li>
  <li>Create <code>classes</code> keys throughout your Hiera hierarchy.
    <ul>
      <li>The value of each <code>classes</code> key should be an <strong>array.</strong></li>
      <li>Each value in the array should be <strong>the name of a class.</strong></li>
    </ul>
  </li>
</ol>

<p>Once you do these steps, Puppet will automatically assign classes from Hiera to every node. Note that the <code>hiera_include</code> function uses an <a href="./lookup_types.html#array-merge">array merge lookup</a> to retrieve the <code>classes</code> array; this means every node will get <strong>every</strong> class from its hierarchy.</p>

<p>Example:</p>

<p>Assuming a hierarchy of:</p>

<div class="highlight"><pre><code class="yaml">    <span class="l-Scalar-Plain">:hierarchy</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">"%{::clientcert}"</span>
      <span class="p-Indicator">-</span> <span class="s">"%{::osfamily}"</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">common</span>
</code></pre>
</div>

<p>&#8230;and given Hiera data like the following:</p>

<div class="highlight"><pre><code class="yaml">    <span class="c1"># common.yaml</span>
    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">classes</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">base</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">security</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mcollective</span>

    <span class="c1"># Debian.yaml</span>
    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">classes</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">base::linux</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">localrepos::apt</span>

    <span class="c1"># web01.example.com</span>
    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">classes</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">apache</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">apache::passenger</span>
</code></pre>
</div>

<p>&#8230;the Ubuntu node <code>web01.example.com</code> would get all of the following classes:</p>

<ul>
  <li>apache</li>
  <li>apache::passenger</li>
  <li>base::linux</li>
  <li>localrepos::apt</li>
  <li>base</li>
  <li>security</li>
  <li>mcollective</li>
</ul>

<p>In Puppet 3, each of these classes would then automatically look up any required parameters in Hiera.</p>

              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">&#8593; Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">


<h2 id="hiera-1">Hiera 1</h2>

<ul>
  <li><a href="./index.html">Overview</a></li>
  <li><a href="./installing.html">Installation</a></li>
  <li><a href="./configuring.html">Configuration and hiera.yaml</a></li>
  <li><a href="./hierarchy.html">Hierarchies</a></li>
  <li><a href="./lookup_types.html">Lookup Types</a></li>
  <li><a href="./data_sources.html">Writing Data Sources</a></li>
  <li><a href="./variables.html">Variables and Interpolation</a></li>
  <li><span class="currentpage">Usage with Puppet</span></li>
  <li><a href="./complete_example.html">Complete Example</a></li>
  <li><a href="./command_line.html">Usage on the Command Line</a></li>
  <li><a href="./custom_backends.html">Writing New Backends</a></li>
</ul>


                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../images/smallbits_small_docs.png" alt="Puppet docs download" /></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo" /></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers &amp; consultants</a>
                  </p><p>
		</p><h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save" id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class="mktInput"><input class="mktFormText mktFormEmail" name="Email" id="Email" type="text" value="" maxlength="255" /><span class="mktFormMsg"></span></span>

				<input id="mktFrmSubmit" type="submit" class="btn" style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value="Subscribe" name="submitButton" onclick="formSubmit(document.getElementById(&quot;mktForm_1013&quot;)); return false;" />

				<input style="display: none;" id="mktFrmReset" type="reset" value="Clear" name="resetButton" onclick="formReset(document.getElementById(&quot;mktForm_1013&quot;)); return false;" />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&amp;kw={keyword}" />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/" />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/" />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript"><![CDATA[
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				]]></script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		</p><h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0" /></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0" /></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0" /></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0" /></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0" /></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0" /></a></li>
					</ul>

              	

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &#169; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript"><![CDATA[Cufon.now();]]></script>
  	<style type="text/css"><![CDATA[h1, h2, .btn { visibility : visible; }]]></style>


	</body>
</html>
