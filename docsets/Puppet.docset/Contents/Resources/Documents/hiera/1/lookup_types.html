<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Hiera 1: Lookup Types — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../../favicon.ico' />


  <meta name="description" content="Hiera always takes a lookup key and returns a single value (of some simple or complex data type), but it has several methods for extracting/assembl...">



    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/ampersands.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/navigation-accordion.js'></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/hiera/1/lookup_types.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Hiera 1: Lookup Types</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Hiera 1: Lookup Types</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#priority-default">Priority (default)</a></li>
  <li class="toc-lv2"><a href="#array-merge">Array Merge</a></li>
  <li class="toc-lv2"><a href="#hash-merge">Hash Merge</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#native-merging">Native Merging</a></li>
   <li class="toc-lv3"><a href="#deep-merging-in-hiera--120">Deep Merging in Hiera ≥ 1.2.0</a></li>
</ol></li>
</ol></nav>
              <p>Hiera always takes a lookup key and returns a single value (of some simple or complex data type), but it has several methods for extracting/assembling that one value from the hierarchy. We refer to these as &#8220;lookup methods.&#8221;</p>

<p>All of these lookup methods are available via Hiera&#8217;s Puppet functions, command line interface, and Ruby API.</p>

<h2 id="priority-default">Priority (default)</h2>

<p>A <strong>priority lookup</strong> gets a value from <strong>the</strong> most specific matching level of the hierarchy. Only one hierarchy level &#8212; the first one to match &#8212; is consulted.</p>

<p>Priority lookups can retrieve values of any data type (strings, arrays, hashes), but the entire value will come from only one hierarchy level.</p>

<p>This is Hiera&#8217;s default lookup method.</p>

<h2 id="array-merge">Array Merge</h2>

<p>An <strong>array merge lookup</strong> assembles a value from <strong>every</strong> matching level of the hierarchy. It retrieves <strong>all</strong> of the (string or array) values for a given key, then <strong>flattens</strong> them into a single array of unique values. If priority lookup can be thought of as a &#8220;default with overrides&#8221; pattern, array merge lookup can be though of as &#8220;default with additions.&#8221;</p>

<p>For example, given a hierarchy of:</p>

<pre><code>- web01.example.com
- common
</code></pre>

<p>&#8230;and the following data:</p>

<div class="highlight"><pre><code class="yaml">    <span class="c1"># web01.example.com.yaml</span>
    <span class="l-Scalar-Plain">mykey</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">one</span>

    <span class="c1"># common.yaml</span>
    <span class="l-Scalar-Plain">mykey</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">two</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">three</span>
</code></pre>
</div>

<p>&#8230;an array merge lookup would return a value of <code>[one, two, three]</code>.</p>

<p>In this version of Hiera, array merge lookups will fail with an error if any of the values found in the data sources are hashes. It only works with strings, string-like scalar values (booleans, numbers), and arrays.</p>

<h2 id="hash-merge">Hash Merge</h2>

<p>A <strong>hash merge lookup</strong> assembles a value from <strong>every</strong> matching level of the hierarchy. It retrieves <strong>all</strong> of the (hash) values for a given key, then <strong>merges</strong> the hashes into a single hash.</p>

<p>In Hiera 1.x, hash merge lookups will fail with an error if any of the values found in the data sources are strings or arrays. It only works when every value found is a hash.</p>

<h3 id="native-merging">Native Merging</h3>

<p>In Hiera 1.0 and 1.1, this is the only available kind of hash merging. In Hiera ≥ 1.2, deep merges are also available (see below).</p>

<p>In a native hash merge, Hiera merges only the <strong>top-level keys and values</strong> in each source hash. If the same key exists in both a lower priority source and a higher priority source, the higher priority value will be used.</p>

<p>For example, given a hierarchy of:</p>

<pre><code>- web01.example.com
- common
</code></pre>

<p>&#8230;and the following data:</p>

<div class="highlight"><pre><code class="yaml">    <span class="c1"># web01.example.com.yaml</span>
    <span class="l-Scalar-Plain">mykey</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">z</span><span class="p-Indicator">:</span> <span class="s">&quot;local</span><span class="nv"> </span><span class="s">value&quot;</span>

    <span class="c1"># common.yaml</span>
    <span class="l-Scalar-Plain">mykey</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">a</span><span class="p-Indicator">:</span> <span class="s">&quot;common</span><span class="nv"> </span><span class="s">value&quot;</span>
      <span class="l-Scalar-Plain">b</span><span class="p-Indicator">:</span> <span class="s">&quot;other</span><span class="nv"> </span><span class="s">common</span><span class="nv"> </span><span class="s">value&quot;</span>
      <span class="l-Scalar-Plain">z</span><span class="p-Indicator">:</span> <span class="s">&quot;default</span><span class="nv"> </span><span class="s">local</span><span class="nv"> </span><span class="s">value&quot;</span>
</code></pre>
</div>

<p>&#8230;a native hash merge lookup would return a value of <code>{z =&gt; "local value", a =&gt; "common value", b =&gt; "other common value"}</code>. Note that in cases where two or more source hashes share some keys, higher priority data sources in the hierarchy will override lower ones.</p>

<h3 id="deep-merging-in-hiera--120">Deep Merging in Hiera ≥ 1.2.0</h3>

<p>In Hiera 1.2.0 and later, you can also configure hash merge lookups to <strong>recursively merge</strong> hash keys. (Implemented as <a href="https://projects.puppetlabs.com/issues/16107">Issue 16107</a>.) This is intended for users who have moved complex data structures (such as <a href="./../../references/latest/function.html#createresources"><code>create_resources</code> hashes</a>) into Hiera.</p>

<p>To configure deep merging, use the <a href="./configuring.html#mergebehavior"><code>:merge_behavior</code> setting</a>, which can be set to <code>native</code>, <code>deep</code>, or <code>deeper</code>.</p>

<blockquote>
  <p>Limitations:</p>

  <ul>
    <li>This currently only works with the yaml and json backends.</li>
    <li>You must install the <code>deep_merge</code> Ruby gem for deep merges to work. If it isn&#8217;t available, Hiera will fall back to the default <code>native</code> merge behavior.</li>
    <li>This configuration is global, not per-lookup.</li>
  </ul>
</blockquote>

<h4 id="merge-behaviors">Merge Behaviors</h4>

<p>There are three merge behaviors available.</p>

<ul>
  <li>The default <code>native</code> type is described above under &#8220;Native Merging,&#8221; and matches what Hiera 1.0 and 1.1 do.</li>
  <li>The <code>deep</code> type is largely useless and should be avoided.</li>
  <li>The <code>deeper</code> type does a recursive merge, behaving as most users expect.</li>
</ul>

<p>In a <code>deeper</code> hash merge, Hiera <strong>recursively</strong> merges keys and values in each source hash. <strong>For each key,</strong> if the value is:</p>

<ul>
  <li><strong>&#8230;only present in one</strong> source hash, it goes into the final hash.</li>
  <li>&#8230;a <strong>string/number/boolean</strong> and exists in two or more source hashes, the <strong>highest priority</strong> value goes into the final hash.</li>
  <li>&#8230;an <strong>array</strong> and exists in two or more source hashes, the values from each source are <strong>merged</strong> into a single array and de-duplicated (but not automatically flattened, as in an array merge lookup).</li>
  <li>&#8230;a <strong>hash</strong> and exists in two or more source hashes, the values from each source are <strong>recursively merged,</strong> as though they were source hashes.</li>
  <li><strong>&#8230;mismatched</strong> between two or more source hashes, we haven&#8217;t validated the behavior. It should act as described in the <a href="https://github.com/peritor/deep_merge"><code>deep_merge</code> gem documentation</a>.</li>
</ul>

<p>In a <code>deep</code> hash merge, Hiera behaves as above, except that when a string/number/boolean exists in two or more source hashes, the <strong>lowest priority</strong> value goes into the final hash. As mentioned above, this is generally useless.</p>

<h4 id="example">Example</h4>

<p>A typical use case
for hashes in Hiera is building a data structure which gets passed to the
<code>create_resources</code> function. This example implements business rules that say:</p>

<ol>
  <li>user &#8216;jen&#8217; is defined only on the host &#8216;deglitch&#8217;</li>
  <li>user &#8216;bob&#8217; is defined everywhere, but has a different uid on &#8216;deglitch&#8217; than
he receives on other hosts.</li>
  <li>user &#8216;ash&#8217; is defined everywhere with a consistent uid and shell.</li>
</ol>

<p>In hiera.yaml, we set a two-level hierarchy:</p>

<div class="highlight"><pre><code class="yaml">    <span class="c1"># /etc/puppet/hiera.yaml</span>
    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">:backends</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">yaml</span>
    <span class="l-Scalar-Plain">:logger</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">puppet</span>
    <span class="l-Scalar-Plain">:hierarchy</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&quot;%{hostname}&quot;</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">common</span>
    <span class="l-Scalar-Plain">:yaml</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">:datadir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/etc/puppet/hieradata</span>
    <span class="c1"># options are native, deep, deeper</span>
    <span class="l-Scalar-Plain">:merge_behavior</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">deeper</span>
</code></pre>
</div>

<p>In common.yaml, we set up default users for all nodes:</p>

<div class="highlight"><pre><code class="yaml">    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">site_users</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">bob</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">uid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">501</span>
        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/bin/bash</span>
      <span class="l-Scalar-Plain">ash</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">uid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">502</span>
        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/bin/zsh</span>
        <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">common</span>
</code></pre>
</div>

<p>In deglitch.yaml, we set up node-specific user details for the deglitch.example.com:</p>

<div class="highlight"><pre><code class="yaml">    <span class="l-Scalar-Plain">---</span>
    <span class="l-Scalar-Plain">site_users</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">jen</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">uid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">503</span>
        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/bin/zsh</span>
        <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">deglitch</span>
      <span class="l-Scalar-Plain">bob</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">uid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1000</span>
        <span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">deglitch</span>
</code></pre>
</div>

<p>With a standard <code>native</code> hash merge, we would end up with a hash like the following:</p>

<div class="highlight"><pre><code class="ruby">    <span class="p">{</span>
      <span class="s2">&quot;bob&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;deglitch&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">1000</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="s2">&quot;jen&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;deglitch&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">503</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/zsh&quot;</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="s2">&quot;ash&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;common&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">502</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/zsh&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Notice that Bob is missing his shell &#8212; this is because the value of the top-level <code>bob</code> key from common.yaml was replaced entirely.</p>

<p>With a <code>deeper</code> hash merge, we would get a more intuitive behavior:</p>

<div class="highlight"><pre><code class="ruby">    <span class="p">{</span>
      <span class="s2">&quot;bob&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;deglitch&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/bash&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;jen&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;deglitch&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">503</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/zsh&quot;</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="s2">&quot;ash&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;common&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">502</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/zsh&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this case, Bob&#8217;s shell persists from common.yaml, but deglitch.yaml is allowed to override his uid and group, reducing the amount of data you have to duplicate between files.</p>

<p>With a <code>deep</code> merge, you would get:</p>

<div class="highlight"><pre><code class="ruby">    <span class="p">{</span>
      <span class="s2">&quot;bob&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;deglitch&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">501</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/bash&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;jen&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;deglitch&quot;</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/zsh&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">503</span>
      <span class="p">},</span>
      <span class="s2">&quot;ash&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
        <span class="n">group</span><span class="o">=&gt;</span><span class="s2">&quot;common&quot;</span><span class="p">,</span>
        <span class="n">uid</span><span class="o">=&gt;</span><span class="mi">502</span><span class="p">,</span>
        <span class="n">shell</span><span class="o">=&gt;</span><span class="s2">&quot;/bin/zsh&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this case, deglitch.yaml was able to set the group because common.yaml didn&#8217;t have a value for it, but where there was a conflict, like the uid, common won. Most users don&#8217;t want this.</p>

<p>Unfortunately none of these merge behaviors work with data bindings for automatic parameter lookup, because there&#8217;s no way to specify the lookup type. So instead of any of the above results, automatic data binding lookups will only see results from <code>deglitch.yaml</code>. See <a href="https://projects.puppetlabs.com/issues/20199">Bug #20199</a> to track progress on this.</p>


              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">


<h2 id="hiera-1">Hiera 1</h2>

<ul>
  <li><a href="./index.html">Overview</a></li>
  <li><a href="./installing.html">Installation</a></li>
  <li><a href="./configuring.html">Configuration and hiera.yaml</a></li>
  <li><a href="./hierarchy.html">Hierarchies</a></li>
  <li><span class="currentpage">Lookup Types</span></li>
  <li><a href="./data_sources.html">Writing Data Sources</a></li>
  <li><a href="./variables.html">Variables and Interpolation</a></li>
  <li><a href="./puppet.html">Usage with Puppet</a></li>
  <li><a href="./complete_example.html">Complete Example</a></li>
  <li><a href="./command_line.html">Usage on the Command Line</a></li>
  <li><a href="./custom_backends.html">Writing New Backends</a></li>
</ul>


                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>


	</body>
</html>
