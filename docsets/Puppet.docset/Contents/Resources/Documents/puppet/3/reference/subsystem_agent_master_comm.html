<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" xml:lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  	<title>Subsystems: Agent/Master HTTPS Communications &#8212; Documentation &#8212; Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom" />
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/" />
    <link rel="index" title="Puppet Labs Documentation" href="http://docs.puppetlabs.com" />
    <link rel="icon" href="./../../../favicon.ico" />


  <meta name="description" content="The puppet agent and the puppet master server communicate via HTTPS over host-verified SSL.  Note on verification: If the agent does not yet have i..." />



    <!-- FIXME: absolute paths -->

    <script type="text/javascript" src="./../../../files/javascripts/html5.js"></script>
    <script type="text/javascript" src="./../../../files/javascripts/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="./../../../files/javascripts/drop_down.js"></script>
    <script type="text/javascript" src="./../../../files/javascripts/cufon-yui.js"></script>
    <script type="text/javascript" src="./../../../files/fonts/Klavika_400-Klavika_600.font.js"></script>
    <script type="text/javascript" src="./../../../files/javascripts/ampersands.js"></script>
    <script type="text/javascript" src="./../../../files/javascripts/navigation-accordion.js"></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/puppet/3/reference/subsystem_agent_master_comm.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/style.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/syntax.css" media="screen" /> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/adbanner.css" media="screen" />

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    

  	<script type="text/javascript"><![CDATA[
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	]]></script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css"><![CDATA[h1, h2{ visibility : hidden }]]></style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups &amp; DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          </li><li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class="children">
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Subsystems: Agent/Master HTTPS Communications</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Subsystems: Agent/Master HTTPS Communications</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#diagram">Diagram</a></li>
  <li class="toc-lv2"><a href="#check-for-keys-and-certificates">Check for Keys and Certificates</a></li>
  <li class="toc-lv2"><a href="#obtain-a-certificate-if-necessary">Obtain a Certificate (if necessary)</a></li>
  <li class="toc-lv2"><a href="#request-node-object-and-switch-environments">Request Node Object and Switch Environments</a></li>
  <li class="toc-lv2"><a href="#fetch-plugins">Fetch Plugins</a></li>
  <li class="toc-lv2"><a href="#request-catalog-while-submitting-facts">Request Catalog While Submitting Facts</a></li>
  <li class="toc-lv2"><a href="#make-file-source-requests-while-applying-catalog">Make File Source Requests While Applying Catalog</a></li>
  <li class="toc-lv2"><a href="#submit-report">Submit Report</a></li>
</ol></nav>

<!-- TODO insert info about the CRL at the appropriate locations. Does the agent check it, these days? -->

<p>The puppet agent and the puppet master server communicate via HTTPS over host-verified SSL.</p>

<blockquote>
  <p><strong>Note on verification:</strong> If the agent does not yet have its own certificate, it will make several unverified requests before it can switch to verified mode. In these requests, the agent doesn&#8217;t identify itself to the master and doesn&#8217;t check the master&#8217;s cert against the CA. In the descriptions below, assume every request is host-verified unless stated otherwise.</p>
</blockquote>

<p>The agent/master HTTP interface is REST-like, but varies from strictly RESTful design in several ways. The endpoints used by the agent are detailed in the <a href="./../../../guides/rest_api.html">HTTP API reference</a>. Note that all HTTP endpoints are preceded by the environment being used. Note also that access to each individual endpoint is controlled by <a href="./../../../guides/rest_auth_conf.html">auth.conf</a> on the master.</p>

<h2 id="diagram">Diagram</h2>

<p>This flow diagram illustrates the pattern of agent-side checks and HTTPS requests to the puppet master during a single Puppet run.</p>

<p><a href="#check-for-keys-and-certificates">See below the image for a textual description of this process</a>, which explains the illustrated steps in more detail.</p>

<p><a href="./images/agent-master-https-sequence-large.gif"><img src="./images/agent-master-https-sequence-small.gif" alt="An illustration of the process described below -- this diagram contains no new content, but is simply a visual interpretation of everything from &quot;check for keys and certificates&quot; on down." /></a></p>

<h2 id="check-for-keys-and-certificates">Check for Keys and Certificates</h2>

<ol>
  <li>Does the agent have a private key at <code>$ssldir/private_keys/&lt;name&gt;.pem</code>?
    <ul>
      <li>If no, generate one.</li>
    </ul>
  </li>
  <li>Does the agent have a copy of the CA certificate at <code>$ssldir/certs/ca.pem</code>? <!-- TODO this might be out of order. -->
    <ul>
      <li>If no, fetch it. (Unverified GET request to <code>/certificate/ca</code>. Since the agent is retrieving the foundation for all future trust over an untrusted link, this could be vulnerable to MITM attacks, but it&#8217;s also just a convenience; you can make this step unnecessary by distributing the CA cert as part of your server provisioning process, so that agents never ask for a CA cert over the network. If you do this, an attacker could temporarily deny Puppet service to brand new nodes, but would be unable to take control of them with a rogue puppet master.)</li>
    </ul>
  </li>
  <li>Does the agent have a signed certificate at <code>$ssldir/certs/&lt;name&gt;.pem</code>?
    <ul>
      <li>If yes, skip the following section and continue to &#8220;request node object.&#8221;</li>
      <li>(If it has a cert but it doesn&#8217;t match the private key, bail with an error.)</li>
    </ul>
  </li>
</ol>

<h2 id="obtain-a-certificate-if-necessary">Obtain a Certificate (if necessary)</h2>

<p>Note that if the agent has submitted a certificate signing request, an admin user will need to run <code>puppet cert sign &lt;name&gt;</code> on the CA puppet master before the agent can fetch a signed certificate. (Unless autosign is enabled.) Since incoming CSRs are unverified, you can use fingerprints to prove them, by comparing <code>puppet agent --fingerprint</code> on the agent to <code>puppet cert list</code> on the CA master.</p>

<ol>
  <li>Try to fetch an already-signed certificate from the master. (Unverified GET request to <code>/certificate/&lt;name&gt;</code>.)
    <ul>
      <li>If it gets one, skip the rest of this section and continue to &#8220;request node object.&#8221;</li>
      <li>(If it gets one that doesn&#8217;t match the private key, bail with an error.)</li>
    </ul>
  </li>
  <li>Determine whether the agent has already requested a certificate signing: Look for <code>$ssldir/certificate_requests/&lt;name&gt;.pem</code>.
    <ul>
      <li>If this file exists, the agent will bail, assuming it needs user intervention on the master. If <code>waitforcert</code> is enabled, it will wait a few seconds and start this section over.</li>
    </ul>
  </li>
  <li>Double-check with the master whether the agent has already requested a certificate signing; the agent may have just lost the local copy of the request. (Unverified GET request to <code>/certificate_request/&lt;name&gt;</code>.)
    <ul>
      <li>If this request doesn&#8217;t 404, the agent will bail, assuming it needs user intervention on the master. If <code>waitforcert</code> is enabled, it will wait a few seconds and start this section over.</li>
    </ul>
  </li>
  <li>If the agent has reached this step, it has never requested a certificate, so request one now. (Unverified PUT request to <code>/certificate_request/&lt;name&gt;</code>.)</li>
  <li>Return to the first step of this section, in case the master has autosign enabled; if it doesn&#8217;t, the agent will end up bailing at step 2.</li>
</ol>

<h2 id="request-node-object-and-switch-environments">Request Node Object and Switch Environments</h2>

<ol>
  <li>Do a GET request to <code>/node/&lt;name&gt;</code>.
    <ul>
      <li>If successful, read the environment from the node object.
        <ul>
          <li>If the node object has one: In all subsequent requests during this run, use this environment instead of the one in the agent&#8217;s config file.</li>
        </ul>
      </li>
      <li>If unsuccessful, or if the node object had no environment set, continue using the environment from the agent&#8217;s config file.</li>
    </ul>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong> This step was added in Puppet 3.0.0, to allow an ENC to centrally assign nodes to environments. The lenient failure mode is because many users&#8217; <a href="./../../../guides/rest_auth_conf.html">auth.conf</a> files didn&#8217;t allow access to node objects, since that rule was only added to the default auth.conf in Puppet 2.7.0 and many people don&#8217;t update their config files for every upgrade.</p>
</blockquote>

<h2 id="fetch-plugins">Fetch Plugins</h2>

<p>If <code>pluginsync</code> is enabled on the agent:</p>

<ol>
  <li>Do a GET request to <code>/file_metadatas/plugins</code> with <code>recurse=true</code> and <code>links=manage</code>. This is a special file server mountpoint that scans the <code>lib</code> directory of every module. Note the funky Rails-esque endpoint pluralization on <code>file_metadata</code>.</li>
  <li>Check whether any of the discovered plugins need to be downloaded.
    <ul>
      <li>If so, do a GET request to <code>/file_content/plugins/&lt;file&gt;</code> for each one.</li>
    </ul>
  </li>
</ol>

<h2 id="request-catalog-while-submitting-facts">Request Catalog While Submitting Facts</h2>

<ol>
  <li>Do a POST request to <code>/catalog/&lt;name&gt;</code>, where the post data is all of the node&#8217;s <a href="./lang_variables.html#facts-and-built-in-variables">facts</a> encoded as JSON. Receive a compiled <a href="./lang_summary.html#compilation-and-catalogs">catalog</a> in return.</li>
</ol>

<blockquote>
  <p><strong>Note:</strong> This used to be a GET request with facts encoded as base64-encoded zlib-compressed JSON submitted as a URL parameter. This would sometimes cause failures with certain web servers and a large amount of facts, and was changed to a POST in Puppet 2.7.0. GETs should still work in Puppet 3 if something other than an agent tries one, but agents will use POSTs.</p>

  <p>Note also that submitting facts isn&#8217;t necessarily logically bound to requesting a catalog, and could be done out of band on a different schedule; this is just the way Puppet happens to do it, because the original design assumptions were that relevant facts could change at any moment and you&#8217;d always want to guarantee the most recent data. We&#8217;re experimenting with other ways, some of which might turn out to be better ideas.</p>
</blockquote>

<h2 id="make-file-source-requests-while-applying-catalog">Make File Source Requests While Applying Catalog</h2>

<p><a href="./../../../references/3.1.latest/type.html#file">File</a> resources can specify file contents as either a <code>content</code> or <code>source</code> attribute. Content attributes go into the catalog, and puppet agent needs no additional data. Source attributes only put references into the catalog, and may require additional HTTPS requests.</p>

<p>If you are using the normal compiler, then for each file source, puppet agent will:</p>

<ol>
  <li>Do a GET request to <code>/file_metadata/&lt;something&gt;</code>.</li>
  <li>Compare the metadata to the state of the file on disk.
    <ul>
      <li>If it is in sync, move on to the next file source.</li>
      <li>If it is out of sync, do a GET request to <code>/file_content/&lt;something&gt;</code> for the current content.</li>
    </ul>
  </li>
</ol>

<p>If you are using the <a href="./../../../references/3.1.latest/indirection.html#catalog">static compiler</a>, all file metadata is embedded in the catalog. For each file source, puppet agent will:</p>

<ol>
  <li>Compare the embedded metadata to the state of the file on disk.
    <ul>
      <li>If it is in sync, move on to the next file source.</li>
      <li>If it is out of sync, do a GET request to <code>/file_bucket_file/md5/&lt;checksum&gt;</code> for the current content.</li>
    </ul>
  </li>
</ol>

<p>Note that this is cheaper in terms of network traffic, but potentially more expensive during catalog compilation. Large amounts of files, especially recursive directories, will amplify the effect in both directions.</p>

<h2 id="submit-report">Submit Report</h2>

<p>If <code>report</code> is enabled on the agent:</p>

<ol>
  <li>Do a PUT request to <code>/report/&lt;name&gt;</code>. The content of the PUT should be a Puppet report object in YAML format.</li>
</ol>

<blockquote>
  <p><strong>Note:</strong> Yes, using PUT for this is not quite proper, but that&#8217;s how it was implemented. It may change in the future.</p>
</blockquote>

              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">&#8593; Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">



<h3 id="puppet-3-reference-manual">Puppet 3 Reference Manual</h3>

<p><a href="./index.html">Main Index</a></p>


<ul>
  <li><strong>Puppet 3 Overview</strong>
    <ul>
      <li><a href="./index.html">Introduction</a></li>
      <li><a href="./whats_new.html">What's New in Puppet 3</a></li>
      <li><a href="./release_notes.html">Puppet 3.x.x Release Notes</a></li>
      <li><a href="./system_requirements.html">System Requirements</a></li>
    </ul>
  </li>
  <li><strong>The Puppet Language</strong>
    <ul>
      <li><a href="./lang_visual_index.html">Visual Index</a></li>
      <li><a href="./lang_summary.html">Summary</a></li>
      <li><a href="./lang_reserved.html">Reserved Words and Allowed Names</a></li>
      <li><a href="./lang_resources.html">Resources</a></li>
      <li><a href="./lang_relationships.html">Relationships and Ordering</a></li>
      <li><a href="./lang_defaults.html">Resource Defaults</a></li>
      <li><a href="./lang_variables.html">Variables</a></li>
      <li><a href="./lang_scope.html">Scope</a></li>
      <li><a href="./lang_conditional.html">Conditional Statements</a></li>
      <li><a href="./lang_expressions.html">Expressions</a></li>
      <li><a href="./lang_functions.html">Functions</a></li>
      <li><a href="./lang_classes.html">Classes</a></li>
      <li><a href="./lang_defined_types.html">Defined Types</a></li>
      <li><a href="./lang_containment.html">Containment</a></li>
      <li><a href="./lang_namespaces.html">Namespaces and Autoloading</a></li>
      <li><a href="./lang_collectors.html">Resource Collectors</a></li>
      <li><a href="./lang_node_definitions.html">Node definitions</a></li>
      <li><a href="./lang_datatypes.html">Data Types</a></li>
      <li><a href="./lang_comments.html">Comments</a></li>
      <li><a href="./lang_virtual.html">Virtual Resources</a></li>
      <li><a href="./lang_exported.html">Exported Resources</a></li>
      <li><a href="./lang_tags.html">Tags</a></li>
      <li><a href="./lang_run_stages.html">Run Stages</a></li>
      <li><a href="./lang_import.html">Importing Manifest Files</a></li>
      <li><a href="./lang_experimental_3_2.html">Experimental Features: Puppet 3.2</a></li>
    </ul>
  </li>


  <li><strong>Modules</strong>
    <ul>
      <li><a href="./modules_fundamentals.html">Fundamentals</a></li>
      <li><a href="./../../../guides/plugins_in_modules.html">Plugins in Modules</a></li>
      <li><a href="./modules_installing.html">Installing Modules</a></li>
      <li><a href="./modules_publishing.html">Publishing Modules on the Puppet Forge</a></li>
      <li><a href="./modules_documentation.html">Module Documentation</a></li>
    </ul>
  </li>

  <li><strong>Configuration</strong>
    <ul>
      <li><a href="./config_ssl_external_ca.html">SSL: Using an External CA</a></li>
    </ul>
  </li>

  <li><strong>Data Formats</strong>
    <ul>
      <li><a href="./format_report.html">Report Format</a></li>
    </ul>
  </li>

  <li><strong>Puppet Subsystems</strong>
    <ul>
      <li><span class="currentpage">Agent/Master HTTPS Communications</span></li>
    </ul>
  </li>
  <li><strong>Generated References</strong>
    <ul>
      <li><a href="./../../../references/3.2.latest/type.html">Resource Types</a></li>
      <li><a href="./../../../references/3.2.latest/configuration.html">Configuration Settings</a></li>
      <li><a href="./../../../references/3.2.latest/function.html">Functions</a></li>
      <li><a href="./../../../references/3.2.latest/metaparameter.html">Metaparameters</a></li>
      <li><a href="./../../../references/3.2.latest/report.html">Report Handlers</a></li>
      <li><a href="./../../../references/3.2.latest/indirection.html">Indirections and Termini</a></li>
      <li><a href="./../../../references/3.2.latest/developer/index.html">Developer Documentation</a></li>
    </ul>
  </li>
  <li><strong>More Sections Coming Later</strong>
    <ul>
      <li><strong>Standard Puppet Operation</strong></li>
      <li><strong>Command Line Interface</strong></li>
      <li><strong>The Puppet Services</strong></li>
      <li><strong>Node Classification</strong></li>
      <li><strong>File Serving</strong></li>
      <li><strong>Resource Types and Providers</strong></li>
      <li><strong>SSL and Certificates</strong></li>
      <li><strong>Puppet Data Library</strong></li>
      <li><strong>Environments</strong></li>
      <li><strong>Configuring Puppet</strong></li>
      <li><strong>Internals</strong></li>
    </ul>
  </li>
</ul>



                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../../images/smallbits_small_docs.png" alt="Puppet docs download" /></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo" /></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers &amp; consultants</a>
                  </p><p>
		</p><h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save" id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class="mktInput"><input class="mktFormText mktFormEmail" name="Email" id="Email" type="text" value="" maxlength="255" /><span class="mktFormMsg"></span></span>

				<input id="mktFrmSubmit" type="submit" class="btn" style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value="Subscribe" name="submitButton" onclick="formSubmit(document.getElementById(&quot;mktForm_1013&quot;)); return false;" />

				<input style="display: none;" id="mktFrmReset" type="reset" value="Clear" name="resetButton" onclick="formReset(document.getElementById(&quot;mktForm_1013&quot;)); return false;" />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&amp;kw={keyword}" />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/" />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/" />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript"><![CDATA[
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				]]></script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		</p><h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0" /></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0" /></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0" /></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0" /></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0" /></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0" /></a></li>
					</ul>

              	

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &#169; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript"><![CDATA[Cufon.now();]]></script>
  	<style type="text/css"><![CDATA[h1, h2, .btn { visibility : visible; }]]></style>


	</body>
</html>
