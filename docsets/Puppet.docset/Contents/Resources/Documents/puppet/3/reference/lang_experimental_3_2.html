<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Language: Experimental Features (Puppet 3.2) — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../../../favicon.ico' />


  <meta name="description" content="Background: The Puppet &#8220;Future&#8221; ParserStarting with Puppet 3.2, you can set parser = future in puppet.conf to enable experimental new l...">



    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../../../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../../../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/ampersands.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/navigation-accordion.js'></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/puppet/3/reference/lang_experimental_3_2.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Language: Experimental Features (Puppet 3.2)</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Language: Experimental Features (Puppet 3.2)</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#background-the-puppet-future-parser">Background: The Puppet &#8220;Future&#8221; Parser</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#requirements">Requirements</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#scope-of-this-document">Scope of This Document</a></li>
  <li class="toc-lv2"><a href="#collection-manipulation-and-iteration">Collection Manipulation and Iteration</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#lambdas">Lambdas</a></li>
   <li class="toc-lv3"><a href="#available-functions">Available Functions</a></li>
   <li class="toc-lv3"><a href="#chaining-functions">Chaining Functions</a></li>
   <li class="toc-lv3"><a href="#learning-more-about-the-iteration-functions">Learning More About the Iteration Functions</a></li>
   <li class="toc-lv3"><a href="#alternative-syntax-for-lambdas">Alternative Syntax for Lambdas</a></li>
   <li class="toc-lv3"><a href="#lambda-scope">Lambda Scope</a></li>
   <li class="toc-lv3"><a href="#calls-with-lambdas">Calls with Lambdas</a></li>
   <li class="toc-lv3"><a href="#statements-in-a-lambda-body">Statements in a Lambda Body</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#other-changes">Other Changes</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#new-language-features">New Language Features</a></li>
   <li class="toc-lv3"><a href="#additional-restrictions-and-error-reporting">Additional Restrictions and Error Reporting</a></li>
</ol></li>
</ol></nav>

<h2 id="background-the-puppet-future-parser">Background: The Puppet &#8220;Future&#8221; Parser</h2>

<p>Starting with Puppet 3.2, you can set <code>parser = future</code> in puppet.conf to enable experimental new language features, which may or may not be included in a future Puppet version.</p>

<p>We&#8217;re doing this to get early feedback on potential features without imposing heavy requirements on people who might want to test them. You can start testing future features with the normal release of Puppet, just by changing a setting.</p>

<p>Under the hood, the &#8220;future&#8221; parser is a ground-up reimplementation of the Puppet grammar. This replacement parser is separate from the specific new features being enabled, and allows us to implement <em>many</em> things that would have been difficult or impossible before. It will eventually replace the current parser entirely, although this won&#8217;t happen until a major release boundary.</p>

<p>In addition to the experimental features, the &#8220;future&#8221; parser makes some other changes and clean-ups to the language. These improvements are shown in the &#8220;Other Changes&#8221; section of this page.</p>

<h3 id="requirements">Requirements</h3>

<p>To enable everything described in this document:</p>

<ul>
  <li>Use Puppet 3.2.x. This isn&#8217;t available in prior versions.</li>
  <li>Install the <code>rgen</code> gem. If you installed Puppet from the official packages, this was already installed as a dependency; otherwise, you may need to install it manually.</li>
  <li>On your puppet master(s), set <a href="./../../../references/latest/configuration.html#parser"><code>parser = future</code></a>in the <code>[master]</code> block of puppet.conf. (In a masterless &#8220;puppet apply&#8221; deployment, set this in the <code>[main]</code> block on every node.)
    <ul>
      <li>Alternately, you can set <code>--parser future</code> on the command line when running puppet apply.</li>
    </ul>
  </li>
</ul>

<h2 id="scope-of-this-document">Scope of This Document</h2>

<p>This page describes the experimental parser features in Puppet 3.2, which includes support for <em>iteration</em> and <em>enumerables.</em></p>

<p>This page is user-oriented (in contrast to the technical background information found in <a href="https://github.com/puppetlabs/armatures/tree/master/arm-2.iteration">ARM-2.Iteration</a>), and offers an introduction to iteration in Puppet and lambdas. It also presents differences in the experimental parser compared to Puppet 3.</p>

<p>This experimental feature set implements several alternative syntaxes. The intent is to study which of these alternatives is most liked and should go into an official release. The introductions and examples are written in the recommended style as described in <a href="https://github.com/puppetlabs/armatures/tree/master/arm-2.iteration">ARM-2.iteration</a>. Alternatives are shown in a separate section.</p>

<h2 id="collection-manipulation-and-iteration">Collection Manipulation and Iteration</h2>

<p>This experimental feature set contains support for iteration and enumerables via an extension to the language known as <em>lambdas</em>.</p>

<ul>
  <li>For a demonstration with context, <a href="https://github.com/hlindberg/puppet-network/commit/b1665a2da730e31b76a9230796510d01e6a626d7">see this revision of the puppet-network module</a> (<a href="https://github.com/hlindberg/puppet-network">GitHub home</a> for the revised module)</li>
</ul>

<h3 id="lambdas">Lambdas</h3>

<p>A Lambda can be thought of as <em>parameterized code blocks;</em> a block of code that has parameters and can be invoked/called with arguments. A single lambda can be passed to a function (such as the iteration function <code>each</code>).</p>

<pre><code>$a = [1,2,3]
each($a) |$value| { notice $value }
</code></pre>

<p>We can try this on the command line:</p>

<pre><code>puppet apply --parser future -e '$a=[1,2,3] each($a) |$value|{ notice $value }'
Notice: Scope(Class[main]): 1
Notice: Scope(Class[main]): 2
Notice: Scope(Class[main]): 3
Notice: Finished catalog run in 0.12 seconds
</code></pre>

<p>Let&#8217;s look at what we just did:</p>

<ul>
  <li>We used <code>puppet apply</code> and passed the <code>--parser future</code> option to get the experimental parser, as <a href="#requirements">described above.</a> (All examples below assume this is set in <code>puppet.conf</code>).</li>
  <li>We called a function called <code>each</code></li>
  <li>We passed an <a href="./../../../puppet/3/reference/lang_datatypes.html#arrays">array</a> to it as an argument</li>
  <li>After the list of arguments we gave it a <em>lambda</em>:
    <ul>
      <li>The lambda&#8217;s parameters are declared within <em>pipes</em> (<code>|</code>) (just like parameters are specified for a define).</li>
      <li>We declared the lambda to have one parameter, and we named it <code>$value</code> (we could have called it whatever we wanted; <code>$x</code>, or <code>$a_unicorn</code>, etc.)</li>
      <li>The lambdas body is enclosed in braces <code>{ }</code>, where you can place any puppet logic except class, define, or node statements.</li>
    </ul>
  </li>
</ul>

<h3 id="available-functions">Available Functions</h3>

<p>You have already seen the iteration function <code>each</code> (there is more to say about it), but before going into details, meet the entire family of iteration functions.</p>

<ul>
  <li><code>each</code> (also available as <code>foreach</code>) &#8212; iterates over each element of an array or hash</li>
  <li><code>collect</code> &#8212; transforms an array or a hash into a new Array</li>
  <li><code>select</code> &#8212; filters an array or hash (include elements for which lambda returns true)</li>
  <li><code>reject</code> &#8212; filters an array or hash (exclude elements for which lambda returns true)</li>
  <li><code>reduce</code> &#8212; reduces an array or hash to a single value which is computed by the lambda</li>
  <li><code>slice</code> &#8212; slices an array or hash into chunks and feeds each result to a lambda</li>
</ul>

<p>The function <code>each</code> (AKA <code>foreach</code>) calls a lambda with one or two arguments (depending on how many are used in the lambda parameters).</p>

<p><strong>For an array:</strong></p>

<p>If one parameter is used, it will be set to the value of each element. If two parameters are used, they will be set to the index and value of each element.</p>

<p><strong>For a hash:</strong></p>

<p>If two parameters are used, they will be set to the key and value of each hash entry. If one parameter is used, it is set to an array containing <code>[key, value]</code>.</p>

<p>Using a similar example as before, but now with two parameters, we get:</p>

<pre><code>user$ puppet apply -e '$a  = ['a','b','c'] each($a) |$index, $value| { notice "$index = $value" }'
Notice: Scope(Class[main]): 0 = a
Notice: Scope(Class[main]): 1 = b
Notice: Scope(Class[main]): 2 = c
</code></pre>

<p>The remaining functions also operate on arrays and hashes, and always convert hash entries to an array of <code>[key, value]</code>.</p>

<p>Here are some examples to illustrate:</p>

<pre><code>select([1,20,3]) |$value| { $value &lt; 10 }
# produces [1,3]

reject([1,20,3]) |$value| { $value &gt;= 10 }
# produces [1,3]

reduce([1,2,3]) |$result, $value|  { $result + $value }
# produces: 6

slice(['fred', 10, 'mary', 20], 2) |$name, $val| { notice "$name = $val" }
# results in the following output
Notice: Scope(Class[main]): fred = 10
Notice: Scope(Class[main]): mary = 20
</code></pre>

<h3 id="chaining-functions">Chaining Functions</h3>

<p>You can chain function calls from left to right. And a chain may be as short as a single step.</p>

<p>The examples you have seen can be written like this:</p>

<pre><code>[1,2,3].each |$index, $value| { notice "$index = $value" }'

[1,20,3].select |$value| { $value &lt; 10 }

[1,20,3].reject() |$value| { $value &gt;= 10 }

[1,2,3].reduce |$result, $value|  { $result + $value }

['fred', 10, 'mary', 20].slice(2) |$name, $val| { notice "$name = $val" }
</code></pre>

<p>And then let&#8217;s chain these:</p>

<pre><code>[1,20,3].select |$value| {$value &lt; 10 }.each |$value| { notice $value }
# produces the output
Notice: Scope(Class[main]): 1
Notice: Scope(Class[main]): 3
</code></pre>

<p>Note: It is possible to chain functions that produce a value (which includes the iteration functions, but not functions like <code>notice</code>).</p>

<h3 id="learning-more-about-the-iteration-functions">Learning More About the Iteration Functions</h3>

<p>The functions are documented as all other functions and this documentation is available in arm-2.iteration <a href="https://github.com/puppetlabs/armatures/blob/master/arm-2.iteration/iteration.md#functions-for-iteration-and-transformation">&#8220;Functions for iteration and transformation&#8221;</a>.</p>

<p>Here is the <a href="https://github.com/puppetlabs/armatures/blob/master/arm-2.iteration/index.md">Index of arm-2</a> if you want to read all the details, alternatives, and what has been considered so far.</p>

<h3 id="alternative-syntax-for-lambdas">Alternative Syntax for Lambdas</h3>

<p>ARM-2 proposes alternatives to the syntax that are implemented in the experimental version. The alternative syntaxes for lambdas are an experiment to see which one is found to be most understandable to users.</p>

<pre><code># Alternative 0 (as shown): Parameters are outside the lambda block.
[1,2,3].each |$value| { notice $value }

# Alternative 1: Parameters are inside the lambda block.
[1,2,3].each { |$value| notice $value }

# Alternative 2: A fat arrow is placed after the parameters.
[1,2,3].each |$value| =&gt; { notice $value }
</code></pre>

<p><a href="https://github.com/puppetlabs/armatures/tree/master/arm-2.iteration">ARM-2</a> also proposes a completely different way of  manipulating data based on the notion of unix pipes; please refer to <a href="https://github.com/puppetlabs/armatures/tree/master/arm-2.iteration">ARM-2</a> for the details of this alternative. It is also based on lambdas, but with slightly different syntax. The pipe syntax proposal has not been implemented.</p>

<h3 id="lambda-scope">Lambda Scope</h3>

<p>When a lambda is evaluated, this takes place in a <em>local scope</em> that shadows outer scopes. Each invocation of a lambda sets up a fresh local scope. The variables assigned (and the lambda parameters) are immutable once assigned, and they can not be referenced from code outside of the lambda block. The lambda block may however use variables visible in the scope where the lambda is given, as in this example:</p>

<pre><code>$names = [fred, mary]
[1,2].each |$x| { notice "$i is called ${names[$x]}"}
</code></pre>

<h3 id="calls-with-lambdas">Calls with Lambdas</h3>

<p>You can place a lambda after calls on these forms:</p>

<pre><code>each($x)  |$value| { … }
$x.each   |$value| { … }
$x.each() |$value| { … }

slice($x, 2) |$value| { … }
$x.slice(2)  |$value| { … }
</code></pre>

<p>But these are <em>illegal</em>:</p>

<pre><code>each $x |$value| { … }
slice $x, 2 |$value| { … }
$z = |$value| { … }
</code></pre>

<h3 id="statements-in-a-lambda-body">Statements in a Lambda Body</h3>

<p>The statements in a lambda body can be anything legal in Puppet except definition of classes, resource types (i.e. &#8216;define&#8217;), or nodes. This is the same rule as for any conditional construct in Puppet.</p>

<h2 id="other-changes">Other Changes</h2>

<p>In re-implementing a parser for the puppet language, there are a few changes to the language itself that were made. Some of the changes are to enforce restrictions which were suppose to be there in the first place, whereas other changes were to update the language to be able to support lambdas in a meaningful way (this takes more than you might at first think).</p>

<h3 id="new-language-features">New Language Features</h3>

<p>Several new features have been added to the language in the course of re-implementing and re-examining what was there.</p>

<h4 id="expressions-are-now-valid-statements">Expressions Are Now Valid Statements</h4>

<p>In Puppet 3 it is not possible to have a body of code that is just an expression. This makes it</p>

<p>difficult to enter predicates as in the case of a collect or reject.</p>

<p>An expression such as&#8230;</p>

<pre><code>1 + 2
</code></pre>

<p>&#8230;is now a legal statement if it appears as the last &#8220;statement&#8221; in a block. Block &#8220;return&#8221; their last expression/statement as its produced result. There is no explicit &#8220;return&#8221;, it is always the value of the last evaluated expression.</p>

<h4 id="arrays-and-hashes-are-now-allowed-everywhere">Arrays and Hashes Are Now Allowed &#8220;Everywhere&#8221;</h4>

<p>In Puppet 3. if you wanted to operate on a literal array or hash, you typically had to assign it to a variable first. This was due to how the internal grammar for the language was organized. You can now use literal arrays and hashes more naturally in a puppet manifest.</p>

<pre><code>notice([1, 2][1])
# produces the output
Notice: Scope(Class[main]): 2
</code></pre>

<h4 id="concatenation-and-append">Concatenation and Append</h4>

<p>You can concatenate array and merge hashes with <code>+</code></p>

<pre><code>[1,2,3] + [4,5,6]   # produces [1,2,3,4,5,6]
{a =&gt; 1} + {b =&gt; 2} # produces {a=&gt;1, b=&gt;2 }
</code></pre>

<p>You can append to an array with <code>&lt;&lt;</code></p>

<pre><code>[1,2,3] &lt;&lt; 10 # produces [1,2,3,10]
[1,2,3] &lt;&lt; [4,5] # produces [1,2,3,[4,5]]
</code></pre>

<h4 id="a-semicolon-acts-as-an-optional-expression-separator">A Semicolon Acts as an Optional Expression Separator</h4>

<p>There is one corner case in the expression based grammar that required an expression separator <code>;</code> to be added. It can optionally be used to increase readability in one-liners.</p>

<pre><code>$a = 1; $b = 10
</code></pre>

<p>Which naturally also is legal without the semicolon.</p>

<p>The separator becomes important when you want to end a block with a literal array or hash, and when they would alter the meaning of the <em>preceding</em> operand. (This example makes use of <code>+</code> to concatenate two arrays)</p>

<pre><code>{ $x = [[1],[2],[3]]
  $a = [a] + $x[1]
}
# Results in $a being assigned [a,2], and this is also the value
# returned by the block
</code></pre>

<p>is very different from:</p>

<pre><code>{ $x = [[1],[2],[3]]
  $a = [a] + $x; [1]
}
# Results in $a being assigned to [a, [1],[2],[3]] and the
# result of the block (which is returned) is [1]
</code></pre>

<h4 id="functions-that-produce-a-value-may-be-invoked-as-statements">Functions That Produce a Value May Be Invoked as Statements</h4>

<p>It is harmless to call a function that produce a value and not use the returned value. Puppet 3 forbids this and raises an error. With the entry of iteration functions (which always return a value, but may be used for only the side effects) this was made impossible by Puppet 3&#8217;s separation of function (returning a value) and procedure (returning nothing).</p>

<h4 id="right-side-of-matches-may-be-a-string-unfinished">Right Side of Matches May Be a String (unfinished)</h4>

<p>It is allowed to have a string instead of a regular expression in matches expressions. The intent is to support variable interpolation in these strings before they are converted to regular expressions. This is unfinished, and will currently result in an error when evaluated (instead of when parsed).</p>

<h4 id="unless-with-else-supported">Unless with Else Supported</h4>

<p>An <code>unless</code> can now have an <code>else</code> clause (but it cannot be combined with an <code>elsif</code>).</p>

<p>While not being recommended to use complex logic in <code>unless</code>, it is at the same time quite annoying to have to reverse tests in order to be able to do something like a notice &#8220;unless not triggered&#8221; for debugging.</p>

<h4 id="chained-assignments">Chained Assignments</h4>

<p>Chained assignments are now possible for both <code>=</code>, and <code>+=</code>.</p>

<pre><code>$a = $b = 10
</code></pre>

<p>Note that <code>=</code> and <code>+=</code> have low precedence, so this is an error:</p>

<pre><code>$a = 1 + $b = 10 # i.e. this is parsed as $a = (1 + $b) = 10
</code></pre>

<p>and needs to be written</p>

<pre><code>$a = 1 + ($b = 10)
</code></pre>

<p>Assignments may thus also be used where expressions are.</p>

<h4 id="function-calls-in-interpolation-supported">Function Calls in Interpolation Supported</h4>

<p>Calling a function in interpolation now works:</p>

<pre><code>notice "This is a random number: ${fqdn_rand(30)}
</code></pre>

<p>This has mysterious result in the regular parser since it is interpreted as</p>

<pre><code>${$fqdn_rand(30)}
</code></pre>

<h3 id="additional-restrictions-and-error-reporting">Additional Restrictions and Error Reporting</h3>

<p>The new parser structure also allowed us to revisit some of the features of the language and remove some things that might have been causing problems. It also allows for better error reporting in many cases.</p>

<h4 id="user-defined-numeric-variables-not-allowed">User Defined Numeric Variables Not Allowed</h4>

<p>Assignments to numeric variables are flagged as errors.</p>

<p>This is illegal:</p>

<pre><code>$3 = 'hello'
</code></pre>

<p>In some puppet versions this produces strange effects, and in some it is silently ignored.</p>

<p>As a consequence it is also illegal to name parameters in defines, and parameterized classes with numeric names.</p>

<p>This is illegal:</p>

<pre><code>define mytype ($1, $2) { … }
</code></pre>

<p>It is ok to use names with digits 0-9 as long as one character is not a digit.</p>

<h4 id="bare-words-may-not-start-with-a-digit">&#8220;Bare Words&#8221; May Not Start with a Digit</h4>

<p>The positive effect of this is that numbers entered without quotes can be validated to be correct decimal, hex or octal values.</p>

<h4 id="numbers-are-validated-if-entered-without-quotes">Numbers Are Validated If Entered without Quotes</h4>

<p>If you enter an unquoted number in decimal, hex or octal it is now validated, and an error is raised if it is illegal.</p>

<p>These will raise errors:</p>

<pre><code>$a = 0x0EH
$b = 0778
</code></pre>

<h4 id="many-errors-now-contain-position-on-line">Many Errors Now Contain Position on Line</h4>

<p>If available, errors now output position on the line. This helps for errors related to punctuation such as <code>{</code> since it may appear several times on a line and the problem may be hard to find/understand. (This problem was made worse with the addition of lambdas to the language since they are typically entered as one-liners).</p>

<p>The output is: <code>filename:line:pos</code></p>

<p>Pos is never displayed without a line, if you see <code>file:3</code>, it is a reference to the line.</p>

<p>Position starts from 1 (first character on a line is in position 1).</p>

<h4 id="odd-expected-errors-fixed">Odd &#8220;Expected&#8221; Errors Fixed</h4>

<p>When there is a syntax errors involving a token that is paired (e.g. <code>{</code>, <code>(</code>, <code>[</code>), the error message always said &#8220;<code>expected ...</code>&#8221; and it showed the matching side of the violating token. This is only correct if the problem is reaching EOF. In all other cases this information was misleading, adding what was suggested would almost always make things worse.</p>

<p>The &#8220;expected&#8221; is now only included when encountering the end of file and there are outstanding expectations (such as terminating an open string).</p>

<h4 id="error-and-warning-feedback">Error and Warning Feedback</h4>

<p>Error and Warning feedback from parsing now outputs multiple errors / warnings (if multiple were found before lower level parsing gave up). The default cap on output of these are 10. The number can be changed via the settings:</p>

<pre><code>max_errors
max_warnings
max_deprecations
</code></pre>

<p>When there are multiple errors, the output emits errors up to the cap. A final error is then generated with the error and warning count. If there is only one error, only this error is emitted (no count). Deprecations count as warnings.</p>

<p>As an example, you can try this:</p>

<pre><code>puppet apply --parser future -e '$a = node "a+b" { }'
Error: Invalid use of expression. A Node Definition does not produce a value at line 1:6
Error: The hostname 'a+b' contains illegal characters (only letters, digits, '_', '-', and '.' are allowed) at line 1:11
Error: Classes, definitions, and nodes may only appear at toplevel or inside other classes at line 1:6
Error: Could not parse for environment production: Found 3 errors. Giving up on node henriks-macbook-pro.local
</code></pre>

<h4 id="fat-arrow-as-comma-is-not-supported">Fat Arrow as Comma Is Not Supported</h4>

<p>In the 3 parser, it is allowed to use a fat arrow <code>=&gt;</code> instead of a comma in many places. This undocumented feature is removed in the experimental parser.</p>

              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">



<h3 id="puppet-3-reference-manual">Puppet 3 Reference Manual</h3>

<p><a href="./index.html">Main Index</a></p>


<ul>
  <li><strong>Puppet 3 Overview</strong>
    <ul>
      <li><a href="./index.html">Introduction</a></li>
      <li><a href="./whats_new.html">What's New in Puppet 3</a></li>
      <li><a href="./release_notes.html">Puppet 3.x.x Release Notes</a></li>
      <li><a href="./system_requirements.html">System Requirements</a></li>
    </ul>
  </li>
  <li><strong>The Puppet Language</strong>
    <ul>
      <li><a href="./lang_visual_index.html">Visual Index</a></li>
      <li><a href="./lang_summary.html">Summary</a></li>
      <li><a href="./lang_reserved.html">Reserved Words and Allowed Names</a></li>
      <li><a href="./lang_resources.html">Resources</a></li>
      <li><a href="./lang_relationships.html">Relationships and Ordering</a></li>
      <li><a href="./lang_defaults.html">Resource Defaults</a></li>
      <li><a href="./lang_variables.html">Variables</a></li>
      <li><a href="./lang_scope.html">Scope</a></li>
      <li><a href="./lang_conditional.html">Conditional Statements</a></li>
      <li><a href="./lang_expressions.html">Expressions</a></li>
      <li><a href="./lang_functions.html">Functions</a></li>
      <li><a href="./lang_classes.html">Classes</a></li>
      <li><a href="./lang_defined_types.html">Defined Types</a></li>
      <li><a href="./lang_containment.html">Containment</a></li>
      <li><a href="./lang_namespaces.html">Namespaces and Autoloading</a></li>
      <li><a href="./lang_collectors.html">Resource Collectors</a></li>
      <li><a href="./lang_node_definitions.html">Node definitions</a></li>
      <li><a href="./lang_datatypes.html">Data Types</a></li>
      <li><a href="./lang_comments.html">Comments</a></li>
      <li><a href="./lang_virtual.html">Virtual Resources</a></li>
      <li><a href="./lang_exported.html">Exported Resources</a></li>
      <li><a href="./lang_tags.html">Tags</a></li>
      <li><a href="./lang_run_stages.html">Run Stages</a></li>
      <li><a href="./lang_import.html">Importing Manifest Files</a></li>
      <li><span class="currentpage">Experimental Features: Puppet 3.2</span></li>
    </ul>
  </li>


  <li><strong>Modules</strong>
    <ul>
      <li><a href="./modules_fundamentals.html">Fundamentals</a></li>
      <li><a href="./../../../guides/plugins_in_modules.html">Plugins in Modules</a></li>
      <li><a href="./modules_installing.html">Installing Modules</a></li>
      <li><a href="./modules_publishing.html">Publishing Modules on the Puppet Forge</a></li>
      <li><a href="./modules_documentation.html">Module Documentation</a></li>
    </ul>
  </li>

  <li><strong>Configuration</strong>
    <ul>
      <li><a href="./config_ssl_external_ca.html">SSL: Using an External CA</a></li>
    </ul>
  </li>

  <li><strong>Data Formats</strong>
    <ul>
      <li><a href="./format_report.html">Report Format</a></li>
    </ul>
  </li>

  <li><strong>Puppet Subsystems</strong>
    <ul>
      <li><a href="./subsystem_agent_master_comm.html">Agent/Master HTTPS Communications</a></li>
    </ul>
  </li>
  <li><strong>Generated References</strong>
    <ul>
      <li><a href="./../../../references/3.2.latest/type.html">Resource Types</a></li>
      <li><a href="./../../../references/3.2.latest/configuration.html">Configuration Settings</a></li>
      <li><a href="./../../../references/3.2.latest/function.html">Functions</a></li>
      <li><a href="./../../../references/3.2.latest/metaparameter.html">Metaparameters</a></li>
      <li><a href="./../../../references/3.2.latest/report.html">Report Handlers</a></li>
      <li><a href="./../../../references/3.2.latest/indirection.html">Indirections and Termini</a></li>
      <li><a href="./../../../references/3.2.latest/developer/index.html">Developer Documentation</a></li>
    </ul>
  </li>
  <li><strong>More Sections Coming Later</strong>
    <ul>
      <li><strong>Standard Puppet Operation</strong></li>
      <li><strong>Command Line Interface</strong></li>
      <li><strong>The Puppet Services</strong></li>
      <li><strong>Node Classification</strong></li>
      <li><strong>File Serving</strong></li>
      <li><strong>Resource Types and Providers</strong></li>
      <li><strong>SSL and Certificates</strong></li>
      <li><strong>Puppet Data Library</strong></li>
      <li><strong>Environments</strong></li>
      <li><strong>Configuring Puppet</strong></li>
      <li><strong>Internals</strong></li>
    </ul>
  </li>
</ul>



                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>


	</body>
</html>
