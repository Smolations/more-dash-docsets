<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Puppet 2.7 Release Notes — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../../../favicon.ico' />


  <meta name="description" content="Puppet release notes for version 2.7.x.">



    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../../../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../../../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/ampersands.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/navigation-accordion.js'></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/puppet/2.7/reference/release_notes.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Puppet 2.7 Release Notes</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Puppet 2.7 Release Notes</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#puppet-27-release-notes">Puppet 2.7 Release Notes</a></li>
  <li class="toc-lv2"><a href="#puppet-2723">Puppet 2.7.23</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fixes">Security Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2722">Puppet 2.7.22</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fix">Security Fix</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2721">Puppet 2.7.21</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#downloads">2.7.21 Downloads</a></li>
   <li class="toc-lv3"><a href="#changelog">2.7.21 Changelog</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2720">Puppet 2.7.20</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#important-notes-about-2720">Important notes about 2.7.20</a></li>
   <li class="toc-lv3"><a href="#contributors">Contributors</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2719">Puppet 2.7.19</a></li>
  <li class="toc-lv2"><a href="#puppet-2718">Puppet 2.7.18</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fixes-1">Security Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2717">Puppet 2.7.17</a></li>
  <li class="toc-lv2"><a href="#puppet-2716">Puppet 2.7.16</a></li>
  <li class="toc-lv2"><a href="#puppet-2715">Puppet 2.7.15</a></li>
  <li class="toc-lv2"><a href="#puppet-2714">Puppet 2.7.14</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#contributors-1">Contributors</a></li>
   <li class="toc-lv3"><a href="#features">Features</a></li>
   <li class="toc-lv3"><a href="#bug-fixes">Bug Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2713">Puppet 2.7.13</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fixes-2">Security Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2712">Puppet 2.7.12</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#features-1">Features</a></li>
   <li class="toc-lv3"><a href="#bug-fixes-1">Bug Fixes</a></li>
   <li class="toc-lv3"><a href="#details">Details</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2711">Puppet 2.7.11</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fixes-3">Security Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-2710">Puppet 2.7.10</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#pulled-due-to-regressions-from-279">Pulled due to regressions from 2.7.9</a></li>
   <li class="toc-lv3"><a href="#better-validation-for-ipv4-and-ipv6-address-in-host-type">Better validation for IPv4 and IPv6 address in host type.</a></li>
   <li class="toc-lv3"><a href="#support-symbolic-file-modes">Support symbolic file modes.</a></li>
   <li class="toc-lv3"><a href="#only-load-facts-once-per-puppet-run">Only load facts once per puppet run</a></li>
   <li class="toc-lv3"><a href="#puppetd-does-not-remove-its-pidfile-when-it-exits">Puppetd does not remove its pidfile when it exits</a></li>
   <li class="toc-lv3"><a href="#retry-inventory-activerecord-transaction-failure">Retry inventory ActiveRecord transaction failure</a></li>
   <li class="toc-lv3"><a href="#properly-track-blockers-when-generating-additional-resources">Properly track blockers when generating additional resources</a></li>
   <li class="toc-lv3"><a href="#make-the-debian-service-provider-handle-services-that-dont-conform-to-the-debain-policy-manual">Make the Debian service provider handle services that don&#8217;t conform to the debain policy manual.</a></li>
   <li class="toc-lv3"><a href="#write-reports-to-a-temporary-file-and-move-them-into-place">Write reports to a temporary file and move them into place</a></li>
   <li class="toc-lv3"><a href="#test-augueas-versions-correctly-with-versioncmp">Test Augueas versions correctly with versioncmp</a></li>
   <li class="toc-lv3"><a href="#saveexecute-changes-on-versions-of-augeas--036">Save/execute changes on versions of Augeas &lt; 0.3.6</a></li>
   <li class="toc-lv3"><a href="#make-puppettypeensurable-false-when-exists-is-undefined">Make Puppet::Type.ensurable? false when exists? is undefined</a></li>
   <li class="toc-lv3"><a href="#consider-package-epoch-version-when-comparing-yum-package-versions">Consider package epoch version when comparing yum package versions</a></li>
   <li class="toc-lv3"><a href="#log-when-we-start-evaluating-resource-at-the-info-level">Log when we start evaluating resource at the info level</a></li>
   <li class="toc-lv3"><a href="#fix-array-support-in-schedules-range-parameters">Fix array support in schedule&#8217;s range parameters</a></li>
   <li class="toc-lv3"><a href="#make-resourcefile-work-with-composite-namevars">Make resourcefile work with composite namevars</a></li>
   <li class="toc-lv3"><a href="#add-readmedeveloper-describing-utf-8-in-puppet">Add README_DEVELOPER describing UTF-8 in Puppet</a></li>
   <li class="toc-lv3"><a href="#better-ssl-error-message-certificate-doesnt-match-key">Better SSL error message certificate doesn&#8217;t match key</a></li>
   <li class="toc-lv3"><a href="#add-a-defaults-argument-to-createresources">Add a defaults argument to create_resources</a></li>
   <li class="toc-lv3"><a href="#link-should-autorequire-target">Link should autorequire target</a></li>
   <li class="toc-lv3"><a href="#use-smfs-svcadm--s-option-to-wait-for-errors">Use SMF&#8217;s svcadm -s option to wait for errors</a></li>
   <li class="toc-lv3"><a href="#added-missing-requestheader-entries-to-extrackfilesapache2conf">Added missing RequestHeader entries to ext/rack/files/apache2.conf</a></li>
   <li class="toc-lv3"><a href="#debug-logging-when-we-start-evaluating-resources">Debug logging when we start evaluating resources.</a></li>
   <li class="toc-lv3"><a href="#update-storeconfigclean-script-to-read-puppetconf">Update storeconfigclean script to read puppet.conf</a></li>
   <li class="toc-lv3"><a href="#add-mysql2-gem-support">Add mysql2 gem support</a></li>
   <li class="toc-lv3"><a href="#mac-highlights">Mac Highlights</a></li>
   <li class="toc-lv3"><a href="#windows-highlights">Windows Highlights</a></li>
   <li class="toc-lv3"><a href="#freebsd-highlights">FreeBSD Highlights</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-279">Puppet 2.7.9</a></li>
  <li class="toc-lv2"><a href="#puppet-278">Puppet 2.7.8</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#known-issues">Known Issues</a></li>
   <li class="toc-lv3"><a href="#new-features">New Features</a></li>
   <li class="toc-lv3"><a href="#bug-fixes-3">Bug Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-277">Puppet 2.7.7</a></li>
  <li class="toc-lv2"><a href="#puppet-276">Puppet 2.7.6</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fixes-4">Security Fixes</a></li>
   <li class="toc-lv3"><a href="#features-and-enhancements">Features and Enhancements</a></li>
   <li class="toc-lv3"><a href="#enhancement-return-reports-on-ral-save">Enhancement: Return reports on ral save</a></li>
   <li class="toc-lv3"><a href="#bug-fixes-4">Bug Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-275">Puppet 2.7.5</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fixes-5">Security Fixes</a></li>
   <li class="toc-lv3"><a href="#bug-fixes-5">Bug Fixes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-274">Puppet 2.7.4</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#security-fixes-6">Security Fixes</a></li>
   <li class="toc-lv3"><a href="#fixes-and-enhancements">Fixes and Enhancements</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-273">Puppet 2.7.3</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#add-node-clean-action">Add Node Clean action</a></li>
   <li class="toc-lv3"><a href="#deprecate-restauthconfigallowed-in-favor-of-checkauthorization">Deprecate RestAuthConfig#allowed? in favor of #check_authorization</a></li>
   <li class="toc-lv3"><a href="#security-file-should-support-inline-comments">#6026 - security file should support inline comments</a></li>
   <li class="toc-lv3"><a href="#suggest-where-to-start-troubleshooting-ssl-error-message">Suggest where to start troubleshooting SSL error message</a></li>
   <li class="toc-lv3"><a href="#detect-resource-alias-conflicts-when-titles-do-not-match">#8596 Detect resource alias conflicts when titles do not match</a></li>
   <li class="toc-lv3"><a href="#maint-adding-logging-to-include-environment-when-source-fails">maint: Adding logging to include environment when source fails</a></li>
   <li class="toc-lv3"><a href="#maint-add-debug-logging-when-the-master-receives-a-report">maint: Add debug logging when the master receives a report</a></li>
   <li class="toc-lv3"><a href="#port-sslcertificateauthorityinterface-to-a-face">#6789 Port SSL::CertificateAuthority::Interface to a Face</a></li>
   <li class="toc-lv3"><a href="#document-that---detailed-exitcodes-is-a-bitmask">#8401 Document that &#8211;detailed-exitcodes is a bitmask</a></li>
   <li class="toc-lv3"><a href="#fix-module-check-not-to-fail-when-empty-metadatajson">#4142 Fix module check not to fail when empty metadata.json</a></li>
   <li class="toc-lv3"><a href="#change-default-reporturl-to-match-newer-dashboard-versions">#8147 Change default reporturl to match newer Dashboard versions</a></li>
   <li class="toc-lv3"><a href="#password-disclosure-when-changing-a-users-password">#6857 Password disclosure when changing a user&#8217;s password</a></li>
   <li class="toc-lv3"><a href="#additional-notes">Additional Notes</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#puppet-272">Puppet 2.7.2</a></li>
  <li class="toc-lv2"><a href="#puppet-271">Puppet 2.7.1</a></li>
  <li class="toc-lv2"><a href="#puppet-270">Puppet 2.7.0</a></li>
  <li class="toc-lv2"><a href="#notable-features-and-bug-fixes">Notable Features and Bug Fixes</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#apache-license">Apache License</a></li>
   <li class="toc-lv3"><a href="#ruby-19-support">Ruby 1.9 Support</a></li>
   <li class="toc-lv3"><a href="#deterministic-catalog-application">Deterministic Catalog Application</a></li>
   <li class="toc-lv3"><a href="#manage-network-devices">Manage Network Devices</a></li>
   <li class="toc-lv3"><a href="#dependency-cycle-reporting">Dependency cycle reporting</a></li>
   <li class="toc-lv3"><a href="#man-pages">Man Pages</a></li>
   <li class="toc-lv3"><a href="#deprecations">Deprecations</a></li>
   <li class="toc-lv3"><a href="#notice-changed-manifests-on-the-first-try">Notice Changed Manifests on the First Try</a></li>
   <li class="toc-lv3"><a href="#static-compiler">Static Compiler</a></li>
   <li class="toc-lv3"><a href="#improved-apis">Improved APIs</a></li>
   <li class="toc-lv3"><a href="#services-are-assumed-to-have-status-commands">Services Are Assumed to Have Status Commands</a></li>
   <li class="toc-lv3"><a href="#default-acl-improvements">Default ACL improvements</a></li>
   <li class="toc-lv3"><a href="#pkgutil-provider">pkgutil Provider</a></li>
   <li class="toc-lv3"><a href="#puppet-faces">Puppet Faces</a></li>
   <li class="toc-lv3"><a href="#certificate-api">Certificate API</a></li>
</ol></li>
</ol></nav>
              <h2 id="puppet-27-release-notes">Puppet 2.7 Release Notes</h2>

<h2 id="puppet-2723">Puppet 2.7.23</h2>

<p>Released August 15, 2013.</p>

<p>2.7.23 is a security fix release of the Puppet 2.7 series. It has no other bug fixes or new features.</p>

<h3 id="security-fixes">Security Fixes</h3>

<h4 id="cve-2013-4761-resourcetype-remote-code-execution-vulnerabilityhttppuppetlabscomsecuritycvecve-2013-4761"><a href="http://puppetlabs.com/security/cve/cve-2013-4761/">CVE-2013-4761 (<code>resource_type</code> Remote Code Execution Vulnerability)</a></h4>

<p>By using the <code>resource_type</code> service, an attacker could cause Puppet to load
arbitrary Ruby files from the puppet master server&#8217;s file system. While this behavior is not
enabled by default, <code>auth.conf</code> settings could be modified to allow it. The exploit requires
local file system access to the Puppet Master.</p>

<h4 id="cve-2013-4956-puppet-module-permissions-vulnerabilityhttppuppetlabscomsecuritycvecve-2013-4956"><a href="http://puppetlabs.com/security/cve/cve-2013-4956/">CVE-2013-4956 (Puppet Module Permissions Vulnerability)</a></h4>

<p>The puppet module subcommand did not correctly control permissions of modules it installed, instead transferring permissions that existed when the module was built.</p>

<h2 id="puppet-2722">Puppet 2.7.22</h2>

<p>2.7.22 is a security fix release of the Puppet 2.7 series. It has no other bug fixes or new features.</p>

<h3 id="security-fix">Security Fix</h3>

<p><em><a href="http://puppetlabs.com/security/cve/cve-2013-3567/">CVE-2013-3567 Unauthenticated Remote Code Execution Vulnerability</a>.</em></p>

<p>A critical vulnerability was found in puppet wherein it was possible for the puppet master to take YAML from an untrusted client via the REST API. This YAML could be deserialized to construct an object containing arbitrary code.</p>

<h2 id="puppet-2721">Puppet 2.7.21</h2>

<p>Puppet 2.7.21 is a <strong>security release</strong> addressing several security vulnerabilities discovered in
the 2.7.x line of Puppet. These vulnerabilities have been assigned Mitre CVE numbers <a href="http://puppetlabs.com/security/cve/cve-2013-1640">CVE-2013-1640</a>, <a href="http://puppetlabs.com/security/cve/cve-2013-1652">CVE-2013-1652</a>, <a href="http://puppetlabs.com/security/cve/cve-2013-1653">CVE-2013-1653</a>, <a href="http://puppetlabs.com/security/cve/cve-2013-1654">CVE-2013-1654</a>, <a href="http://puppetlabs.com/security/cve/cve-2013-1655">CVE-2013-1655</a> and <a href="http://puppetlabs.com/security/cve/cve-2013-2275">CVE-2013-2275</a>.</p>

<p>All users of Puppet 2.7.20 and earlier who cannot upgrade to the current version of Puppet, 3.1.1, are strongly encouraged to upgrade
to 2.7.21.</p>

<h3 id="downloads">2.7.21 Downloads</h3>

<ul>
  <li>Source: <a href="https://downloads.puppetlabs.com/puppet/puppet-2.7.21.tar.gz">https://downloads.puppetlabs.com/puppet/puppet-2.7.21.tar.gz</a></li>
  <li>Windows package: <a href="https://downloads.puppetlabs.com/windows/puppet-2.7.21.msi">https://downloads.puppetlabs.com/windows/puppet-2.7.21.msi</a></li>
  <li>RPMs: <a href="https://yum.puppetlabs.com/el">https://yum.puppetlabs.com/el</a> or <code>/fedora</code></li>
  <li>Debs: <a href="https://apt.puppetlabs.com">https://apt.puppetlabs.com</a></li>
  <li>Mac package: <a href="http://downloads.puppetlabs.com/mac/puppet-2.7.21.dmg">http://downloads.puppetlabs.com/mac/puppet-2.7.21.dmg</a></li>
  <li>Gems are available via rubygems: <a href="https://rubygems.org/downloads/puppet-2.7.21.gem">https://rubygems.org/downloads/puppet-2.7.21.gem</a> or by using <code>gem
install puppet --version=2.7.21</code></li>
</ul>

<p>See the Verifying Puppet Download section at:
<a href="https://projects.puppetlabs.com/projects/puppet/wiki/Downloading_Puppet">https://projects.puppetlabs.com/projects/puppet/wiki/Downloading_Puppet</a></p>

<p>Please report feedback via the Puppet Labs Redmine site, using an affected puppet version of 2.7.21:
<a href="http://projects.puppetlabs.com/projects/puppet/">http://projects.puppetlabs.com/projects/puppet/</a></p>

<h3 id="changelog">2.7.21 Changelog</h3>

<ul>
  <li>Andrew Parker (2):
    <ul>
      <li>(#14093) Remove unsafe attributes from TemplateWrapper</li>
      <li>(#14093) Restore access to the filename in the template</li>
    </ul>
  </li>
  <li>Jeff McCune (2):
    <ul>
      <li>(#19151) Reject SSLv2 SSL handshakes and ciphers</li>
      <li>(#19531) (CVE-2013-2275) Only allow report save from the node matching the certname</li>
    </ul>
  </li>
  <li>Josh Cooper (8):
    <ul>
      <li>Fix module tool acceptance test</li>
      <li>Run openssl from windows when trying to downgrade master</li>
      <li>Remove unnecessary rubygems require</li>
      <li>Don&#8217;t assume puppetbindir is defined</li>
      <li>Display SSL messages so we can match our regex</li>
      <li>Don&#8217;t require openssl client to return 0 on failure</li>
      <li>Don&#8217;t assume master supports SSLv2</li>
      <li>(#19391) Find the catalog for the specified node name</li>
    </ul>
  </li>
  <li>Justin Stoller (2):
    <ul>
      <li>Acceptance tests for CVEs 2013 (1640, 1652, 1653, 1654, 2274, 2275)</li>
      <li>Separate tests for same CVEs into separate files</li>
    </ul>
  </li>
  <li>Moses Mendoza (2):
    <ul>
      <li>Add missing 2.7.20 CHANGELOG entries</li>
      <li>Update CHANGELOG, PUPPETVERSION for 2.7.21</li>
    </ul>
  </li>
  <li>Nick Lewis (3):
    <ul>
      <li>(#19393) Safely load YAML from the network</li>
      <li>Always read request body when using Rack</li>
      <li>Fix order-dependent test failure in rest_authconfig_spec</li>
    </ul>
  </li>
  <li>Patrick Carlisle (3):
    <ul>
      <li>(#19391) (CVE-2013-1652) Disallow use_node compiler parameter for remote requests</li>
      <li>(#19392) (CVE-2013-1653) Validate instances passed to indirector</li>
      <li>(#19392) Don&#8217;t validate key for certificate_status</li>
    </ul>
  </li>
  <li>Pieter van de Bruggen (1):
    <ul>
      <li>Updating module tool acceptance tests with new expectations.</li>
    </ul>
  </li>
</ul>

<h2 id="puppet-2720">Puppet 2.7.20</h2>

<p>2.7.20 is a bug fix release with some performance improvements ported back from 3.0.x line.
For a list of bug fixes targeted for this release, see the <a href="http://projects.puppetlabs.com/versions/307">bug tracker</a></p>

<h3 id="important-notes-about-2720">Important notes about 2.7.20</h3>

<p>Regarding (#15560):
If you had specifically enabled</p>

<pre><code>`managehome =&gt; true`
</code></pre>

<p>for user resources expecting it not to work on Windows, be aware that (#15560) has been resolved,
and this works now for both creation with <code>ensure =&gt; present</code> <strong>AND deletion</strong> with <code>ensure =&gt; absent</code>.
Previously deleted users (deleted with Puppet &lt; 2.7.20-rc1) will not have their orphaned home directories
removed, however.</p>

<p>Puppet 2.7.20 also addresses concerns regarding a change introduced in Puppet 2.7.16,
&#8220;<a href="https://github.com/puppetlabs/puppet/commit/b26699a2b89f3724b4322a3723d2c700fb7e4dd3">b26699a</a>
(#10146) <code>-</code> is not legal in variable names.&#8221;, which disallowed the use of dashes in variable names.
Puppet 2.7.20 introduces a new configuration option, <code>allow_variables_with_dashes</code>, which can be set to
<code>true</code> to allow variables with dashes. The option is set to false by default to maintain existing behavior. The
following commit message includes additional information:</p>

<pre><code> (#10146) `-` in variable names should be deprecated!

 In commit b26699a2 I fixed an accidentally introduced change to the lexer,
 allowing `-` to be part of a variable name.  That had lasted for a while and
 was surprisingly popular.  It was also hugely ambiguous around `-` as minus,
 and led to all sorts of failures - unexpected interpolations to nothing -
 because of that.

 A much better strategy would have been to deprecate the feature, issue proper
 warnings, and include an option to allow users to toggle the behaviour.

 Initially defaulting that to "permit", and eventually toggling over to "deny",
 would have made the whole experience much smoother - even if this was totally
 documented as not working, and was a clear bug that it changed.

 So, thanks to prompting from Benjamin Irizarry, we do just that: introduce the
 configuration option, default it to "deny" to match current behaviour, but
 allow users the choice to change this back.

 Please be aware that allowing variables with `-` might break all sorts of
 things around, for example, Forge modules though.  Most people write code to
 the documented standard, and their code might well totally fail to work with
 this changed away from the default!

 Signed-off-by: Daniel Pittman &lt;daniel@puppetlabs.com&gt;
</code></pre>

<h3 id="contributors">Contributors</h3>
<p>Adrien Thebo, Andrew Parker, Ashley Penney, Branan Purvine-Riley, Dan Bode, Daniel Pittman, Dominic Cleal, Dustin J. Mitchell, Eric Sorenson, Eric Stonfer, Gleb Arshinov, James Turnbull, Jeff McCune, Jeff Weiss, Josh Cooper, Ken Barber, Ken Dreyer, Lee Lowder, Markus Roberts, Matthaus Owens, Michael Stahnke, Moses Mendoza, Neil Hemingway, Nick Fagerlund, Patrick Carlisle, Roman Barczyński, S. Zachariah Sprackett, Sean E. Millichamp, Stefan Schulte, Todd Zullinger</p>

<h2 id="puppet-2719">Puppet 2.7.19</h2>

<p>Ruby 1.9.3 has a different error when <code>require</code> fails.</p>

<pre><code>The text of the error message when load fails has changed, resulting in the
test failing.  This adapts that to catch the different versions, allowing this
to pass in all cases.
</code></pre>

<p>(#15291) Add Vendor tag to Puppet spec file</p>

<pre><code>Previously the spec file had no Vendor tag, which left it undefined. This
commit adds a Vendor tag that references the _host_vendor macro, so that it can
be easily set to 'Puppet Labs' internally and customized by users easily. The
Vendor tag makes it easier for users to tell where the package came from.
</code></pre>

<p>Add packaging support for fedora 17</p>

<pre><code>This commit modifies the puppet.spec file to use
the ruby vendorlib instead of sitelib if building
for fedora 17, which ships with ruby 1.9. Mostly
borrowed from the official Fedora 17 package.
</code></pre>

<p>(#15471) Fix setting mode of last_run_summary</p>

<pre><code>The writlock function didn't work with setting the mode on the
last_run_summary file. This backports some of the work in commit
7d8fd144949f21eff924602c2a6b7f130f1c0b69. Specifically, the changes
from using writelock to replace_file for saving the summary file. This
builds on top of the backport of getting replace_file to work on
windows.
</code></pre>

<p>(#15471) Ensure non-root can read report summary</p>

<pre><code>The security fix for locking down the last_run_report, which contains
sensitive information, also locked down the last_run_summary, which does
not contain sensitive information. Unfortunately this file is often used
by monitoring systems so that they can track puppet runs. Since the
agent runs as root and the monitoring systems do not, this caused the
summary to become unreadable by the monitoring systems.

This commit returns the summary to being world readable which undoes
part of the change done in fd44bf5e6d0d360f6a493d663b653c121fa83c3f
</code></pre>

<p>Use Win32 API atomic replace in <code>replace_file</code></p>

<pre><code>The changes to enable Windows support in `replace_file` were not actually
complete, and it didn't work when the file didn't exist - because of
limitations of the emulation done on our side, rather than anything else.

Windows has a bunch of quirks, and Ruby doesn't actually abstract over the
underlying platform a great deal.  We can use the Windows API ReplaceFile, and
MoveFileEx, to achieve the desired behaviour though.

This adds even more conditional code inside the `replace_file` method to
handle multiple platforms - but it really isn't very clean.  Better to get
this working now, then refactor, though.
</code></pre>

<p>(#11868) Use <code>Installer</code> automation interface to query package state</p>

<pre><code>Previously, Puppet recorded MSI packages it had installed in a YAML
file. However, if the file was deleted or the system modified, e.g.
Add/Remove Programs, then Puppet did not know the package state had
changed.

Also, if the name of the package did not change across versions, e.g.
VMware Tools, then puppet would report the package as insync even though
the installed version could be different than the one pointed to by the
source parameter.

Also, `msiexec.exe` returns non-zero exit codes when either the package
requests a reboot (194), the system requires a reboot (3010), e.g. due
to a locked file, or the system initiates a reboot (1641). This would
cause puppet to think the install failed, and it would try to reinstall
the packge the next time it ran (since the YAML file didn't get
updated).

This commit changes the msi package provider to use the `Installer`
Automation (COM) interface to query the state of the system[1]. It will
now accurately report on installed packages, even those it did not
install, including Puppet itself (#13444). If a package is removed via
Add/Remove Programs, Puppet will re-install it the next time it runs.

The MSI package provider will now warn in the various reboot scenarios,
but report the overall install/uninstall as successful (#14055).

When using the msi package resource, the resource title should match the
'ProductName' property in the MSI Property table, which is also the
value displayed in Add/Remove Programs, e.g.

    package { 'Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148':
      ensure =&gt; installed,
      ...
    }

In cases where the ProductName does not change across versions, e.g.
VMware Tools, you MUST use the PackageCode as the name of the resource
in order for puppet to accurately determine the state of the system:

    package { '{0E3AA38E-EAD3-4348-B5C5-051B6852CED6}':
      ensure =&gt; installed,
      ...
    }

You can obtain the PackageCode in ruby using:

    require 'win32ole'
    installer = WIN32OLE.new('WindowsInstaller.Installer')
    db = installer.OpenDatabase(path, 0)
    puts db.SummaryInformation.Property(9)

where &lt;path&gt; is the path to the MSI.

The msi provider does not automatically compare PackageCodes when
determining if the resource is insync, because the source MSI could be
on a network share, and we do not want to copy the potentially large
file just to see if changes need to be made.

The msi provider does not use the `Installer` interface to perform
install and uninstall, because I have not found a way to obtain useful
error codes when reboots are requested. Instead the methods
`InstallProduct` and `ConfigureProduct` raise exceptions with the
general 0x80020009 error, which means 'Exception occurred'. So for now
we continue to use msiexec.exe for install and uninstall, though the msi
provider may not uninstall multi-instance transforms correctly, since
the transform (MST) used to install the package needs to be respecified
during uninstall. This could be resolved by allowing uninstall_options
to be specified, or figuring out how to obtain useful error codes when
using the `Installer` interface.

[1] http://msdn.microsoft.com/en-us/library/windows/desktop/aa369432(v=vs.85).aspx
</code></pre>

<p>(#14964) Unlink Tempfiles consistently across different ruby versions</p>

<pre><code>The previous fix for #14964 relied on inconsisent behavior of ruby 1.8's
`Tempfile#close!` method, which is called by `close(true)`.  Although
the ruby documentation says `close!` is the same as `delete` followed by
`unlink`, the exact semantics are different.  The former calls the
Tempfile's finalizer callback directly and can raise an `Errno::EACCES`,
while `unlink` never does.

In ruby 1.9, the `Tempfile#close!` method was changed to call `unlink`,
making the two APIs consistent.  As a result, the begin-ensure block
added previously to fix #14964 was wrong.

Also, previously if the call to `read` failed, then the Tempfile would
not be closed and deleted until its finalizer ran.

This commit changes the `wait_for_output` method to close and unlink the
Tempfile in two steps.  The `unlink` method will not raise an
`Errno::EACCES` in either ruby 1.8 or 1.9.   It also changes the `read`
call to occur within the begin-ensure block, so that the Tempfile is
closed and unlinked as soon as we are done with it.
</code></pre>

<p>(Maint) Require the right file for md5</p>

<pre><code>md5 doesn't exist on 1.9.3. It seems to have been an alias in previous
versions of ruby for digest/md5. Requiring the other file directly
allows this to work on all supported rubies.
</code></pre>

<p>Don&#8217;t allow resource titles which aren&#8217;t strings</p>

<pre><code>It was possible to create resources whose titles weren't strings, by
using a variable containing a hash, or the result of a function which
doesn't return a string. This can cause problems resolving relationships
when the stringified version of the title differs between master and
agent.

Now we will only accept primitives, and will stringify them. That is:
string, symbol, number, boolean. Arrays or nested arrays will still be
flattened and used to create multiple resources. Any other value (for
instance: a hash) will cause a parse error.
</code></pre>

<p>Eliminate require calls at runtime.</p>

<pre><code>Calling `require` is a surprisingly expensive operation, especially if
ActiveRecord has been loaded.  Consequently, the places where we do that in
the body of a function are hot-spots in the profile.

They are also, generally, pretty simple and clear wins: almost all of them can
simply require the library the first time they are loaded and everything will
work fine.

In my testing with a complex, real-world set of manifests this reduces time
spent by ~ 3 wall-clock seconds in require and all children.
</code></pre>

<p>Fix broken ability to remove resources from the catalog.</p>

<pre><code>For the last forever, the Puppet catalog object has unable to remove resources
correctly - they used the wrong key to remove items from an internal map.

Because the test was broken we also ran into a situation where this simply
wasn't noticed - and, presumably, we simply didn't depend on this in the real
world enough to actually discover the failure.

This fixes that, as well as the bad test, to ensure that the feature works
correctly, and that it stays that way.
</code></pre>

<p>(#14962) PMT doesn&#8217;t support setting a relative modulepath</p>

<pre><code>We previously fixed expansion for the target_dir, but this only worked when the
target_dir was set explicitly, it didn't support relative paths being passed in
the modulepath. This patch fixes that and adds tests.

As a side-effect, this should also fixes cases where the first modulepath
defined in the configuration file is relative.

It also corrects the tests previously applied for expanding the target_dir, as
it used to rely on expanding the target_dir before adding it to the modulepath.
This wasn't necessary, so now we don't bother testing that the targetdir is
expanded in the modulepath after being added.

Acceptance tests have been added for testing modulepath, with absolute
and relative paths.
</code></pre>

<p>(#15221) Create /etc/puppet/modules directory for puppet module tool</p>

<pre><code>Previously, this directory was not created by the package,
which caused errors when the puppet module tool was used
to install modules. This commit updates the RPM spec file
to create this directory upon installation of the package.
</code></pre>

<p>(#13070) Mark files as loaded before we load</p>

<pre><code>There is a loading cycle that occurs in some situations. It showed up as
not being able to describe certain types because the description
depended on the name of the type's class. For some reason (that is not
entirely clear) the multiple loading of code seems to cause the name of
the class to be wrong.

This patch changes it to mark the file as loaded first, so that we don't
get into a loading cycle.
</code></pre>

<p>Extract host validation in store report processor</p>

<pre><code>Extract the validation step and refactor tests around this. Tests now don't
touch the filesystem which avoids a corner case on windows that caused test
failures.
</code></pre>

<p>Enforce &#8220;must not should&#8221; on Puppet::Type instances in tests.</p>

<pre><code>Because we define a `should` method on Puppet::Type, and that conflicts with
the identically named method in RSpec, we have an alias for `must` defined in
the test helper.

Sadly, this isn't *complete*: if you call `should` on those instances you
actually get no failure, it just silently ignores your actual test.

This change monkey-patches Puppet::Type in the spec helper, and adds a type
check to fail hard if you supply something "illegal" as the argument to
Puppet::Type.
</code></pre>

<p>(#14531) Change default ensure value from symlink to link</p>

<pre><code>If ensure on a file resource is omitted, puppet will set the should value
to :symlink in the initialize method of the file type but the ensure property
does not use :symlink but :link to identify a link.

As a result, puppet will always treat a resource with a specific target
property but no ensure property as out of sync:

    file { '/tmp/a':
      target =&gt; '/tmp/b',
    }

When puppet now calls sync on the ensure property, the fileresource
(`/tmp/a`) is removed first (method `remove_existing`) but we do not
execute the block passed to `newvalue(:link)` to recreate it. Because
there is no `newvalue(:symlink)` block, we instead run the block in
`newvalue(/./)` which is just a dummy and does nothing at all. As a
result puppet will *always* say it created something while in fact
making sure that the resource is *removed*.

Change the default ensure value from :symlink to :link if target is
set.
</code></pre>

<p>Upstart code cleanup, init provider improvement</p>

<pre><code>This commit adds an is_init? function to the init provider, to prevent the init
provider from handling upstart jobs redundantly (which happens with services
such as network-interface and network-interface-security). It also adds tests
for the exlusion of instances in the upstart provider and exclusion of upstart
services from the init instances. It also cleans up some upstart provider code
(self.instances, self.search), eliminating redundant code and refactoring some
methods (upstart_status, status, normal_status).
This also removes the custom status command from upstart, which almost
certainly wasn't doing what it was expected. The upstart status command is
effective at gauging the status of upstart services.
</code></pre>

<p>Handle network-interface-security in upstart</p>

<pre><code>Similar to network-interface, network-interface-security is an upstart job that
requires special handling to get status information. While network-interface
takes and interface argument, network-interface-security takes a job argument.
This commit adds that special case, and also updates the search method with a
corresponding special case so the jobs can be recognized as upstart jobs.
</code></pre>

<p>Add exclude list to upstart provider</p>

<pre><code>The wait-for-state service seems to be a helper that is used by upstart, but
doesn't have a useful status or consistent way to call. Trying to use that
upstart service generally results in an error. This commit adds an exclude list
similar to the redhat provider so that services like 'wait-for-state' can be
excluded from the service instances.
</code></pre>

<p>(#15027, #15028, #15029) Fix upstart version parsing</p>

<pre><code>A leading space in the --version argument would confuse upstart, and the
version returned would not always be a semantic version, which caused the
upstart provider to fail. This commit updates the initctl call to remove the
leading space from the --version argument, and also replaces the implicit
SemVer comparisons with wrapper functions that call out to
Puppet::Util::Package.versioncmp to do version comparisons. It also fixes a
subtly broken regex to grab the full version string.
</code></pre>

<p>(#13489) Synchronously start and stop services</p>

<pre><code>Previously, we were using the `win32-service` gem to start and stop
services.  It uses Win32 APIs to programmatically send start and stop
requests.  The actual service starts/stops asynchronously with respect
to the request.  As a result, when refreshing a service, puppet would
issue a stop request, immediately followed by a start request, and that
would race as the service would often still be running when the start
request occurred, leading to 'An instance of the service is already
running'.

This commit changes the windows service provider to use `net.exe` to
start and stop services.  This command will block until the service
start/stops, and returns 0 on success, making it easy to adapt to the
provider command pattern.  The one downside is that the exit codes don't
have the same resolution that we can get via the `sc.exe` or by calling
the Service Control Manager programmatically.  But that is not too
critical because we do capture the output of the `net.exe` command, e.g.
'The service name is invalid.' and include it in the exception message.
</code></pre>

<p>(#14964) Don&#8217;t fail if we can&#8217;t unlink the Tempfile on Windows</p>

<pre><code>Previously, if the exec resource created a process, e.g. start.exe, that
executed another process asynchronously, then the grandchild would inherit
the tempfile handle, preventing puppet from being able to unlink it. This
is not an issue on POSIX systems.

This commit changes the `wait_for_output` method to ignore Errno::EACCES
exceptions caused when closing and unlinking the stdout tempfile. The
behavior on POSIX systems is unchanged.
</code></pre>

<p>(#14860) Fix puppet cert exit status on failures</p>

<pre><code>Without this patch applied the following command errors out but does not
correctly set the exit status:

    puppet cert generate foo.bar.com --dns_alt_names foo,foo.bar.com

The error returned is:

    err: Could not call generate: CSR 'pe-internal-broker-test'
      contains subject alternative names (DNS:pe-centos6, \
      DNS:pe-centos6.puppetlabs.vm, DNS:pe-internal-broker-test, \
      DNS:stomp), which are disallowed. Use `puppet cert \
      --allow-dns-alt-names sign pe-internal-broker-test` to sign this \
      request.

However, the exit status is 0.

This is a problem because we need to easily detect if certificate
generation from the command line failed or succeeded.  The most natural
and expected way to check this is by looking at the exit status.

The root cause of the problem is that
Puppet::SSL::CertificateAuthority::InterFace#apply incorrectly catches
and masks the exception raised by the generate method because it simply
logs an error with Puppet.err and continues along happily.

This patch fixes the problem by re-raising the error produced by
generate, allowing the application controller to catch the error
appropriately and exit with the non-zero exit status.
</code></pre>

<p>(#13379) Add path of pluginsync&#8217;d lenses to Augeas load_path automatically</p>

<pre><code>The path $libdir/augeas/lenses is added to the Augeas load_path initialisation
option automatically to support lenses being pluginsynced.  Lenses should be
added into the &lt;module&gt;/lib/augeas/lenses directory inside a module.

The load_path parameter has been expanded to support an array of paths as well
as a colon-separated list.
</code></pre>

<p>Fixes for #10915 and #11200 - user provider for AIX</p>

<pre><code>The user provider on AIX fails to set the password for local users
using chpasswd.

This commit includes the code in ticket #11200 suggested by Josh
Cooper. It works in my environment (AIX 5.3 + 6.1).

chpasswd can also return 1 even on success; it's not clear if this is
by design, as the manpage doesn't mention it. The lack of output from
chpasswd indicates success; if there's a problem it dumps output to
stderr/stdout.
</code></pre>

<h2 id="puppet-2718">Puppet 2.7.18</h2>

<p>This is a <strong>security</strong> release in the 2.7.x branch.</p>

<h3 id="security-fixes-1">Security Fixes</h3>

<p>CVE-2012-3864 Arbitrary file read on the puppet master from authenticated clients (high)
    It is possible to construct an HTTP get request from an authenticated
    client with a valid certificate that will return the contents of an arbitrary
    file on the Puppet master that the master has read-access to.</p>

<p>CVE-2012-3865 Arbitrary file delete/D.O.S on Puppet Master from authenticated clients (high)
    Given a Puppet master with the &#8220;Delete&#8221; directive allowed in auth.conf
    for an authenticated host, an attacker on that host can send a specially
    crafted Delete request that can cause an arbitrary file deletion on the
    Puppet master, potentially causing a denial of service attack. Note that
    this vulnerability does <em>not</em> exist in Puppet as configured by default.</p>

<p>CVE-2012-3866 last_run_report.yaml is world readable (medium)
    The most recent Puppet run report is stored on the Puppet master
    with world-readable permissions. The report file contains the context
    diffs of any changes to configuration on an agent, which may contain
    sensitive information that an attacker can then access. The last run
    report is overwritten with every Puppet run.</p>

<p>Arbitrary file read on the Puppet master by an agent (medium)
    This vulnerability is dependent upon CVE-2012-3866 &#8220;last_run_report.yml
    is world readable&#8221; above. By creating a hard link of a Puppet-managed
    file to an arbitrary file that the Puppet master can read, an attacker forces
    the contents to be written to the puppet run summary. The context diff is
    stored in last_run_report.yaml, which can then be accessed by the
    attacker.</p>

<p>CVE-2012-3867 Insufficient input validation for agent hostnames (low)
    An attacker could trick the administrator into signing an attacker&#8217;s
    certificate rather than the intended one by constructing specially
    crafted certificate requests containing specific ANSI control sequences.
    It is possible to use the sequences to rewrite the order of text displayed
    to an administrator such that display of an invalid certificate and valid
    certificate are transposed. If the administrator signs the attacker&#8217;s
    certificate, the attacker can then man-in-the-middle the agent.</p>

<p>CVE-2012-3408 Agents with certnames of IP addresses can be impersonated (low)
    If an authenticated host with a certname of an IP address changes IP
    addresses, and a second host assumes the first host&#8217;s former IP
    address, the second host will be treated by the puppet master as the
    first one, giving the second host access to the first host&#8217;s catalog.
    Note: This will not be fixed in Puppet versions prior to the forthcoming
    3.x. Instead, with this Puppet 2.7.18, IP-based authentication in
    Puppet &lt; 3.x is deprecated, and a warning will be issued when used.</p>

<h2 id="puppet-2717">Puppet 2.7.17</h2>

<p>(#15027, #15028, #15029) Fix upstart version parsing</p>

<pre><code>A leading space in the --version argument would confuse upstart, and the
version returned would not always be a semantic version, which caused the
upstart provider to fail. This commit updates the initctl call to remove the
leading space from the --version argument, and also replaces the implicit
SemVer comparisons with wrapper functions that call out to
Puppet::Util::Package.versioncmp to do version comparisons. It also fixes a
subtly broken regex to grab the full version string.
</code></pre>

<p>Add exclude list to upstart provider</p>

<pre><code>The wait-for-state service seems to be a helper that is used by upstart, but
doesn't have a useful status or consistent way to call. Trying to use that
upstart service generally results in an error. This commit adds an exclude list
similar to the redhat provider so that services like 'wait-for-state' can be
excluded from the service instances.
</code></pre>

<p>Handle network-interface-security in upstart</p>

<pre><code>Similar to network-interface, network-interface-security is an upstart job that
requires special handling to get status information. While network-interface
takes and interface argument, network-interface-security takes a job argument.
This commit adds that special case, and also updates the search method with a
corresponding special case so the jobs can be recognized as upstart jobs.
</code></pre>

<h2 id="puppet-2716">Puppet 2.7.16</h2>

<p>(#8858) Explicitly set SSL peer verification mode.</p>

<pre><code>In Ruby 1.8 the Net::HTTP library defaults to skipping peer verification when
no mode is explicitly set.  Ruby 1.9, on the other hand, does not: it defaults
to verification of the peer certificate - leading to failure when we depended
on the default value in our HTTP setup.

This changes to explicitly set the verification mode, ensuring we get
consistent results across all Ruby versions.
</code></pre>

<p>*Significantly improve compilation performance when using modules
    When autoloading classes/defines, the typeloader constructs a set of
    possible locations for the class, based on its name. Effectively, it
    will look in the canonical locations corresponding to each namespace in
    the fully-qualified name. So for each namespace, it will ask the
    environment for a Puppet::Module instance for that module, to ask it
    which of the module&#8217;s potentially manifests match the class it&#8217;s looking
    for. To answer that request, the environment instantiates a
    Puppet::Module.</p>

<pre><code>This amounts to potentially thousands of Puppet::Module instances being
created, because it does this many times (based on nesting of the class
name) per include/autoload/import. When Puppet::Module instances are
created, they parse and load their metadata.json file, in part to
validate their use. This implies that each compilation results in
metadata.json being parsed thousands of times, which is extremely slow
(and obviously provides no actual benefit).

Fortunately, the environment object already keeps a list of
Puppet::Module instances for every module in its modulepath. The fix
applied here is simply to change the environment such that it provides
modules by looking them up in its cached list, resulting in up to an
order of magnitude improvement in compilation time.
</code></pre>

<p>*Colorize console output on Windows
    Previously, <code>Puppet[:color]</code> was false on Windows, because the Windows
    console does not support ANSI escape sequences.</p>

<pre><code>The win32console gem converts ANSI color escape sequences into Win32
console API calls to change the foreground color, etc. If the output
stream has been redirected to a file, then the gem does not translate
the sequences, instead preserving them in the stream, as is done on
Unix.

To disable colorized output specify `color=false` or `--color=false` on
the command line.

This commit adds a `Puppet.features.ansicolor?` feature that defines
whether ANSI color escape sequences are supported. On Windows, this is
only true if the win32console gem can be loaded. On other platforms, the
value is always true.

The win32console gem will be packaged into the Windows installer, and
so, `Puppet[:color]` now defaults to true. If the gem can't be loaded,
then puppet will revert to its previous behavior.
</code></pre>

<p>(#8174) Allow defines to reference topscope</p>

<pre><code>Because the compiler re-assigned the topscope, looking up topscope vars
or facts from a defined resource type was causing deprecation warnings
when it should not be. By cherry-picking commits
b02aa930a03a282588e81f65e14f47a138a4b9f0 and
c995be16bc9e3ad8dbad9d21b49df76de5b72ea9 the topscope is no longer
re-assigned and so defined resource types can now lookup these kinds of
variables without problem.
</code></pre>

<p>Evaluate node classes either in top or node scope</p>

<pre><code>Classes that are tied to a node should be preferred to be evaluated in
the node scope, but if we don't have one then they should be in the top
scope
</code></pre>

<p>(#14297) Handle upstart services better</p>

<pre><code>The previous changes to the upstart provider didn't take into account services
that may have upstart jobs in /etc/init with no corresponding symlink to
upstart-job in /etc/init.d. This fix adds /etc/init/$service.conf to the search
path in the upstart provider.

In order to allow upstart to use debian as its parent, this commit adds methods
for enabled?, enable and disable. Without this fix, using a debian style init
script on ubuntu requires manually specifying the debian provider be used.
With this commit, the upstart provider can be the default for ubuntu and
still fail up to its parent, debian.

The enabled?, disable, and enable methods are complicated because upstart has 3
behaviors to account for. Upstart &lt; 0.6.7 have only the conf file and start on
stanzas to worry about, 0.6.7 &lt; upstart &lt; 0.9.0 has a manual stanza which
removes any previous start on declaration, and upstart &gt;= 0.9.0 has an override
file. In upstart &gt;= 0.9.0, the provider does all of its work using override files
to leave the upstart conf file for the service intact and unchanged.

Because of the need to know which upstart version is being used, this commit
also adds a method and a class variable to hold and access the upstart version,
obtained by a call to `initctl --version`.
</code></pre>

<p>(#14343) Lookup in correct inherited scope</p>

<pre><code>The previous twoscope lookup of the inheritied scope tried to find the
inherited scope by looking up the class_scope() directly. Unfortunately,
this does not work correctly in cases where the inherited scope is
qualified to the topscope (::parent) or where the scope is implicitly
qualified (class a { class b {} class c inherits b {} }).

By using the same mechanism that variables use for looking up scope (the
qualified_scope() method) variable lookup will find a scope consistent
with what qualified variable lookups will find.
</code></pre>

<p>(#14761) Add boot, reboot to excludes list for redhat provider</p>

<pre><code>On sles, the reboot init script would be triggered during a `puppet resource
service` call, which would ignore the status argument and proceed
to reboot the
system. It would also call the boot init script, which could hang the puppet
call indefinitely. This commit adds both the boot and reboot services to the
redhat provider's exclude list. It also updates the redhat
provider spec test
to test for those changes.
</code></pre>

<p>(#14615) Exclude helperscripts in gentoo service provider</p>

<pre><code>The directory `/etc/init.d` does not only store normal initscripts but
also a few helper scripts (like `functions.sh`). The former behaviour was
to treat them as regular initscripts which can lead to dangerous results
especially when running `puppet resource service`. This command will
issue `/etc/init.d/&lt;script&gt; status` on every script inside
`/etc/init.d`. Because the helperscripts don't care about arguments,
this will cause the system to reboot when `/etc/init.d/reboot.sh status` is
executed.
Exclude helperscripts when searching inside `/etc/init.d`.
</code></pre>

<h2 id="puppet-2715">Puppet 2.7.15</h2>

<p>Puppet 2.7.15 was never released, and its commits were rolled into 2.7.16.</p>

<h2 id="puppet-2714">Puppet 2.7.14</h2>

<h3 id="contributors-1">Contributors</h3>
<p>Andrew Parker, Chris Price, Daniel Pittman, Dominic Cleal, Gary
Larizza, Hunter Haugen, Jeff McCune, Jeff Weiss, Josh Cooper, Justin
Stoller, Kelsey Hightower, Ken Barber, Lauri Tirkkonen, Matt Robinson,
Matthaus Litteken, Moses Mendoza, Nicholas Hubbard, Nick Lewis, Nick
Fagerlund, Nigel Kersten, Patrick Carlisle, Pieter van de Bruggen,
Reid Vandewiele, and Stefan Schulte</p>

<h3 id="features">Features</h3>
<pre><code>Puppet Module Tool Face - the module tool has seen a host of
improvements including dependency resolution, environment handling,
and searching the forge. There are more details available at
http://docs.puppetlabs.com/puppet/2.7/reference/modules_installing.html
</code></pre>

<h3 id="bug-fixes">Bug Fixes</h3>

<p>(#13682) Rename Puppet::Module::Tool to Puppet::ModuleTool</p>

<pre><code>Without this patch, Puppet will monkey patch the existing implementation
of the puppet-module Gem if it is used.  This is bad because the two
implementations are all jumbled up inside of one another and behavior
may become unpredictable.  Warnings are also displayed directly to the
end user in the form of redefined constants.

This patch fixes the problem by renaming Puppet::Module::Tool inside of
Puppet to Puppet::ModuleTool  This fixes the problem because Puppet will
no longer monkey-patch the Puppet::Module::Tool module inside of the
puppet-module Gem.

This patch also has the added benefit of making the Module's name match
up with the CamelCase filepath (puppet/module_tool/ =&gt;
Puppet::ModuleTool)  As a result, no file moves are necessary.
</code></pre>

<p>(#13682) Fix acceptance test failures</p>

<pre><code>On Lucid, /usr/share/puppet may not exist.  The module upgrade tests all
make the assumption that this parent directory exists.  This causes
false positive failures when running systest against a Lucid system.

This patch modifies the setup code for all of the tests to ensure the
parent directory exists.
</code></pre>

<p>(maint) Ensure every file has a trailing newline</p>

<pre><code>Without this patch some files exist in the tree that don't have trailing
newlines.  This is annoying because perl -pli.bak -e will automatically
add a newline to every file it modifies in place.  The files that
actually have modifications by the global search and replace need to be
separated from the files that only have newlines added.

This patch simply adds newlines to everything if they don't exist on the
last line.

Yes, the PNG's are perfectly fine with a trailing newline as well.
</code></pre>

<p>(#14036) Handle upstart better</p>

<pre><code>Change the upstart provider to better handle the mix of some services
that are upstart controlled and some that are init script controlled.
</code></pre>

<p>(#14060) Fix quoting of commands to interpolate inside the shell.</p>

<pre><code>The `shell` exec provider was supposed to emulate the behaviour of 0.25 exec,
which was to pass the content through the default shell to get it executed.

Unfortunately, it got quoting a bit wrong, and ended up interpolating
variables at the wrong point - it used double quotes where single quotes were
really what was desired.

Thanks to Matthew Byng-Maddick for the report, and a fix to the quoting; in
the end we should not be in this position - we shouldn't be using string
execution where we can pass an array instead.  That avoids any chance that
there is more than one round of shell interpolation entirely.

As a bonus, this fixes the base exec type to support specifying the command to
run that very way, and making it good.
</code></pre>

<p>(#14101) Improve deprecation warning for dynamic lookup</p>

<pre><code>The new message will tell the user how to get more information about
what is occuring. More information will be provided at debug level so
that a user can see what the change to the lookup will be.
</code></pre>

<p>Better warnings about scoping</p>

<p>Make new scoping look through inherited scopes</p>

<pre><code>Previous to this commit, Puppet would look through a given scope
hierarchy and give deprecation warnings when a value was found in either
an inherited class scope or included class scope, when it should only
give the warning in the case of the included class scope.
This commit makes the new-scope behavior also examine inherited scopes,
though continuing to ignore included scopes.
</code></pre>

<p>Implement newlookupvar() to replace dynamic scope</p>

<pre><code>lookupvar() is shifted to oldlookupvar() and newlookupvar() is added. An
intermediary lookupvar() function will query both and if the answer
varies then it will throw a deprecation warning for dynamic scoping. The
intermediary and old lookup functions may be removed at a later date,
thus completing the transition.
A test case has been introduced to detect dynamic scoping and the
deprecation warning. Slight modifications to the spec test scoping
objects were made to bring them more in line with the real world.
All scope tests pass. When oldlookupvar is replaced, the deprecated
dynamic scoping test case will fail and all other scope test cases will
pass.
</code></pre>

<p>Augeas Improvements</p>

<p>(#11988) Work around Augeas reload bug when changing save modes</p>

<pre><code>After saving a file in one save mode and switching to another,
Augeas realise
to reload the file when Augeas#load is called again.  Work around this by
explicitly reloading all files we saved while using the first save mode.
</code></pre>

<p>(#11988) Don&#8217;t overwrite symlinks in augeas provider</p>

<pre><code>Previously, if not running with `force` set, we would try to write the
file in SAVE_NEWFILE mode to create a &lt;filename&gt;.augnew file with the
changes. We determined whether there were changes to be made based on
that file (and used it to show a diff). When it came time to actually
make the changes, we would simply move the .augnew file over the file
being managed. Unfortunately, if the file being managed were a symlink,
this would clobber it.

There was a fallback path in the case of force (or older versions of
augeas not supporting SAVE_NEWFILE) in which we would make the
changes in SAVE_OVERWRITE mode as normal. Now, the behavior is a
combination of the two; we still use SAVE_NEWFILE to determine whether
changes need to be made and to show a diff, but then remove the .augnew
file and always run again in SAVE_OVERWRITE mode to save the changes.
This effectively delegates the behavior of preserving the file, etc.
to augeas, so we don't duplicate effort or bugs.
</code></pre>

<p>(#13204) Don&#8217;t ignore missing PATH.augnew files</p>

<pre><code>The original fix for #13204 may have masked other potential bugs if the
PATH.augnew file was missing.  It simply tested for the file
existance and not
only when duplicate save events occurred.
This change de-duplicates the list of save events instead, so if a
bug appeared
where PATH.augnew was genuinely missing, the error wouldn't be squashed.
</code></pre>

<p>(#13204) Workaround duplicate Augeas save events</p>

<pre><code>Bug #264 in Augeas causes duplicate save events to be returned when editing
under /boot in newfile mode.  Because we loop around these events,
diffing and unlinking the files, this causes an ENOENT error when we process
the same event twice.

This commit checks that the file we intend to operate on exists.
</code></pre>

<p>(#7592) Remove redundant call to String#to_s</p>

<pre><code>Previously, the augeas provider made calls like the following:
@aug.get(key).to_s
Since the Augeas#get method returns a String not an array, the to_s
call is redundant. (Note the #match method does return an array.)
The augeas tests were stubbing the #get method to return an array in
some places (and a string in others). Prior to 1.9.2, ruby will
automatically convert ["foo"].to_s to "foo", so everything worked as
expected. However, under 1.9.2, ["foo"].to_s becomes "[\"foo\"]".
These failures weren't noticed earlier, because our 1.9.2@allFeatures
jenkins nodes do not have ruby-augeas installed. In other words, tests
that require Puppet.features.augeas? were never running in
Jenkins. The recent change to improve augeas testing, removed the
dependency on this feature being installed, so these tests started
failing.
This commit just removes the redundant call to String#to_s, and
updates the spec tests to match what the Augeas#get method really
returns.
</code></pre>

<p>Zypper Provider Improvements</p>

<p>(#8312) Fix zypper provider so ensure =&gt; &#8216;latest&#8217; now works</p>

<pre><code>Previously the regular expression to match the correct column from
'zypper list-updates' was wrong, it seems to have been based on the command
'zypper packages' instead. This was caused ensure =&gt; 'latest' to fail as the
provider couldn't adequately figure out what newer versions were actually
availabe.
So I've fixed the regular expression (based on Felix Frank's
patch) and updated
the spec test so that it uses the real output from zypper
list-updates and now
references an external spec file, as apposed to referencing the
content inline.
</code></pre>

<p>Windows Bugfixes</p>

<p>(#12392) Created Windows eventlog message resource dll</p>

<pre><code>This commit adds the ability to build a message resource dll used to
display localized eventlog messages on Windows. Windows eventlog expects
that each log event has a unique id, which can then be localized in a
resource dll, one for each locale. However, puppet does not yet support
this, see #11076. So this commit defines three puppet event ids
corresponding to the three levels of Windows events that we support
(info, warn, and error).
In order to build the dll, you need the Windows SDK installed that
contains the mc, rc, and link utilities.
</code></pre>

<p>(Maint) Don&#8217;t assume eventlog gem is installed on Windows</p>

<pre><code>Previously, the test would fail when run on a Windows box that didn't
have the eventlog gem installed. Since the Windows agent should be able
to run without the gem installed, and fall back to writing to a log
file, this commit changes the test to only run when the gem is
installed. There is already a test that verifies that we fall back if
the eventlog feature is not available.
</code></pre>

<h2 id="puppet-2713">Puppet 2.7.13</h2>

<p>This is a <strong>security</strong> release in the 2.7.x branch.</p>

<h3 id="security-fixes-2">Security Fixes</h3>

<h4 id="cve-2012-1906-high---appdmg-and-pkgdmg-providers-write-packages-to-insecure-location">CVE-2012-1906 (High) - appdmg and pkgdmg providers write packages to insecure location</h4>

<p>http://puppetlabs.com/security/cve/cve-2012-1906</p>

<p>(#13260)</p>

<pre><code>If a remote source is given for a package, the package is downloaded
to a predictable filename in /tmp. It is possible to create a symlink
at this name and use it to clobber any file on the system, or by
switching the symlink install arbitrary packages (and package installers
can execute arbitrary code).
</code></pre>

<h4 id="cve-2012-1986-high---filebucket-arbitrary-file-read">CVE-2012-1986 (High) - Filebucket arbitrary file read</h4>

<p>http://puppetlabs.com/security/cve/cve-2012-1986</p>

<p>(#13511)
    It is possible to construct a REST request to fetch a file from a
    filebucket that overrides the puppet master’s defined location
    for the files to be stored. If a user has access to construct directories
    and symlinks on the machine they can read any file that the user the
    puppet master is running as has access to.</p>

<h4 id="cve-2012-1987-moderate---filebucket-denial-of-service">CVE-2012-1987 (Moderate) - Filebucket denial of service</h4>

<p>http://puppetlabs.com/security/cve/cve-2012-1987</p>

<p>(#13552,#13553)</p>

<pre><code>By constructing a marshaled form of a Puppet::FileBucket::File object a
user can cause it it to be written to any place on the disk of the puppet
master. This could be used for a denial of service attack against the
puppet master if an attacker fills a filesystem that can cause systems to
stop working. In order to do this the attacker needs no access to the
puppet master system, but does need access to agent SSL keys.

Using the symlink attack described in Bug #13511 the puppet master
can be caused to read from a stream (e.g. /dev/random) when either
trying to save a file or read a file. Because of the way in which the puppet
master deals with sending files on the filesystem to a remote system via a
REST request the thread handling the request will block forever reading from
that stream and continually consuming more memory. This can lead to the
puppet master system running out of memory and cause a denial of service.
</code></pre>

<h4 id="cve-2012-1988-high---filebucket-arbitrary-code-execution">CVE-2012-1988 (High) - Filebucket arbitrary code execution</h4>

<p>http://puppetlabs.com/security/cve/cve-2012-1988</p>

<p>(#13518)
    Filebucket arbitrary code execution
    This requires access to the cert on the agent and an unprivileged
    account on the master.  By creating a path on the master in a
    world-writable location that matches a command string, one can
    then make a file bucket request to execute that command.</p>

<h4 id="cve-2012-1989-high---telnet-utility-used-for-network-devices-writes-to-insecure-location">CVE-2012-1989 (High) - Telnet utility (used for network devices) writes to insecure location</h4>

<p>http://puppetlabs.com/security/cve/cve-2012-1989</p>

<p>(#13606)
    The telnet.rb file opens a NET::Telnet connection with an output log
    of /tmp/out.log. That log could be replaced by a symlink anywhere
    on the system and the puppet user would happily write through the
    symlink, potentially clobbering data or worse.</p>

<h2 id="puppet-2712">Puppet 2.7.12</h2>

<h3 id="features-1">Features</h3>

<ul>
  <li>Zypper package provider supports zypper 0.6</li>
  <li>Raise default key lengths in Puppet</li>
</ul>

<p>Plumbing For Puppet Module Tool improvements</p>

<ul>
  <li>Module requirements should include versions</li>
  <li>Fix SemVer&#8217;s range behavior to work with Ruby 1.9</li>
  <li>Face actions should be able to set exit codes</li>
  <li>Implement a rich console logging prototype</li>
  <li>Enhance the uninstall PMT action</li>
  <li>All forge interactions should be centralized</li>
  <li>Add module dependency errors to module list output</li>
  <li>Enhance PMT search action output</li>
</ul>

<h3 id="bug-fixes-1">Bug Fixes</h3>

<p>Windows Bug Fixes</p>

<ul>
  <li>Fix puppet agent &#8211;listen on Windows</li>
  <li>Don&#8217;t add execute bit to newly created files on Windows</li>
  <li>Skip default file permissions for sync&#8217;ed files on Windows</li>
  <li>Allow POSIX paths for files served to Windows agents</li>
  <li>Refactor Windows administrator detection</li>
  <li>
    <p>Disable puppet kick on windows</p>
  </li>
  <li>Restored agent lockfile behavior to 2.7.9;  in 2.7.10 and 2.7.11, &#8216;puppet agent &#8211;disable&#8217; begun to use a new lock file named &#8216;puppetdlock.disabled&#8217;.  This was determined to cause compatibility issues with certain external tools, so the pre-2.7.10 behavior has been restored.</li>
  <li>Agent lockfile backwards compatibility to support users upgrading from 2.7.10 or 2.7.11.</li>
  <li>Improved status / notification message when attempting to run an agent after agents have been administratively disabled (via &#8216;puppet agent &#8211;disable&#8217;).</li>
  <li>Cron error messages on Windows less cryptic</li>
  <li>Don&#8217;t overwrite symlinks in augeas provider</li>
  <li>Fix zypper provider so ensure =&gt; &#8216;latest&#8217; works</li>
</ul>

<h3 id="details">Details</h3>

<p>(#11988) Don&#8217;t overwrite symlinks in augeas provider</p>

<pre><code>Previously, if not running with `force` set, we would try to write the
file in SAVE_NEWFILE mode to create a &lt;filename&gt;.augnew file with the
changes. We determined whether there were changes to be made based on
that file (and used it to show a diff). When it came time to actually
make the changes, we would simply move the .augnew file over the file
being managed. Unfortunately, if the file being managed were a symlink,
this would clobber it.

There was a fallback path in the case of force (or older versions of
augeas not supporting SAVE_NEWFILE) in which we would make the
changes in SAVE_OVERWRITE mode as normal. Now, the behavior is a
combination of the two; we still use SAVE_NEWFILE to determine whether
changes need to be made and to show a diff, but then remove the .augnew
file and always run again in SAVE_OVERWRITE mode to save the changes.
This effectively delegates the behavior of preserving the file, etc.
to augeas, so we don't duplicate effort or bugs.
</code></pre>

<p>(#8312) Fix zypper provider so ensure =&gt; &#8216;latest&#8217; now works</p>

<pre><code>Previously the regular expression to match the correct column from
'zypper list-updates' was wrong, it seems to have been based on the command
'zypper packages' instead. This was caused ensure =&gt; 'latest' to fail as the
provider couldn't adequately figure out what newer versions were actually
availabe.

So I've fixed the regular expression (based on Felix Frank's patch) and updated
the spec test so that it uses the real output from zypper list-updates and now
references an external spec file, as apposed to referencing the content inline.
</code></pre>

<p>(#12914) Allow puppet to be interrupted while waiting for child</p>

<pre><code>Previously, puppet on Windows could not be interrupted, e.g. Ctrl-C,
while waiting for a child process it executed to exit. For example,
when executing a pre/post run command.

This commit changes puppet to poll the state of the child process'
handle, sleeping for 1 second in between.
</code></pre>

<p>(#12844) Agent lockfiles: backwards compatibility with 2.7.10/2.7.11</p>

<pre><code>In 2.7.10 there was a change in behavior introduced with regards
to agent lockfiles.  Basically we split the concept of "an agent
is currently running" apart from the concept of "the agent has
been administratively disabled" by using 2 different lockfiles.

That change was determined to have broken compatibility with
mcollective, so it has been reverted as of 2.7.12.

This commit provides backwards compatibility between 2.7.12+
and 2.7.10/2.7.11 for cases where a user may have administratively
disabled their agent and then upgraded to a newer version of puppet.
</code></pre>

<p>(#12881) Fix cron type default name error on windows</p>

<pre><code>On windows I ran into this error with the cron type:

    err: Failed to apply catalog: undefined method 'name' for nil:NilClass

Without this patch, the problem appears to be that the cron type name
parameter defaults to the following block:

    defaultto { Etc.getpwuid(Process.uid).name || "root" }

On windows `Etc.getpwuid(Process.uid)` returns `nil`.  This patch fixes
the problem by binding the object returned by
`Etc.getpwuid(Process.uid)` to a variable.  We then check if the
variable responds to the `name` method, and only send a message to name
if so.  Otherwise, we return "root"
</code></pre>

<p>(#12933) Better error message when agent is administratively disabled</p>

<pre><code>Detect the difference between the cases where an agent run is
aborted due to another agent run already in progress vs. being
aborted due to the agent being administratively disabled via
'--disable', and print a more useful message for the latter case.
</code></pre>

<p>(#12080) Implement a rich console logging prototype.</p>

<pre><code>The new telly_prototype_console log destination aims to be a more human-friendly logging
endpoint, and acts as a prototype of some of the work we plan to build into Telly.
</code></pre>

<p>(#12106) Enhance the uninstall PMT action for UX</p>

<pre><code>Before this patch the uninstall action only uninstalled puppet modules by
name. The uninstallation of a module consists of removing a directory in
the module path that matches the name of the module. This does not take
into account the version of the module installed.

This patch changes the behaviour of the uninstall action with the
following features:

* Modules can be uninstalled by specific version
* Modules can be uninstalled by enviornment
* Output of the unistall command has been enhanced to provide a better UX

This patch also includes updated specs for the change in behaviour.
</code></pre>

<p>(#12244) All forge interactions should be centralized</p>

<pre><code>Before this patch each module application makes direct connection to the
Puppet Forge. This is a maintenance nightmare, any changes to the
Forge API requires changes to all the module applications.

This patch re-factors how we communicate with the Forge. All module
application now use the interface exposed by the `lib/puppet/forge.rb`
module.

This patch also includes tests for the new forge.rb module, and updates
others to reflect the new behaviour.
</code></pre>

<p>(#12256) Fix SemVer&#8217;s range behavior to work with Ruby 1.9</p>

<pre><code>In Ruby 1.9 Range's implementation of include? changed so that if the
objects being compared were non-numeric it would iterate over them
instead of doing a comparison with the endpoints.  We're subclassing
numeric to force non-discrete range behavior.

Numeric doesn't allow singleton methods to be defined, so we had to
change the way inspect worked when dealing with MIN and MAX values.

Paired-with: Pieter van de Bruggen &lt;pieter@puppetlabs.com&gt;
</code></pre>

<p>(#12256) module_requirements should include versions</p>

<pre><code>Before this patch module requirements do not include version numbers.
Since modules with the same name, but different version numbers, can be
installed at the same time -- in different parts of the modulepath,
there is no way to tell which module has the dependency.

This patch fixes this issue by changing the data structure that
represents module requirements from a two item Array to a Hash with
three keys: name, version, and version_requirement.

This patch includes updated spec tests related to this change.
</code></pre>

<p>(#10299) Use CheckTokenMembership to see if user has admin rights</p>

<pre><code>Previously, on Windows 2003 and earlier, Puppet.features.root? was
implemented by checking if the current user is a member of the local
Administrators group. However, many accounts, e.g. LocalSystem, are
implicit members of this group, so Puppet.features.root? would
incorrectly return false. This led to puppet not being able to find
its default configuration directory, among other things.

Conversely, a process can be executing using a restricted token, so
while the user may be a member of the Administrators group, the
process will be running with less privileges, and
Puppet.features.root?  would incorrectly return true.

This commit uses CheckTokenMembership to determine if the local
Administrators group SID is both present and enabled in the calling
thread's access token.

The behavior on Vista/2008 is unchanged. The calling thread's token
must be currently elevated.
</code></pre>

<p>(#12725) Fix puppet agent &#8211;listen on Windows</p>

<pre><code>Previously, running `puppet agent --listen` failed on Windows, because
we were trying to set the Fcntl::FD_CLOEXEC flag on webrick's http
access log, but Windows does not support that flag.

There are ways to prevent file handles from being inherited across
calls to CreateProcess (either disabling inheritance on a given handle
or preventing all handles from being inherited). But for now, this
commit just skips setting the flag on Windows.

This commit also re-enables spec tests that were disabled on
Windows. The thinking previously is that webrick would never run on a
Windows agent, but that's not true.
</code></pre>

<p>(#11740) Wait on the handle from the PROCESS_INFORMATION structure</p>

<pre><code>Previously, the `Puppet::Util.execute` method was using `waitpid2` to
wait for the child process to exit and retrieve its exit status. On
Windows, this method (as implemented by the win32-process gem) opens a
handle to the process with the given pid, and then calls
`WaitForSingleObject` and `GetExitCodeProcess` on the process
handle. However, the pid-to-handle lookup will raise an exception if
the child process has exited. As a result there was a race condition
whereby puppet could sometimes fail to retrieve the exit status of
child processes.

The normal way of getting the exit code for a child process on Windows
is to use the child process handle contained in the
`PROCESS_INFORMATION` structure returned by `CreateProcess`. This
works regardless of whether the child process is currently executing
or not.

This commit reworks the `Puppet::Util.execute_windows` method to wait
on the child process handle contained in the process information
structure. This requires that we pass the `:close_handles =&gt; false`
option to the win32-process gem so that it doesn't close the handles.

This commit also re-enables tests that were previously being skipped
due to this bug.
</code></pre>

<p>(#11408): Don&#8217;t add execute bit to newly created files on Windows</p>

<pre><code>Previously, if a directory was executable for owner or group, then any
file created at a later time in the directory would have its execute
bit set. For example, if a directory's mode is set to 0750, then any
file created in the directory at a later time would have the same
mode.

This causes the file mode to change unnecessarily across puppet
runs. For example, when puppet starts for the first time, it creates a
$vardir/certs directory that is executable. During the same run, it
writes out its signed cert, which is now executable. The second time
puppet runs, it sees that the mode is out-of-sync, it should be 0644,
and changes the mode.

If the same scenario occurs to a service's configuration file, then
puppet could bounce the service unnecessarily.

This commit creates two sets of inherit-only access control entries on
the parent directory. One set applies the same permissions from the
parent directory to its subdirectories (containers) at creation time. The other set
masks off the execute bit for its files (objects) at creation time.

Note puppet always has FULL_CONTROL (which includes FILE_EXECUTE) for
files it creates, so this commit does not prevent puppet from being
able to execute content that it downloads. It only prevents group and
other from having execute permission by default.

In order to grant execute permission to group and other on a file that
puppet manages, you must explicitly specify the appropriate mode in
the file's resource.
</code></pre>

<p>(#11408) Allow POSIX paths for files served to Windows agents</p>

<pre><code>Previously, Windows agents would fail during fact and plugin sync. The
agent would retrieve the remote file metadata and attempt to set the
metadata's path based on the path of the file as it exists on the
remote system. Since the remote system is typically a POSIX puppet
master, our `Puppet::Util.absolute_path?` path check would fail on
Windows.

To complicate matters, the path of the "remote" file can in fact be a
Windows-style path, such as when using puppet apply and a modulepath
that refers to the local filesystem.

This commit changes the `Puppet::FileServing::Base#path=` method to
allow both POSIX and Windows style paths on Windows hosts, but only
allows POSIX style paths on POSIX hosts, since we don't support
running puppet master on Windows.
</code></pre>

<p>(#6663) Raise default key lengths in Puppet.</p>

<pre><code>The CA key length was lower than it should be - 1024 bits is no longer secure
enough for real world use.  This raises both client and CA certs to use 4096
bit keys.  Those are slow, but effective for long term security.

People who know enough to decide that the trade-off of speed vs limited window
of security can still totally reduce the size of the key without much trouble,
but we default to being more cautious.

This also pegs the key lengths low in testing, since building a 4K key is
awful slow if you want to do it time and time again over the course of dozens
of tests.
</code></pre>

<h2 id="puppet-2711">Puppet 2.7.11</h2>

<p>This is a <strong>security, and bug fix</strong> release in the 2.7.x branch.</p>

<h3 id="security-fixes-3">Security Fixes</h3>

<h4 id="cve-2012-1053-group-privilege-escalation">CVE-2012-1053 (Group Privilege Escalation)</h4>

<p>http://puppetlabs.com/security/cve/cve-2012-1053/</p>

<p>(#12457, #12458, #12459)
A bug in Puppet gives unexpected and improper group privileges to execs and types/providers.
When executing commands as a different user, Puppet leaves the forked
process with Puppet’s own group permissions. Specifically:</p>

<ul>
  <li>Puppet’s primary group (usually root) is always present in a process’s supplementary groups.</li>
  <li>When an exec resource is assigned a user to run as but not a group,</li>
  <li>Puppet will set its effective GID to Puppet’s own GID (usually root).</li>
  <li>Permanently changing a process’s UID and GID won’t clear the supplementary groups, leaving the process with Puppet’s own supplementary groups (usually including root).</li>
</ul>

<p>This causes any untrusted code executed by a Puppet exec resource to
be given unexpectedly high permissions.</p>

<h4 id="cve-2012-1054-user-privilege-escalation">CVE-2012-1054 (User Privilege Escalation)</h4>

<p>http://puppetlabs.com/security/cve/cve-2012-1054/</p>

<p>(#12460)</p>

<p>If a user’s <code>.k5login</code> file is a symlink, Puppet will overwrite the
link’s target when managing that user’s login file with the k5login
resource type. This allows local privilege escalation by linking a
user’s <code>.k5login</code> file to root’s <code>.k5login</code> file.</p>

<p>2.7.11 also addresses the following regressions in the 2.7.10 release
#12572, #12188, #12412, #2927, #12296, #12310, #12464</p>

<h2 id="puppet-2710">Puppet 2.7.10</h2>

<h3 id="pulled-due-to-regressions-from-279">Pulled due to regressions from 2.7.9</h3>

<p>We are continuing to see several issues introduced Puppet 2.7.10.  We
are recommending that users discontinue its usage.  This could mean
using 2.7.9 or waiting patiently until we can get 2.7.11 out the door.</p>

<p>These are the most significant tickets around the  2.7.10 regressions.
#12310, #2927, #12269, #12588</p>

<h4 id="community-mvp-for-this-release-brice-figureau-masterzen-for-the">Community MVP for this release: Brice Figureau (@masterzen) for the</h4>
<p>Instrumentation Framework</p>

<h4 id="highlights">Highlights</h4>
<p>We have several section of release notes this month due to the high volume of commits.  Sections are Instrumentation, Core, Mac OS, Windows, and FreeBSD.</p>

<ul>
  <li>Instrumentation Features available</li>
  <li>Symbolic File modes supports ( e.g. u=rw,go=r) for File type</li>
  <li>Write reports to a temporary file and move them into place</li>
  <li>Add password get/set behavior for Mac OS X 10.7</li>
  <li>Add support for user expiriy in pw user provider</li>
  <li>Improve pw group provider on FreeBSD</li>
  <li>Make sure managehome is respected on FreeBSD</li>
  <li>Add password management on FreeBSD</li>
</ul>

<h4 id="bug-fixes-2">Bug Fixes</h4>
<ul>
  <li>Make the Debian service provider handle services that don&#8217;t conform to the debian policy manual.</li>
  <li>Only load facts once per run</li>
  <li>Puppetd removes pid file upon exit</li>
  <li>Fix MySQL deadlock possibility within inventory service</li>
  <li>Test Augeas versions correctly with versioncmp</li>
  <li>Consider package epoch version when comparing yum package versions</li>
  <li>Link should autorequire target</li>
  <li>Use SMF&#8217;s svcadm -s option to wait for errors</li>
  <li>Fix fact and plugin sync on Windows</li>
  <li>Set password before creating user on Windows</li>
  <li>Always serve files in binary mode on Windows</li>
  <li>Don&#8217;t hard code ruby install paths in Windows batch files</li>
  <li>Don&#8217;t copy owner and group when sourcing files from master on Windows</li>
  <li>Fix OS X supplementary group handling</li>
  <li>Use launchctl load -w in launchd provider (Mac OS)</li>
  <li>Improve error msg for missing pip command</li>
  <li>Better validation for IPv4 and IPv6 address in host type.</li>
</ul>

<h4 id="instrumentation">Instrumentation</h4>
<p>Contributed by:  Brice Figureau <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#098;&#114;&#105;&#099;&#101;&#045;&#112;&#117;&#112;&#112;&#101;&#116;&#064;&#100;&#097;&#121;&#115;&#111;&#102;&#119;&#111;&#110;&#100;&#101;&#114;&#046;&#099;&#111;&#109;">&#098;&#114;&#105;&#099;&#101;&#045;&#112;&#117;&#112;&#112;&#101;&#116;&#064;&#100;&#097;&#121;&#115;&#111;&#102;&#119;&#111;&#110;&#100;&#101;&#114;&#046;&#099;&#111;&#109;</a></p>

<p>The Puppet Instrumentation Framework is a tool to install into a puppet
executable:</p>

<ul>
  <li>instrumentation listeners</li>
  <li>code probes</li>
</ul>

<p>Code probes are static commands we add to the Puppet codebase to
instrument some specific parts of the code. Currently only the
Indirector is covered (but since it is the central piece of Puppet, it
should cover a lot of possible use).</p>

<p>Each time the program reaches a code probe (and instrumentation is
enabled), the Instrumentation Framework sends an event to the registered
instrumentation listeners. Those can be enabled/disabled/added/removed
live without restarting the executable.
Those listeners responsibility is to produce something useful to the
user. The patch shipped with 3 example listeners, one that logs
execution time of every probe, another that aggregate some performance
data about probes, and the final one decorates the executable process
name (as seen in top) with the latest probes it encounters.</p>

<p>The Framework also includes a set of REST API and REST Faces to allow it
to enable/disable listeners or probes or to get access to listener
performance data if they produce some.</p>

<p>How to use the Instrumentation Framework:</p>

<p>You need a live running Puppet executable (preferably a puppet master
which by default listens to REST requests). It might also be necessary
to modify the auth.conf to allow the instrumentation requests.</p>

<p>Display the list of known instrumentation listeners
    puppet instrumentation_listener search x &#8211;terminus rest</p>

<p>Enable the &#8220;performance&#8221; instrumentation listener
    puppet instrumentation_listener enable performance &#8211;terminus rest</p>

<p>Know more about the &#8220;performance&#8221; listener (is it enabled for
instance):
    puppet instrumentation_listener find performance &#8211;terminus rest</p>

<p>Of course this will only work if probes are enabled:</p>

<p>List all the current executable probes:
     puppet instrumentation_probe search x &#8211;terminus rest</p>

<p>Enable the instrumentation probes:
     puppet instrumentation_probe enable &#8211;terminus rest</p>

<p>How to get access to the data coming from a listener (here the
&#8220;performance&#8221; one):
    puppet instrumentation_data find performance &#8211;terminus rest</p>

<h4 id="core">Core</h4>

<h4 id="improve-error-msg-for-missing-pip-comand">Improve error msg for missing pip comand</h4>
<p>Author: Kelsey Hightower <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#107;&#101;&#108;&#115;&#101;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#107;&#101;&#108;&#115;&#101;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11958) Improve error msg for missing pip command</p>

<p>Without this patch the pip package provider does not produce a user
friendly error message when the pip command is not available. The
current error message looks like this:</p>

<pre><code>    err: /Stage[main]/Dummy/Package[virtualenv]/ensure: change from
    absent to present failed: Could not set 'present on ensure:
    undefined method `pip' for
    #&lt;Puppet::Type::Package::ProviderPip:0xb6cf6cd0&gt; at
    /etc/puppet/modules/dummy/manifests/init.pp:5
</code></pre>

<p>This patch improves the error message by passing a string argument, &#8216;Could not locate
the pip command.&#8217;, when raising the <code>NoMethodError</code>. The new error
message looks like this:</p>

<pre><code>    err: /Stage[main]/Dummy/Package[virtualenv]/ensure: change from
    absent to present failed: Could not set 'present on ensure: Could
    not locate the pip command. at
    /etc/puppet/modules/dummy/manifests/init.pp:5
</code></pre>

<p>This patch also includes updated spec tests validating this change. No
other behavior changes are being introduced.</p>

<h3 id="better-validation-for-ipv4-and-ipv6-address-in-host-type">Better validation for IPv4 and IPv6 address in host type.</h3>
<p>Author: Daniel Pittman <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#097;&#110;&#105;&#101;&#108;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#100;&#097;&#110;&#105;&#101;&#108;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11499) Better validation for IPv4 and IPv6 address in host type.</p>

<p>The previous code was fairly lax in validation, and would allow a bunch of
invalid addresses through - as well as rejecting some legal, but uncommon,
IPv6 address types.</p>

<p>This adds substantial testing, especially around IPv6 addressing, and replaces
the older validation with new, fancy stuff that works for all the cases.</p>

<h3 id="support-symbolic-file-modes">Support symbolic file modes.</h3>
<p>Author: Daniel Pittman <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#097;&#110;&#105;&#101;&#108;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#100;&#097;&#110;&#105;&#101;&#108;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#2927) Support symbolic file modes.</p>

<p>This adds a new feature, support for symbolic file modes, to Puppet.  In
addition to being able to specify the octal mode, you can now use the same
symbolic mode style that chmod supports:</p>

<pre><code>    file { "/example": mode =&gt; "u=rw,go=r" }
</code></pre>

<p>This also supports relative file modes:</p>

<pre><code>    file { "/relative": mode = "u+w,go-wx" }
</code></pre>

<p>Support is based on the common GNU and BSD symbolic modes of operation; you
specify a comma separated list of actions to take in each you can sit:</p>

<p>The user (u), group (g), other (o), or all (a) of the permission map.</p>

<p>You can modify the ability to read (r), write (w), execute / search (x) on a
 file or directory.</p>

<p>You can also modify the sticky bit (t), or the setuid and setgid bits (s).</p>

<p>Finally, you can set conditional execute permissions (X), which will result in
the file having the execute bit if the target is a directory, or if the target
had <em>any</em> execute bit set.  (eg: g+X will set x if the original was u=x,g=.)</p>

<h3 id="only-load-facts-once-per-puppet-run">Only load facts once per puppet run</h3>

<p>Author: Patrick Carlisle <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#112;&#097;&#116;&#114;&#105;&#099;&#107;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#112;&#097;&#116;&#114;&#105;&#099;&#107;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#8341) Only load facts once per puppet run</p>

<p>Make the facter terminus the only place that loads facts (with the notable
exception of pluginsync which loads any ruby code it syncs).</p>

<p>This should satisfy several requirements:</p>

<ul>
  <li>daemonized puppet agent can get fresh facts on each run</li>
  <li>puppet master can load facts</li>
  <li>facts are not loaded more than once by the puppet agent fact handler</li>
</ul>

<h3 id="puppetd-does-not-remove-its-pidfile-when-it-exits">Puppetd does not remove its pidfile when it exits</h3>
<p>Author: R.I.Pienaar <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#114;&#105;&#112;&#064;&#100;&#101;&#118;&#099;&#111;&#046;&#110;&#101;&#116;">&#114;&#105;&#112;&#064;&#100;&#101;&#118;&#099;&#111;&#046;&#110;&#101;&#116;</a></p>

<p>(#5246) Puppetd does not remove its pidfile when it exits</p>

<p>The Puppet::Daemon instance sets up the pid file when it starts
but it&#8217;s up to the user of that object to arrange for stop to be
called</p>

<p>There are signal handlers setup to call stop but in a onetime run
those are never called</p>

<p>This change arrange for the stop method to be called after a onetime
run is done but do not hand the task of exiting the application over
to that so that the agent application can handle the report status
based exit codes</p>

<h3 id="retry-inventory-activerecord-transaction-failure">Retry inventory ActiveRecord transaction failure</h3>
<p>Author: Carl Caum <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#099;&#097;&#114;&#108;&#064;&#099;&#097;&#114;&#108;&#099;&#097;&#117;&#109;&#046;&#099;&#111;&#109;">&#099;&#097;&#114;&#108;&#064;&#099;&#097;&#114;&#108;&#099;&#097;&#117;&#109;&#046;&#099;&#111;&#109;</a></p>

<p>Retry inventory ActiveRecord transaction failure</p>

<p>Previous to this commit, if the ActiveRecord transaction for saving
facts failed do to MySQL deadlock, for example, the transaction would
fail printing a message to the user.  This primarily occurred during a
PE agent installation if multiple agent&#8217;s were being creating
simultaneously.</p>

<p>This commit adds the ability to retry if a
ActiveRecord::StatementInvalid exception is thrown.  To accomplish this,
this commit ports Cloud Provisioner&#8217;s
Puppet::CloudPack::Utils#retry_action method to Puppet core under
Puppet::Util::RetryAction#retry_action.</p>

<h3 id="properly-track-blockers-when-generating-additional-resources">Properly track blockers when generating additional resources</h3>
<p>Author: Nick Lewis <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#110;&#105;&#099;&#107;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#110;&#105;&#099;&#107;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11641) Properly track blockers when generating additional resources</p>

<p>Previously, we would enqueue any unblocked resources as we added them to the
graph. These were our initial resources, with no dependencies, and served as a
starting place for traversal. However, we would
add_dynamically_generated_resources before traversing, which could add
additional resources and dependencies. We never accounted for these, causing
our measure of blockedness to become incorrect (a resource could have more
dependencies than we counted).</p>

<p>This is similar to the case of eval_generate adding additional resources. In
that case, we clear the blockers list and allow it to be recalculated on
demand. Unfortunately, that approach doesn&#8217;t work for the case where we add
resources before traversing (as in add_dynamically_generated_resources),
because we wouldn&#8217;t have a reliable list of resources to begin traversal with.
Now we no longer enqueue resources when adding them, and instead wait until
after we have called add_dynamically_generated_resources (which happens only
once). This allows us to add our root resources with the assurance they won&#8217;t
change before we start evaluating them.</p>

<h3 id="make-the-debian-service-provider-handle-services-that-dont-conform-to-the-debain-policy-manual">Make the Debian service provider handle services that don&#8217;t conform to the debain policy manual.</h3>
<p>Author: Zach Leslie <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#122;&#097;&#099;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#122;&#097;&#099;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#7296) Make the Debian service provider handle services that don&#8217;t conform to the debain policy manual.</p>

<p>This change is to support initscripts that do not support the &#8211;query
method of invoke-rc.d used by the Debian provider to determine if
service is enabled.</p>

<p>The fix checks that the link count in /etc/rc?.d is equal to 4, which is
the number of links that should be present when using the Debian service
provider, which is done by <code>update-rc.d #{service} defaults</code>.</p>

<h3 id="write-reports-to-a-temporary-file-and-move-them-into-place">Write reports to a temporary file and move them into place</h3>
<p>Author: Ricky Zhou <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#114;&#105;&#099;&#107;&#121;&#064;&#102;&#101;&#100;&#111;&#114;&#097;&#112;&#114;&#111;&#106;&#101;&#099;&#116;&#046;&#111;&#114;&#103;">&#114;&#105;&#099;&#107;&#121;&#064;&#102;&#101;&#100;&#111;&#114;&#097;&#112;&#114;&#111;&#106;&#101;&#099;&#116;&#046;&#111;&#114;&#103;</a></p>

<p>(#8119) Write reports to a temporary file and move them into place</p>

<p>When writing reports, there is a window in between opening and writing to the
report file when the report file exists as an empty file. This makes writing
report processors a little annoying as they have to deal with this case. This
writes the report into a temporary file then renames it to the report file.</p>

<h3 id="test-augueas-versions-correctly-with-versioncmp">Test Augueas versions correctly with versioncmp</h3>
<p>Author: Dominic Cleal <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#099;&#108;&#101;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#100;&#099;&#108;&#101;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></p>

<p>(#11414) Test Augeas versions correctly with versioncmp</p>

<p>The release of Augeas 0.10.0 broke simplistic version comparisons with the &gt;=
operator, so now use versioncmp.</p>

<h3 id="saveexecute-changes-on-versions-of-augeas--036">Save/execute changes on versions of Augeas &lt; 0.3.6</h3>
<p>Author: Dominic Cleal <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#099;&#108;&#101;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#100;&#099;&#108;&#101;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></p>

<p>(#11414) Save/execute changes on versions of Augeas &lt; 0.3.6</p>

<p>Versions of Augeas prior to 0.3.6 didn&#8217;t report their version number, so a
fallback of executing changes once in need_to_run? and again in execute_changes
is performed.  Otherwise a save is done in need_to_run? and this is re-used in
execute_changes.</p>

<p>The /augeas/events/saved node is used to tell whether the latter optimisation
happened, but the return value of #match wasn&#8217;t tested correctly (it&#8217;s an empty
array).</p>

<h3 id="make-puppettypeensurable-false-when-exists-is-undefined">Make Puppet::Type.ensurable? false when exists? is undefined</h3>
<p>Author: Ilya Sher <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#105;&#108;&#121;&#097;&#046;&#115;&#104;&#101;&#114;&#064;&#099;&#111;&#100;&#105;&#110;&#103;&#045;&#107;&#110;&#105;&#103;&#104;&#116;&#046;&#099;&#111;&#109;">&#105;&#108;&#121;&#097;&#046;&#115;&#104;&#101;&#114;&#064;&#099;&#111;&#100;&#105;&#110;&#103;&#045;&#107;&#110;&#105;&#103;&#104;&#116;&#046;&#099;&#111;&#109;</a></p>

<p>(#11333) Make Puppet::Type.ensurable? false when exists? is undefined</p>

<p>Puppet::Type.ensurable? incorrectly returned true even when
public_method_defined?(:exists?) was false because the check never
actually happened. This make sure all the necessary methods are checked
and adds tests.</p>

<h3 id="consider-package-epoch-version-when-comparing-yum-package-versions">Consider package epoch version when comparing yum package versions</h3>
<p>Author: Jude Nagurney <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#117;&#100;&#101;&#064;&#112;&#119;&#097;&#110;&#046;&#111;&#114;&#103;">&#106;&#117;&#100;&#101;&#064;&#112;&#119;&#097;&#110;&#046;&#111;&#114;&#103;</a></p>

<p>(#8062) Consider package epoch version when comparing yum package versions</p>

<p>By including the epoch version in the version returned as the &#8220;latest&#8221;
available, we can now properly consider package updates where only the
epoch version has changed.</p>

<h3 id="log-when-we-start-evaluating-resource-at-the-info-level">Log when we start evaluating resource at the info level</h3>
<p>Author: Patrick Carlisle <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#112;&#097;&#116;&#114;&#105;&#099;&#107;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#112;&#097;&#116;&#114;&#105;&#099;&#107;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#4865) Log when we start evaluating resources at the info level</p>

<p>Since we log the final time at info it makes sense to log the start at info as
well.</p>

<h3 id="fix-array-support-in-schedules-range-parameters">Fix array support in schedule&#8217;s range parameters</h3>
<p>Author: Sean Millichamp <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#101;&#097;&#110;&#064;&#098;&#114;&#117;&#101;&#110;&#111;&#114;&#046;&#111;&#114;&#103;">&#115;&#101;&#097;&#110;&#064;&#098;&#114;&#117;&#101;&#110;&#111;&#114;&#046;&#111;&#114;&#103;</a></p>

<p>(#10321) Fix array support in schedule&#8217;s range parameter</p>

<p>Change the schedule type&#8217;s range parameter to properly evaluate
all elements of a supplied array for validity instead of only
checking the first member of the array. Add documentation to
clarify that range does accept an array.</p>

<p>Fix the associated tests to use must instead of should (Puppet::Type#should
shadows the rspec should).</p>

<h3 id="make-resourcefile-work-with-composite-namevars">Make resourcefile work with composite namevars</h3>
<p>Author: Max Martin <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#109;&#097;&#120;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#109;&#097;&#120;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#10109) Make resourcefile work with composite namevars</p>

<p>The code for creating the resourcefile was directly calling
resource.name_var, which was causing problems with resources that have
composite namevars (since, for these, Type#name_var will return false).
This patch sanitizes the process by first checking whether there is a
single namevar, and simply calling resource.ref if there is not one.</p>

<h3 id="add-readmedeveloper-describing-utf-8-in-puppet">Add README_DEVELOPER describing UTF-8 in Puppet</h3>
<p>Author: Jeff McCune <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#101;&#102;&#102;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#106;&#101;&#102;&#102;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11246) Add README_DEVELOPER describing UTF-8 in Puppet</p>

<p>Without this patch, developers of Puppet don&#8217;t have a clear place to get
a high level understanding of the way other Puppet developers are
working with UTF-8 and the differences in character encodings between
Ruby 1.8 and 1.9.</p>

<p>This patch addresses this problem by adding a new document,
README_DEVELOPER.md where developers and contributors can look to for
high level information.</p>

<h3 id="better-ssl-error-message-certificate-doesnt-match-key">Better SSL error message certificate doesn&#8217;t match key</h3>
<p>Author: Joshua Harlan Lifton <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#108;&#105;&#102;&#116;&#111;&#110;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#108;&#105;&#102;&#116;&#111;&#110;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#7110) Better SSL error message certificate doesn&#8217;t match key</p>

<p>Previously, any error with the certificate retrieved from the master
matching the agent&#8217;s private key would give the same static error
message, which wasn&#8217;t particularly helpful. This commit differentiates
three different error cases: missing certificate, missing private key,
and certificate doesn&#8217;t match private key. In the last case, the error
message includes the fingerprint of the certificate in question and
explicit command line instructions on how to fix the problem.</p>

<h3 id="add-a-defaults-argument-to-createresources">Add a defaults argument to create_resources</h3>
<p>Author: Matthias Pigulla <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#109;&#112;&#064;&#119;&#101;&#098;&#102;&#097;&#099;&#116;&#111;&#114;&#121;&#046;&#100;&#101;">&#109;&#112;&#064;&#119;&#101;&#098;&#102;&#097;&#099;&#116;&#111;&#114;&#121;&#046;&#100;&#101;</a></p>

<p>(#9768) Add a defaults argument to create_resources</p>

<p>Make it possible to supply defaults when calling create_resources using an
optional hash argument.</p>

<h3 id="link-should-autorequire-target">Link should autorequire target</h3>
<p>Author: Stefan Schulte <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#116;&#101;&#102;&#097;&#110;&#046;&#115;&#099;&#104;&#117;&#108;&#116;&#101;&#064;&#116;&#097;&#117;&#110;&#117;&#115;&#115;&#116;&#101;&#105;&#110;&#046;&#110;&#101;&#116;">&#115;&#116;&#101;&#102;&#097;&#110;&#046;&#115;&#099;&#104;&#117;&#108;&#116;&#101;&#064;&#116;&#097;&#117;&#110;&#117;&#115;&#115;&#116;&#101;&#105;&#110;&#046;&#110;&#101;&#116;</a></p>

<p>(#5421) Link should autorequire target</p>

<p>When we manage a local link to a directory and the target directory is
managed by puppet as well, establish an autorequire. So if we have
something like</p>

<pre><code>  file { '/foo': ensure =&gt; directory }
  file { '/link_to_foo': ensure =&gt; '/foo' }
  file { '/link_to_foo/bar': ensure =&gt; file }
</code></pre>

<p>we can ensure that puppet does not create dead links and does not try to
create &#8216;/link_to_foo/bar&#8217; before /foo is created.</p>

<h3 id="use-smfs-svcadm--s-option-to-wait-for-errors">Use SMF&#8217;s svcadm -s option to wait for errors</h3>
<p>Author: Dominic Cleal <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#099;&#108;&#101;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#100;&#099;&#108;&#101;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></p>

<p>(#10807) Use SMF&#8217;s svcadm -s option to wait for errors</p>

<p>By default running <code>svcadm enable example</code> will start the service in the
background and won&#8217;t return errors if it fails.  Using the -s option will cause
svcadm to wait and return errors back to the provider if the service cannot
start for some reason.</p>

<h3 id="added-missing-requestheader-entries-to-extrackfilesapache2conf">Added missing RequestHeader entries to ext/rack/files/apache2.conf</h3>
<p>Author: Eli Klein <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#101;&#107;&#108;&#101;&#105;&#110;&#064;&#114;&#097;&#108;&#108;&#121;&#100;&#101;&#118;&#046;&#099;&#111;&#109;">&#101;&#107;&#108;&#101;&#105;&#110;&#064;&#114;&#097;&#108;&#108;&#121;&#100;&#101;&#118;&#046;&#099;&#111;&#109;</a></p>

<pre><code>Added missing RequestHeader entries to ext/rack/files/apache2.conf
</code></pre>

<h3 id="debug-logging-when-we-start-evaluating-resources">Debug logging when we start evaluating resources.</h3>
<p>Author: Daniel Pittman <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#097;&#110;&#105;&#101;&#108;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#100;&#097;&#110;&#105;&#101;&#108;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#4865) Debug logging when we start evaluating resources.</p>

<p>The <code>evaltrace</code> option allowed individual resource evaluation time to be
tracked, which made it easier to post-hoc identify which resources took long
periods of time to process.</p>

<p>It is also helpful, when doing live debugging, to know where the hang happens;
to support that we now log a debug message about starting the evaluation of
the resource before we go into the process.</p>

<h3 id="update-storeconfigclean-script-to-read-puppetconf">Update storeconfigclean script to read puppet.conf</h3>
<p>Author: Nan Liu <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#110;&#097;&#110;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#110;&#097;&#110;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#8547) Update storeconfigclean script to read puppet.conf</p>

<p>The existing storeconfig script is parsing and reading puppet.conf
specifically from the master section. This change allows the script to
read from the settings from puppet.conf in the order of master, main,
and loads the rails default. This should match the puppet application
behaviour.</p>

<h3 id="add-mysql2-gem-support">Add mysql2 gem support</h3>
<p>Author: Stefan Schulte <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#116;&#101;&#102;&#097;&#110;&#046;&#115;&#099;&#104;&#117;&#108;&#116;&#101;&#064;&#116;&#097;&#117;&#110;&#117;&#115;&#115;&#116;&#101;&#105;&#110;&#046;&#110;&#101;&#116;">&#115;&#116;&#101;&#102;&#097;&#110;&#046;&#115;&#099;&#104;&#117;&#108;&#116;&#101;&#064;&#116;&#097;&#117;&#110;&#117;&#115;&#115;&#116;&#101;&#105;&#110;&#046;&#110;&#101;&#116;</a></p>

<p>(#9997) Add mysql2 gem support</p>

<p>Besides the mysql gem there is a mysql2 gem that is a &#8220;modern, simple
and very fast Mysql library for Ruby&#8221; [1]. It can either be installed as a
separate gem (v0.2.x) for ActiveRecord &lt; 3.1 or can be used as part of
ActiveRecord 3.1</p>

<p>To use mysql2 the dbadapter setting must be set to &#8220;mysql2&#8221; and this patch
adds support for this setting.</p>

<pre><code>[1] https://github.com/brianmario/mysql2#readme
</code></pre>

<h3 id="mac-highlights">Mac Highlights</h3>
<p>####  Fix OS X Ruby supplementary group handling
Author: Gary Larizza <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#3419) Fix OS X Ruby supplementary group handling</p>

<p>Catch Errno::EINVAL as some operating systems (OS X in particular) can
cause troubles when using Process#groups= to change the user/process
list of supplementary groups membership.</p>

<p>Test coverage has been added to check for regressions.</p>

<p>Add a test for the expected failure</p>

<h4 id="fix-group-resource-in-os-x">Fix group resource in OS X</h4>
<p>Author: Gary Larizza <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#4855) Fix group resource in OS X</p>

<p>The group provider on OS X uses “dseditgroup” to manage group
membership. Due to Apple bug 8481241 (“dseditgroup can’t remove unknown
users from groups”), however, if the puppet group provider needs to
remove a non-existant user from a group it manages, it will fail.</p>

<p>To remedy this, in the meantime, the provider will call dscl to delete
the non-existant member from the group. If that fails then the error
is rescued and feedback is provided.</p>

<h4 id="build-a-rake-task-for-building-apple-packages">Build a Rake task for building Apple Packages</h4>
<p>Author: Gary Larizza <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>Build a Rake task for building Apple Packages</p>

<h4 id="use-launchctl-load--w-in-launchd-provider">Use launchctl load -w in launchd provider</h4>
<p>Author: Gary Larizza <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#2773) Use launchctl load -w in launchd provider</p>

<p>There was an issue where a service on OS X would be enabled but also
stopped and the launchd service provider couldn&#8217;t start it. In this
case, the launchd service provider needed to execute:</p>

<pre><code>launchctl load -w JOB_PATH
</code></pre>

<p>to successfully start the service, but it wasn&#8217;t programmed
to do so.</p>

<p>To remedy this, the launchd service provider&#8217;s start method now checks
if the job is disabled OR if the job is currently stopped.</p>

<p>A spec test was added to catch for this unique situation.</p>

<h4 id="add-password-getset-behavior-for-107">Add password get/set behavior for 10.7</h4>
<p>Author: Gary Larizza <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#103;&#097;&#114;&#121;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11293) Add password get/set behavior for 10.7</p>

<p>Puppet did not have the ability to get/set passwords in OS X version
10.7.  This commit implements this behavior. Users in 10.7 have a
binary plist file in /var/db/dslocal/nodes/Default/users that contains
a &#8216;ShadowHashData&#8217; key. The value for this key is actually a binary
encrypted plist which contains a &#8216;SALTED-SHA512&#8217; key containing
a base64 encoded string. This string is actually the salted-SHA512
password hash with a 4 byte salt prepending the hash. Puppet expects
this 4 byte salt + salted-SHA512 password hash in order to set the
user&#8217;s password. Since this value is drastically different from
previous versions of OS X, Puppet will fail if you try and pass
a SHA1 password hash that was used in previous versions of OS X.</p>

<p>Spec tests were added to ensure that Puppet fails with an incorrect
password, and that the get/set behavior works properly with OS X
version 10.7.</p>

<h3 id="windows-highlights">Windows Highlights</h3>

<h4 id="always-serve-files-in-binary-mode">Always serve files in binary mode</h4>
<p>Author: Josh Cooper <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11929) Always serve files in binary mode</p>

<p>Previously, Windows agents were reading files in text mode when serving
them locally, such as when serving files from a local module, corrupting
binary files in the process.</p>

<p>This commit reads files in binary mode, which is a noop on Unix.</p>

<h4 id="use-dp0-to-resolve-bat-files-install-directory">Use <code>%~dp0</code> to resolve bat file&#8217;s install directory</h4>
<p>Author: Josh Cooper <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11714) Use <code>%~dp0</code> to resolve bat file&#8217;s install directory</p>

<p>This commit uses the <code>%~dp0</code> batch script modifier to resolve the
drive and path of the directory containing the envpuppet.bat
file. This eliminates the need for hard coded paths within the script
tselfIt also uses <code>%VAR:\=/%</code> to substitute each backslash for a
forward slash in the RUBYLIB environment</p>

<p>Also added a section about running the spec tests on Windows.</p>

<h4 id="add-envpuppet-batch-file-to-run-puppet-from-source-on-windows">Add envpuppet batch file to run Puppet from source on Windows</h4>
<p>Author: Jeff McCune <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#101;&#102;&#102;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#106;&#101;&#102;&#102;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11714) Add envpuppet batch file to run Puppet from source on Windows</p>

<p>Running Puppet on windows from source is non-trivial since the
environment variables behave quite differently.  In addition, it&#8217;s not
clear windows paths expect / rather than \ path separators.</p>

<p>This patch provides an envpuppet batch file to run Puppet from source on
Windows platforms.</p>

<h4 id="dont-hard-code-ruby-install-paths-in-windows-batch-files">Don&#8217;t hard code ruby install paths in Windows batch files</h4>
<p>Author: Josh Cooper <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11847) Don&#8217;t hard code ruby install paths in Windows batch files</p>

<p>Previously, the {filebucket,pi,puppet,puppetdoc,ralsh}.bat files hard
coded the path to the ruby installation, making it impossible to move
the ruby install directory.</p>

<p>This commit changes the script to use the <code>%~dp0</code> batch file modifier,
which resolves to the drive letter and path of the directory of the
batch file being executed.</p>

<p>Windows XP and later all support the <code>%*</code> modifier, so this commit
removes the Win 9x code paths that are not supported.</p>

<h4 id="set-password-before-creating-user-on-windows">Set password before creating user on Windows</h4>
<p>Author: Paul Tinsley <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#112;&#097;&#117;&#108;&#046;&#116;&#105;&#110;&#115;&#108;&#101;&#121;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">&#112;&#097;&#117;&#108;&#046;&#116;&#105;&#110;&#115;&#108;&#101;&#121;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;</a></p>

<p>(#11717) Set password before creating user on Windows</p>

<p>Previously, puppet could not create a user with no password when a
local password complexity policy was set. This commit sets the
password on the user prior to creating it, and updates the spec tests
accordingly.</p>

<h4 id="fix-fact-and-plugin-sync-on-windows">Fix fact and plugin sync on Windows</h4>
<p>Author: Josh Cooper <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#11408) Fix fact and plugin sync on Windows</p>

<p>Previously, fact and pluginsync were broken on Windows, because it was
defaulting the owner and group to Process.uid/gid, and then failing to
translate them into Windows SIDs.</p>

<p>This commit changes the default file owner to the current user name,
and the default file group to Nobody, which is the group that Windows
typically applies to newly created files.</p>

<h4 id="dont-copy-owner-and-group-when-sourcing-files-from-master">Don&#8217;t copy owner and group when sourcing files from master</h4>
<p>Author: Josh Cooper <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#106;&#111;&#115;&#104;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a></p>

<p>(#10586) Don&#8217;t copy owner and group when sourcing files from master</p>

<p>Previously, puppet on Windows was not able to source files from the
master, because it was attempting to translate the uid/gid from
the Unix master into a Windows account, and obviously failing.</p>

<p>This commit skips the owner and group properties when copying them
from non-local sources, i.e. sources whose URIs have a &#8216;puppet&#8217;
scheme.</p>

<p>If the source comes from a local source, then puppet behaves the same
as it did previously, it copies the owner and group if the source
volume supports Windows ACLs, e.g. C:/, samba mapped drives, or uses
default values if the volume does not, e.g. VMware shared drives.</p>

<h3 id="freebsd-highlights">FreeBSD Highlights</h3>

<h4 id="add-support-for-user-expiriy-in-pw-user-provider">Add support for user expiriy in pw user provider</h4>
<p>Author: Tim Bishop <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;">&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;</a></p>

<p>(#11046) Add support for user expiry in pw user provider</p>

<p>Add support for setting an expiry date for a user in the pw user
provider. FreeBSD uses the format DD-MM-YYYY rather than Puppet&#8217;s
YYYY-MM-DD. Tests added to confirm the value is correctly swapped
around.</p>

<p>Also added custom accessor method to take the unix timestamp given
by the operating system to a Puppet-style YYYY-MM-DD. This stops
Puppet from repeatedly trying to set the expiry date if it&#8217;s already
correct.</p>

<h4 id="improve-pw-group-provider-on-freebsd">Improve pw group provider on FreeBSD</h4>
<p>Author: Tim Bishop <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;">&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;</a></p>

<p>(#11046) Improve pw group provider on FreeBSD</p>

<p>Make the pw group provider on FreeBSD support managing group members.
Also readd the allowdupe feature since in testing on FreeBSD 7, 8
and 9 the -o flag to pw works as documented.</p>

<p>Add tests for the provider.</p>

<h4 id="make-sure-managehome-is-respected-on-freebsd">Make sure managehome is respected on FreeBSD</h4>
<p>Author: Tim Bishop <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;">&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;</a></p>

<p>(#10962) Make sure managehome is respected on FreeBSD</p>

<p>When modifying the home directory of a user and managehome is set
the -m flag should be used with pw. This ensures that the new home
directory is created if it doesn&#8217;t exist.</p>

<p>Also add test to verify this behaviour.</p>

<h4 id="add-password-management-on-freebsd">Add password management on FreeBSD</h4>
<p>Author: Tim Bishop <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;">&#116;&#105;&#109;&#064;&#098;&#105;&#115;&#104;&#110;&#101;&#116;&#046;&#110;&#101;&#116;</a></p>

<p>(#11318) Add password management on FreeBSD</p>

<p>This adds the manages_passwords feature to the pw user provider. It is based
on the patch by Andrew Hust that was integrated into FreeBSD puppet port. It
adds tests covering the create, delete and modify processes of the provider.</p>

<p>This integrates a fix for #7500 that was introduced by the original patch.
The existing code takes the first character of each property and uses it as a
flag. However, with pw, the -p flag is for setting the password expiration.
The result is that the password isn&#8217;t set at create time and that the password
is set to expire. The next run of puppet correctly sets the password but the
expiry is still set. The new code avoids using -p for passwords, and also sets
the password correctly when an account is created.</p>

<h2 id="puppet-279">Puppet 2.7.9</h2>

<p>This is a bug fix release for regression (#11306) in 2.7.8 on Ruby 1.8.5.</p>

<p>The 1.8.5-incompatible code wasn’t caught because of a long-standing bug in our tests that went unnoticed because of a bug in our CI setup. The former issue caused specs to fail before they even started running on 1.8.5, and the latter caused the run to still be reported as successful. We’ve fixed the former bug, but haven’t yet figured out a way to fix the latter (as it seems to be a bug in Ruby 1.8.5 + rspec). We will, however, be taking steps to ensure that such problems with our CI setup are more visible and caught sooner.</p>

<p>(#11306)
    Fix Ruby 1.8.5-incompatible code in Transaction#eval_generate</p>

<pre><code>This was previously creating a Hash from an array of pairs.
Unfortunately, Ruby 1.8.5 only supports an argument list of pairs rather
than an array, so this code didn't work with that version.
</code></pre>

<h2 id="puppet-278">Puppet 2.7.8</h2>

<p>This is a <strong>feature and bug fix</strong> release in the 2.7.x branch.</p>

<h3 id="known-issues">Known Issues</h3>

<p><strong>This release introduced a regression that causes errors under Ruby 1.8.5,</strong> which was not noticed until after release. See issue #11306 for more details as we investigate, and delay upgrading to this version if you depend on Ruby 1.8.5 in your node population.</p>

<h3 id="new-features">New Features</h3>

<h4 id="display-file-diffs-through-the-puppet-log-system">Display file diffs through the Puppet log system.</h4>

<p>(#2744)</p>

<p>When Puppet generated a diff after changing a file on disk, it previously
printed it directly to stdout; although a user could view it, it
was lost to the rest of the system, and did not appear in monitoring, logs, or reports.</p>

<p>We now send file diffs through our regular logging system, so that they can be viewed in reports and logs. <strong>Note that this may have security implications if reports are being sent to an untrusted destination, as Puppet now exposes partial file contents in reports.</strong></p>

<h4 id="allow-optional-trailing-comma-in-argument-lists">Allow optional trailing comma in argument lists.</h4>

<p>(#6335)</p>

<p>You can now put an optional comma at the end of argument lists for parameterized
class definitions and defined types. This makes parameter lists more closely
resemble resource attributes.</p>

<h3 id="bug-fixes-3">Bug Fixes</h3>

<h4 id="provide-default-subjectaltnames-when-bootstrapping-master">Provide default subjectAltNames when bootstrapping master</h4>

<p>(#10739)</p>

<p>When bootstrapping a new puppet master without explicitly setting its valid alternate DNS names, we&#8217;ve always added some default Subject Alternative Names to its certificate so agents could reach it at <code>puppet</code> and <code>puppet.&lt;domain&gt;</code>. This got broken in the process of fixing #2848 (the CVE-2011-3872 AltNames vulnerability), which caused new puppet masters to get certificates with no valid Subject Alternative Names. (That is, the master could only be reached at its FQDN, not at <code>puppet</code>.)</p>

<p>This fix brings back the default AltNames behavior for initial puppet master certificates, while staying true to the policy changes we made for #2848 and making sure the default names never end up in agent certs. As ever, the default DNS names are only used if the <code>dns_alt_names</code> setting isn&#8217;t explicitly set.</p>

<h4 id="dont-automatically-enable-showdiff-in-noop-mode">Don&#8217;t automatically enable <code>show_diff</code> in noop mode</h4>

<p>(#2744)</p>

<p>As of 845825a, file diffs are now logged, rather than printed to
console. Because log messages may be stored and are more broadly readable,
we no longer implicitly set <code>show_diff</code> in noop mode.</p>

<h4 id="allow-providers-to-be-used-in-the-run-they-become-suitable">Allow providers to be used in the run they become suitable</h4>

<p>(#6907)</p>

<p>At long last! You can now deliver a provider with pluginsync, use a Puppet resource to install executables or files the provider depends on, and use that provider in resources during the same run.</p>

<p>This works for both explicitly selected providers and providers that would be the default for their type.</p>

<h4 id="output-four-digit-file-modes-in-logging-and-reporting">Output four-digit file modes in logging and reporting</h4>

<p>(#7274)</p>

<p>When reporting a change to a file&#8217;s mode, Puppet now outputs the four-digit
file mode instead of omitting the leading 0, i.e. 0755 instead of 755. This
reduces the likelihood of setting the wrong mode on a file through a
copy/paste accident.</p>

<h4 id="fix-parenthesize-method-arguments-warnings-under-ruby-186">Fix &#8220;parenthesize method arguments&#8221; warnings under Ruby 1.8.6</h4>

<p>(#10161)</p>

<p>In the process of Windows development, we introduced some warnings under Ruby 1.8.6:</p>

<pre><code>warning: parenthsize arguments(s) for future versions
</code></pre>

<p>These have been fixed, along with several testing/spec improvements around order dependent tests, and testing on Windows.</p>

<h4 id="restore-mongrel-xmlrpc-functionality">Restore Mongrel XMLRPC functionality</h4>

<p>(#10244)</p>

<p>Some code was over-eagerly removed, which turned out to still be necessary for backward compatibility with XMLRPC clients. It has been re-instated in this release.</p>

<h4 id="fix-missing-facts-under-mongrel">Fix missing facts under Mongrel</h4>

<p>(#9109)</p>

<p>When using Puppet with Mongrel, facts were being lost from agent nodes running
2.7.0 or higher. This was caused by Mongrel puppet masters only retrieving
request parameters from the query parameters of the URL, which mixed badly
with clients that submit their facts in a POST request. This has been fixed,
and Mongrel puppet masters can merge the POST request body with the query
parameters.</p>

<h4 id="speed-up-recursive-file-management-in-27">Speed up recursive file management in 2.7</h4>

<p>(#9671)</p>

<p>Recursively managing file ownership and permissions
is now at least ten times faster. This
speed improvement can also
be seen in some other scenarios.</p>

<h4 id="windows-handle-files-on-non-acl-volumes-more-gracefully">Windows: Handle files on non-ACL volumes more gracefully</h4>

<p>(#10614)</p>

<ul>
  <li>We now check whether a Windows volume supports ACLs before just trying to get or set them. This eliminates a nasty error that would arise when managing owner, group, and/or mode on a file whose volume didn&#8217;t support ACLs.</li>
  <li>We also insert default ACL values when sourcing file content from a volume that doesn&#8217;t support Windows ACLs (e.g. a VMware shared drive) to a volume that does; this allows content to be sourced without requiring the owner, group, and mode to be specified in the manifest. A file&#8217;s owner now defaults to Administrators, its group defaults to Nobody, and its mode defaults to 0644.</li>
  <li>Setting and clearing of the read-only attribute is improved.</li>
  <li>Potential segfaults when attempting to manage ACLs on non-ACL volumes have been fixed by improving our handling of return values from the Windows APIs.</li>
</ul>

<p>These fixes do not affect the POSIX file provider.</p>

<h4 id="ruby-181-dont-rely-on-kernelpathname">Ruby 1.8.1: Don&#8217;t rely on Kernel#Pathname</h4>

<p>(#10727)</p>

<p>We&#8217;ve removed an unnecessary incompatibility with pre-1.8.5 Rubies in <code>Puppet::Type::File</code>, which was caused by using Kernel#Pathname.</p>

<h4 id="allow-authenticated-clients-to-access-anything-clients-without-certificates-can-access">Allow authenticated clients to access anything clients <em>without</em> certificates can access</h4>

<p>(#9508)</p>

<p>Previously, the default <code>auth.conf</code> allowed anonymous clients <em>more</em> access to the certificate endpoint than authenticated clients. We now allow authenticated clients to access any endpoint that we trust anonymous clients to use. This improves support for distributed certificate management workflows.</p>

<h4 id="serve-file-content-in-binary-mode">Serve file content in binary mode</h4>

<p>(#9983)</p>

<p>Previously, Puppet::FileServing::Content opened files in text
mode. This has been changed to use binary mode.</p>

<h2 id="puppet-277">Puppet 2.7.7</h2>

<p>2.7.7 was killed in the Thunderdome by 2.7.8. It was never released.</p>

<h2 id="puppet-276">Puppet 2.7.6</h2>

<p>This is a <strong>security, feature, and bug fix</strong> release in the 2.7.x branch.</p>

<h3 id="security-fixes-4">Security Fixes</h3>

<h4 id="cve-2011-3872-altnames-vulnerability">CVE-2011-3872 (AltNames vulnerability)</h4>

<p><a href="http://puppetlabs.com/security/cve/cve-2011-3872/">(Full vulnerability and mitigation details)</a></p>

<p><strong>This is a major security vulnerability which must be manually remediated;</strong>
upgrading Puppet will not fully protect a site from this vulnerability.</p>

<p>A bug in all previous versions causes Puppet to insert the puppet master’s DNS
alt names (&#8220;certdnsnames&#8221; in puppet.conf) into the X.509 Subject Alternative
Name field of all certificates, rather than just the puppet master’s
certificate.</p>

<p>Since the puppet agent daemon can use the Subject Alternative Name field to
identify its puppet master, your site may contain agent certificates that can
be used in a Man in the Middle (MITM) attack to impersonate the puppet master.</p>

<p>This release fixes the underlying bug that caused dangerous certificates to be
issued, but <strong>any existing certificates with improper DNS alternate names will
remain dangerous until your agent nodes have been reconfigured.</strong></p>

<p>Any site where the puppet master&#8217;s <code>certdnsnames</code> setting has been enabled is
vulnerable to attack. See the <a href="http://puppetlabs.com/security/cve/cve-2011-3872/">CVE-2011-3872 details page</a> for
more information, including:</p>

<ul>
  <li>How to determine whether you are affected</li>
  <li>How to fully remediate the vulnerability</li>
  <li>How to download and use the automated remediation toolkit released by Puppet Labs</li>
</ul>

<h3 id="features-and-enhancements">Features and Enhancements</h3>

<h4 id="enhancement-usergroup-management-on-windows">Enhancement: User/group management on Windows</h4>

<p>(#9328) Retrieve user and group SIDs on windows.</p>

<p>Puppet can now manage user and group resources on Windows, and will use
Windows security identifiers (SIDs) for the uid and gid properties. (The uid
and gid properties are read-only for the time being.)</p>

<h4 id="enhancement-better-file-support-on-windows">Enhancement: Better file support on Windows</h4>

<p>The file type and providers have been significantly refactored to properly
manage the owners, groups, and permissions of files on Windows.</p>

<p>Some subtleties to be aware of:</p>

<ul>
  <li>In general, this implementation only supports &#8220;typical&#8221; permissions,
where group permissions are a subset of user, and other permissions
are a subset of group, e.g. 754, but not 467.</li>
  <li>The owner can be either a user or group SID, and most system files
are owned by the Administrators group.</li>
  <li>The group can be either a user or group SID.</li>
  <li>Unexpected results can occur if the owner and group are the
same, but the user and group classes are different, e.g. 750. In
this case, it is not possible to allow write access to the owner,
but not the group. As a result, the actual permissions set on the
file would be 770.</li>
  <li>In general, only privileged users can set the owner, group, or
change the mode for files they do not own. In 2003, the user must
be a member of the Administrators group. In Vista/2008, the user
must be running with elevated privileges.</li>
  <li>A file/dir can be deleted by anyone with the DELETE access right
OR by anyone that has the FILE_DELETE_CHILD access right for the
parent. See http://support.microsoft.com/kb/238018. But on Unix,
the user must have write access to the file/dir AND execute access
to all of the parent path components.</li>
  <li>Many access control entries are inherited from parent directories,
and it is common for file/dirs to have more than 3 entries,
e.g. Users, Power Users, Administrators, SYSTEM, etc, which cannot
be mapped into the 3 class POSIX model. The get_mode method will
set the S_IEXTRA bit flag indicating that an access control entry
was found whose SID is neither the owner, group, or other. This
enables Puppet to detect when file/dirs are out-of-sync,
especially those that Puppet did not create, but is attempting
to manage.</li>
  <li>On Unix, the owner and group can be modified without changing the
mode. But on Windows, an access control entry specifies which SID
it applies to. As a result, the set_owner and set_group methods
automatically rebuild the access control list based on the new
(and different) owner or group.</li>
</ul>

<h4 id="enhancement-support-plaintext-password-in-windows">Enhancement: Support plaintext password in Windows</h4>

<p>(#9326) Support plaintext passwords in Windows &#8216;user&#8217; provider.</p>

<p>The Windows &#8216;user&#8217; provider now includes password support, although passwords
must be passed as plaintext instead of as hashes.</p>

<h3 id="enhancement-return-reports-on-ral-save">Enhancement: Return reports on ral save</h3>

<p>(#9838) Return the transaction report when doing a ral save</p>

<p>When using puppet resource from the command line, using <code>puppet resource</code>
to do a save will log error messages to the console when
saving using the ral indirection.  However, this doesn&#8217;t help when using
that indirection in Ruby like you might from MCollective&#8217;s puppetral
agent.</p>

<p>So we now return the transaction report you get from applying the
catalog.</p>

<p>The only place we could find this indirection being used was in the
<code>puppet resource</code> application, although it&#8217;s possible that code external
to puppet uses this indirection and will need to change what it expects
for the return value of save.</p>

<h3 id="bug-fixes-4">Bug Fixes</h3>

<h4 id="fix-recognize-more-duplicate-resources">Fix: Recognize more duplicate resources</h4>

<p>(#8596) Title and name must be unique within a given resource</p>

<p>Puppet 2.6 introduced a bug where titles were no longer being compared to
names when identifying duplicate resources. For example:</p>

<pre><code>file { '/tmp/foo':
  ensure =&gt; file,
}

file { 'same_file':
  path   =&gt; '/tmp/foo',
  ensure =&gt; absent,
}
</code></pre>

<p>This would work, but wasn&#8217;t supposed to. It will now register as a duplicate, as intended.</p>

<h4 id="fix-allow-multi-line-exec-resources">Fix: Allow multi-line exec resources</h4>

<p>(#9996) Restore functionality for multi-line commands in exec resources</p>

<h4 id="fix-eliminate-warning-on-groupadd">Fix: Eliminate warning on groupadd</h4>

<p>(#9027) Get rid of spurious info messages in groupadd</p>

<p>Usage of the groupadd provider was leading to spurious log messages of
this form:</p>

<pre><code>info: /Group[developer]: Provider groupadd does not support features
manages_aix_lam; not managing attribute ia_load_module
</code></pre>

<p>These messages have been eliminated. See also issue #7137, covering
similar issues with the useradd provider.</p>

<h4 id="fix-remove-unnecessary-deprecation-warning-in-puppet-resource">Fix: Remove unnecessary deprecation warning in puppet resource</h4>

<p>(#9837) Call puppet apply to avoid deprecation warning</p>

<p><code>puppet resource --edit</code> was causing unnecessary deprecation warnings similar to the following:</p>

<pre><code>warning: Implicit invocation of 'puppet apply' by passing files (or flags) directly
to 'puppet' is deprecated, and will be removed in the 2.8 series.  Please
invoke 'puppet apply' directly in the future.
</code></pre>

<p>These have been resolved.</p>

<h4 id="fix-resolve-issues-with-windows-uris">Fix: Resolve issues with Windows URIs</h4>

<p>Previously, specifying a Windows file URI of the form &#8216;file:///C:/foo&#8217;
as a file source failed to strip the leading slash when attempting to
source the file. (Also, there was ambiguity after values were munged, since a
value of the form &#8216;C:/foo&#8217; could either be a Windows file path or a
URI whose scheme is &#8216;C&#8217;.)</p>

<p>This behavior has been fixed, and Windows file URIs can be used safely.</p>

<h4 id="fix-expose-all-functions-in-templates">Fix: Expose all functions in templates</h4>

<p>(#4549) Fix templates to be able to call all functions</p>

<p>Only a small subset of Puppet functions were available on the scope in
templates.  This had people doing workarounds like:</p>

<pre><code>inline_template("&lt;%= Puppet::Parser::Functions.autoloader.loadall; scope.function_extlookup(['hello world']) %&gt;")
</code></pre>

<p>These workarounds are no longer necessary, and templates can load any available
Puppet function.</p>

<h4 id="fix-update-pluginsync-to-only-load-ruby-files">Fix: Update pluginsync to only load ruby files.</h4>

<p>(#4135) Update pluginsync to only load ruby files.</p>

<p>Previously, puppet agent would attempt to load any file distributed via
pluginsync as though it were Ruby code. This was causing errors by loading,
for example, README files.</p>

<p>Pluginsync will still distribute any type of file, but puppet agent will no
longer attempt to load non-Ruby files.</p>

<h4 id="fix-fix-logging-on-windows">Fix: Fix logging on Windows</h4>

<p>(#9435) Gracefully handle when syslog feature is unavailable</p>

<p>Previously, Puppet would try to create a syslog log destination when run
without a log destination, which would fail on Windows because the Syslog
module was not available. Behavior when syslog isn&#8217;t available has been fixed.</p>

<h4 id="fix-disable-daemonizing-on-windows">Fix: Disable daemonizing on Windows</h4>

<p>(#9329) Disable agent daemonizing on Windows</p>

<p>For this release, we will not be providing the
code to run puppet agent as a service, though we have verified that
puppet will run as a service using a third-party service wrapper,
nssm.</p>

<p>Until support for running the agent as a service is complete, we have changed
the default <code>daemonize</code> setting on Windows. Puppet will also report an error if
<code>daemonize</code> is set to true on Windows.</p>

<h2 id="puppet-275">Puppet 2.7.5</h2>

<p>Puppet 2.7.5 is a <strong>security and regression fix</strong> release in the 2.7.x branch.</p>

<ul>
  <li>See the 2.7.5 <a href="http://groups.google.com/group/puppet-announce/t/5c363480686372e3">announcement</a> on puppet-announce</li>
  <li>You can also see the general <a href="http://groups.google.com/group/puppet-announce/t/91e3b46d2328a1cb">security notice email</a></li>
</ul>

<h3 id="security-fixes-5">Security Fixes</h3>

<h4 id="three-security-vulnerabilities">Three security vulnerabilities</h4>

<p>This release resolves the following security vulnerabilities:</p>

<ul>
  <li><a href="http://puppetlabs.com/security/cve/cve-2011-3869/">CVE-2011-3869 &#8211; k5login can overwrite arbitrary files as root</a></li>
  <li><a href="http://puppetlabs.com/security/cve/cve-2011-3870/">CVE-2011-3870 &#8211; SSH auth key local privilege escalation</a></li>
  <li><a href="http://puppetlabs.com/security/cve/cve-2011-3871/">CVE-2011-3871 &#8211; Predictable temporary filename in puppet resource/ralsh</a></li>
</ul>

<p>Follow the links above for details on each vulnerability.</p>

<h3 id="bug-fixes-5">Bug Fixes</h3>

<h4 id="fix-storeconfigs-regression-from-274">Fix: storeconfigs regression from 2.7.4</h4>

<p>(#9832) General StoreConfigs regression.</p>

<p>Some StoreConfigs exported and imported resources were not being
found under PostgreSQL. This fix resolves the regression.</p>

<h2 id="puppet-274">Puppet 2.7.4</h2>

<p>Puppet 2.7.4 is security and feature release in the 2.7.x branch.  Due to the security patches included, it is recommended anybody using the 2.7.x series update to 2.7.4.</p>

<p>In addition to the security patch, this release adds functional Windows providers for several types, and makes changes to the storeconfigs indirection.</p>

<h3 id="security-fixes-6">Security Fixes</h3>

<h4 id="cve-2011-3848-directory-traversal-attacks-through-indirections">CVE-2011-3848 (directory traversal attacks through indirections)</h4>

<p><a href="http://puppetlabs.com/security/cve/cve-2011-3848/">(Full vulnerability details)</a></p>

<p>In various versions of Puppet it was possible to cause a directory traversal
attack through the SSLFile indirection base class.  This was variously
triggered through the user-supplied key, or the Subject of the certificate, in
the code.</p>

<p>Now, we detect bad patterns down in the base class for our indirections, and
fail hard on them.  This reduces the attack surface with as little disruption
to the overall codebase as possible, making it suitable to deploy as part of
older, stable versions of Puppet.</p>

<p>In the long term we will also address this higher up the stack, to prevent
these problems from reoccurring, but for now this will suffice.</p>

<p>Huge thanks to Kristian Erik Hermansen <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#107;&#114;&#105;&#115;&#116;&#105;&#097;&#110;&#046;&#104;&#101;&#114;&#109;&#097;&#110;&#115;&#101;&#110;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">&#107;&#114;&#105;&#115;&#116;&#105;&#097;&#110;&#046;&#104;&#101;&#114;&#109;&#097;&#110;&#115;&#101;&#110;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;</a> for the
responsible disclosure, and useful analysis, around this defect.</p>

<h3 id="fixes-and-enhancements">Fixes and Enhancements</h3>

<h4 id="allow-cron-vars-to-have-leading-whitespace">Allow cron vars to have leading whitespace</h4>

<p>Fix #9440</p>

<p>Patch applied from Jeremy Thornhill. This allows whitespace to appear before
cron variables. Previously, whitespace before cron variables would trigger a
parse failure, and the crontab, except for the puppet managed portion, would
get removed. This addresses that issue. It also includes a test for this issue,
added into the tests directory, which seems to be where the crontab tests live.</p>

<h4 id="write-out-a-list-of-resources-that-are-managed-by-puppet-agent">Write out a list of resources that are managed by puppet agent</h4>

<p>Feature #8667</p>

<p>Similar to how the Puppet classes are written out each catalog apply,
the list of resources is now being written out to a text file that can
be easily used by tools like MCollective.  This allows tools that do
ad-hoc management of resources to know if they&#8217;re changing a resource
that puppet manages, and adjust behavior accordingly.</p>

<h4 id="fix-value-validation-on-options">Fix value validation on options</h4>

<p>Fix #7114</p>

<p>Support single options that legally include a comma like
&#8220;from=host1,host2&#8221;. We now basically allow either &#8220;word&#8221; or &#8220;key=value&#8221;
as options. That&#8217;s also what the parsedfile provider currently supports
when parsing options.</p>

<h4 id="gigabitethernettengigabitethernet-are-uncorrectly-parsed">GigabitEthernet/TenGigabitEthernet are uncorrectly parsed</h4>

<p>Fix #7984</p>

<p>The interface name abbreviation to canonical name doesn&#8217;t return
the correct name for GigabitEthernet and doesn&#8217;t support TenGigabitEthernet
interfaces.</p>

<h4 id="allow-macauthorization-provider-to-work-on-os-x-lion-107">Allow macauthorization provider to work on OS X Lion 10.7</h4>

<p>Fix #9143</p>

<p>We&#8217;ve flipped around the confine check so we explicitly exclude the
versions of OS X where this provider won&#8217;t work, rather than working
from a whitelist.</p>

<h4 id="move-complex-collect-expression-error-into-terminus">Move complex collect expression error into terminus.</h4>

<p>Fix #9051</p>

<p>When the StoreConfig system was extracted from core to a set of termini, most
of the rules about permitted syntax were pushed down into the same place, to
allow them to also be replaced.</p>

<p>One set of restrictions were missed, the limitation that complex search
criteria (like and, or, or parenthetical expressions) were not permitted, and
remained in our parser.</p>

<p>Now, they live in the terminus, and we enforce them only there.  This ensures
that StoreConfigs can be replaced with a back-end that supports complex
collection criteria without other changes to the Puppet core.</p>

<h4 id="dont-rely-on-error-message-to-detect-uac-capable-platform">Don&#8217;t rely on error message to detect UAC capable platform</h4>

<p>Fix #8662</p>

<p>The call to Win32::Security.elevated_privileges? can raise an
exception when running on a pre-Vista computer or if the process fails
to open its process token.</p>

<p>Previously, we were looking at the exception message to determine
which case it was. However, Windows 2003 and 2003 R2 return different
error codes (and therefore messages) for the pre-Vista case. In 2003,
it returns error code 1 (Incorrect function), but in 2003 R2 it
returns 87 (The parameter is incorrect). Since SUIDManager was only
looking for Incorrect function, SUIDManager.root? would always return
false on 2003 R2.</p>

<p>Ideally, we could just check if the GetTokenInformation Win32 API was
available, and only call it on platforms where it makes sense. But
this API is available on all recent version of Windows. What&#8217;s new in
Vista and up is the TokenElevation value of the
<code>TOKEN_INFORMATION_CLASS</code> enumeration.</p>

<p>This commit changes the suidmanager to only call GetTokenInformation
when the major kernel version, as reported by facter, is 6.0 or
greater, which corresponds to Vista/2008. See:</p>

<p><a href="http://msdn.microsoft.com/en-us/library/ms724833(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/ms724833(v=vs.85).aspx</a></p>

<h4 id="add-msi-package-provider-for-use-with-windows">Add MSI package provider for use with Windows</h4>

<p>Feature #8412</p>

<p>This provider takes some of its inspiration from the appdmg provider
used with OS X.  It will maintain a list of packages that have been
installed and removed from the system via the provider in a directory
under Puppet&#8217;s vardir called db/package/msi.  These state files will
be named the same as the resource name with &#8216;.yml&#8217; appended.  The
state files will be a hash containing the resource name, the install
options used, and the source location of the MSI.</p>

<p>Any properties that a user wishes to provide to the MSI can be
specified as key/value pairs in the install_options parameter.  For
example:</p>

<pre><code>package { 'mysql':
  provider =&gt; msi,
  source =&gt; 'E:\mysql.msi',
  ensure =&gt; installed,
  install_options =&gt; { 'INSTALLDIR' =&gt; 'C:\mysql' },
}
</code></pre>

<p>The MSI properties specified by install_options will be appropriately
quoted when invoking msiexec.exe to install the MSI.</p>

<p>Because the source parameter is integral to the functionality of being
able to install and uninstall MSI packages, we also override
validate_source to make sure that the source parameter is always set,
and is not an empty string when using this provider.</p>

<h4 id="add-a-windows-exec-provider">Add a Windows exec provider</h4>

<p>Feature #8140</p>

<p>This provider inherits from the <code>Puppet::Provider::Exec</code> class, and is
very similar to the posix provider in its behavior. This provider
doesn&#8217;t have the ability to run as a particular user or group and will
fail if that is attempted, but does support setting all other
parameters, as well as autorequires.</p>

<p>Rather than the shell provider inheriting from the posix provider, they
both now inherit from a common <code>Puppet::Provider::Exec</code> class. This new
base class and inheritance structure will allow the forthcoming windows
provider to also inherit from that class, rather than from the
unsuitable posix provider.</p>

<p>Also, now that Puppet::Util.execute supports commands as strings in
addition to arrays, the command to execute is passed to
<code>Puppet::Util::SUIDManager.run_and_capture</code> as a string, rather than a
string wrapped in an array. This ensures we will never improperly quote
a command with arguments provided as a single string.</p>

<h4 id="default-config-dir-to-programdata-on-windows">Default config dir to %PROGRAMDATA% on Windows</h4>

<p>Fix #8660</p>

<p>The puppet install.rb script now defaults the config directory to
%PROGRAMDATA%\PuppetLabs\puppet\etc on Windows. This is more inline
with Windows best-practices, as this directory is used to store
application data across all users. The PROGRAMDATA environment
variable also takes into account alternate system drives, by using the
SYSTEMDRIVE environment variable.</p>

<p>Note that the <code>Dir::COMMON_APPDATA</code> constant is so named because it
corresponds to the <code>CSIDL_COMMON_APPDATA</code> constant, which on 2000, XP,
and 2003 is <code>%ALLUSERSPROFILE%\Application Data</code>, and on Vista, Win7 and
2008 is <code>%SYSTEMDRIVE%\ProgramData</code>.</p>

<p>This commit also updates puppet&#8217;s default run_mode var and conf
directories when running as &#8220;root&#8221; to match the install script, and
fixes the spec test, which was looking in the <code>Dir::WINDOWS</code> directory.</p>

<h2 id="puppet-273">Puppet 2.7.3</h2>

<p>2.7.3 is a maintenance and enhancement release in the 2.7.x branch.</p>

<h3 id="add-node-clean-action">Add Node Clean action</h3>

<p>Fix #1886 - Add node cleanup capability</p>

<p>This adds a new &#8220;clean&#8221; action to the puppet node face, which removes all traces of a node on the puppetmaster
(including certs, cached facts and nodes, reports, and storedconfig
entries).</p>

<p>Furthermore, it is capable of unexporting exported resources of a
host so that consumers of these resources can remove the exported
resources and we will safely remove the node from our
infrastructure.</p>

<p>Usage:</p>

<pre><code>puppet node clean [--unexport] &lt;host&gt; [&lt;host2&gt; ...]
</code></pre>

<p>To achieve this we add different destroy methods to the different
parts of the indirector. So for example for yaml indirections we
already offer read access for the yaml, this changeset adds
the destroy handler which only removes the yaml file for
a request. This can be used to remove cached entries.</p>

<h3 id="deprecate-restauthconfigallowed-in-favor-of-checkauthorization">Deprecate RestAuthConfig#allowed? in favor of #check_authorization</h3>

<p>#allowed? was a poorly named method since it isn&#8217;t actually a predicate
method. Instead of returning a boolean, this methods throws an
exception when the access is denied (in order to keep the full context
of what ACE triggered the deny).</p>

<p>Given that #allowed? was overriding the behavior from AuthConfig, we
leave a version of #allowed? in place that will issue a deprecation
warning before delegating to #check_authorization.  Once support for
XML-RPC agents is removed from the master, we will be able to remove
this delegation, since there should no longer be a reason for a
distinction between AuthConfig and RestAuthConfig.</p>

<h3 id="security-file-should-support-inline-comments">#6026 - security file should support inline comments</h3>

<p>Auth.conf, namespaceauth.conf and fileserver.conf were not supporting
trailing inlined comments.
Also this commit fixes some indentation and error management.</p>

<h3 id="suggest-where-to-start-troubleshooting-ssl-error-message">Suggest where to start troubleshooting SSL error message</h3>

<p>Much like the infamous &#8220;hostname was not match&#8221; error message, there is
another SSL error that people run into that is not clear how to
troubleshoot.</p>

<pre><code>err: Could not send report: SSL_connect returned=1 errno=0
state=SSLv3 read server certificate B: certificate verify failed.
</code></pre>

<p>As far as I can tell this only ever happens when the clock is off on the
master or client.  People seem to think it will happen other times, but
I have not been able to reproduce it other ways - missing private key,
revoked cert, offline CA all have their own errors.  I googled around
and the only thing I&#8217;ve seen for this error in relation to puppet is the
time sync problem.</p>

<p>So the error message text just has some additional info to suggest you
check your clocks.</p>

<h3 id="detect-resource-alias-conflicts-when-titles-do-not-match">#8596 Detect resource alias conflicts when titles do not match</h3>

<p>The introduction of composite namevars caused the resource title used in
resource aliases to be set as an array, even when the resource only had one
namevar. This would fail to conflict with non-alias entries in the resource
table, which used a string for the title, even though the single element array
contained the same string.</p>

<p>Now, we flatten the key used in the resource table, so that single element
arrays are represented as strings, and will properly conflict with resource
titles.</p>

<h3 id="maint-adding-logging-to-include-environment-when-source-fails">maint: Adding logging to include environment when source fails</h3>

<h3 id="maint-add-debug-logging-when-the-master-receives-a-report">maint: Add debug logging when the master receives a report</h3>

<p>It&#8217;s always bothered me that when running puppet inspect (or any
application that produces a report really) the master gives no
indication that anything happened when it processes the report.</p>

<h3 id="port-sslcertificateauthorityinterface-to-a-face">#6789 Port SSL::CertificateAuthority::Interface to a Face</h3>

<p>The Puppet::SSL::CertificateAuthority::Interface class was an early prototype
heading toward building out a system like Faces.  Now that we have done that,
this changeset ports the early code to a new face.</p>

<h3 id="document-that---detailed-exitcodes-is-a-bitmask">#8401 Document that &#8211;detailed-exitcodes is a bitmask</h3>

<p>The agent/apply/device man pages mentioned the 2 and 4 exit codes, but didn&#8217;t
mention that they can combine to make 6 if there are both changes and failures.
This commit adds the missing information to all three man pages.</p>

<h3 id="fix-module-check-not-to-fail-when-empty-metadatajson">#4142 Fix module check not to fail when empty metadata.json</h3>

<p>Even though the puppet module tool was fixed to generate the required
metadata attributes when it packages modules, it still creates an empty
metadata.json file that gets checked into everybody&#8217;s module repos.
This causes the module to be unusable straight from a git clone since
puppet was requiring all the required metadata attributes just with the
presence of that file, and resulting in the error:</p>

<pre><code>No source module metadata provided for mcollective at
</code></pre>

<p>This change makes it so that if you have an empty metadata.json (like
the moduletool generates), puppet doesn&#8217;t consider it to have metadata.
If you have ANY metadata attributes in that file, it will still check to
make sure all the required attributes are present.</p>

<p>The work around up to this point has just been to delete the
metadata.json file in git cloned modules.</p>

<p>This also fixed the tests around this to actually run, since previously
the tests depended on the a json feature, which we didn&#8217;t have.  We do,
however, have a pson feature.</p>

<h3 id="change-default-reporturl-to-match-newer-dashboard-versions">#8147 Change default reporturl to match newer Dashboard versions</h3>

<p>Puppet&#8217;s default reporturl setting was http://localhost:3000/reports, which has
been deprecated in Puppet Dashboard in favor of
http://localhost:3000/reports/upload. As Dashboard is the first-class
destination for the http report processor, this commit changes Puppet&#8217;s default
to match what current versions of Dashboard expect.</p>

<h3 id="password-disclosure-when-changing-a-users-password">#6857 Password disclosure when changing a user&#8217;s password</h3>

<p>Make the should_to_s and is_to_s functions to return a form of &#8216;redacted&#8217;.</p>

<p>Rather than send the password hash to system logs in cases of failure or
running in &#8211;noop mode, just state whether it&#8217;s the new or old hash. We&#8217;re
already doing this with password changes that work, so this just brings it
inline with those, albeit via a slightly different pair of methods.</p>

<h3 id="additional-notes">Additional Notes</h3>

<ul>
  <li>Several odd behaviors seen in 2.7.2rc2 should now meet expectations.</li>
  <li>8ec0804 #8301 Red Hat spec file for 2.7.2rc1 won&#8217;t work</li>
  <li>2263be6 #5108 Update service type docs for new hasstatus default</li>
</ul>

<p>This merges up all changes in the 2.6.9 release that were unable to be merged into 2.7.{0,1} due to 2.7 being frozen in release candidate state.</p>

<p>Highlights include:</p>

<ul>
  <li>99330fa (#7224) Reword &#8216;hostname was not match&#8217; error message</li>
  <li>1d867b0 (#7224) Add a helper to Puppet::SSL::Certificate to retrieve alternate names</li>
  <li>db1a392 (#7506) Organize READMEs; specify supported Ruby versions in README.md</li>
  <li>98ba407 (#7127) Stop puppet if a prerun command fails</li>
  <li>caca469 (#4416) Ensure types are providified after reloading</li>
  <li>413b136 (#4416) Always remove old provider before recreating it</li>
  <li>98f58ce (#2128) Add WARNING for node_name_{fact,value} descriptions</li>
  <li>3f0dbb5 (#650) Allow symlinks for configuration directories</li>
  <li>1c70f0c (#2128) Add support for setting node name based on a fact</li>
  <li>c629958 (#2128) Get facts before retrieving catalog</li>
  <li>8eb0e16 (#2728) Add diff output for changes made by Augeas provider</li>
  <li>c02126d (#5966) Add support for hostname regular expressions in auth.conf</li>
  <li>75e2764 (#5318) Always notice changes to manifests when compiling.</li>
  <li>0bcbca5 maint: Dedup the loadpath so we don&#8217;t have to walk it multiple times</li>
  <li>89d447b (#6962) Add &#8220;arguments&#8221; method to help API</li>
  <li>8eea3f5 Added the vcsrepo type and providers to the core</li>
  <li>107b38a maint: Fix pacman provider to work with Ruby 1.9</li>
  <li>0b8ebac (#7300) Fix instances method of mount provider</li>
</ul>

<h2 id="puppet-272">Puppet 2.7.2</h2>

<p>2.7.2 was slain in the Thunderdome by 2.7.3.</p>

<h2 id="puppet-271">Puppet 2.7.1</h2>

<p>2.7.1 is a bug fix release in the 2.7.x branch.</p>

<p>Fixing bug #8048.  This made users of Puppet as a gem unable to install Puppet 2.7.0 release if gem was configured to use rdoc, as rdoc failed to parse on one file.</p>

<p>This issue only impacted users of Puppet as a gem.</p>

<h2 id="puppet-270">Puppet 2.7.0</h2>

<p>2.7.0 is a new feature release of Puppet.</p>

<h2 id="notable-features-and-bug-fixes">Notable Features and Bug Fixes</h2>

<h3 id="apache-license">Apache License</h3>

<p>Puppet is now released under the Apache 2.0 license. More info is available <a href="http://docs.puppetlabs.com/guides/faq#change-to-apache-license">here</a>.</p>

<h3 id="ruby-19-support">Ruby 1.9 Support</h3>

<p>There are some known issues with the 2.7.0 release, but we now support Ruby 1.9.2 and higher, and will be aggressively fixing bugs under Ruby 1.9.</p>

<h3 id="deterministic-catalog-application">Deterministic Catalog Application</h3>

<p>Previously, Puppet didn&#8217;t guarantee that it would apply unrelated resources in any particular order. This meant that if you forgot to specify some important <code>before</code> or <code>require</code> relationship, a single catalog might work fine on eight nodes and then fail mysteriously on the ninth and tenth. This could be frustrating! Now it&#8217;s gone: Puppet will make sure that the same catalog will always be applied in the same order on every machine, and it&#8217;ll either succeed reliably or fail reliably. (This change will also be appearing in the final 2.6.x releases.)</p>

<p>(See issue #6911.)</p>

<h3 id="manage-network-devices">Manage Network Devices</h3>

<p>Based on an open-space discussion that happened at PuppetCamp EU in May, 2010, Brice Figureau has implemented the start of a network management solution.</p>

<p>Currently this initial solution has a base network type/provider and providers for managing Cisco interfaces and vlans. The puppet provider connects to remote switches and routers through either ssh or telnet.</p>

<p>To manage an interface:</p>

<pre><code>interface { "FastEthernet 0/1":
  device_url          =&gt; "ssh://user:pass@cisco2960.domain.com/",
  mode                =&gt; trunk,
  encapsulation       =&gt; dot1q,
  trunk_allowed_vlans =&gt; "1-99,200,253",
  description         =&gt; "to back bone router"
}
</code></pre>

<p>or</p>

<pre><code>interface { "Vlan 1":
  device_url  =&gt; "ssh://user:pass@router.domain.com/",
  description =&gt; "internal net",
  ipaddress   =&gt; [ "192.168.0.1/24", "fe08::/128 link-local"]
}
</code></pre>

<p>And to manage vlans:</p>

<pre><code>vlan { "99":
  description =&gt; "management",
  device_url  =&gt; "ssh://user:pass@cisco2960.domain.com/",
}
</code></pre>

<p>A current limitation is that it isn&#8217;t possible to have 2 switches with the same interface name.</p>

<h3 id="dependency-cycle-reporting">Dependency cycle reporting</h3>

<p>We have significantly improved dependency cycle reporting so that the cycle is clearly identifiable, and will produce graphs of such cycles for easier debugging.  Error messages will now appear as follows:</p>

<pre><code>Found 2 dependency cycles: (Notify[a] =&gt; Notify[b] =&gt; Notify[a]) (Notify[mp2-2] =&gt; Notify[mp2] =&gt; Notify[mp2-2])
</code></pre>

<h3 id="man-pages">Man Pages</h3>

<p>We&#8217;ve spiffed up our man pages. Static man files are in the <code>man/</code> directory of the source, and should be installed for you if you installed Puppet with your OS&#8217;s packaging system. We&#8217;ve also introduced a <code>puppet man</code> subcommand that can render man pages on the fly using <a href="https://github.com/rtomayko/ronn/">ronn</a>. (We recommend running <code>gem install ronn</code> before using it; if it isn&#8217;t installed, puppet man will just print a human-readable version of the man page source text.)</p>

<h3 id="deprecations">Deprecations</h3>

<p>We&#8217;re starting the hourglass on a few older features:</p>

<ul>
  <li><strong>&#8216;puppet&#8217; as a synonym for &#8216;puppet apply&#8217;</strong> &#8212; Starting today, running <code>puppet my-manifest.pp</code> will issue a warning; you should start using <code>puppet apply</code> directly instead. Support for implicit invocation of puppet apply will be dropped in Puppet 2.8.</li>
  <li><strong>Dynamic scope</strong> &#8212; We&#8217;ve started issuing warnings when variables or resource defaults are found via dynamic lookup. <a href="http://docs.puppetlabs.com/guides/scope_and_puppet.html">There&#8217;s more info and explanation in a guide on the docs site</a>, but the short version is that you should start referencing variables with their qualified names instead of counting on dynamic scope. We hope to drop support for dynamic scope in Puppet 2.8. (Issue #5027)</li>
  <li><strong>No more <code>--parseonly</code> option</strong> &#8212; This one&#8217;s already gone, because we used Faces to build a drop-in replacement: use <code>puppet parser validate [&lt;manifest&gt;] [&lt;manifest&gt; ...]</code> instead.</li>
</ul>

<h3 id="notice-changed-manifests-on-the-first-try">Notice Changed Manifests on the First Try</h3>

<p>During the 2.6.x series, puppet agent would sometimes require two runs to receive new configurations when puppet master was running under Passenger. This persistent bug has been dealt with. (This change will also be appearing in the final 2.6.x releases.)</p>

<h3 id="static-compiler">Static Compiler</h3>

<p>We&#8217;ve introduced <code>static_compiler</code>, a new <code>catalog_terminus</code> which can be configured in puppet.conf on your puppet master. (See issue #6873.) The static compiler works by wrapping the default compiler terminus and replacing every <code>puppet:///</code> URL in the catalog it returns with an MD5 reference to a filebucket object; this saves a lot of describe calls while the agent is running, and it ensures that the agent won&#8217;t grab inconsistent file versions if one of the source files changes while it&#8217;s running.</p>

<p>There are some known issues that keep it from being used as-is, yet &#8212; you have to manually sync the agent&#8217;s filebucket to that of the master, the compiler&#8217;s behavior around recursion hasn&#8217;t been rigorously tested, we haven&#8217;t specified how it should behave if your puppet master is serving files through a load balancer, and files are read into memory rather than being streamed. However, this new approach has the potential to drastically speed up file-heavy Puppet runs, and if your site serves a lot of files and you have some lab time to test it, it could be worth a look.</p>

<h3 id="improved-apis">Improved APIs</h3>

<p>You can now <a href="http://docs.puppetlabs.com/guides/rest_api.html#certificate-status">manage and sign certificates via Puppet&#8217;s REST API</a>, which means that in the near future you&#8217;ll be able to check off signing requests for new nodes right from Puppet Dashboard. (And someone can now easily write an iPhone or Android app to fetch and handle CSRs, hint hint. :) )</p>

<h3 id="services-are-assumed-to-have-status-commands">Services Are Assumed to Have Status Commands</h3>

<p>Per issue #5108, the service type&#8217;s <code>hasstatus</code> attribute now defaults to true, which means init scripts are expected to have working status commands. <strong>This is a potentially incompatible change.</strong> If you use an OS where broken status commands are still the norm, you may need to add the following resource default to your <code>site.pp</code> manifest:</p>

<pre><code>Service {
  hasstatus =&gt; false,
}
</code></pre>

<p>This will effectively restore the old behavior.</p>

<h3 id="default-acl-improvements">Default ACL improvements</h3>

<p>We have adjusted the default ACL in the puppet master to allow a node to query configuration information about itself from the internal or external node classifier.</p>

<h3 id="pkgutil-provider">pkgutil Provider</h3>

<p><code>pkgutil</code> provider support has been significantly improved, resolving issue #4258.</p>

<h3 id="puppet-faces">Puppet Faces</h3>

<p>Faces is a new API for creating new Puppet subcommands. Faces dramatically simplifies the process of extending Puppet by building new capabilities, including additional nouns and verbs that can be called by issuing commands from your command line interface.</p>

<p>We&#8217;re particularly excited about Faces and the opportunities it offers for our user base.
You can see how easy it is to create a subcommand and action with our <a href="https://github.com/puppetlabs/puppet/blob/master/lib/puppet/face/parser.rb">new manifest validator</a></p>

<p>This provides a new subcommand and a single action as follows:</p>

<p><code>puppet parser validate &lt;mymanifest.pp&gt;</code></p>

<p>It&#8217;s also easy to create new actions for existing subcommands, which is a great way to extend the Puppet model, and it&#8217;s also become significantly easier to access Puppet subsystems as shown by the <a href="https://github.com/puppetlabs/puppet/blob/master/lib/puppet/face/configurer.rb">configurer subcommand</a>:</p>

<p>This shows how easy it is to access these subcommands and actions in Ruby code:</p>

<pre><code>  facts = Puppet::Face[:facts, '0.0.1'].find(certname)
  catalog = Puppet::Face[:catalog, '0.0.1'].download(certname, facts)
  report = Puppet::Face[:catalog, '0.0.1'].apply(catalog)
</code></pre>

<p>That small amount of code offers this on the command line:</p>

<pre><code>$ puppet configurer synchronize
</code></pre>

<p>which accomplishes basically the same functionality as &#8216;puppet agent &#8211;test&#8217;, but is much simpler to rearrange and modify for your own needs.</p>

<p>We look forward to seeing what the community comes up with now that it is so easy to interact with and extend the underlying model.</p>

<p>To get a look at the new subcommands, start by running <code>puppet help</code>. To see the API in action, look at the source for the <a href="https://github.com/puppetlabs/puppet/blob/2.7.x/lib/puppet/face/secret_agent.rb">secret_agent</a> and <a href="https://github.com/puppetlabs/puppet/blob/2.7.x/lib/puppet/face/parser.rb">parser</a> faces.</p>

<h3 id="certificate-api">Certificate API</h3>

<p>Read or alter the status of a certificate or pending certificate request. This endpoint is roughly equivalent to the puppet cert command; rather than returning complete certificates, signing requests, or revocation lists, this endpoint returns information about the various certificates (and potential and former certificates) known to the CA.</p>

<pre><code>GET /{environment}/certificate_status/{certname}
</code></pre>

<p>Retrieve a PSON hash containing information about the specified host’s certificate. Similar to puppet cert &#8211;list {certname}.</p>

<pre><code>GET /{environment}/certificate_statuses/no_key
</code></pre>

<p>Retrieve a list of PSON hashes containing information about all known certificates. Similar to puppet cert &#8211;list &#8211;all.</p>

<pre><code>PUT /{environment}/certificate_status/{certname}
</code></pre>

<p>Change the status of the specified host’s certificate. The desired state is sent in the body of the PUT request as a one-item PSON hash; the two allowed complete hashes are {&#8220;desired_state&#8221;:&#8221;signed&#8221;} (for signing a certificate signing request; similar to puppet cert &#8211;sign) and {&#8220;desired_state&#8221;:&#8221;revoked&#8221;} (for revoking a certificate; similar to puppet cert &#8211;revoke); see examples below for details.</p>

<p>When revoking certificates, you may wish to use a DELETE request instead, which will also clean up other info about the host.</p>

<pre><code>DELETE /{environment}/certificate_status/{hostname}
</code></pre>

<p>Cause the certificate authority to discard all information regarding a host (including any certificates, certificate requests, and keys), and revoke the certificate if one is present. Similar to puppet cert &#8211;clean.</p>

<p>Examples include:</p>

<pre><code>curl -k -H "Accept: pson" https://puppetmaster:8140/production/certificate_status/testnode.localdomain
curl -k -H "Accept: pson" https://puppetmaster:8140/production/certificate_statuses/all
curl -k -X PUT -H "Content-Type: text/pson" --data '{"desired_state":"signed"}' https://puppetmaster:8140/production/certificate_status/client.network.address
curl -k -X PUT -H "Content-Type: text/pson" --data '{"desired_state":"revoked"}' https://puppetmaster:8140/production/certificate_status/client.network.address
curl -k -X DELETE -H "Accept: pson" https://puppetmaster:8140/production/certificate_status/client.network.address
</code></pre>


              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">



<h3 id="puppet-27-reference-manual">Puppet 2.7 Reference Manual</h3>

<p><a href="./index.html">Main Index</a></p>

<ul>
  <li><strong>The Puppet Language</strong>
    <ul>
      <li><a href="./lang_visual_index.html">Visual Index</a></li>
      <li><a href="./lang_summary.html">Summary</a></li>
      <li><a href="./lang_reserved.html">Reserved Words and Acceptable Names</a></li>
      <li><a href="./lang_resources.html">Resources</a></li>
      <li><a href="./lang_relationships.html">Relationships and Ordering</a></li>
      <li><a href="./lang_defaults.html">Resource Defaults</a></li>
      <li><a href="./lang_variables.html">Variables</a></li>
      <li><a href="./lang_scope.html">Scope</a></li>
      <li><a href="./lang_conditional.html">Conditional Statements</a></li>
      <li><a href="./lang_expressions.html">Expressions</a></li>
      <li><a href="./lang_functions.html">Functions</a></li>
      <li><a href="./lang_classes.html">Classes</a></li>
      <li><a href="./lang_defined_types.html">Defined Types</a></li>
      <li><a href="./lang_containment.html">Containment</a></li>
      <li><a href="./lang_namespaces.html">Namespaces and Autoloading</a></li>
      <li><a href="./lang_collectors.html">Resource Collectors</a></li>
      <li><a href="./lang_node_definitions.html">Node definitions</a></li>
      <li><a href="./lang_datatypes.html">Data Types</a></li>
      <li><a href="./lang_comments.html">Comments</a></li>
      <li><a href="./lang_virtual.html">Virtual Resources</a></li>
      <li><a href="./lang_exported.html">Exported Resources</a></li>
      <li><a href="./lang_tags.html">Tags</a></li>
      <li><a href="./lang_run_stages.html">Run Stages</a></li>
      <li><a href="./lang_import.html">Importing Manifest Files</a></li>
    </ul>
  </li>
  <li><strong>Modules</strong>
    <ul>
      <li><a href="./modules_fundamentals.html">Fundamentals</a></li>
      <li><a href="./../../../guides/plugins_in_modules.html">Plugins in Modules</a></li>
      <li><a href="./modules_installing.html">Installing Modules</a></li>
      <li><a href="./modules_publishing.html">Publishing Modules on the Puppet Forge</a></li>
      <li><a href="./modules_documentation.html">Module Documentation</a></li>
    </ul>
  </li>
  <li><strong>Data Formats</strong>
    <ul>
      <li><a href="./format_report.html">Report Formats</a></li>
    </ul>
  </li>
  <li><strong>Generated References</strong>
    <ul>
      <li><a href="./../../../references/2.7.latest/type.html">Resource Types</a></li>
      <li><a href="./../../../references/2.7.latest/configuration.html">Configuration Settings</a></li>
      <li><a href="./../../../references/2.7.latest/function.html">Functions</a></li>
      <li><a href="./../../../references/2.7.latest/metaparameter.html">Metaparameters</a></li>
      <li><a href="./../../../references/2.7.latest/report.html">Report Handlers</a></li>
    </ul>
  </li>
  <li><strong>More Sections Coming Later</strong>
    <ul>
      <li><strong>Puppet 2.7 Overview</strong></li>
      <li><strong>Standard Puppet Operation</strong></li>
      <li><strong>Command Line Interface</strong></li>
      <li><strong>The Puppet Services</strong></li>
      <li><strong>The Ruby DSL</strong></li>
      <li><strong>Node Classification</strong></li>
      <li><strong>File Serving</strong></li>
      <li><strong>Resource Types and Providers</strong></li>
      <li><strong>SSL and Certificates</strong></li>
      <li><strong>Puppet Data Library</strong></li>
      <li><strong>Environments</strong></li>
      <li><strong>Configuring Puppet</strong></li>
      <li><strong>Internals</strong></li>
    </ul>
  </li>
</ul>

                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>


	</body>
</html>
