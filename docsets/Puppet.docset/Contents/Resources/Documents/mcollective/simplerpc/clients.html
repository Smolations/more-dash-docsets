<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Writing SimpleRPC Clients — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../../favicon.ico' />


  <meta name="description" content="As pointed out in the SimpleRPCIntroduction page you can use the mco rpc CLIto call agents and it will do it&#8217;s best to print results in a san...">



    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/ampersands.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/navigation-accordion.js'></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/mcollective/simplerpc/clients.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Writing SimpleRPC Clients</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Writing SimpleRPC Clients</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#the-basic-client">The Basic Client</a></li>
  <li class="toc-lv2"><a href="#call-an-agent-and-print-the-result">Call an Agent and print the result</a></li>
  <li class="toc-lv2"><a href="#adjusting-the-output">Adjusting the output</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#verbosely-displaying-results">Verbosely displaying results</a></li>
   <li class="toc-lv3"><a href="#disabling-the-progress-indicator">Disabling the progress indicator</a></li>
   <li class="toc-lv3"><a href="#saving-the-reports-in-variables-without-printing">Saving the reports in variables without printing</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#applying-filters-programatically">Applying filters programatically</a></li>
  <li class="toc-lv2"><a href="#resetting-filters-to-empty">Resetting filters to empty</a></li>
  <li class="toc-lv2"><a href="#processing-agents-in-batches">Processing Agents in Batches</a></li>
  <li class="toc-lv2"><a href="#forcing-rediscovery">Forcing Rediscovery</a></li>
  <li class="toc-lv2"><a href="#supplying-your-own-discovery-information">Supplying your own discovery information</a></li>
  <li class="toc-lv2"><a href="#only-sending-requests-to-a-subset-of-discovered-nodes">Only sending requests to a subset of discovered nodes</a></li>
  <li class="toc-lv2"><a href="#gaining-access-to-the-full-mcollectiveclient">Gaining access to the full MCollective::Client</a></li>
  <li class="toc-lv2"><a href="#dealing-with-the-results-directly">Dealing with the results directly</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#results-and-exceptions">Results and Exceptions</a></li>
   <li class="toc-lv3"><a href="#simple-rpc-style-results">Simple RPC style results</a></li>
   <li class="toc-lv3"><a href="#gaining-access-to-mcollectiveclientreq-results">Gaining access to MCollective::Client#req results</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#adding-custom-command-line-options">Adding custom command line options</a></li>
  <li class="toc-lv2"><a href="#disabling-command-line-parsing-and-supplying-your-options-programatically">Disabling command line parsing and supplying your options programatically</a></li>
  <li class="toc-lv2"><a href="#sending-simplerpc-requests-without-discovery-and-blocking">Sending SimpleRPC requests without discovery and blocking</a></li>
  <li class="toc-lv2"><a href="#doing-your-own-discovery">Doing your own discovery</a></li>
  <li class="toc-lv2"><a href="#the-rpcutil-helper-agent">The rpcutil Helper Agent</a></li>
</ol></nav>

<p>As pointed out in the <a href="index.html">SimpleRPCIntroduction</a> page you can use the <code>mco rpc</code> CLI
to call agents and it will do it&#8217;s best to print results in a sane way.  When
this is not enough you can write your own clients.</p>

<p>Simple RPC clients can do most of what a normal <a href="agents.html">client</a> can do
but it makes a lot of things much easier if you stick to the Simple RPC
conventions.</p>

<p>This guide shows how to write standalone scripts to interact with your
collective.  There is a single executable system.  You can apply most of
the techniques documented here to writing plugins for that application system.
See the full reference for the plugin system <a href="../reference/plugins/application.html">here</a>.  You should try
to write your general agent CLIs using this plugin system rather than the stand
alone scripts detailed below as that promote a unified interface that behave in a
consistent manner.</p>

<p>We&#8217;ve recorded a <a href="http://mcollective.blip.tv/file/3808928/">tutorial that will give you a quick look at what is involved
in writing agents and a very simple client</a>.</p>

<p>We&#8217;ll walk through building a ever more complex example of Hello World here.</p>

<h2 id="the-basic-client">The Basic Client</h2>
<p>The client is mostly a bunch of helper methods that you use as a <a href="http://juixe.com/techknow/index.php/2006/06/15/mixins-in-ruby/">Ruby
Mixin</a> in your own code, it provides:</p>

<ul>
  <li>Standard command line option parsing with help output</li>
  <li>Ability to add your own command line options</li>
  <li>Simple access to agents and actions</li>
  <li>Tools to help you print results</li>
  <li>Tools to print stats</li>
  <li>Tools to construct your own filters</li>
  <li>While retaining full power of <code>MCollective::Client</code> if you need the additional feature sets</li>
  <li>And being as simple or as complex to match your level of code proficiency</li>
</ul>

<p>We&#8217;ll write a client for the <code>Helloworld</code> agent that you saw in the
<a href="index.html">SimpleRPCIntroduction</a>.</p>

<h2 id="call-an-agent-and-print-the-result">Call an Agent and print the result</h2>
<p>A basic hello world client can be seen below:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="c1">#!/usr/bin/ruby</span>
<span class="lineno"> 2</span>
<span class="lineno"> 3</span> <span class="nb">require</span> <span class="s1">&#39;mcollective&#39;</span>
<span class="lineno"> 4</span>
<span class="lineno"> 5</span> <span class="kp">include</span> <span class="no">MCollective</span><span class="o">::</span><span class="no">RPC</span>
<span class="lineno"> 6</span>
<span class="lineno"> 7</span> <span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
<span class="lineno"> 8</span>
<span class="lineno"> 9</span> <span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
<span class="lineno">10</span>
<span class="lineno">11</span> <span class="n">printrpcstats</span>
<span class="lineno">12</span>
<span class="lineno">13</span> <span class="n">mc</span><span class="o">.</span><span class="n">disconnect</span>
</code></pre>
</div>

<p>Save this into <code>hello.rb</code> and run it with <code>--help</code>, you should see the standard basic help including filters for discovery.</p>

<p>If you&#8217;ve set up the Agent and run the client you should see something along these lines:</p>

<div class="highlight"><pre><code class="ruby"><span class="err">$</span> <span class="n">hello</span><span class="o">.</span><span class="n">rb</span>

<span class="no">Finished</span> <span class="n">processing</span> <span class="mi">44</span> <span class="n">hosts</span> <span class="k">in</span> <span class="mi">375</span><span class="o">.</span><span class="mi">57</span> <span class="n">ms</span>
</code></pre>
</div>

<p>While it ran you would have seen a little progress bar and then just the summary line.  The idea is that if you&#8217;re talking to a 1000 machine there&#8217;s no point in seeing a thousand <code>OK</code>, you only want to see what failed and this is exactly what happens here, you&#8217;re only seeing errors.</p>

<p>If you run it with <code>--verbose</code> you&#8217;ll see a line of text for every host and also a larger summary of results.</p>

<p>I&#8217;ll explain each major line in the code below then add some more features from there:</p>

<div class="highlight"><pre><code class="ruby"><span class="kp">include</span> <span class="no">MCollective</span><span class="o">::</span><span class="no">RPC</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>The first line pulls in the various helper functions that we provide, this is the Mixin we mentioned earlier.</p>

<p>We then create a new client to the agent &#8220;helloworld&#8221; that you access through the <code>mc</code> variable.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>

<span class="n">printrpcstats</span>
</code></pre>
</div>

<p>To call a specific action you simply have to do <code>mc.echo</code> this calls the <code>echo</code> action, we pass a <code>:msg</code> parameter into it with the string we want echo&#8217;d back.  The parameters will differ from action to action.  It returns a simple array of the results that you can print any way you want, we&#8217;ll show that later.</p>

<p><code>printrpc</code> and <code>printrpcstats</code> are functions used to print the results and stats respectively.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span><span class="o">.</span><span class="n">disconnect</span>
</code></pre>
</div>

<p>This cleanly disconnects the client from the middleware, some middleware tools like ActiveMQ will log confusing exceptions if you do not do this.  It&#8217;s good form to always disconnect but isn&#8217;t strictly required.</p>

<h2 id="adjusting-the-output">Adjusting the output</h2>

<h3 id="verbosely-displaying-results">Verbosely displaying results</h3>
<p>As you see there&#8217;s no indication that discovery is happening and as pointed out we do not display results that are ok, you can force verbosity as below on individual requests:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">discover</span> <span class="ss">:verbose</span> <span class="o">=&gt;</span> <span class="kp">true</span>

<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">),</span> <span class="ss">:verbose</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre>
</div>

<p>Here we&#8217;ve added a <code>:verbose</code> flag and we&#8217;ve specifically called the discover method.  Usually you don&#8217;t need to call discover it will do it on demand.  Doing it this way you&#8217;ll always see the line:</p>

<div class="highlight"><pre><code class="console"><span class="go">Determining the amount of hosts matching filter for 2 seconds .... 44</span>
</code></pre>
</div>

<p>Passing verbose to <code>printrpc</code> forces it to print all the results, failures or not.</p>

<p>If you just wanted to force verbose on for all client interactions, do:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kp">true</span>

<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>In this case everything will be verbose, regardless of command line options.</p>

<h3 id="disabling-the-progress-indicator">Disabling the progress indicator</h3>
<p>You can disable the twirling progress indicator easily:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="kp">false</span>
</code></pre>
</div>

<p>Now whenever you call an action you will not see the progress indicator.</p>

<h3 id="saving-the-reports-in-variables-without-printing">Saving the reports in variables without printing</h3>
<p>You can retrieve the stats from the clients and also get text of reports without printing them:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">stats</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stats</span>

<span class="n">report</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">report</span>
</code></pre>
</div>

<p><code>report</code> will now have the text that would have been displayed by &#8216;printrpcstats&#8217; you can also use <code>no_response_report</code> to get report text for just the list of hosts that didnt respond.</p>

<p>If you didn&#8217;t want to just print the results out to STDOUT you can also get them back as just text:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">report</span> <span class="o">=</span> <span class="n">rpcresults</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="applying-filters-programatically">Applying filters programatically</h2>
<p>You can pass filters on the command line using the normal <code>--with-*</code> options but you can also do it programatically.  Here&#8217;s a new version of the client that only calls machines with the configuration management class <code>/dev_server/</code> and the fact <code>country=uk</code></p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">class_filter</span> <span class="sr">/dev_server/</span>
<span class="n">mc</span><span class="o">.</span><span class="n">fact_filter</span> <span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;uk&quot;</span>

<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>You can set other filters like <code>agent_filter</code>, <code>identity_filter</code> and <code>compound_filter</code>.</p>

<p>The <code>fact_filter</code> method supports a few other forms in adition to above:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span><span class="o">.</span><span class="n">fact_filter</span> <span class="s2">&quot;country=uk&quot;</span>
<span class="n">mc</span><span class="o">.</span><span class="n">fact_filter</span> <span class="s2">&quot;physicalprocessorcount&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;=&quot;</span>
</code></pre>
</div>

<p>This will limit it to all machines in the UK with more than 3 processors.</p>

<h2 id="resetting-filters-to-empty">Resetting filters to empty</h2>
<p>If while using the client you wish to reset the filters to an empty set of filters - containing only the agent name that you&#8217;re busy addressing you can do it as follows:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">class_filter</span> <span class="sr">/dev_server/</span>

<span class="n">mc</span><span class="o">.</span><span class="n">reset_filter</span>
</code></pre>
</div>

<p>After this code snippet the filter will only have an agent filter of <code>helloworld</code> set.</p>

<h2 id="processing-agents-in-batches">Processing Agents in Batches</h2>
<p>By default the client will communicate with all machines at the same time.
This might not be desired as you might affect a DOS on related components.</p>

<p>You can instruct the client to communicate with remote agents in batches
and sleep between each batch.</p>

<p>Any client application has this capability using the <code>--batch</code> and <code>--batch-sleep-time</code>
command line options.</p>

<p>You can also enable this programatically either per client or per request:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">mc</span><span class="o">.</span><span class="n">batch_sleep_time</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;hello world&quot;</span><span class="p">,</span> <span class="ss">:batch_size</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="ss">:batch_sleep_time</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<p>By default batching is disabled and sleep time is 1</p>

<p>Setting the <code>batch_size</code> to 0 will disable batch mode in both examples above,
effectively overriding what was supplied on the command line.</p>

<h2 id="forcing-rediscovery">Forcing Rediscovery</h2>
<p>By default it will only do discovery once per script and then re-use the results, you can though force rediscovery if you had to adjust filters mid run for example.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">class_filter</span> <span class="sr">/dev_server/</span>
<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">reset</span>

<span class="n">mc</span><span class="o">.</span><span class="n">fact_filter</span> <span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;uk&quot;</span>
<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>Here we make one <code>echo</code> call - which would do a discovery - we then reset the client, adjust filters and call it again.  The 2nd call would do a new discovery and have new client lists etc.</p>

<h2 id="supplying-your-own-discovery-information">Supplying your own discovery information</h2>

<p>A new core messaging mode has been introduced that enables direct non filtered communicatin to specific nodes.  This has enabled us to provide an discovery-optional
mode but only if the collective is configured to support direct messaging.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="ss">:nodes</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;host1&quot;</span><span class="p">,</span> <span class="s2">&quot;host2&quot;</span><span class="p">,</span> <span class="s2">&quot;host3&quot;</span><span class="o">]</span>

<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>This will immediately, without doing discovery, communicate just with these 3 hosts.  It will do normal failure reporting as with normal discovery based
requests but will just be much faster as the 2 second discovery overhead is avoided.</p>

<p>The goal with this feature is for cases such as deployment tools where you have a known expectation of which machines to deploy to and you always want
to know if that fails.  In that use case a discovery based approach is not 100% suitable as you won&#8217;t know about down machines.  This way you can provide
your own source of truth.</p>

<p>When using the direct mode messages have a TTL associated with them that defaults to 60 seconds.  Since 1.3.2 you can set the TTL globally in the configuration
file but you can also set it on the client:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">ttl</span> <span class="o">=</span> <span class="mi">3600</span>

<span class="n">mc</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="ss">:nodes</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;host1&quot;</span><span class="p">,</span> <span class="s2">&quot;host2&quot;</span><span class="p">,</span> <span class="s2">&quot;host3&quot;</span><span class="o">]</span>

<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>With the TTL set to 3600 if any of the hosts are down at the time of the request the request will wait on the middleware and should they come back up
before 3600 has passed since request time they will then perform the requested action.</p>

<h2 id="only-sending-requests-to-a-subset-of-discovered-nodes">Only sending requests to a subset of discovered nodes</h2>
<p>By default all nodes that get discovered will get the request.  This isn&#8217;t always desirable maybe you want to deploy only to a random subset of hosts or maybe you have a service exposed over MCollective that you want to treat as a HA service and so only speak with one host that provides the functionality.</p>

<p>You can limit the hosts to talk to either using a number or a percentage, the code below shows both:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">limit_targets</span> <span class="o">=</span> <span class="s2">&quot;10%&quot;</span>
<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>This will pick 10% of the discovered hosts - or 1 if 10% is less than 1 - and only target those nodes with your request.  You can also set it to an integer.</p>

<p>There are two possible modes for choosing the targets.  You can configure a global default method but also set it on your client:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">mc</span><span class="o">.</span><span class="n">limit_targets</span> <span class="o">=</span> <span class="s2">&quot;10%&quot;</span>
<span class="n">mc</span><span class="o">.</span><span class="n">limit_method</span> <span class="o">=</span> <span class="ss">:random</span>
<span class="n">printrpc</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;Welcome to MCollective Simple RPC&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>The above code will force a <code>:random</code> selection, you can also set it to <code>:first</code></p>

<h2 id="gaining-access-to-the-full-mcollectiveclient">Gaining access to the full MCollective::Client</h2>
<p>If you wanted to work with the Client directly as in <a href="agents.html">WritingAgents</a> after perhaps setting up some queries or gathering data first you can gain access to the client, you might also need access to the options array that was parsed out from the command line and any subsequent filters that you added.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">client</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">options</span>
</code></pre>
</div>

<p>The first call will set up the CLI option parsing, create clients etc, you can then just grab the client and options and go on as per <a href="agents.html">WritingAgents</a>.  This is a much quicker way to write full power clients, by just by short-circuiting the options parsing etc.</p>

<h2 id="dealing-with-the-results-directly">Dealing with the results directly</h2>
<p>The biggest reason that you&#8217;d write custom clients is probably if you wanted to do custom processing of the results, there are 2 options to do it.</p>

<p><a name="Results_and_Exceptions"> </a></p>

<h3 id="results-and-exceptions">Results and Exceptions</h3>
<p>Results have a set structure and depending on how you access the results you will either get Exceptions or result codes.</p>

<table>
  <thead>
    <tr>
      <th>Status Code</th>
      <th>Description</th>
      <th>Exception Class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>OK</td>
      <td>&#160;</td>
    </tr>
    <tr>
      <td>1</td>
      <td>OK, failed.  All the data parsed ok, we have a action matching the request but the requested action could not be completed.</td>
      <td>RPCAborted</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Unknown action</td>
      <td>UnknownRPCAction</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Missing data</td>
      <td>MissingRPCData</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Invalid data</td>
      <td>InvalidRPCData</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Other error</td>
      <td>UnknownRPCError</td>
    </tr>
  </tbody>
</table>

<p>Just note these now, I&#8217;ll reference them later down.</p>

<h3 id="simple-rpc-style-results">Simple RPC style results</h3>
<p>Simple RPC provides a trimmed down version of results from the basic Client library.  You&#8217;d choose to use this if you just want to do simple things or maybe you&#8217;re just learning Ruby.  You&#8217;ll get to process the results <em>after</em> the call is either done or timed out completely.</p>

<p>This is an important difference between the two approaches, in one you can parse the results as it comes in, in the other you will only get results after processing is done.  This would be the main driving facter for choosing one over the other.</p>

<p>Here&#8217;s an example that will print out results in a custom way.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;hello world&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">resp</span><span class="o">|</span>
   <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%-40s: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">resp</span><span class="o">[</span><span class="ss">:sender</span><span class="o">]</span><span class="p">,</span> <span class="n">resp</span><span class="o">[</span><span class="ss">:data</span><span class="o">][</span><span class="ss">:msg</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<p>This will produce a result something like this:</p>

<div class="highlight"><pre><code class="console"><span class="go">dev1.you.net                          : hello world</span>
<span class="go">dev2.you.net                          : hello world</span>
<span class="go">dev3.you.net                          : hello world</span>
</code></pre>
</div>

<p>The <code>each</code> in the above code just loops through the array of results.  Results are an array of Hashes, the data you got for above has the following structure:</p>

<div class="highlight"><pre><code class="console"><span class="go">[{:statusmsg=&gt;&quot;OK&quot;,</span>
<span class="go"> :sender=&gt;&quot;dev1.your.net&quot;,</span>
<span class="go"> :data=&gt;{:msg =&gt; &quot;hello world&quot;},</span>
<span class="go"> :statuscode=&gt;0},</span>
<span class="go">{:statusmsg=&gt;&quot;OK&quot;,</span>
<span class="go"> :sender=&gt;&quot;dev2.your.net&quot;,</span>
<span class="go"> :data=&gt;{:msg =&gt; &quot;hello world&quot;},</span>
<span class="go"> :statuscode=&gt;0}]</span>
</code></pre>
</div>

<p>The <code>:statuscode</code> matches the table above so you can make decisions based on each result&#8217;s status.</p>

<h3 id="gaining-access-to-mcollectiveclientreq-results">Gaining access to MCollective::Client#req results</h3>
<p>You can get access to each result in real time, in this case you will need to handle the exceptions in the table above and you&#8217;ll get a different style of result set.  The result set will be exactly as from the full blown client.</p>

<p>In this mode there will be no progress indicator, you&#8217;ll deal with results as and when they come in not after the fact as in the previous example.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;hello world&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">resp</span><span class="o">|</span>
   <span class="k">begin</span>
      <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%-40s: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">resp</span><span class="o">[</span><span class="ss">:senderid</span><span class="o">]</span><span class="p">,</span> <span class="n">resp</span><span class="o">[</span><span class="ss">:body</span><span class="o">][</span><span class="ss">:data</span><span class="o">]</span><span class="p">)</span>
   <span class="k">rescue</span> <span class="no">RPCError</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="s2">&quot;The RPC agent returned an error: </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
   <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>The output will be the same as above</p>

<p>In this mode the results you get will be like this:</p>

<div class="highlight"><pre><code class="ruby"><span class="p">{</span><span class="ss">:msgtarget</span><span class="o">=&gt;</span><span class="s2">&quot;/topic/mcollective.helloworld.reply&quot;</span><span class="p">,</span>
 <span class="ss">:senderid</span><span class="o">=&gt;</span><span class="s2">&quot;dev2.your.net&quot;</span><span class="p">,</span>
 <span class="ss">:msgtime</span><span class="o">=&gt;</span><span class="mi">1261696663</span><span class="p">,</span>
 <span class="ss">:hash</span><span class="o">=&gt;</span><span class="s2">&quot;2d37daf690c4bcef5b5380b1e0c55f0c&quot;</span><span class="p">,</span>
 <span class="ss">:body</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:statusmsg</span><span class="o">=&gt;</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="ss">:statuscode</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="ss">:data</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;hello world&quot;</span><span class="p">}},</span>
 <span class="ss">:requestid</span><span class="o">=&gt;</span><span class="s2">&quot;2884afb0b52cb38ea4d4a3146d18ef5f&quot;</span><span class="p">,</span>
 <span class="ss">:senderagent</span><span class="o">=&gt;</span><span class="s2">&quot;helloworld&quot;</span><span class="p">}</span>
</code></pre>
</div>

<p>Note how here we need to catch the exceptions, just handing <code>:statuscode</code> will not be enough as the RPC client will raise exceptions - all descendant from <code>RPCError</code> so you can easily catch just those.</p>

<p>You can additionally gain access to a SimpleRPC style result in addition to the more complex native client results:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;hello world&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">resp</span><span class="p">,</span> <span class="n">simpleresp</span><span class="o">|</span>
   <span class="k">begin</span>
      <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%-40s: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">simpleresp</span><span class="o">[</span><span class="ss">:sender</span><span class="o">]</span><span class="p">,</span> <span class="n">simpleresp</span><span class="o">[</span><span class="ss">:data</span><span class="o">][</span><span class="ss">:msg</span><span class="o">]</span><span class="p">)</span>
   <span class="k">rescue</span> <span class="no">RPCError</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="s2">&quot;The RPC agent returned an error: </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
   <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>You can still use printrpc to print these style of results and gain advantage of the DDL and so forth:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="s2">&quot;hello world&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">resp</span><span class="p">,</span> <span class="n">simpleresp</span><span class="o">|</span>
   <span class="k">begin</span>
      <span class="n">printrpc</span> <span class="n">simpleresp</span>
   <span class="k">rescue</span> <span class="no">RPCError</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="s2">&quot;The RPC agent returned an error: </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
   <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>You will need to handle exceptions yourself but you have a simpler result set to deal with</p>

<h2 id="adding-custom-command-line-options">Adding custom command line options</h2>
<p>You can look at the <code>mco rpc</code> script for a big sample, here I am just adding a simple <code>--msg</code> option to our script so you can customize the message that will be sent and received.</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="c1">#!/usr/bin/ruby</span>
<span class="lineno"> 2</span>
<span class="lineno"> 3</span> <span class="nb">require</span> <span class="s1">&#39;mcollective&#39;</span>
<span class="lineno"> 4</span>
<span class="lineno"> 5</span> <span class="kp">include</span> <span class="no">MCollective</span><span class="o">::</span><span class="no">RPC</span>
<span class="lineno"> 6</span>
<span class="lineno"> 7</span> <span class="n">options</span> <span class="o">=</span> <span class="n">rpcoptions</span> <span class="k">do</span> <span class="o">|</span><span class="n">parser</span><span class="p">,</span> <span class="n">options</span><span class="o">|</span>
<span class="lineno"> 8</span>    <span class="n">parser</span><span class="o">.</span><span class="n">define_head</span> <span class="s2">&quot;Generic Echo Client&quot;</span>
<span class="lineno"> 9</span>    <span class="n">parser</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;Usage: hello [options] [filters] --msg MSG&quot;</span>
<span class="lineno">10</span>
<span class="lineno">11</span>    <span class="n">parser</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--msg MSG&#39;</span><span class="p">,</span> <span class="s1">&#39;Message to pass&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
<span class="lineno">12</span>       <span class="n">options</span><span class="o">[</span><span class="ss">:msg</span><span class="o">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="lineno">13</span>    <span class="k">end</span>
<span class="lineno">14</span> <span class="k">end</span>
<span class="lineno">15</span>
<span class="lineno">16</span> <span class="k">unless</span> <span class="n">options</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="ss">:msg</span><span class="p">)</span>
<span class="lineno">17</span>    <span class="nb">puts</span><span class="p">(</span><span class="s2">&quot;You need to specify a message with --msg&quot;</span><span class="p">)</span>
<span class="lineno">18</span>    <span class="nb">exit!</span> <span class="mi">1</span>
<span class="lineno">19</span> <span class="k">end</span>
<span class="lineno">20</span>
<span class="lineno">21</span> <span class="n">mc</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;helloworld&quot;</span><span class="p">,</span> <span class="ss">:options</span> <span class="o">=&gt;</span> <span class="n">options</span><span class="p">)</span>
<span class="lineno">22</span>
<span class="lineno">23</span> <span class="n">mc</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="ss">:msg</span> <span class="o">=&gt;</span> <span class="n">options</span><span class="o">[</span><span class="ss">:msg</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">resp</span><span class="o">|</span>
<span class="lineno">24</span>    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%-40s: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">resp</span><span class="o">[</span><span class="ss">:sender</span><span class="o">]</span><span class="p">,</span> <span class="n">resp</span><span class="o">[</span><span class="ss">:data</span><span class="o">][</span><span class="ss">:msg</span><span class="o">]</span><span class="p">)</span>
<span class="lineno">25</span> <span class="k">end</span>
</code></pre>
</div>

<p>This version of the code should be run like this:</p>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> test.rb --msg foo
<span class="go">dev1.you.net                          : foo</span>
<span class="go">dev2.you.net                          : foo</span>
<span class="go">dev3.you.net                          : foo</span>
</code></pre>
</div>

<p>Documentation for the Options Parser can be found <a href="http://github.com/puppetlabs/marionette-collective/blob/master/lib/mcollective/optionparser.rb">in its code</a>.</p>

<p>And finally if you add options as above rather than try to parse it yourself you will get help integration for free:</p>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> hello.rb --help
<span class="go">Usage: hello [options] [filters] --msg MSG</span>
<span class="go">Generic Echo Client</span>
<span class="go">    -m, --msg MSG                    Message to pass</span>

<span class="go">Common Options</span>
<span class="go">    -c, --config FILE                Load configuratuion from file rather than default</span>
<span class="go">        --dt SECONDS                 Timeout for doing discovery</span>
<span class="go">        --discovery-timeout</span>
<span class="go">    -t, --timeout SECONDS            Timeout for calling remote agents</span>
<span class="go">    -q, --quiet                      Do not be verbose</span>
<span class="go">    -v, --verbose                    Be verbose</span>
<span class="go">    -h, --help                       Display this screen</span>

<span class="go">Host Filters</span>
<span class="go">        --wf, --with-fact fact=val   Match hosts with a certain fact</span>
<span class="go">        --wc, --with-class CLASS     Match hosts with a certain configuration management class</span>
<span class="go">        --wa, --with-agent AGENT     Match hosts with a certain agent</span>
<span class="go">        --wi, --with-identity IDENT  Match hosts with a certain configured identity</span>
</code></pre>
</div>

<h2 id="disabling-command-line-parsing-and-supplying-your-options-programatically">Disabling command line parsing and supplying your options programatically</h2>

<p>Sometimes, perhaps when embedding an MCollective client into another tool like Puppet, you do not want MCollective to do any command line parsing as there might be conflicting command line options etc.</p>

<p>This can be achieved by supplying an options hash to the SimpleRPC client:</p>

<div class="highlight"><pre><code class="ruby"><span class="kp">include</span> <span class="no">MCollective</span><span class="o">::</span><span class="no">RPC</span>

<span class="n">options</span> <span class="o">=</span>  <span class="no">MCollective</span><span class="o">::</span><span class="no">Util</span><span class="o">.</span><span class="n">default_options</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="p">{</span><span class="ss">:options</span> <span class="o">=&gt;</span> <span class="n">options</span><span class="p">})</span>
</code></pre>
</div>

<p>This will create a RPC client for the agent test without any options parsing at all.</p>

<p>To set options like discovery timeout and so forth you will need use either the client utilities or manipulate the hash upfront, the client utility methods is the best.   The code below sets the discovery timeout in a way that does not require you to know any internal structures or the content of the options hash.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">options</span> <span class="o">=</span>  <span class="no">MCollective</span><span class="o">::</span><span class="no">Util</span><span class="o">.</span><span class="n">default_options</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="p">{</span><span class="ss">:options</span> <span class="o">=&gt;</span> <span class="n">options</span><span class="p">})</span>
<span class="n">client</span><span class="o">.</span><span class="n">discovery_timeout</span> <span class="o">=</span> <span class="mi">4</span>
</code></pre>
</div>

<p>Using this method of creating custom options hashes mean we can make internal changes to MCollective without affecting your code in the future.</p>

<h2 id="sending-simplerpc-requests-without-discovery-and-blocking">Sending SimpleRPC requests without discovery and blocking</h2>

<p>Usually this section will not apply to you.  The client libraries support sending a request without waiting for a reply.  This could be useful if you want to clean yum caches but don&#8217;t really care if it actually happens everywhere.</p>

<p>You will loose these abilities:</p>

<ul>
  <li>Knowing if your request was received by any agents</li>
  <li>Any stats about processing times etc</li>
  <li>Any information about the success or failure of your request</li>
</ul>

<p>The above should make it clear already that this is a limited use case, it&#8217;s essentially a broadcast request with no feedback loop.</p>

<p>The code below will send a request to the <code>runonce</code> action for an agent <code>puppetd</code>, once the request is dispatched I will have no idea if it got handled etc, my code will just continue onwards.</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">p</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;puppetd&quot;</span><span class="p">)</span>

<span class="nb">p</span><span class="o">.</span><span class="n">identity_filter</span> <span class="s2">&quot;your.box.com&quot;</span>
<span class="n">reqid</span> <span class="o">=</span> <span class="nb">p</span><span class="o">.</span><span class="n">runonce</span><span class="p">(</span><span class="ss">:forcerun</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:process_results</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
</code></pre>
</div>

<p>This will honor any attached filters set either programatically or through the command line, it will send the request but will
just not handle any responses.  All it will do is return the request id.</p>

<h2 id="doing-your-own-discovery">Doing your own discovery</h2>
<p>For web applications you&#8217;d probably use cached copied of Registration data to do discovery rather than wait for MC to do discovery between each request.</p>

<p>To do this, you&#8217;ll need to construct a filter and a list of expected hosts and then do a custom call:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">puppet</span> <span class="o">=</span> <span class="n">rpcclient</span><span class="p">(</span><span class="s2">&quot;puppetd&quot;</span><span class="p">)</span>

<span class="n">printrpc</span> <span class="n">puppet</span><span class="o">.</span><span class="n">custom_request</span><span class="p">(</span><span class="s2">&quot;runonce&quot;</span><span class="p">,</span> <span class="p">{</span><span class="ss">:forcerun</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">},</span> <span class="s2">&quot;your.box.com&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;identity&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;your.box.com&quot;</span><span class="p">})</span>
</code></pre>
</div>

<p>This will do a call with exactly the same stats, block and other semantics as a normal call like:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">printrpc</span> <span class="n">puppet</span><span class="o">.</span><span class="n">runonce</span><span class="p">(</span><span class="ss">:forcerun</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</code></pre>
</div>

<p>But instead of doing any discovery it will use the host list and filter you supplied in the call.</p>

<h2 id="the-rpcutil-helper-agent">The <code>rpcutil</code> Helper Agent</h2>

<p>A helper agent called <a href="./../../mcollective/reference/plugins/rpcutil.html"><code>rpcutil</code></a> is included that helps you gather stats, inventory etc about the running daemon.</p>

              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">


<ul>
  <li><strong>Overview</strong>
    <ul>
      <li><a href="./../../mcollective/index.html">Introduction</a></li>
      <li><a href="./../../mcollective/overview_components.html">Overview of Components</a></li>
      <li><a href="./../../mcollective/terminology.html">Terminology</a></li>
      <li><a href="./../../mcollective/screencasts.html">Screencasts</a></li>
      <li><a href="./../../mcollective/releasenotes.html">Release Notes</a></li>
      <li><a href="./../../mcollective/changelog.html">Changelog</a></li>
    </ul>
  </li>
  <li><strong>Deploying MCollective</strong>
    <ul>
      <li><a href="./../../mcollective/deploy/index.html">Index</a></li>
      <li><a href="./../../mcollective/deploy/demo.html">Demo</a></li>
      <li><a href="./../../mcollective/deploy/standard.html">Getting Started (Standard Deployment)</a></li>
    </ul>
  </li>
  <li><strong>Configuration / Deployment Topics</strong>
    <ul>
      <li><strong>Installation:</strong></li>
      <li><a href="./../../mcollective/deploy/install.html">Installing MCollective</a></li>
      <li><a href="./../../mcollective/deploy/plugins.html">Installing Plugins</a></li>
      <li><strong>Configuration:</strong></li>
      <li><a href="./../../mcollective/configure/server.html">Server Config Reference</a></li>
      <li><a href="./../../mcollective/configure/client.html">Client Config Reference</a></li>
      <li><a href="./../../mcollective/reference/integration/puppet.html">Puppet Integration</a></li>
      <li><a href="./../../mcollective/reference/integration/chef.html">Chef Integration</a></li>
      <li><strong>Middleware:</strong></li>
      <li><a href="./../../mcollective/deploy/middleware/index.html">Middleware Types</a></li>
      <li><a href="./../../mcollective/deploy/middleware/activemq.html">ActiveMQ Configs for MCollective</a></li>
      <li><a href="./../../mcollective/deploy/middleware/activemq_keystores.html">ActiveMQ TLS Keystore Setup</a></li>
      <li><a href="./../../mcollective/reference/integration/activemq_clusters.html">ActiveMQ Clustering</a></li>
      <li><a href="./../../mcollective/reference/integration/activemq_ssl.html">ActiveMQ TLS</a></li>
      <li><a href="./../../mcollective/reference/integration/activemq_security.html">ActiveMQ Security</a></li>
      <li><strong>Connector Plugins:</strong></li>
      <li><a href="./../../mcollective/reference/plugins/connector_activemq.html">The ActiveMQ Connector</a></li>
      <li><a href="./../../mcollective/reference/plugins/connector_rabbitmq.html">The RabbitMQ Connector</a></li>
      <li><strong>Security Plugins:</strong></li>
      <li><a href="./../../mcollective/reference/plugins/security_ssl.html">Configuring SSL Validation Security</a></li>
      <li><strong>Advanced Features:</strong></li>
      <li><a href="./../../mcollective/reference/basic/subcollectives.html">Subcollectives and Partitioning</a></li>
      <li><a href="./../../mcollective/simplerpc/auditing.html">Auditing</a> <!-- contains plugin-writing info --></li>
    </ul>
  </li>
  <li><strong>Use and Administer MCollective</strong>
    <ul>
      <li><a href="./../../mcollective/reference/basic/basic_cli_usage.html">Command Line Usage Instructions</a></li>
      <li><a href="./../../mcollective/reference/ui/filters.html">Command Filtering and Discovery</a></li>
      <li><a href="./../../mcollective/reference/basic/daemon.html">Controlling the MCollective Daemon</a></li>
      <li><a href="./../../mcollective/reference/plugins/rpcutil.html">Controlling the MCollective Daemon with the rpcutil Agent</a></li>
      <li><a href="./../../mcollective/reference/ui/nodereports.html">On-Demand Node Reports</a></li>
    </ul>
  </li>
  <li><strong>Write Agent Plugins</strong>
    <ul>
      <li><a href="./../../mcollective/simplerpc/agents.html">Writing Agent Plugins</a></li>
      <li><a href="./../../mcollective/reference/plugins/ddl.html">Writing DDL Files</a></li>
      <li><a href="./../../mcollective/reference/plugins/aggregate.html">Aggregating Results</a> <!-- mixes DDL info with info about writing aggregate plugins --></li>
    </ul>
  </li>
  <li><strong>Write Clients and Applications</strong>
    <ul>
      <li><span class="currentpage">Writing Clients</span></li>
      <li><a href="./../../mcollective/reference/plugins/application.html">Writing New mco Subcommands</a></li>
    </ul>
  </li>
  <li><strong>Write Other Plugins</strong>
    <ul>
      <li><a href="./../../mcollective/simplerpc/authorization.html">Writing Authorization Plugins and Enabling Authorization</a> <!-- contains deploy/config info --></li>
      <li><a href="./../../mcollective/reference/plugins/data.html">Writing Data Plugins</a></li>
      <li><a href="./../../mcollective/reference/plugins/discovery.html">Writing and Using Discovery Plugins</a> <!-- contains usage info --></li>
      <li><a href="./../../mcollective/reference/plugins/facts.html">Writing Facts Plugins</a></li>
      <li><a href="./../../mcollective/reference/plugins/registration.html">Writing Registration Plugins</a></li>
      <li><a href="./../../mcollective/reference/plugins/validator.html">Writing Validator Plugins</a></li>
    </ul>
  </li>
  <li><a href="http://projects.puppetlabs.com/projects/mcollective-plugins/wiki">Plugin Directory</a></li>
  <li><strong>Internals</strong>
    <ul>
      <li><a href="./../../mcollective/reference/basic/messageflow.html">Message Flow</a> <!-- needs more/needs update --></li>
      <li><a href="./../../mcollective/simplerpc/index.html">SimpleRPC Overview</a></li>
      <li><a href="./../../mcollective/simplerpc/messageformat.html">SimpleRPC Message Format</a></li>
      <li><a href="./../../mcollective/reference/basic/messageformat.html">Core Message Format</a></li>
      <li><a href="./../../mcollective/security.html">Security Overview</a></li>
    </ul>
  </li>
  <li><strong>Older and Non-Recommended Information</strong>
    <ul>
      <li><a href="./../../mcollective/reference/plugins/security_aes.html">Configuring AES Security</a></li>
      <li><a href="./../../mcollective/reference/plugins/connector_stomp.html">Configuring the Generic Stomp Connector</a></li>
      <li><a href="./../../mcollective/reference/basic/basic_agent_and_client.html">Writing Old-Style Agent Plugins</a></li>
      <li><a href="./../../mcollective/reference/index.html">Alternate Index</a></li>
    </ul>
  </li>
</ul>

                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>


	</body>
</html>
