<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" xml:lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  	<title>Learning Puppet &#8212; Preparing an Agent VM &#8212; Documentation &#8212; Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom" />
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/" />
    <link rel="index" title="Puppet Labs Documentation" href="http://docs.puppetlabs.com" />
    <link rel="icon" href="./../favicon.ico" />


  <meta name="description" content="We&#8217;re now moving into exercises that involve both a puppet master and one or more agent nodes, and to get the most out of this section, you" />



    <!-- FIXME: absolute paths -->

    <script type="text/javascript" src="./../files/javascripts/html5.js"></script>
    <script type="text/javascript" src="./../files/javascripts/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="./../files/javascripts/drop_down.js"></script>
    <script type="text/javascript" src="./../files/javascripts/cufon-yui.js"></script>
    <script type="text/javascript" src="./../files/fonts/Klavika_400-Klavika_600.font.js"></script>
    <script type="text/javascript" src="./../files/javascripts/ampersands.js"></script>
    <script type="text/javascript" src="./../files/javascripts/navigation-accordion.js"></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/learning/agentprep.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/style.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/syntax.css" media="screen" /> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/adbanner.css" media="screen" />

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    

  	<script type="text/javascript"><![CDATA[
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	]]></script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css"><![CDATA[h1, h2{ visibility : hidden }]]></style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups &amp; DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          </li><li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class="children">
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Learning Puppet &#8212; Preparing an Agent VM</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Learning Puppet &#8212; Preparing an Agent VM</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#step-0-get-the-latest-vm">Step 0: Get the Latest VM</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#download-the-latest-vm">Download the Latest VM</a></li>
   <li class="toc-lv3"><a href="#or-upgrade-pe-on-your-existing-vm">Or: Upgrade PE on Your Existing VM</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#step-1-duplicate-your-existing-vm">Step 1: Duplicate Your Existing VM</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#with-vmware-fusion">With VMware Fusion</a></li>
   <li class="toc-lv3"><a href="#with-virtualbox">With VirtualBox</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#step-2-reconfigure-the-new-node-with-puppet">Step 2: Reconfigure the New Node With Puppet</a></li>
  <li class="toc-lv2"><a href="#step-3-make-sure-the-vms-can-communicate">Step 3: Make Sure the VMs Can Communicate</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#ensure-the-vms-can-reach-each-other-by-ip">Ensure the VMs Can Reach Each Other by IP</a></li>
   <li class="toc-lv3"><a href="#ensure-the-vms-can-reach-the-master-by-name">Ensure the VMs Can Reach the Master by Name</a></li>
   <li class="toc-lv3"><a href="#ensure-the-firewalls-are-down">Ensure the Firewalls are Down</a></li>
   <li class="toc-lv3"><a href="#ensure-both-vms-know-the-time">Ensure Both VMs Know the Time</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#next">Next</a></li>
</ol></nav>

<p>We&#8217;re now moving into exercises that involve both a puppet master and one or more agent nodes, and to get the most out of this section, you&#8217;ll need to be running more than one node at a time. This interlude will help you get two nodes running and configured so that you&#8217;re ready for the next few chapters.</p>

<h2 id="step-0-get-the-latest-vm">Step 0: Get the Latest VM</h2>

<p>Things have changed quite a bit since we posted the first Learning Puppet VM, so to keep these instructions simple, everything below will assume you&#8217;re running a system with Puppet Enterprise 2.0 or later. You can check which version of PE you&#8217;re running like this:</p>

<pre><code>[root@learn ~]# puppet --version
2.7.9 (Puppet Enterprise 2.0.1)
</code></pre>

<p>If you&#8217;re up to date, <a href="#step-1-duplicate-your-existing-vm">skip down to here.</a> If you&#8217;re running an older version, do one of the following:</p>

<h3 id="download-the-latest-vm">Download the Latest VM</h3>

<p><a href="http://info.puppetlabs.com/learning-puppet-vm">The latest version of the Learning Puppet VM is right over here.</a> As ever, it&#8217;s about 500 MB and free for everyone to download.</p>

<p>Before replacing your VM, make sure to save any manifests or modules from your previous copy. (After all, the whole point of Puppet is that you can use them to get right back to where you were.)</p>

<h3 id="or-upgrade-pe-on-your-existing-vm">Or: Upgrade PE on Your Existing VM</h3>

<p>If you can&#8217;t download a whole new VM right now, you can:</p>

<ul>
  <li><a href="http://info.puppetlabs.com/download-pe.html">Download the latest version of Puppet Enterprise</a>. Choose the EL 5 for i386 installer, which is about 50 MB.</li>
  <li>Copy the installer tarball to your VM and <a href="./../pe/latest/install_upgrading.html">follow the upgrade instructions in the PE 2 User&#8217;s Guide</a>.</li>
</ul>

<p>This is more advanced than just downloading the current VM, especially if you&#8217;re upgrading from PE 1.0 or 1.1, but we&#8217;ve tried to document the process clearly. Follow the instructions for upgrading a combined master/console server.</p>

<h2 id="step-1-duplicate-your-existing-vm">Step 1: Duplicate Your Existing VM</h2>

<p>There are any number of ways you could make an agent VM for the next steps, but the fastest and easiest is to simply copy your existing VM and reconfigure it. (The reconfiguring could be difficult, but there&#8217;s a module for that.)</p>

<p>Below, we give instructions for copying the VM with VMware Fusion and with VirtualBox.</p>

<h3 id="with-vmware-fusion">With VMware Fusion</h3>

<p><em>(Note: although we don&#8217;t provide a full walkthrough for VMware Workstation, the process should be similar.)</em></p>

<ol>
  <li>
    <p>If you still have the zipped VM archive you originally downloaded, you can extract it again for a fresh copy.</p>

    <p>Otherwise, shut down the VM by running <code>shutdown -h now</code> while logged in as root. Once the system is stopped, locate the folder or bundle that contains the VMX file &#8212; you can right-click its entry in the Virtual Machine Library window and choose &#8220;Show in Finder&#8221; &#8212; and duplicate that entire directory.</p>

    <p><img src="./images/dupe_vmware_show.png" alt="Show in finder menu item" /> <img src="./images/dupe_vmware_duplicate.png" alt="Duplicate folder menu item" /></p>
  </li>
  <li>
    <p>Your second copy of the files (whether from re-extracting or duplicating) contains a VMX file; <strong>drag it and drop it</strong> onto Fusion&#8217;s Virtual Machine Library window. (If this window isn&#8217;t displayed, the menu item to display it is in Fusion&#8217;s &#8220;Window&#8221; menu.) This will import the virtual machine <em>without</em> automatically starting it up, which will give you a chance to change its RAM. (If you accidentally start it anyway, you can always change the RAM later or leave it as is.)</p>
  </li>
  <li>
    <p>Once Fusion has the VM, you can right-click its entry in the Library window and choose &#8220;Settings&#8221; to change the amount of memory it will consume. (Use the &#8220;Processors &amp; RAM&#8221; section of the settings window.) Although the original (puppet master) VM will need at least 512 MB of RAM, you can safely dial the agent VM down to 256 MB.</p>

    <p>You shouldn&#8217;t need to change the networking settings from the default mode (NAT); with VMware, this will allow your VMs to access the internet, each other, and your host system. If you need other nodes on the network to be able to contact your VMs, you can change the networking mode to Bridged.</p>
  </li>
  <li>
    <p>When you start the VM for the first time, Fusion will ask whether you moved it or copied it. You should answer that you copied it.</p>
  </li>
</ol>

<h3 id="with-virtualbox">With VirtualBox</h3>

<ol>
  <li>
    <p>If you still have the folder with the original OVF file, you can re-import it into VirtualBox for a new VM.</p>

    <p>Otherwise, shut down the VM by running <code>shutdown -h now</code> while logged in as root. Once the system is stopped, right-click on the VM&#8217;s entry in the VirtualBox Manager window, and select Clone. You will be presented with a series of dialog boxes.</p>

    <p><img src="./images/dupe_vbox_clone.png" alt="Clone menu item" /></p>

    <ol>
      <li>
        <p>In the first one, choose a new name for the VM and make sure the &#8220;Reinitialize the MAC address of all network cards&#8221; box is <strong>checked.</strong></p>

        <p><img src="./images/dupe_vbox_reinit.png" alt="Reinitialize checkbox" /></p>
      </li>
      <li>
        <p>In the second one, choose &#8220;Full Clone.&#8221;</p>

        <p><img src="./images/dupe_vbox_fullclone.png" alt="Full clone radio button" /></p>
      </li>
    </ol>
  </li>
  <li>
    <p>Once VirtualBox has the new VM ready, <a href="./index.html#with-virtualbox">change its network adapter to Bridged Adapter mode</a>; otherwise, it will be unable to communicate with the puppet master. (You can also configure two network adapters instead of using bridged mode, but this is advanced and should not be done by most users.)</p>
  </li>
  <li>
    <p>You can also click on the &#8220;System&#8221; settings to reduce the amount of memory the VM will consume. An agent node should only need 256 MB of RAM.</p>
  </li>
</ol>

<h2 id="step-2-reconfigure-the-new-node-with-puppet">Step 2: Reconfigure the New Node With Puppet</h2>

<p>Install <a href="./files/learningpuppet.tar.gz">this learningpuppet module</a> on the agent VM, and apply the <code>learningpuppet::makeagent</code> class:</p>

<pre><code># wget http://docs.puppetlabs.com/learning/files/learningpuppet.tar.gz
# tar -xzf learningpuppet.tar.gz
# mv learningpuppet /etc/puppetlabs/puppet/modules/
# puppet apply -e "class {'learningpuppet::makeagent':}"
</code></pre>

<p>If you don&#8217;t give the class a <code>newname</code> attribute, it will default to <code>agent1</code>, which is probably what you want.</p>

<h2 id="step-3-make-sure-the-vms-can-communicate">Step 3: Make Sure the VMs Can Communicate</h2>

<p>For Puppet to work right, your two VMs must:</p>

<ul>
  <li>Be able to reach each other by IP address</li>
  <li>Be able to reach the puppet master by name</li>
  <li>Have their firewalls turned off</li>
  <li>Have (reasonably) synchronized clocks</li>
</ul>

<h3 id="ensure-the-vms-can-reach-each-other-by-ip">Ensure the VMs Can Reach Each Other by IP</h3>

<h4 id="with-vmware-fusion-1">With VMware Fusion</h4>

<p>The VMs will be communicating via their <code>eth0</code> IP addresses. Find these addresses by running <code>facter ipaddress_eth0</code> on each system, then try to ping that IP from the other VM.</p>

<p>If the VMs can&#8217;t communicate, examine each VM&#8217;s settings and make sure:</p>

<ul>
  <li>The networking mode is either NAT or Bridged.</li>
  <li>Both VMs have the <em>same</em> networking mode.</li>
</ul>

<h4 id="with-virtualbox-1">With VirtualBox</h4>

<p>If both VMs have a single network adapter in Bridged Adapter mode (recommended), they will be communicating via their <code>eth0</code> IP addresses. Find these addresses by running <code>facter ipaddress_eth0</code> on each system, then try to ping that IP from the other VM.</p>

<p>If you have configured the VMs to have two network adapters, examine their settings &#8212; the VMs will be communicating via whichever adapter is set to Host Only Adapter mode. Run <code>facter ipaddress_&lt;ADAPTER&gt;</code> to find these IP addresses.</p>

<h3 id="ensure-the-vms-can-reach-the-master-by-name">Ensure the VMs Can Reach the Master by Name</h3>

<p>Make sure both VMs&#8217; <code>/etc/hosts</code> files contain a line similar to the following:</p>

<pre><code>172.16.158.151  learn.localdomain   learn puppet.localdomain puppet # This host is required for Puppet's name resolution to work correctly.
</code></pre>

<p>The IP address should be the one you found for the puppet master in the previous step.</p>

<p>Once you&#8217;ve edited the files, test that both VMs can ping the master at both its full name and its aliases:</p>

<pre><code>[root@agent1]# ping learn.localdomain
[root@agent1]# ping puppet
</code></pre>

<p>If this doesn&#8217;t work, make sure that the <code>/etc/hosts</code> files don&#8217;t have any conflicting lines &#8212; there should be only one line with those puppet master hostnames. If <code>/etc/hosts</code> looks good, you may also need to flush cached DNS information in each VM:</p>

<pre><code># nscd --invalidate=hosts
</code></pre>

<h3 id="ensure-the-firewalls-are-down">Ensure the Firewalls are Down</h3>

<p>We shipped the VM with iptables turned off, but it&#8217;s worth checking to make sure it&#8217;s still down:</p>

<pre><code># service iptables status
Firewall is stopped.
</code></pre>

<p>(In a real environment, you&#8217;d add firewall rules for Puppet traffic instead of disabling the firewall.)</p>

<h3 id="ensure-both-vms-know-the-time">Ensure Both VMs Know the Time</h3>

<p>Run <code>date -u</code> on both VMs, and compare the output. They should be within about a minute of each other.</p>

<h2 id="next">Next</h2>

<p>Your VMs are ready &#8212; now <a href="./agent_master_basic.html">continue reading</a> for a tour of the agent/master Puppet workflow.</p>

              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">&#8593; Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">


<ul>
  <li><a href="./../learning/index.html">Introduction</a></li>
  <li><strong>Part one: Serverless Puppet</strong>
    <ul>
      <li><a href="./../learning/ral.html">Resources and the RAL</a></li>
      <li><a href="./../learning/manifests.html">Manifests</a></li>
      <li><a href="./../learning/ordering.html">Ordering</a></li>
      <li><a href="./../learning/variables.html">Variables, Conditionals, Facts</a></li>
      <li><a href="./../learning/modules1.html">Modules and Classes</a></li>
      <li><a href="./../learning/templates.html">Templates</a></li>
      <li><a href="./../learning/modules2.html">Class Parameters</a></li>
      <li><a href="./../learning/definedtypes.html">Defined Types</a></li>
    </ul>
  </li>
  <li><strong>Part two: Master/Agent Puppet</strong>
    <ul>
      <li><span class="currentpage">Preparing an Agent VM</span></li>
      <li><a href="./../learning/agent_master_basic.html">Basic Agent/Master Puppet</a></li>
    </ul>
  </li>
</ul>

                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../images/smallbits_small_docs.png" alt="Puppet docs download" /></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo" /></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers &amp; consultants</a>
                  </p><p>
		</p><h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save" id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class="mktInput"><input class="mktFormText mktFormEmail" name="Email" id="Email" type="text" value="" maxlength="255" /><span class="mktFormMsg"></span></span>

				<input id="mktFrmSubmit" type="submit" class="btn" style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value="Subscribe" name="submitButton" onclick="formSubmit(document.getElementById(&quot;mktForm_1013&quot;)); return false;" />

				<input style="display: none;" id="mktFrmReset" type="reset" value="Clear" name="resetButton" onclick="formReset(document.getElementById(&quot;mktForm_1013&quot;)); return false;" />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&amp;kw={keyword}" />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/" />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/" />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript"><![CDATA[
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				]]></script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		</p><h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0" /></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0" /></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0" /></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0" /></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0" /></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0" /></a></li>
					</ul>

              	

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &#169; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript"><![CDATA[Cufon.now();]]></script>
  	<style type="text/css"><![CDATA[h1, h2, .btn { visibility : visible; }]]></style>


	</body>
</html>
