<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Data Plugins — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../../../favicon.ico' />


  <meta name="description" content="OverviewUp to MCollective 2.0 the discovery system could only discover againstinstalled agents, configuration management classes or facts and the n...">



    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../../../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../../../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/ampersands.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/navigation-accordion.js'></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/mcollective/reference/plugins/data.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Data Plugins</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Data Plugins</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#overview">Overview</a></li>
  <li class="toc-lv2"><a href="#viewing-or-retrieving-results-from-a-data-plugin">Viewing or retrieving results from a data plugin</a></li>
  <li class="toc-lv2"><a href="#writing-a-data-plugin">Writing a data plugin</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#the-ruby-logic-for-the-plugin">The Ruby logic for the plugin</a></li>
   <li class="toc-lv3"><a href="#the-ddl-for-the-plugin">The DDL for the plugin</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#auto-generated-documentation">Auto generated documentation</a></li>
  <li class="toc-lv2"><a href="#available-plugins-for-a-node-you-can-use-the-mco-inventory">Available plugins for a node You can use the mco inventory</a></li>
</ol></nav>

<h2 id="overview">Overview</h2>
<p>Up to MCollective 2.0 the discovery system could only discover against
installed agents, configuration management classes or facts and the node
identities. We&#8217;re extending this to support discovery against many
sources through a simple plugin system.</p>

<p><em>NOTE:</em> This feature is available since version 2.1.0</p>

<p>The basic idea is that you could do discovery statements like the ones
below:</p>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> mco find -S <span class="s2">&quot;fstat(&#39;/etc/rsyslog.conf&#39;).md5=/4edff591f6e38/&quot;</span>
</code></pre>
</div>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> mco find -S <span class="s2">&quot;sysctl(&#39;net.ipv4.conf.all.forwarding&#39;).value=1&quot;</span>
</code></pre>
</div>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> mco find -S <span class="s2">&quot;sysctl(&#39;net.ipv4.conf.all.forwarding&#39;).value=1 and % location=dc1&quot;</span>
</code></pre>
</div>

<p>You could also use these data sources in your own agents or other
plugins:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">action</span> <span class="s2">&quot;query&quot;</span> <span class="k">do</span>
   <span class="n">reply</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="o">=</span> <span class="no">Data</span><span class="o">.</span><span class="n">sysctl</span><span class="p">(</span><span class="n">request</span><span class="o">[</span><span class="ss">:sysctl_name</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="k">end</span>
</code></pre>
</div>

<p><em>NOTE:</em> As opposed to the <a href="./../../../mcollective/reference/plugins/discovery.html">DiscoveryPlugins</a> which are used by the client <br />
to communicate to the nodes using direct addressing, data plugins on the other <br />
hand refer to data that the nodes can provide, and hence this uses the normal<br />
broadcast discovery paradigm.   </p>

<p>These new data sources are plugins so you can provide via the plugin
system and they require DDL documents.  The DDL will be used on both the
client and the server to provide strict validation and configuration.</p>

<p>The DDL for these plugins will affect the client libraries in the
following ways:</p>

<ul>
  <li>You will get errors if you try to discover using unknown functions</li>
  <li>Your input argument values will be validated against the DDL</li>
  <li>You will only be able to use output properties that are known in the DDL</li>
  <li>If a plugin DDL says it needs 5 seconds to run your discovery and maximum run times will increase by 5 seconds automatically</li>
</ul>

<p>On the servers the DDL will:</p>

<ul>
  <li>be used to validate known plugins</li>
  <li>be used to validate input arguments</li>
  <li>be used to validate requests for known output values</li>
</ul>

<h2 id="viewing-or-retrieving-results-from-a-data-plugin">Viewing or retrieving results from a data plugin</h2>

<p>You can view the output from a data plugin using the <em>rpcutil</em> agent:</p>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> mco rpc rpcutil get_data <span class="nb">source</span><span class="o">=</span>fstat <span class="nv">query</span><span class="o">=</span>/etc/hosts
<span class="go">.</span>
<span class="go">.</span>
<span class="go">your.node.net</span>
<span class="go">           atime: 2012-06-14 21:41:54</span>
<span class="go">       atime_age: 54128</span>
<span class="go">   atime_seconds: 1339706514</span>
<span class="go">           ctime: 2012-01-18 20:28:34</span>
<span class="go">       ctime_age: 12842128</span>
<span class="go">   ctime_seconds: 1326918514</span>
<span class="go">             gid: 0</span>
<span class="go">             md5: 54fb6627dbaa37721048e4549db3224d</span>
<span class="go">            mode: 100644</span>
<span class="go">           mtime: 2010-01-12 13:28:22</span>
<span class="go">       mtime_age: 76457740</span>
<span class="go">   mtime_seconds: 1263302902</span>
<span class="go">            name: /etc/hosts</span>
<span class="go">          output: present</span>
<span class="go">         present: 1</span>
<span class="go">            size: 158</span>
<span class="go">            type: file</span>
<span class="go">             uid: 0</span>
</code></pre>
</div>

<p>The same action can be used to retrieve data programatically.</p>

<h2 id="writing-a-data-plugin">Writing a data plugin</h2>

<h3 id="the-ruby-logic-for-the-plugin">The Ruby logic for the plugin</h3>
<p>The data plugins should not change the system in anyway, you should take
care to create plugins that only reads the state of the system.  If you
want to affect the status of the system you should write Agents.</p>

<p>These plugins are kept simple as they will be typed on the command line
so the following restrictions are present:</p>

<ul>
  <li>They can only take 1 input argument</li>
  <li>They can only return simple String, Numeric or Booleans no Hashes or complex data types</li>
  <li>They should be fast as these will impact discovery times and agent run times.</li>
</ul>

<p>Writing data plugins is easy and mimic the basics of writing agents,
below we have a simple <em>sysctl</em> plugin that was used in the examples
earlier:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="k">module</span> <span class="nn">MCollective</span>
<span class="lineno"> 2</span>   <span class="k">module</span> <span class="nn">Data</span>
<span class="lineno"> 3</span>     <span class="k">class</span> <span class="nc">Sysctl_data</span><span class="o">&lt;</span><span class="no">Base</span>
<span class="lineno"> 4</span>       <span class="n">activate_when</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">executable?</span><span class="p">(</span><span class="s2">&quot;/sbin/sysctl&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="no">Facter</span><span class="o">[</span><span class="s2">&quot;kernel&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span> <span class="p">}</span>
<span class="lineno"> 5</span>
<span class="lineno"> 6</span>       <span class="n">query</span> <span class="k">do</span> <span class="o">|</span><span class="n">sysctl</span><span class="o">|</span>
<span class="lineno"> 7</span>         <span class="n">shell</span> <span class="o">=</span> <span class="no">Shell</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;/sbin/sysctl %s&quot;</span> <span class="o">%</span> <span class="n">sysctl</span><span class="p">)</span>
<span class="lineno"> 8</span>         <span class="n">shell</span><span class="o">.</span><span class="n">runcommand</span>
<span class="lineno"> 9</span>
<span class="lineno">10</span>         <span class="k">if</span> <span class="n">shell</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">exitstatus</span> <span class="o">==</span> <span class="mi">0</span>
<span class="lineno">11</span>           <span class="n">value</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/\s*=\s*/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="lineno">12</span>
<span class="lineno">13</span>           <span class="k">if</span> <span class="n">value</span>
<span class="lineno">14</span>             <span class="n">value</span> <span class="o">=</span> <span class="nb">Integer</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">=~</span> <span class="sr">/^\d+$/</span>
<span class="lineno">15</span>             <span class="n">value</span> <span class="o">=</span> <span class="nb">Float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">=~</span> <span class="sr">/^\d+\.\d+$/</span>
<span class="lineno">16</span>           <span class="k">end</span>
<span class="lineno">17</span>
<span class="lineno">18</span>           <span class="n">result</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="lineno">19</span>         <span class="k">end</span>
<span class="lineno">20</span>       <span class="k">end</span>
<span class="lineno">21</span>     <span class="k">end</span>
<span class="lineno">22</span>   <span class="k">end</span>
<span class="lineno">23</span> <span class="k">end</span>
</code></pre>
</div>

<p>The class names have to be <em>Something_data</em> and they must inherit from
<em>Base</em> as in the example here. The file would be saved in the <em>libdir</em>
as <em>data/sysctl_data.rb</em> and <em>data/sysctl_data.ddl</em>.</p>

<p>This plugin will only be activated if the file <em>/sbin/sysctl</em> exist, is
executable and if the system is a Linux server. This allow us to install
it on a Windows machine where it will just be disabled and those
machines will never be discovered using this function.</p>

<p>We then create a block that would be the main body of the query.  We use
the <em>MCollective::Shell</em> class to run sysctl, parse the output and save
it into the <em>result</em> hash.</p>

<p>The result hash is the only way to return values from these plugins. You
can only save simple strings, numbers or booleans in the result.</p>

<h3 id="the-ddl-for-the-plugin">The DDL for the plugin</h3>
<p>As mentioned every data plugin requires a DDL.  These DDL files mimic
those of the <a href="./../../../mcollective/reference/plugins/ddl.html">SimpleRPC Agents</a>.</p>

<p>Below you&#8217;ll find a DDL for the above sysctl data plugin:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="n">metadata</span>    <span class="ss">:name</span>        <span class="o">=&gt;</span> <span class="s2">&quot;Sysctl values&quot;</span><span class="p">,</span>
<span class="lineno"> 2</span>             <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;Retrieve values for a given sysctl&quot;</span><span class="p">,</span>
<span class="lineno"> 3</span>             <span class="ss">:author</span>      <span class="o">=&gt;</span> <span class="s2">&quot;R.I.Pienaar &lt;rip@devco.net&gt;&quot;</span><span class="p">,</span>
<span class="lineno"> 4</span>             <span class="ss">:license</span>     <span class="o">=&gt;</span> <span class="s2">&quot;ASL 2.0&quot;</span><span class="p">,</span>
<span class="lineno"> 5</span>             <span class="ss">:version</span>     <span class="o">=&gt;</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<span class="lineno"> 6</span>             <span class="ss">:url</span>         <span class="o">=&gt;</span> <span class="s2">&quot;http://marionette-collective.org/&quot;</span><span class="p">,</span>
<span class="lineno"> 7</span>             <span class="ss">:timeout</span>     <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="lineno"> 8</span>
<span class="lineno"> 9</span> <span class="n">dataquery</span> <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;Sysctl values&quot;</span> <span class="k">do</span>
<span class="lineno">10</span>     <span class="n">input</span> <span class="ss">:query</span><span class="p">,</span>
<span class="lineno">11</span>           <span class="ss">:prompt</span> <span class="o">=&gt;</span> <span class="s2">&quot;Variable Name&quot;</span><span class="p">,</span>
<span class="lineno">12</span>           <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;Valid Variable Name&quot;</span><span class="p">,</span>
<span class="lineno">13</span>           <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span>
<span class="lineno">14</span>           <span class="ss">:validation</span> <span class="o">=&gt;</span> <span class="sr">/^[\w\-\.]+$/</span><span class="p">,</span>
<span class="lineno">15</span>           <span class="ss">:maxlength</span> <span class="o">=&gt;</span> <span class="mi">120</span>
<span class="lineno">16</span>
<span class="lineno">17</span>     <span class="n">output</span> <span class="ss">:value</span><span class="p">,</span>
<span class="lineno">18</span>            <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;Kernel Parameter Value&quot;</span><span class="p">,</span>
<span class="lineno">19</span>            <span class="ss">:display_as</span> <span class="o">=&gt;</span> <span class="s2">&quot;Value&quot;</span>
<span class="lineno">20</span> <span class="k">end</span>
</code></pre>
</div>

<p>The <em>timeout</em> must be set correctly, if your data source is slow you
need to reflect that in the timeout here.  The timeout will be used on
the clients to decide how long to wait for discovery responses from the
network so getting this wrong will result in nodes not being discovered.</p>

<p>Each data plugin can only have one <em>dataquery</em> block with exactly 1
<em>input</em> block but could have multiple <em>output</em> blocks.</p>

<p>It&#8217;s important to get the validation correct, here we only accept the
characters we know are legal in sysctl variables on Linux.  We will
specifically never allow backticks to be used in arguments to avoid
accidental shell exploits.</p>

<p>Note the correlation between output names and the use in discovery and
agents here we create an output called <em>value</em> this means we would use
it in discovery as:</p>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> mco find -S <span class="s2">&quot;sysctl(&#39;net.ipv4.conf.all.forwarding&#39;).value=1&quot;</span>
</code></pre>
</div>

<p>And we would output the result from our plugin code as:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">result</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre>
</div>

<p>And in any agent where we might use the data source:</p>

<div class="highlight"><pre><code class="ruby"><span class="lineno">1</span> <span class="n">something</span> <span class="o">=</span> <span class="no">Data</span><span class="o">.</span><span class="n">sysctl</span><span class="p">(</span><span class="s1">&#39;net.ipv4.conf.all.forwarding&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</code></pre>
</div>

<p>These have to match everywhere, you cannot reference undeclared data and
you cannot use input that does not validate against the DDL declared
validations.</p>

<p>Refer to the full <a href="./../../../mcollective/reference/plugins/ddl.html">DDL</a> documentation for details on all possible values
of the <em>metadata</em>, <em>input</em> and <em>output</em> blocks.</p>

<h2 id="auto-generated-documentation">Auto generated documentation</h2>
<p>As with agents the DDL can be used to generate documentation, if you
wanted to know what the input and output values are for a specific
plugin you can use <em>mco plugin doc</em> to see generated documentation.</p>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> mco plugin doc sysctl
<span class="go">Sysctl values</span>
<span class="go">=============</span>

<span class="go">Retrieve values for a given sysctl</span>

<span class="go">      Author: R.I.Pienaar &lt;rip@devco.net&gt;</span>
<span class="go">     Version: 1.0</span>
<span class="go">     License: ASL 2.0</span>
<span class="go">     Timeout: 1</span>
<span class="go">   Home Page: http://marionette-collective.org/</span>

<span class="go">QUERY FUNCTION INPUT:</span>

<span class="go">              Description: Valid Variable Name</span>
<span class="go">                   Prompt: Variable Name</span>
<span class="go">                     Type: string</span>
<span class="go">               Validation: (?-mix:^[\w\-\.]+$)</span>
<span class="go">                   Length: 120</span>

<span class="go">QUERY FUNCTION OUTPUT:</span>

<span class="go">           value:</span>
<span class="go">              Description: Kernel Parameter Value</span>
<span class="go">               Display As: Value</span>
</code></pre>
</div>

<h2 id="available-plugins-for-a-node-you-can-use-the-mco-inventory">Available plugins for a node You can use the <em>mco inventory</em></h2>
<p>application to see remotely what plugins a node has available:</p>

<div class="highlight"><pre><code class="console"><span class="gp">%</span> mco inventory your.node
<span class="go">Inventory for your.node:</span>

<span class="go">   .</span>
<span class="go">   .</span>
<span class="go">   .</span>

<span class="go">   Data Plugins:</span>
<span class="go">      fstat           sysctl</span>
</code></pre>
</div>


              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">


<ul>
  <li><strong>Overview</strong>
    <ul>
      <li><a href="./../../../mcollective/index.html">Introduction</a></li>
      <li><a href="./../../../mcollective/overview_components.html">Overview of Components</a></li>
      <li><a href="./../../../mcollective/terminology.html">Terminology</a></li>
      <li><a href="./../../../mcollective/screencasts.html">Screencasts</a></li>
      <li><a href="./../../../mcollective/releasenotes.html">Release Notes</a></li>
      <li><a href="./../../../mcollective/changelog.html">Changelog</a></li>
    </ul>
  </li>
  <li><strong>Deploying MCollective</strong>
    <ul>
      <li><a href="./../../../mcollective/deploy/index.html">Index</a></li>
      <li><a href="./../../../mcollective/deploy/demo.html">Demo</a></li>
      <li><a href="./../../../mcollective/deploy/standard.html">Getting Started (Standard Deployment)</a></li>
    </ul>
  </li>
  <li><strong>Configuration / Deployment Topics</strong>
    <ul>
      <li><strong>Installation:</strong></li>
      <li><a href="./../../../mcollective/deploy/install.html">Installing MCollective</a></li>
      <li><a href="./../../../mcollective/deploy/plugins.html">Installing Plugins</a></li>
      <li><strong>Configuration:</strong></li>
      <li><a href="./../../../mcollective/configure/server.html">Server Config Reference</a></li>
      <li><a href="./../../../mcollective/configure/client.html">Client Config Reference</a></li>
      <li><a href="./../../../mcollective/reference/integration/puppet.html">Puppet Integration</a></li>
      <li><a href="./../../../mcollective/reference/integration/chef.html">Chef Integration</a></li>
      <li><strong>Middleware:</strong></li>
      <li><a href="./../../../mcollective/deploy/middleware/index.html">Middleware Types</a></li>
      <li><a href="./../../../mcollective/deploy/middleware/activemq.html">ActiveMQ Configs for MCollective</a></li>
      <li><a href="./../../../mcollective/deploy/middleware/activemq_keystores.html">ActiveMQ TLS Keystore Setup</a></li>
      <li><a href="./../../../mcollective/reference/integration/activemq_clusters.html">ActiveMQ Clustering</a></li>
      <li><a href="./../../../mcollective/reference/integration/activemq_ssl.html">ActiveMQ TLS</a></li>
      <li><a href="./../../../mcollective/reference/integration/activemq_security.html">ActiveMQ Security</a></li>
      <li><strong>Connector Plugins:</strong></li>
      <li><a href="./../../../mcollective/reference/plugins/connector_activemq.html">The ActiveMQ Connector</a></li>
      <li><a href="./../../../mcollective/reference/plugins/connector_rabbitmq.html">The RabbitMQ Connector</a></li>
      <li><strong>Security Plugins:</strong></li>
      <li><a href="./../../../mcollective/reference/plugins/security_ssl.html">Configuring SSL Validation Security</a></li>
      <li><strong>Advanced Features:</strong></li>
      <li><a href="./../../../mcollective/reference/basic/subcollectives.html">Subcollectives and Partitioning</a></li>
      <li><a href="./../../../mcollective/simplerpc/auditing.html">Auditing</a> <!-- contains plugin-writing info --></li>
    </ul>
  </li>
  <li><strong>Use and Administer MCollective</strong>
    <ul>
      <li><a href="./../../../mcollective/reference/basic/basic_cli_usage.html">Command Line Usage Instructions</a></li>
      <li><a href="./../../../mcollective/reference/ui/filters.html">Command Filtering and Discovery</a></li>
      <li><a href="./../../../mcollective/reference/basic/daemon.html">Controlling the MCollective Daemon</a></li>
      <li><a href="./../../../mcollective/reference/plugins/rpcutil.html">Controlling the MCollective Daemon with the rpcutil Agent</a></li>
      <li><a href="./../../../mcollective/reference/ui/nodereports.html">On-Demand Node Reports</a></li>
    </ul>
  </li>
  <li><strong>Write Agent Plugins</strong>
    <ul>
      <li><a href="./../../../mcollective/simplerpc/agents.html">Writing Agent Plugins</a></li>
      <li><a href="./../../../mcollective/reference/plugins/ddl.html">Writing DDL Files</a></li>
      <li><a href="./../../../mcollective/reference/plugins/aggregate.html">Aggregating Results</a> <!-- mixes DDL info with info about writing aggregate plugins --></li>
    </ul>
  </li>
  <li><strong>Write Clients and Applications</strong>
    <ul>
      <li><a href="./../../../mcollective/simplerpc/clients.html">Writing Clients</a></li>
      <li><a href="./../../../mcollective/reference/plugins/application.html">Writing New mco Subcommands</a></li>
    </ul>
  </li>
  <li><strong>Write Other Plugins</strong>
    <ul>
      <li><a href="./../../../mcollective/simplerpc/authorization.html">Writing Authorization Plugins and Enabling Authorization</a> <!-- contains deploy/config info --></li>
      <li><span class="currentpage">Writing Data Plugins</span></li>
      <li><a href="./../../../mcollective/reference/plugins/discovery.html">Writing and Using Discovery Plugins</a> <!-- contains usage info --></li>
      <li><a href="./../../../mcollective/reference/plugins/facts.html">Writing Facts Plugins</a></li>
      <li><a href="./../../../mcollective/reference/plugins/registration.html">Writing Registration Plugins</a></li>
      <li><a href="./../../../mcollective/reference/plugins/validator.html">Writing Validator Plugins</a></li>
    </ul>
  </li>
  <li><a href="http://projects.puppetlabs.com/projects/mcollective-plugins/wiki">Plugin Directory</a></li>
  <li><strong>Internals</strong>
    <ul>
      <li><a href="./../../../mcollective/reference/basic/messageflow.html">Message Flow</a> <!-- needs more/needs update --></li>
      <li><a href="./../../../mcollective/simplerpc/index.html">SimpleRPC Overview</a></li>
      <li><a href="./../../../mcollective/simplerpc/messageformat.html">SimpleRPC Message Format</a></li>
      <li><a href="./../../../mcollective/reference/basic/messageformat.html">Core Message Format</a></li>
      <li><a href="./../../../mcollective/security.html">Security Overview</a></li>
    </ul>
  </li>
  <li><strong>Older and Non-Recommended Information</strong>
    <ul>
      <li><a href="./../../../mcollective/reference/plugins/security_aes.html">Configuring AES Security</a></li>
      <li><a href="./../../../mcollective/reference/plugins/connector_stomp.html">Configuring the Generic Stomp Connector</a></li>
      <li><a href="./../../../mcollective/reference/basic/basic_agent_and_client.html">Writing Old-Style Agent Plugins</a></li>
      <li><a href="./../../../mcollective/reference/index.html">Alternate Index</a></li>
    </ul>
  </li>
</ul>

                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>


	</body>
</html>
