<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>MCollective » Deploy » Middleware » ActiveMQ Config — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../../../favicon.ico' />


  <meta name="description" content="SummaryApache ActiveMQ is the primary middleware we recommend with MCollective. It&#8217;s good software, but its XML config file is large and unwi...">



    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../../../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../../../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/ampersands.js'></script>
    <script type='text/javascript' src='./../../../files/javascripts/navigation-accordion.js'></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/mcollective/deploy/middleware/activemq.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../../../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">MCollective » Deploy » Middleware » ActiveMQ Config</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>ActiveMQ Config Reference for MCollective Users</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#summary">Summary</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#how-to-use-this-page">How to Use This Page</a></li>
   <li class="toc-lv3"><a href="#example-config-files">Example Config Files</a></li>
   <li class="toc-lv3"><a href="#version-limits">Version Limits</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#how-mcollective-uses-activemq">How MCollective Uses ActiveMQ</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#absolute-minimum-requirements">Absolute Minimum Requirements</a></li>
   <li class="toc-lv3"><a href="#topic-and-queue-names">Topic and Queue Names</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#config-file-location-and-format">Config File Location and Format</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#external-activemq-documentation">External ActiveMQ Documentation</a></li>
   <li class="toc-lv3"><a href="#wildcards">Wildcards</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#required-settings">Required Settings</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#transport-connectors">Transport Connector(s)</a></li>
   <li class="toc-lv3"><a href="#reply-queue-pruning">Reply Queue Pruning</a></li>
   <li class="toc-lv3"><a href="#disable-producer-flow-control-on-topics">Disable Producer Flow Control on Topics</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#recommended-settings">Recommended Settings</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#tls-credentials">TLS Credentials</a></li>
   <li class="toc-lv3"><a href="#authentication-users-and-groups">Authentication (Users and Groups)</a></li>
   <li class="toc-lv3"><a href="#authorization-group-permissions">Authorization (Group Permissions)</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#settings-for-networks-of-brokers">Settings for Networks of Brokers</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#broker-name">Broker Name</a></li>
   <li class="toc-lv3"><a href="#openwire-transports">OpenWire Transports</a></li>
   <li class="toc-lv3"><a href="#network-connectors">Network Connectors</a></li>
   <li class="toc-lv3"><a href="#destination-filtering">Destination Filtering</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#tuning">Tuning</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#dont-use-dedicated-task-runner">Don&#8217;t Use Dedicated Task Runner</a></li>
   <li class="toc-lv3"><a href="#increase-jvm-heap-if-necessary">Increase JVM Heap if Necessary</a></li>
   <li class="toc-lv3"><a href="#memory-and-temp-usage-for-messages-systemusage">Memory and Temp Usage for Messages (systemUsage)</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#boilerplate">Boilerplate</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#persistence">Persistence</a></li>
   <li class="toc-lv3"><a href="#management-context">Management Context</a></li>
   <li class="toc-lv3"><a href="#statistics-broker">Statistics Broker</a></li>
   <li class="toc-lv3"><a href="#jetty-web-consoles-apis-etc">Jetty (Web Consoles, APIs, etc.)</a></li>
</ol></li>
</ol></nav>

<h2 id="summary">Summary</h2>

<p>Apache ActiveMQ is the primary middleware we recommend with MCollective. It&#8217;s good software, but its XML config file is large and unwieldy, and you may need to edit many sections of it in a complex MCollective deployment. This reference guide attempts to describe every major ActiveMQ setting that matters to MCollective.</p>

<h3 id="how-to-use-this-page">How to Use This Page</h3>

<ul>
  <li>This page <strong>doesn&#8217;t</strong> describe the complete format of the activemq.xml config file, and will sometimes use incomplete shorthand to describe elements of it.</li>
  <li>You should definitely refer to an example config file while reading, so you can see each element&#8217;s full syntax in context.</li>
  <li>You don&#8217;t need to read this entire page when setting up a new deployment. We recommend that you:
    <ul>
      <li>Start with an example config file (see directly below).</li>
      <li>Make heavy use of the table of contents above.</li>
      <li>Skim the sections of this page you currently care about, and edit your config as needed.</li>
      <li>Refer back to this page later when you need to expand your broker infrastructure.</li>
    </ul>
  </li>
  <li>If you are a new user, we recommend that you:
    <ul>
      <li>Start with the <a href="http://github.com/puppetlabs/marionette-collective/raw/master/ext/activemq/examples/single-broker/activemq.xml">single-broker example config</a>.</li>
      <li>Change the <a href="#authentication-users-and-groups">user account passwords</a>.</li>
      <li><a href="#tls-credentials">Set up TLS</a>.</li>
    </ul>
  </li>
</ul>

<h3 id="example-config-files">Example Config Files</h3>

<p>We have several.</p>

<ul>
  <li><a href="http://github.com/puppetlabs/marionette-collective/raw/master/ext/activemq/examples/single-broker/activemq.xml">Minimal config example</a> &#8212; single broker <!-- , minimal authorization. --></li>
  <li><a href="https://github.com/puppetlabs/marionette-collective/tree/master/ext/activemq/examples/multi-broker">Maximal config example</a> &#8212; multi-broker <!--  with extensive authorization. --></li>
</ul>

<!--
* [Template-based example][template_example] --- reduces configuration down to a handful of variables; shows how those few decisions ramify into many config edits.
 -->

<blockquote>
  <p><strong>Note:</strong> Some config data needs to be set in both MCollective and ActiveMQ; your configuration of one will affect the other. In this page, we call out that information with headers labeled &#8220;Shared Configuration.&#8221;</p>
</blockquote>

<h3 id="version-limits">Version Limits</h3>

<p>This document is about the &#8220;new&#8221; MCollective/ActiveMQ interface, which means it requires the following:</p>

<ul>
  <li>MCollective 2.0.0 or newer</li>
  <li>ActiveMQ 5.5.0 or newer</li>
  <li>Stomp gem 1.2.2 or newer</li>
  <li>The <a href="./../../../mcollective/reference/plugins/connector_activemq.html">activemq connector</a> plugin (included with MCollective 2.0.0 and newer)</li>
</ul>

<p>(<a href="#content">↑ Back to top</a>)</p>

<h2 id="how-mcollective-uses-activemq">How MCollective Uses ActiveMQ</h2>

<p>MCollective connects to ActiveMQ over the Stomp protocol, and presents certain credentials:</p>

<ul>
  <li>It provides a username and password, with which ActiveMQ can do what it pleases.</li>
  <li>If TLS is in use, it will also present a certificate (and verify the ActiveMQ server&#8217;s certificate).</li>
</ul>

<p>Once allowed to connect, MCollective will use the Stomp protocol to create subscriptions. It will then produce and consume a lot of traffic on queues and topics whose names begin with <code>mcollective</code>. (See &#8220;Topic and Queue Names&#8221; directly below.)</p>

<h3 id="absolute-minimum-requirements">Absolute Minimum Requirements</h3>

<p>ActiveMQ defaults to believing that it is routing traffic between processes in a single JVM instance: it doesn&#8217;t assume it is connected to the network, and it uses a loose-to-nonexistent security model.</p>

<p>This means that if you do nothing but enable Stomp traffic, MCollective will work fine. (Albeit with terrible security and eventual out-of-control memory usage.)</p>

<h3 id="topic-and-queue-names">Topic and Queue Names</h3>

<p>MCollective uses the following destination names. This list uses standard <a href="http://activemq.apache.org/wildcards.html">ActiveMQ destination wildcards</a>. &#8220;COLLECTIVE&#8221; is the name of the collective being used; by default, this is <code>mcollective</code>, but if you are using <a href="./../../../mcollective/reference/basic/subcollectives.html">subcollectives</a>, each one is implemented as an equal peer of the default collective.</p>

<p>Topics:</p>

<ul>
  <li><code>ActiveMQ.Advisory.&gt;</code> (built-in topics that all ActiveMQ producers and consumers need all permissions on)</li>
  <li><code>COLLECTIVE.*.agent</code> (for each agent plugin, where the <code>*</code> is the name of the plugin)</li>
</ul>

<p>Queues:</p>

<ul>
  <li><code>COLLECTIVE.nodes</code> (used for direct addressing; this is a single destination that uses JMS selectors, rather than a group of destinations)</li>
  <li><code>COLLECTIVE.reply.&gt;</code> (where the continued portion is a request ID)</li>
</ul>

<blockquote>
  <h4 id="shared-configuration">Shared Configuration</h4>

  <p>Subcollectives must also be configured in the MCollective client and server config files. ActiveMQ must allow traffic on any subcollective that MCollective servers and clients expect to use.</p>
</blockquote>

<p>(<a href="#content">↑ Back to top</a>)</p>

<h2 id="config-file-location-and-format">Config File Location and Format</h2>

<p>ActiveMQ&#8217;s config is usually called activemq.xml, and is kept in ActiveMQ&#8217;s configuration directory (<code>/etc/activemq</code> with Puppet Labs&#8217;s Red Hat-like packages, or a subdirectory of <code>/etc/activemq/instances-enabled</code> with the standard Debian or Ubuntu packages). Any other files referenced in activemq.xml will be looked for in the same directory.</p>

<p>The config file is in Java&#8217;s Beans XML format. Note that all of the settings relevant to MCollective are located inside activemq.xml&#8217;s <code>&lt;broker&gt;</code> element.</p>

<p>This document won&#8217;t describe the complete format of the activemq.xml config file, and will sometimes use incomplete shorthand to describe elements of it. You should definitely <a href="#example-config-files">refer to an example config file</a> while reading, so you can see each element&#8217;s full syntax in context.</p>

<p>You can also read external documentation for a more complete understanding.</p>

<blockquote>
  <p><strong>Bug Warning:</strong> In ActiveMQ 5.5, the first-level children of the <code>&lt;broker&gt;</code> element must be arranged in alphabetical order. There is no good reason for this behavior, and it was fixed in ActiveMQ 5.6.</p>
</blockquote>

<h3 id="external-activemq-documentation">External ActiveMQ Documentation</h3>

<p>The Apache ActiveMQ documentation contains important information, but it is often incomplete, badly organized, and confusing. The Fuse documentation (a commercially supported release of ActiveMQ) is significantly better written and better organized, although it requires signing up for an email newsletter, but it may be out of sync with the most recent ActiveMQ releases.</p>

<ul>
  <li><a href="http://activemq.apache.org/version-5-xml-configuration.html">Apache ActiveMQ Documentation</a></li>
  <li><a href="http://fusesource.com/documentation/fuse-message-broker-documentation/">Fuse Documentation</a></li>
</ul>

<h3 id="wildcards">Wildcards</h3>

<p>You&#8217;ll see a lot of <a href="http://activemq.apache.org/wildcards.html">ActiveMQ destination wildcards</a> below. In short:</p>

<ul>
  <li>Segments in a destination name are separated with dots (<code>.</code>)</li>
  <li>A <code>*</code> represents <em>one segment</em> (i.e. any sequence of non-dot characters)</li>
  <li>A <code>&gt;</code> represents <em>the whole rest of the name</em> after a prefix</li>
</ul>

<p>(<a href="#content">↑ Back to top</a>)</p>

<h2 id="required-settings">Required Settings</h2>

<p>One way or another, you must set all of the following.</p>

<h3 id="transport-connectors">Transport Connector(s)</h3>

<p>It&#8217;s generally best to only enable the transport connectors you need. For example, if you&#8217;re using Stomp over TLS, don&#8217;t leave a bare Stomp transport open. If you&#8217;re not using a network of brokers, close the OpenWire transport.</p>

<p>The <code>name</code> attribute of a transport connector doesn&#8217;t seem to matter as long as it&#8217;s locally unique.</p>

<h4 id="stomp">Stomp</h4>

<p>ActiveMQ must listen over the network for Stomp connections; otherwise, MCollective can&#8217;t reach it. Enable this with a <code>&lt;transportConnector&gt;</code> element inside the <code>&lt;transportConnectors&gt;</code> element. We generally recommend using TLS.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;transportConnectors&gt;</span>
      <span class="nt">&lt;transportConnector</span> <span class="na">name=</span><span class="s">&quot;stomp+nio&quot;</span> <span class="na">uri=</span><span class="s">&quot;stomp+nio://0.0.0.0:61613&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/transportConnectors&gt;</span>
</code></pre>
</div>

<ul>
  <li>Note that the protocol/port/arguments for Stomp URIs can differ:
    <ul>
      <li>Unencrypted: <code>stomp+nio://0.0.0.0:61613</code></li>
      <li>CA-verified TLS: <code>stomp+ssl://0.0.0.0:61614?needClientAuth=true</code></li>
      <li>Anonymous TLS: <code>stomp+ssl://0.0.0.0:61614</code></li>
    </ul>
  </li>
  <li>You can choose to restrict the interface/hostname to use instead of listening on <code>0.0.0.0</code>.</li>
</ul>

<!-- uncomment and move into place when activemq 5.9 comes out and we can verify that the bug is fixed.
    * CA-verified TLS (ActiveMQ ≥ 5.9): `stomp+nio+ssl://0.0.0.0:61614?needClientAuth=true`
(The stomp+nio+ssl protocol didn't exist in ActiveMQ 5.5, had a major bug on 5.6, and would drop about half of replies from more than 300 nodes through 5.8, but provides better performance on 5.9+.)
 -->

<blockquote>
  <p><strong>If you are using TLS,</strong> note that you must also:</p>

  <ul>
    <li><a href="#tls-credentials">Configure ActiveMQ&#8217;s TLS credentials</a> (see below)</li>
    <li><a href="./../../../mcollective/reference/integration/activemq_ssl.html">Configure MCollective to use TLS credentials</a></li>
  </ul>
</blockquote>

<h4 id="openwire">OpenWire</h4>

<p>If you are using a network of brokers instead of just one ActiveMQ server, they talk to each other over OpenWire, and will all need a transport connector for that protocol too:</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;transportConnector</span> <span class="na">name=</span><span class="s">&quot;openwire+ssl&quot;</span> <span class="na">uri=</span><span class="s">&quot;ssl://0.0.0.0:61617?needClientAuth=true&quot;</span><span class="nt">/&gt;</span>
</code></pre>
</div>

<ul>
  <li>Note that the protocol/port/arguments for OpenWire URIs can differ:
    <ul>
      <li>Unencrypted: <code>tcp://0.0.0.0:61616</code></li>
      <li>CA-verified TLS: <code>ssl://0.0.0.0:61617?needClientAuth=true</code></li>
      <li>Anonymous TLS: <code>ssl://0.0.0.0:61617</code></li>
    </ul>
  </li>
  <li>You can choose to restrict the interface/hostname to use instead of listening on <code>0.0.0.0</code>.</li>
</ul>

<h4 id="standard-ports-for-stomp-and-openwire">Standard Ports for Stomp and OpenWire</h4>

<p>Alas, there aren&#8217;t any; just a rough consensus.</p>

<ul>
  <li>61613 for unencrypted Stomp</li>
  <li>61614 for Stomp with TLS</li>
  <li>61616 for unencrypted OpenWire</li>
  <li>61617 for OpenWire with TLS</li>
</ul>

<p>All of our documentation assumes these ports.</p>

<blockquote>
  <h4 id="shared-configuration-1">Shared Configuration</h4>

  <p>MCollective needs to know the following:</p>

  <ul>
    <li>The port to use for Stomp traffic</li>
    <li>The hostname or IP address to reach ActiveMQ at</li>
    <li>Whether to use TLS</li>
  </ul>

  <p>In a network of brokers, the other ActiveMQ servers need to know the following:</p>

  <ul>
    <li>The port to use for OpenWire traffic</li>
    <li>The hostname or IP address to reach peer ActiveMQ servers at</li>
    <li>Whether to use TLS</li>
  </ul>
</blockquote>

<h3 id="reply-queue-pruning">Reply Queue Pruning</h3>

<p>MCollective sends replies on uniquely-named, single-use queues with names like <code>mcollective.reply.&lt;UNIQUE ID&gt;</code>. These have to be deleted after about five minutes, lest they clog up ActiveMQ&#8217;s available memory. By default, queues live forever, so you have to configure this.</p>

<p>Use a <code>&lt;policyEntry&gt;</code> element for <code>*.reply.&gt;</code> queues, with <code>gcInactiveDestinations</code> set to true and <code>inactiveTimoutBeforeGC</code> set to 300000 ms (five minutes).</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;destinationPolicy&gt;</span>
      <span class="nt">&lt;policyMap&gt;</span>
        <span class="nt">&lt;policyEntries&gt;</span>
          <span class="nt">&lt;policyEntry</span> <span class="na">queue=</span><span class="s">&quot;*.reply.&gt;&quot;</span> <span class="na">gcInactiveDestinations=</span><span class="s">&quot;true&quot;</span> <span class="na">inactiveTimoutBeforeGC=</span><span class="s">&quot;300000&quot;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;policyEntry</span> <span class="na">topic=</span><span class="s">&quot;&gt;&quot;</span> <span class="na">producerFlowControl=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/policyEntries&gt;</span>
      <span class="nt">&lt;/policyMap&gt;</span>
    <span class="nt">&lt;/destinationPolicy&gt;</span>
</code></pre>
</div>

<h3 id="disable-producer-flow-control-on-topics">Disable Producer Flow Control on Topics</h3>

<p>In the example above, you can also see that <code>producerFlowControl</code> is set to false for all topics. This is highly recommended; setting it to true can cause MCollective servers to appear blocked when there&#8217;s heavy traffic.</p>

<p>(<a href="#content">↑ Back to top</a>)</p>

<h2 id="recommended-settings">Recommended Settings</h2>

<h3 id="tls-credentials">TLS Credentials</h3>

<p>If you are using TLS in either your Stomp or OpenWire <a href="#transport-connectors">transport connectors</a>, ActiveMQ needs a keystore file, a truststore file, and a password for each:</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;sslContext&gt;</span>
      <span class="nt">&lt;sslContext</span>
         <span class="na">keyStore=</span><span class="s">&quot;keystore.jks&quot;</span> <span class="na">keyStorePassword=</span><span class="s">&quot;secret&quot;</span>
         <span class="na">trustStore=</span><span class="s">&quot;truststore.jks&quot;</span> <span class="na">trustStorePassword=</span><span class="s">&quot;secret&quot;</span>
      <span class="nt">/&gt;</span>
    <span class="nt">&lt;/sslContext&gt;</span>
</code></pre>
</div>

<p><strong>Note:</strong> This example is for CA-verified TLS. If you are using anonymous TLS, you may optionally skip the truststore attributes.</p>

<p>The redundant nested <code>&lt;sslContext&gt;</code> elements are not a typo; for some reason ActiveMQ actually needs this.</p>

<p>ActiveMQ will expect to find these files in the same directory as activemq.xml.</p>

<blockquote>
  <h4 id="creating-a-keystore-and-truststore">Creating a Keystore and Truststore</h4>

  <p>There is a <a href="./activemq_keystores.html">separate guide that covers how to create keystores.</a></p>
</blockquote>

<h3 id="authentication-users-and-groups">Authentication (Users and Groups)</h3>

<p>When they connect, MCollective clients and servers provide a username, password, and optionally an SSL certificate. ActiveMQ can use any of these to authenticate them.</p>

<p>By default, ActiveMQ ignores all of these and has no particular concept of &#8220;users.&#8221; Enabling authentication means ActiveMQ will only allow users with proper credentials to connect. It also gives you the option of setting up per-destination authorization (see below).</p>

<p>You set up authentication by adding the appropriate element to the <code>&lt;plugins&gt;</code> element. <a href="http://fusesource.com/docs/broker/5.5/security/front.html">The Fuse documentation has a more complete description of ActiveMQ&#8217;s authentication capabilities;</a> the <a href="http://activemq.apache.org/security.html">ActiveMQ docs version</a> is less organized and less complete. In summary:</p>

<ul>
  <li><code>simpleAuthenticationPlugin</code> defines users directly in activemq.xml. It&#8217;s well-tested and easy. It also requires you to edit activemq.xml and restart the broker every time you add a new user. The activemq.xml file will contain sensitive passwords and must be protected.</li>
  <li><code>jaasAuthenticationPlugin</code> lets you use external text files (or even an LDAP database) to define users and groups. You need to make a <code>login.config</code> file in the ActiveMQ config directory, and possibly two more files. You can add users and groups without restarting the broker. The external users file will contain sensitive passwords and must be protected.</li>
  <li><code>jaasCertificateAuthenticationPlugin</code> ignores the username and password that MCollective presents; instead, it reads the distinguished name of the certificate and maps that to a username. It requires TLS, a <code>login.config</code> file, and two other external files. It is also impractical unless your servers are all using the same SSL certificate to connect to ActiveMQ; the currently recommended approach of re-using Puppet certificates makes this problematic, but you can probably ship credentials around and figure out a way to make it work. This is not currently well-tested with MCollective.</li>
</ul>

<p>The example below uses <code>simpleAuthenticationPlugin</code>.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;simpleAuthenticationPlugin&gt;</span>
        <span class="nt">&lt;users&gt;</span>
          <span class="nt">&lt;authenticationUser</span> <span class="na">username=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">password=</span><span class="s">&quot;marionette&quot;</span> <span class="na">groups=</span><span class="s">&quot;mcollective,everyone&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;authenticationUser</span> <span class="na">username=</span><span class="s">&quot;admin&quot;</span> <span class="na">password=</span><span class="s">&quot;secret&quot;</span> <span class="na">groups=</span><span class="s">&quot;mcollective,admins,everyone&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/users&gt;</span>
      <span class="nt">&lt;/simpleAuthenticationPlugin&gt;</span>
      <span class="c">&lt;!-- ... authorization goes below... --&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
</code></pre>
</div>

<p>This creates two users: <code>mcollective</code> and <code>admin</code>. Note that unless you set up authorization (see below), these users have the exact same capabilities.</p>

<blockquote>
  <h4 id="shared-configuration-2">Shared Configuration</h4>

  <p>MCollective servers and clients both need a username and password to use when connecting. That user <strong>must</strong> have appropriate permissions (see &#8220;Authorization,&#8221; directly below) for that server or client&#8217;s role.</p>
</blockquote>

<h3 id="authorization-group-permissions">Authorization (Group Permissions)</h3>

<p>By default, ActiveMQ allows everyone to <strong>read</strong> from any topic or queue, <strong>write</strong> to any topic or queue, and create (<strong>admin</strong>) any topic or queue.</p>

<p>By setting rules in an <code>&lt;authorizationPlugin&gt;</code> element, you can regulate things a bit. Some notes:</p>

<ul>
  <li>Authorization is done <strong>by group.</strong></li>
  <li>The exact behavior of authorization doesn&#8217;t seem to be documented anywhere. Going by observation, it appears that ActiveMQ first tries the most specific rule available, then retreats to less specific rules. This means if a given group isn&#8217;t allowed an action by a more specific rule but is allowed it by a more general rule, it still gets authorized to take that action. If you have any solid information about how this works, please email us at <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#102;&#097;&#113;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#102;&#097;&#113;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a>.</li>
  <li>MCollective creates subscriptions before it knows whether there will be any content coming. That means any role able to <strong>read</strong> from or <strong>write</strong> to a destination must also be able to <strong>admin</strong> that destination. Think of &#8220;admin&#8221; as a superset of both read and write.</li>
</ul>

<h4 id="simple-restrictions">Simple Restrictions</h4>

<p>The following example grants all permissions on destinations beginning with <code>mcollective</code> to everyone in group <code>mcollective</code>:</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;plugins&gt;</span>
      <span class="c">&lt;!-- ...authentication stuff... --&gt;</span>
      <span class="nt">&lt;authorizationPlugin&gt;</span>
        <span class="nt">&lt;map&gt;</span>
          <span class="nt">&lt;authorizationMap&gt;</span>
            <span class="nt">&lt;authorizationEntries&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;mcollective.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">read=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">admin=</span><span class="s">&quot;mcollective&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;mcollective.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">read=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">admin=</span><span class="s">&quot;mcollective&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;ActiveMQ.Advisory.&gt;&quot;</span> <span class="na">read=</span><span class="s">&quot;everyone&quot;</span> <span class="na">write=</span><span class="s">&quot;everyone&quot;</span> <span class="na">admin=</span><span class="s">&quot;everyone&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/authorizationEntries&gt;</span>
          <span class="nt">&lt;/authorizationMap&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
      <span class="nt">&lt;/authorizationPlugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
</code></pre>
</div>

<p>This means admins can issue commands and MCollective servers can read those commands and reply. However, it also means that servers can issue commands. If you&#8217;re using MCollective&#8217;s <a href="./../../../mcollective/reference/plugins/security_ssl.html">SSL security plugin</a> (or another security provider with strong client authentication), this is generally fine: servers could potentially <em>receive</em> bogus commands, but will reject any commands that don&#8217;t come from an authorized client user.</p>

<p>Note that the <code>everyone</code> group (as seen in the <code>ActiveMQ.Advisory.&gt;</code> topics) <strong>isn&#8217;t special.</strong> You need to manually make sure all users are members of it. ActiveMQ does not appear to have any kind of real wildcard &#8220;everyone&#8221; group, unfortunately.</p>

<h4 id="detailed-restrictions">Detailed Restrictions</h4>

<p>The following example splits permissions along a simple user/server model:</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;plugins&gt;</span>
      <span class="c">&lt;!-- ...authentication stuff... --&gt;</span>
      <span class="nt">&lt;authorizationPlugin&gt;</span>
        <span class="nt">&lt;map&gt;</span>
          <span class="nt">&lt;authorizationMap&gt;</span>
            <span class="nt">&lt;authorizationEntries&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;mcollective.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;mcollective.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;mcollective.nodes&quot;</span> <span class="na">read=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">admin=</span><span class="s">&quot;mcollective&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;mcollective.reply.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">admin=</span><span class="s">&quot;mcollective&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;mcollective.*.agent&quot;</span> <span class="na">read=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">admin=</span><span class="s">&quot;mcollective&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;mcollective.registration.agent&quot;</span> <span class="na">write=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">read=</span><span class="s">&quot;mcollective&quot;</span> <span class="na">admin=</span><span class="s">&quot;mcollective&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;ActiveMQ.Advisory.&gt;&quot;</span> <span class="na">read=</span><span class="s">&quot;everyone&quot;</span> <span class="na">write=</span><span class="s">&quot;everyone&quot;</span> <span class="na">admin=</span><span class="s">&quot;everyone&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/authorizationEntries&gt;</span>
          <span class="nt">&lt;/authorizationMap&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
      <span class="nt">&lt;/authorizationPlugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
</code></pre>
</div>

<p>This means admins can issue commands and MCollective servers can read those commands and reply. This time, though, servers can&#8217;t issue commands. The exception is the <code>mcollective.registration.agent</code> destination, which servers DO need the ability to write to if you&#8217;ve turned on registration.</p>

<p>Admins, of course, can also read commands and reply as though they were servers, since they have power over the entire <code>mcollective.&gt;</code> destination set. This isn&#8217;t considered much of an additional security risk, considering that admins can already control your entire infrastructure.</p>

<h4 id="detailed-restrictions-with-multiple-subcollectives">Detailed Restrictions with Multiple Subcollectives</h4>

<p>Both of the above examples assume only a single <code>mcollective</code> collective. If you are using additional <a href="./../../../mcollective/reference/basic/subcollectives.html">subcollectives</a> (e.g. <code>uk_collective</code>, <code>us_collective</code>, etc.), their destinations will start with their name instead of <code>mcollective</code>. If you need to separately control authorization for each collective, it&#8217;s best to use a template to do so, so you can avoid repeating yourself.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;plugins&gt;</span>
      <span class="c">&lt;!-- ...authentication stuff... --&gt;</span>
      <span class="nt">&lt;authorizationPlugin&gt;</span>
        <span class="nt">&lt;map&gt;</span>
          <span class="nt">&lt;authorizationMap&gt;</span>
            <span class="nt">&lt;authorizationEntries&gt;</span>
              <span class="c">&lt;!-- &quot;admins&quot; group can do anything. --&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins&quot;</span> <span class="nt">/&gt;</span>

              <span class="err">&lt;</span>%- @collectives.each do |collective| -%&gt;
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;&lt;%= collective %&gt;.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins,&lt;%= collective %&gt;-admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins,&lt;%= collective %&gt;-admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins,&lt;%= collective %&gt;-admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;&lt;%= collective %&gt;.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;admins,&lt;%= collective %&gt;-admins&quot;</span> <span class="na">read=</span><span class="s">&quot;admins,&lt;%= collective %&gt;-admins&quot;</span> <span class="na">admin=</span><span class="s">&quot;admins,&lt;%= collective %&gt;-admins&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;&lt;%= collective %&gt;.nodes&quot;</span> <span class="na">read=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="na">admin=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">queue=</span><span class="s">&quot;&lt;%= collective %&gt;.reply.&gt;&quot;</span> <span class="na">write=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="na">admin=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;&lt;%= collective %&gt;.*.agent&quot;</span> <span class="na">read=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="na">admin=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;&lt;%= collective %&gt;.registration.agent&quot;</span> <span class="na">write=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="na">read=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="na">admin=</span><span class="s">&quot;servers,&lt;%= collective %&gt;-servers&quot;</span> <span class="nt">/&gt;</span>
              <span class="err">&lt;</span>%- end -%&gt;

              <span class="nt">&lt;authorizationEntry</span> <span class="na">topic=</span><span class="s">&quot;ActiveMQ.Advisory.&gt;&quot;</span> <span class="na">read=</span><span class="s">&quot;everyone&quot;</span> <span class="na">write=</span><span class="s">&quot;everyone&quot;</span> <span class="na">admin=</span><span class="s">&quot;everyone&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/authorizationEntries&gt;</span>
          <span class="nt">&lt;/authorizationMap&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
      <span class="nt">&lt;/authorizationPlugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
</code></pre>
</div>

<p>This example divides your users into several groups:</p>

<ul>
  <li><code>admins</code> is the &#8220;super-admins&#8221; group, who can command all servers.</li>
  <li><code>servers</code> is the &#8220;super-servers&#8221; group, who can receive and respond to commands on any collective they believe themselves to be members of.</li>
  <li><code>COLLECTIVE-admins</code> can only command servers on their specific collective. (Since all servers are probably members of the default <code>mcollective</code> collective, the <code>mcollective-admins</code> group are sort of the &#8220;almost-super-admins.&#8221;)</li>
  <li><code>COLLECTIVE-servers</code> can only receive and respond to commands on their specific collective.</li>
</ul>

<p>Thus, when you define your users in the <a href="#authentication-users-and-groups">authentication setup</a>, you could allow a certain user to command both the EU and UK collectives (but not the US collective) with <code>groups="eu_collective-admins,uk_collective-admins"</code>. You would probably want most servers to be &#8220;super-servers,&#8221; since each server already gets to choose which collectives to ignore.</p>

<h4 id="mcollectives-exact-authorization-requirements">MCollective&#8217;s Exact Authorization Requirements</h4>

<p>As described above, any user able to read OR write on a destination must also be able to admin that destination.</p>

<p>Topics:</p>

<ul>
  <li><code>ActiveMQ.Advisory.&gt;</code> &#8212; Everyone must be able to read and write.</li>
  <li><code>COLLECTIVE.*.agent</code> &#8212; Admin users must be able to write. Servers must be able to read.</li>
  <li><code>COLLECTIVE.registration.agent</code> &#8212; If you&#8217;re using registration, servers must be able to read and write. Otherwise, it can be ignored.</li>
</ul>

<p>Queues:</p>

<ul>
  <li><code>COLLECTIVE.nodes</code> &#8212; Admin users must be able to write. Servers must be able to read.</li>
  <li><code>COLLECTIVE.reply.&gt;</code> &#8212; Servers must be able to write. Admin users must be able to read.</li>
</ul>

<blockquote>
  <h4 id="shared-configuration-3">Shared Configuration</h4>

  <p>Subcollectives must also be configured in the MCollective client and server config files. If you&#8217;re setting up authorization per-subcollective, ActiveMQ must allow traffic on any subcollective that MCollective servers and clients expect to use.</p>
</blockquote>

<p>(<a href="#content">↑ Back to top</a>)</p>

<h2 id="settings-for-networks-of-brokers">Settings for Networks of Brokers</h2>

<p>You can group multiple ActiveMQ servers into networks of brokers, and they can route local MCollective traffic amongst themselves. There are a lot of reasons to do this:</p>

<ul>
  <li>Scale &#8212; we recommend a maximum of about 800 MCollective servers per ActiveMQ broker, and multiple brokers let you expand past this.</li>
  <li>High availability &#8212; MCollective servers and clients can attempt to connect to mupltiple brokers in a failover pool.</li>
  <li>Partition resilience &#8212; if an inter-datacenter link goes down, each half&#8217;s local MCollective system will still work fine.</li>
  <li>Network isolation and traffic limiting &#8212; if your clients default to only sending messages to local machines, you can get better performance in the most common case while still being able to command a global collective when you need to.</li>
  <li>Security &#8212; destination filtering can prevent certain users from sending requests to certain datacenters.</li>
</ul>

<p>This is naturally more complicated than configuring a single broker.</p>

<p>Designing your broker network&#8217;s topology is beyond the scope of this reference. The <a href="./../../../mcollective/reference/integration/activemq_clusters.html">ActiveMQ Clusters guide</a> has a brief description of an example network; see <a href="http://activemq.apache.org/networks-of-brokers.html">the ActiveMQ docs</a> or <a href="http://fusesource.com/docs/broker/5.5/clustering/index.html">the Fuse docs</a> for more detailed info. For our purposes, we assume you have already decided:</p>

<ul>
  <li>Which ActiveMQ brokers can communicate with each other.</li>
  <li>What kinds of traffic should be excluded from other brokers.</li>
</ul>

<h3 id="broker-name">Broker Name</h3>

<p><em>Required.</em></p>

<p>The main <code>&lt;broker&gt;</code> element has a <code>brokerName</code> attribute. In single-broker deployments, this can be anything and defaults to <code>localhost</code>. In a network of brokers, each broker&#8217;s name must be globally unique across the deployment; duplicates can cause message loops.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;broker</span> <span class="na">xmlns=</span><span class="s">&quot;http://activemq.apache.org/schema/core&quot;</span> <span class="na">brokerName=</span><span class="s">&quot;uk-datacenter-broker&quot;</span> <span class="na">dataDirectory=</span><span class="s">&quot;${activemq.base}/data&quot;</span> <span class="na">destroyApplicationContextOnStop=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</code></pre>
</div>

<h3 id="openwire-transports">OpenWire Transports</h3>

<p><em>Required.</em></p>

<p>All participants in a network of brokers need OpenWire network transports enabled. <a href="#transport-connectors">See &#8220;Transport Connectors&#8221; above</a> for details.</p>

<h3 id="network-connectors">Network Connectors</h3>

<p><em>Required.</em></p>

<p>If you are using a network of brokers, you need to configure which brokers can talk to each other.</p>

<p>On <strong>one</strong> broker in each linked pair, set up <strong>two</strong> bi-directional network connectors: one for topics, and one for queues. (The only difference between them is the <code>conduitSubscriptions</code> attribute, which must be false for the queue connector.)</p>

<p>This is done with a pair of <code>&lt;networkConnector&gt;</code> elements inside the <code>&lt;networkConnectors&gt;</code> element. Note that the queues connector excludes topics and vice-versa.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;networkConnectors&gt;</span>
      <span class="nt">&lt;networkConnector</span>
        <span class="na">name=</span><span class="s">&quot;stomp1-stomp2-topics&quot;</span>
        <span class="na">uri=</span><span class="s">&quot;static:(tcp://stomp2.example.com:61616)&quot;</span>
        <span class="na">userName=</span><span class="s">&quot;amq&quot;</span>
        <span class="na">password=</span><span class="s">&quot;secret&quot;</span>
        <span class="na">duplex=</span><span class="s">&quot;true&quot;</span>
        <span class="na">decreaseNetworkConsumerPriority=</span><span class="s">&quot;true&quot;</span>
        <span class="na">networkTTL=</span><span class="s">&quot;2&quot;</span>
        <span class="na">dynamicOnly=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;excludedDestinations&gt;</span>
          <span class="nt">&lt;queue</span> <span class="na">physicalName=</span><span class="s">&quot;&gt;&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/excludedDestinations&gt;</span>
      <span class="nt">&lt;/networkConnector&gt;</span>
      <span class="nt">&lt;networkConnector</span>
        <span class="na">name=</span><span class="s">&quot;stomp1-stomp2-queues&quot;</span>
        <span class="na">uri=</span><span class="s">&quot;static:(tcp://stomp2.example.com:61616)&quot;</span>
        <span class="na">userName=</span><span class="s">&quot;amq&quot;</span>
        <span class="na">password=</span><span class="s">&quot;secret&quot;</span>
        <span class="na">duplex=</span><span class="s">&quot;true&quot;</span>
        <span class="na">decreaseNetworkConsumerPriority=</span><span class="s">&quot;true&quot;</span>
        <span class="na">networkTTL=</span><span class="s">&quot;2&quot;</span>
        <span class="na">dynamicOnly=</span><span class="s">&quot;true&quot;</span>
        <span class="na">conduitSubscriptions=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;excludedDestinations&gt;</span>
          <span class="nt">&lt;topic</span> <span class="na">physicalName=</span><span class="s">&quot;&gt;&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/excludedDestinations&gt;</span>
      <span class="nt">&lt;/networkConnector&gt;</span>
    <span class="nt">&lt;/networkConnectors&gt;</span>
</code></pre>
</div>

<p>Notes:</p>

<ul>
  <li>If you&#8217;re using TLS for OpenWire, you&#8217;ll need to change the URIs to something like <code>static:(ssl://stomp2.example.com:61617)</code> &#8212; note the change of both protocol and port.</li>
  <li>You will need to adjust the TTL for your network&#8217;s conditions.</li>
  <li>A username and password are required. The broker with the <code>&lt;networkConnector&gt;</code> connects to the other broker as this user. This user should have <strong>full rights</strong> on <strong>all</strong> queues and topics, unless you really know what you&#8217;re doing. (See <a href="#authentication-users-and-groups">authentication</a> and <a href="#authorization-group-permissions">authorization</a> above.)</li>
  <li>The <code>name</code> attribute on each connector must be globally unique. Easiest way to do that is to combine the pair of hostnames involved with the word &#8220;queues&#8221; or &#8220;topics.&#8221;</li>
  <li>Alternately, you can set up two uni-directional connectors on both brokers; see the Fuse or ActiveMQ documentation linked above for more details.</li>
</ul>

<h3 id="destination-filtering">Destination Filtering</h3>

<p><em>Optional.</em></p>

<p>Relevant external docs:</p>

<ul>
  <li><a href="http://fusesource.com/docs/broker/5.5/clustering/Networks-Filtering.html">Fuse filtering guide</a></li>
</ul>

<p>If you want to prevent certain traffic from leaving a given datacenter, you can do so with <code>&lt;excludedDestinations&gt;</code> or <code>&lt;dynamicallyIncludedDestinations&gt;</code> elements <strong>inside each <code>&lt;networkConnector&gt;</code> element.</strong> This is mostly useful for reducing noise (which can potentially save you money, depending on network topology and datacenter locations), but it can also serve security purposes. Generally, you&#8217;ll be filtering on <a href="./../../../mcollective/reference/basic/subcollectives.html">subcollectives</a>, which, as described above, begin their destination names with the name of the collective.</p>

<p>Both types of filter element can contain <code>&lt;queue&gt;</code> and <code>&lt;topic&gt;</code> elements, with their <code>physicalName</code> attributes defining a destination name with the normal wildcards. Since MCollective uses both queues and topics, you&#8217;ll usually write a pair of rules for any exclusion or inclusion.</p>

<p><strong>Remember to retain the all-queues/all-topics exclusions as <a href="#network-connectors">shown above</a>.</strong></p>

<h4 id="examples">Examples</h4>

<p>Assume a star network topology.</p>

<p>This topology can be achieved by either having each edge broker connect to the central broker, or having the central broker connect to each edge broker. You can achieve the same filtering in both situations, but with slightly different configuration. The two examples below have similar but not identical effects; the ramifications are subtle, and we <em>really</em> recommend reading the external ActiveMQ and Fuse documentation if you&#8217;ve come this far in your deployment scale.</p>

<p>If your central broker is connecting to the UK broker, and you want it to only pass on traffic for the global <code>mcollective</code> collective and the UK-specific <code>uk_collective</code> collective:</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;dynamicallyIncludedDestinations&gt;</span>
      <span class="nt">&lt;topic</span> <span class="na">physicalName=</span><span class="s">&quot;mcollective.&gt;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;queue</span> <span class="na">physicalName=</span><span class="s">&quot;mcollective.&gt;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;topic</span> <span class="na">physicalName=</span><span class="s">&quot;uk_collective.&gt;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;queue</span> <span class="na">physicalName=</span><span class="s">&quot;uk_collective.&gt;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dynamicallyIncludedDestinations&gt;</span>
</code></pre>
</div>

<p>In this case, admin users connected to the central broker can command nodes on the <code>uk_collective</code>, but admin users connected to the UK broker can&#8217;t command nodes on the <code>us_collective</code>, etc.</p>

<p>Alternately, if your UK broker is connecting to your central broker and you want it to refrain from passing on UK-specific traffic that no one outside that datacenter cares about:</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;excludedDestinations&gt;</span>
       <span class="nt">&lt;topic</span> <span class="na">physicalName=</span><span class="s">&quot;uk_collective.&gt;&quot;</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;queue</span> <span class="na">physicalName=</span><span class="s">&quot;uk_collective.&gt;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/excludedDestinations&gt;</span>
</code></pre>
</div>

<p>In this case, admin users connected to the central broker <strong>cannot</strong> command nodes on the <code>uk_collective</code>; it&#8217;s expected that they&#8217;ll be issuing commands to the main <code>mcollective</code> collective if they need to (and are authorized to) cross outside their borders.</p>

<p>(<a href="#content">↑ Back to top</a>)</p>

<h2 id="tuning">Tuning</h2>

<p>The minor adjustments listed below (turn off dedicated task runner, increase heap, and increase memory and temp usage in activemq.xml) will generally let you reach about 800 MCollective nodes connected to a single ActiveMQ server, depending on traffic and usage patterns, number of topics and queues, etc. Any more detailed tuning is beyond the scope of this reference, and is likely to be unnecessary for your deployment.</p>

<h3 id="dont-use-dedicated-task-runner">Don&#8217;t Use Dedicated Task Runner</h3>

<p>Set <code>-Dorg.apache.activemq.UseDedicatedTaskRunner=false</code> when starting ActiveMQ. MCollective creates a lot of queues and topics, so <em>not</em> using a thread per destination will save you a lot of memory usage.</p>

<p>This setting is <strong>not</strong> configured in activemq.xml; it&#8217;s an extra argument to the JVM, which should be provided when ActiveMQ starts up. The place to put this varies, depending on the package you installed ActiveMQ with; it usually goes in the wrapper config file. Check your init script for clues about this file&#8217;s location. With the common TanukiWrapper scripts, it would look something like this:</p>

<pre><code>wrapper.java.additional.4=-Dorg.apache.activemq.UseDedicatedTaskRunner=false
</code></pre>

<h3 id="increase-jvm-heap-if-necessary">Increase JVM Heap if Necessary</h3>

<p>Likewise, the max heap is usually configured in the wrapper config file (<code>wrapper.java.maxmemory=512</code>) or on the command line (<code>-Xmx512m</code>).</p>

<h3 id="memory-and-temp-usage-for-messages-systemusage">Memory and Temp Usage for Messages (<code>systemUsage</code>)</h3>

<p>Since ActiveMQ expects to be embedded in another JVM application, it won&#8217;t automatically fill up the heap with messages; it has extra limitations on how much space to take up with message contents.</p>

<p>As your deployment gets bigger, you may need to increase the <code>&lt;memaryUsage&gt;</code> and <code>&lt;tempUsage&gt;</code> elements in the <code>&lt;systemUsage&gt;</code> element. Unfortunately, we lack a lot of solid data for what to actually set these to. Most users leave the defaults for memory and temp until they have problems, then double the defaults and see whether their problems go away. This isn&#8217;t perfectly effecient, but anecdotally it appears to work.</p>

<p>The many redundant nested elements are not a typo; for some reason, ActiveMQ seems to require this.</p>

<div class="highlight"><pre><code class="xml">    <span class="c">&lt;!--</span>
<span class="c">      The systemUsage controls the maximum amount of space the broker will</span>
<span class="c">      use for messages.</span>

<span class="c">      - memoryUsage is the amount of memory ActiveMQ will take up with</span>
<span class="c">        *actual messages;* it doesn&#39;t include things like thread management.</span>
<span class="c">      - tempUsage is the amount of disk space it will use for stashing</span>
<span class="c">        non-persisted messages if the memoryUsage is exceeded (e.g. in the</span>
<span class="c">        event of a sudden flood of messages).</span>
<span class="c">      - storeUsage is the amount of disk space dedicated to persistent</span>
<span class="c">        messages (which MCollective doesn&#39;t use directly, but which may be</span>
<span class="c">        used in networks of brokers to avoid duplicates).</span>

<span class="c">      If producer flow control is on, ActiveMQ will slow down producers</span>
<span class="c">      when any limits are reached; otherwise, it will use up the</span>
<span class="c">      memoryUsage, overflow into tempUsage (assuming the default cursor</span>
<span class="c">      settings aren&#39;t changed), and start failing message deliveries after</span>
<span class="c">      tempUsage is spent. In MCollective, the latter behavior is generally</span>
<span class="c">      preferable. For more information, see:</span>

<span class="c">      http://activemq.apache.org/producer-flow-control.html</span>
<span class="c">      http://activemq.apache.org/javalangoutofmemory.html</span>
<span class="c">    --&gt;</span>
    <span class="nt">&lt;systemUsage&gt;</span>
        <span class="nt">&lt;systemUsage&gt;</span>
            <span class="nt">&lt;memoryUsage&gt;</span>
                <span class="nt">&lt;memoryUsage</span> <span class="na">limit=</span><span class="s">&quot;20 mb&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/memoryUsage&gt;</span>
            <span class="nt">&lt;storeUsage&gt;</span>
                <span class="nt">&lt;storeUsage</span> <span class="na">limit=</span><span class="s">&quot;1 gb&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/storeUsage&gt;</span>
            <span class="nt">&lt;tempUsage&gt;</span>
                <span class="nt">&lt;tempUsage</span> <span class="na">limit=</span><span class="s">&quot;100 mb&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/tempUsage&gt;</span>
        <span class="nt">&lt;/systemUsage&gt;</span>
    <span class="nt">&lt;/systemUsage&gt;</span>
</code></pre>
</div>

<p>(<a href="#content">↑ Back to top</a>)</p>

<h2 id="boilerplate">Boilerplate</h2>

<p>There&#8217;s little reason to care about these settings in most conditions, but they&#8217;re in the example config files anyway.</p>

<h3 id="persistence">Persistence</h3>

<p>MCollective rarely uses this. It&#8217;s only necessary in networks of brokers, where it is used to prevent routing loops. Leave it enabled; it has no notable performance penalty and its disk usage is limited by the <code>&lt;storeUsage&gt;</code> element described above.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;persistenceAdapter&gt;</span>
      <span class="nt">&lt;kahaDB</span> <span class="na">directory=</span><span class="s">&quot;${activemq.base}/data/kahadb&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/persistenceAdapter&gt;</span>
</code></pre>
</div>

<h3 id="management-context">Management Context</h3>

<p>This is for monitoring. MCollective doesn&#8217;t use this and the examples have it turned off, but you may want it for your own purposes.</p>

<div class="highlight"><pre><code class="xml">    <span class="c">&lt;!--</span>
<span class="c">      The managementContext is used to configure how ActiveMQ is exposed in</span>
<span class="c">      JMX. By default, ActiveMQ uses the MBean server that is started by</span>
<span class="c">      the JVM. For more information, see:</span>

<span class="c">      http://activemq.apache.org/jmx.html</span>
<span class="c">    --&gt;</span>

    <span class="nt">&lt;managementContext&gt;</span>
      <span class="nt">&lt;managementContext</span> <span class="na">createConnector=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/managementContext&gt;</span>
</code></pre>
</div>

<h3 id="statistics-broker">Statistics Broker</h3>

<p>MCollective doesn&#8217;t use this.</p>

<div class="highlight"><pre><code class="xml">    <span class="nt">&lt;plugins&gt;</span>
      <span class="c">&lt;!--</span>
<span class="c">        Enable the statisticsBrokerPlugin to allow ActiveMQ to collect</span>
<span class="c">        statistics.</span>
<span class="c">      --&gt;</span>
      <span class="nt">&lt;statisticsBrokerPlugin/&gt;</span>
      <span class="c">&lt;!-- ...auth, etc... --&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
</code></pre>
</div>

<h3 id="jetty-web-consoles-apis-etc">Jetty (Web Consoles, APIs, etc.)</h3>

<p>The activemq.xml file will often either contain Jetty settings or import them from another file. MCollective doesn&#8217;t use this. If you&#8217;re not using it to manage ActiveMQ, leaving it enabled may be a security risk. Note that this configuration is <strong>outside</strong> the <code>&lt;broker&gt;</code> element.</p>

<div class="highlight"><pre><code class="xml">    <span class="c">&lt;!--</span>
<span class="c">      Enable web consoles, REST and Ajax APIs and demos</span>
<span class="c">      It also includes Camel (with its web console), see ${ACTIVEMQ_HOME}/conf/camel.xml for more info</span>

<span class="c">      Take a look at ${ACTIVEMQ_HOME}/conf/jetty.xml for more details</span>
<span class="c">    --&gt;</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&quot;jetty.xml&quot;</span><span class="nt">/&gt;</span>
</code></pre>
</div>

<p>(<a href="#content">↑ Back to top</a>)</p>

              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">


<ul>
  <li><strong>Overview</strong>
    <ul>
      <li><a href="./../../../mcollective/index.html">Introduction</a></li>
      <li><a href="./../../../mcollective/overview_components.html">Overview of Components</a></li>
      <li><a href="./../../../mcollective/terminology.html">Terminology</a></li>
      <li><a href="./../../../mcollective/screencasts.html">Screencasts</a></li>
      <li><a href="./../../../mcollective/releasenotes.html">Release Notes</a></li>
      <li><a href="./../../../mcollective/changelog.html">Changelog</a></li>
    </ul>
  </li>
  <li><strong>Deploying MCollective</strong>
    <ul>
      <li><a href="./../../../mcollective/deploy/index.html">Index</a></li>
      <li><a href="./../../../mcollective/deploy/demo.html">Demo</a></li>
      <li><a href="./../../../mcollective/deploy/standard.html">Getting Started (Standard Deployment)</a></li>
    </ul>
  </li>
  <li><strong>Configuration / Deployment Topics</strong>
    <ul>
      <li><strong>Installation:</strong></li>
      <li><a href="./../../../mcollective/deploy/install.html">Installing MCollective</a></li>
      <li><a href="./../../../mcollective/deploy/plugins.html">Installing Plugins</a></li>
      <li><strong>Configuration:</strong></li>
      <li><a href="./../../../mcollective/configure/server.html">Server Config Reference</a></li>
      <li><a href="./../../../mcollective/configure/client.html">Client Config Reference</a></li>
      <li><a href="./../../../mcollective/reference/integration/puppet.html">Puppet Integration</a></li>
      <li><a href="./../../../mcollective/reference/integration/chef.html">Chef Integration</a></li>
      <li><strong>Middleware:</strong></li>
      <li><a href="./../../../mcollective/deploy/middleware/index.html">Middleware Types</a></li>
      <li><span class="currentpage">ActiveMQ Configs for MCollective</span></li>
      <li><a href="./../../../mcollective/deploy/middleware/activemq_keystores.html">ActiveMQ TLS Keystore Setup</a></li>
      <li><a href="./../../../mcollective/reference/integration/activemq_clusters.html">ActiveMQ Clustering</a></li>
      <li><a href="./../../../mcollective/reference/integration/activemq_ssl.html">ActiveMQ TLS</a></li>
      <li><a href="./../../../mcollective/reference/integration/activemq_security.html">ActiveMQ Security</a></li>
      <li><strong>Connector Plugins:</strong></li>
      <li><a href="./../../../mcollective/reference/plugins/connector_activemq.html">The ActiveMQ Connector</a></li>
      <li><a href="./../../../mcollective/reference/plugins/connector_rabbitmq.html">The RabbitMQ Connector</a></li>
      <li><strong>Security Plugins:</strong></li>
      <li><a href="./../../../mcollective/reference/plugins/security_ssl.html">Configuring SSL Validation Security</a></li>
      <li><strong>Advanced Features:</strong></li>
      <li><a href="./../../../mcollective/reference/basic/subcollectives.html">Subcollectives and Partitioning</a></li>
      <li><a href="./../../../mcollective/simplerpc/auditing.html">Auditing</a> <!-- contains plugin-writing info --></li>
    </ul>
  </li>
  <li><strong>Use and Administer MCollective</strong>
    <ul>
      <li><a href="./../../../mcollective/reference/basic/basic_cli_usage.html">Command Line Usage Instructions</a></li>
      <li><a href="./../../../mcollective/reference/ui/filters.html">Command Filtering and Discovery</a></li>
      <li><a href="./../../../mcollective/reference/basic/daemon.html">Controlling the MCollective Daemon</a></li>
      <li><a href="./../../../mcollective/reference/plugins/rpcutil.html">Controlling the MCollective Daemon with the rpcutil Agent</a></li>
      <li><a href="./../../../mcollective/reference/ui/nodereports.html">On-Demand Node Reports</a></li>
    </ul>
  </li>
  <li><strong>Write Agent Plugins</strong>
    <ul>
      <li><a href="./../../../mcollective/simplerpc/agents.html">Writing Agent Plugins</a></li>
      <li><a href="./../../../mcollective/reference/plugins/ddl.html">Writing DDL Files</a></li>
      <li><a href="./../../../mcollective/reference/plugins/aggregate.html">Aggregating Results</a> <!-- mixes DDL info with info about writing aggregate plugins --></li>
    </ul>
  </li>
  <li><strong>Write Clients and Applications</strong>
    <ul>
      <li><a href="./../../../mcollective/simplerpc/clients.html">Writing Clients</a></li>
      <li><a href="./../../../mcollective/reference/plugins/application.html">Writing New mco Subcommands</a></li>
    </ul>
  </li>
  <li><strong>Write Other Plugins</strong>
    <ul>
      <li><a href="./../../../mcollective/simplerpc/authorization.html">Writing Authorization Plugins and Enabling Authorization</a> <!-- contains deploy/config info --></li>
      <li><a href="./../../../mcollective/reference/plugins/data.html">Writing Data Plugins</a></li>
      <li><a href="./../../../mcollective/reference/plugins/discovery.html">Writing and Using Discovery Plugins</a> <!-- contains usage info --></li>
      <li><a href="./../../../mcollective/reference/plugins/facts.html">Writing Facts Plugins</a></li>
      <li><a href="./../../../mcollective/reference/plugins/registration.html">Writing Registration Plugins</a></li>
      <li><a href="./../../../mcollective/reference/plugins/validator.html">Writing Validator Plugins</a></li>
    </ul>
  </li>
  <li><a href="http://projects.puppetlabs.com/projects/mcollective-plugins/wiki">Plugin Directory</a></li>
  <li><strong>Internals</strong>
    <ul>
      <li><a href="./../../../mcollective/reference/basic/messageflow.html">Message Flow</a> <!-- needs more/needs update --></li>
      <li><a href="./../../../mcollective/simplerpc/index.html">SimpleRPC Overview</a></li>
      <li><a href="./../../../mcollective/simplerpc/messageformat.html">SimpleRPC Message Format</a></li>
      <li><a href="./../../../mcollective/reference/basic/messageformat.html">Core Message Format</a></li>
      <li><a href="./../../../mcollective/security.html">Security Overview</a></li>
    </ul>
  </li>
  <li><strong>Older and Non-Recommended Information</strong>
    <ul>
      <li><a href="./../../../mcollective/reference/plugins/security_aes.html">Configuring AES Security</a></li>
      <li><a href="./../../../mcollective/reference/plugins/connector_stomp.html">Configuring the Generic Stomp Connector</a></li>
      <li><a href="./../../../mcollective/reference/basic/basic_agent_and_client.html">Writing Old-Style Agent Plugins</a></li>
      <li><a href="./../../../mcollective/reference/index.html">Alternate Index</a></li>
    </ul>
  </li>
</ul>

                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>


	</body>
</html>
