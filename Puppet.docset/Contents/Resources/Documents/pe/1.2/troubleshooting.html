<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>PE 1.2 Manual: Troubleshooting — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../../favicon.ico' />

  <meta name="description" content="A newer version of Puppet Enterprise has been released!  Download PE 3.0.  PE 3.0 user's guide  Jump to newest version of this pageNavigation  Intr...">




    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../../files/javascripts/ampersands.js'></script>
    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/pe/latest/trouble_install.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/style_legacy.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>

            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">PE 1.2 Manual: Troubleshooting</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">

<p class="versionnote">A newer version of Puppet Enterprise has been released!</p>
<ul class="versionnote">
  <li><a href="http://info.puppetlabs.com/download-pe.html">Download PE 3.0</a>.</li>
  <li><a href="./../../pe/3.0/index.html">PE 3.0 user's guide</a></li>
  <li><a href="./../../pe/latest/trouble_install.html">Jump to newest version of this page</a></li>
</ul>

<h4 id="navigation">Navigation</h4>

<ul>
  <li><a href="./intro.html">Introduction</a></li>
  <li><a href="./overview.html">Overview</a></li>
  <li><a href="./installing.html">Installing</a></li>
  <li><a href="./upgrading.html">Upgrading</a></li>
  <li><a href="./using.html">Using Puppet Enterprise</a></li>
  <li>The Accounts Module
    <ul>
      <li><a href="./accounts_user_type.html">The <code>accounts::user</code> Type</a></li>
      <li><a href="./accounts_class.html">The <code>accounts</code> Class</a></li>
    </ul>
  </li>
  <li>Puppet Compliance
    <ul>
      <li><a href="./compliance_basics.html">Puppet Compliance Basics and UI</a></li>
      <li><a href="./using_compliance.html">Using the Puppet Compliance Workflow</a></li>
      <li><a href="./compliance_tutorial.html">Compliance Workflow Tutorial</a></li>
    </ul>
  </li>
  <li><a href="./known_issues.html">Known Issues</a></li>
  <li><strong>Troubleshooting</strong></li>
  <li><a href="./answer_file_reference.html">Answer File Reference</a></li>
</ul>

<h1 id="troubleshooting">Troubleshooting</h1>

<p>This document explains several common problems that can prevent a Puppet Enterprise site from working as expected. Additional troubleshooting information can be found at the <a href="http://docs.puppetlabs.com">main Puppet documentation site</a>, on the <a href="https://groups.google.com/group/puppet-users">Puppet Users mailing list</a>, and in <code>#puppet</code> on freenode.net. </p>

<p>Furthermore, please feel free to contact Puppet Labs&#8217; enterprise technical support:</p>

<ul>
  <li>To file a support ticket, go to <a href="http://support.puppetlabs.com">support.puppetlabs.com</a>. </li>
  <li>To reach our support staff via email, contact <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#064;&#112;&#117;&#112;&#112;&#101;&#116;&#108;&#097;&#098;&#115;&#046;&#099;&#111;&#109;</a>.</li>
  <li>To speak directly to our support staff, call 1-877-575-9775.</li>
</ul>

<p>When reporting issues with the installer itself, please run the installer using the <code>-D</code> debugging flag and provide a transcript of the installer&#8217;s output along with your description of the problem. </p>

<h2 id="firewall-issues">Firewall Issues</h2>

<p>If not configured properly, your system&#8217;s firewall can interfere with access to Puppet Dashboard and with communications between the puppet master server and puppet agent nodes. In particular, CentOS and Red Hat Enterprise Linux ship with extremely restrictive <code>iptables</code> rules, which may need to be modified. </p>

<p>When attempting to debug connectivity issues (especially if puppet agent nodes are generating log messages like <code>err: Could not request certificate: No route to host - connect(2)</code>), first examine your firewall rules and ensure that your master server is allowing tcp connections on port 8140 and your Dashboard server is allowing tcp connections on port 3000.</p>

<p>If you use the REST API and have configured puppet agent to listen for incoming connections, your agent nodes will need to allow tcp connections on port 8139. </p>

<h2 id="certificate-issues">Certificate Issues</h2>

<p>The learning curve of SSL certificate management can lead to a variety of problems. Watch out for the following common scenarios: </p>

<h3 id="agent-node-was-installed-before-the-puppet-master">Agent Node Was Installed Before the Puppet Master</h3>

<p>If you install the puppet agent role on a node before getting the puppet master up and running, the installer won&#8217;t be able to request a certificate during installation, and you won&#8217;t immediately see a pending certificate request when you run <code>puppet cert list</code>. To request a certificate manually, you can log into the agent node and run:</p>

<pre><code>$ sudo puppet agent --test
</code></pre>

<p>&#8230;after which you should be able to sign the certificate on the puppet master. <strong>Alternately,</strong> you can simply wait 30 minutes, as the puppet agent service will request a certificate on its next run.</p>

<h3 id="agent-nodes-refuse-to-trust-the-masters-certificate">Agent Nodes Refuse to Trust the Master&#8217;s Certificate</h3>

<p><strong>Symptom:</strong> Puppet agent is unable to retrieve a configuration, and logs a series of errors ending in <strong>&#8220;hostname was not match with the server certificate.&#8221;</strong></p>

<p>Agent nodes determine the validity of the master&#8217;s certificate based on hostname; if they&#8217;re contacting it using a hostname that wasn&#8217;t included when the certificate was signed, they&#8217;ll reject the certificate. </p>

<p><strong>Solution:</strong> Either:</p>

<p>Modify your agent nodes&#8217; settings to point to one of the master&#8217;s certified hostnames. (This may also require adjusting your site&#8217;s DNS.) To see the puppet master&#8217;s certified hostnames, run:</p>

<pre><code>$ sudo puppet master --configprint certname,certdnsnames
</code></pre>

<p>&#8230;on the puppet master server.</p>

<p><strong>Or:</strong></p>

<p>Re-generate the puppet master&#8217;s certificate: </p>

<ul>
  <li>
    <p>Stop the <code>pe-httpd</code> service:</p>

    <pre><code>  $ sudo /etc/init.d/pe-httpd stop
</code></pre>
  </li>
  <li>
    <p>Delete the puppet master&#8217;s certificate, private key, and public key:</p>

    <pre><code>  $ sudo find /etc/puppetlabs/puppet/ssl -name $(puppet master --configprint certname) -delete
</code></pre>
  </li>
  <li>Edit the <code>certname</code> and <code>certdnsnames</code> settings in the puppet master&#8217;s <code>/etc/puppetlabs/puppet/puppet.conf</code> file to match the puppet master&#8217;s actual hostnames.</li>
  <li>
    <p>Start a non-daemonized WEBrick puppet master instance, and wait for it to generate and sign a new certificate:</p>

    <pre><code>  $ sudo puppet master --no-daemonize --verbose
</code></pre>

    <p>You should stop the temporary puppet master with ctrl-C after you see the &#8220;notice: Starting Puppet master version 2.6.9&#8221; message.</p>
  </li>
  <li>
    <p>Start the <code>pe-httpd</code> service: </p>

    <pre><code>  $ sudo /etc/init.d/pe-httpd start
</code></pre>
  </li>
</ul>

<h3 id="puppet-master-is-rejecting-an-agent-node-with-a-valid-certificate">Puppet master is rejecting an agent node with a valid certificate</h3>

<p><strong>Symptom:</strong> Puppet agent logs a series of errors that end with &#8220;<code>SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed</code>&#8221; or &#8220;<code>SSL_connect returned=1 errno=0 state=SSLv3 read finished A: sslv3 alert bad certificate</code>.&#8221;</p>

<p>The most common cause of this error is time drift in a virtual machine &#8212; if either the puppet master&#8217;s or the agent&#8217;s system time have been reset to <em>before</em> the master or agent certificates were signed, or if the certificates were accidentally signed while the puppet master&#8217;s clock was set to the future, the certificates will be rejected as invalid. </p>

<p><strong>Solution:</strong></p>

<p>To avoid this error, maintain accurate timekeeping on the agent nodes and puppet masters; keep in mind that NTP can behave unreliably in virtual machines. </p>

<p>To repair this error, you will need to re-generate the affected certificates. Use <code>puppet cert print &lt;certname&gt;</code> on the puppet master to examine the valid dates of a certificate, and when you have confirmed that an agent certificate needs to be regenerated, run:</p>

<ul>
  <li><code>puppet cert clean &lt;certname&gt;</code> on the puppet master </li>
  <li><code>rm -rf $(puppet agent --configprint ssldir); puppet agent --test</code> on the affected agent node. </li>
  <li><code>puppet cert sign &lt;certname&gt;</code> on the puppet master</li>
</ul>

<p>If you need to re-generate the puppet master&#8217;s certificate, see <a href="#agent-nodes-refuse-to-trust-the-master's-certificate">the instructions in the previous question</a></p>

<h3 id="an-agent-nodes-os-has-been-re-installed-and-the-master-will-no-longer-communicate-with-it">An agent node&#8217;s OS has been re-installed, and the master will no longer communicate with it</h3>

<p>The puppet master stores signed agent certificates based on nodes&#8217; certnames (unique IDs), which are usually fully-qualified domain names. If a node loses its certificates but retains its unique ID (certname) &#8212; as would happen if the OS and Puppet were re-installed from scratch &#8212; it will re-generate its certificate and send a signing request to the master. However, since the master already has a signed certificate cached for that node, it will ignore the signing request and expect the node to connect using the old (and now lost) certificate. </p>

<p>A similar situation can arise if an agent node is rebuilt while a previous signing request is still pending. </p>

<p><strong>Solution:</strong> On the master server, run <code>puppet cert --clean {agent certname}</code>. The master should now accept the node&#8217;s signing request and wait for permission to sign it. </p>

<h3 id="an-agents-hostname-has-changed-and-it-can-no-longer-contact-its-master">An agent&#8217;s hostname has changed, and it can no longer contact its master</h3>

<p>Normally, a hostname change will not affect a node&#8217;s certname. However, if the certname is changed in <code>puppet.conf</code> or at the command line, the node&#8217;s previously signed certificate won&#8217;t be used when contacting the puppet master. </p>

<p><strong>Solution:</strong> The agent will have submitted a new certificate signing request during the first attempted agent run with the new certname. Simply run <code>sudo puppet cert sign &lt;new certname&gt;</code> on the puppet master to allow the agent to connect under its new name. You can also run <code>puppet cert clean</code> on the previous certificate if you expect to re-use the old certname for a new agent node. </p>

<h3 id="dashboard-was-installed-before-the-puppet-master">Dashboard Was Installed Before the Puppet Master</h3>

<p>If you&#8217;re splitting the Dashboard and puppet master servers and you installed Dashboard first, you&#8217;ll need to modify the post-installation certificate exchange. On the Dashboard server, run the following commands:</p>

<pre><code># puppet agent --test
# cd /opt/puppet/share/puppet-dashboard
# export PATH=/opt/puppet/sbin:/opt/puppet/bin:$PATH
# rake RAILS_ENV=production cert:generate
</code></pre>

<p>After that, you should be able to follow <a href="./installing.html#configuring-a-stand-alone-dashboard-server">the normal post-install instructions for a stand-alone Dashboard server</a>. </p>

<h3 id="puppet-master-server-was-replaced">Puppet Master Server Was Replaced</h3>

<p>All nodes in a given domain must be using certificates signed by the same CA certificate. Since puppet master generates a new CA cert during installation, a new master node will, in its default state, be rejected by any agent nodes which were aware of the previous master. </p>

<p>You have two main options: either delete the <code>/etc/puppetlabs/puppet/ssl</code> directory from each agent node (thereby forcing each node to re-generate certificates and issue new signing requests), or recover the CA certificate and private key from the previous master server and re-generate and re-sign the new master&#8217;s certificate. The short version of how to do the latter is as follows:</p>

<ul>
  <li>Stop puppet master using your system&#8217;s service utilities (e.g., on CentOS: <code>service pe-httpd stop</code>)</li>
  <li>Run <code>puppet cert --clean {master's certname}</code></li>
  <li>Replace the <code>/etc/puppetlabs/puppet/ssl/ca</code> directory with the same directory from the old master</li>
  <li>Run <code>puppet master --no-daemonize</code>, wait approximately 30 seconds, then end the process with ctrl-C</li>
  <li>Start puppet master using your system&#8217;s service utilities</li>
</ul>

<p>(As you can see, replacing a master server requires a certain amount of planning, and if you expect it to be a semi-regular occurrence, you may wish to investigate certificate chaining and the use of external certificate authorities.)</p>

<h2 id="miscellaneous-issues-and-additional-tasks">Miscellaneous Issues and Additional Tasks</h2>

<h3 id="dashboard-has-a-very-large-number-of-pending-background-tasks">Dashboard Has a Very Large Number of Pending Background Tasks</h3>

<p>Background tasks are processed by worker processes, which can sometimes die and leave invalid PID files. To restart the worker tasks, run:</p>

<pre><code>$ sudo /etc/init.d/pe-puppet-dashboard-workers restart
</code></pre>

<p>This should immediately start reducing the number of pending tasks.</p>

<h3 id="change-the-port-used-by-puppet-dashboard">Change The Port Used By Puppet Dashboard</h3>

<p>If you chose to use port 3000 when you installed Puppet Dashboard but later decide you want to use port 80 (or any other port), you will need to stop the <code>pe-httpd</code> service and make the following changes: </p>

<ul>
  <li>In <code>/etc/puppetlabs/httpd/conf.d/puppetdashboard.conf</code>, change the <code>Listen 3000</code> and <code>&lt;VirtualHost *:3000&gt;</code> directives to use port 80. </li>
  <li>In <code>/etc/puppetlabs/puppet/puppet.conf</code>, change the <code>reporturl</code> setting to use your preferred port instead of port 3000.</li>
  <li>In <code>/etc/puppetlabs/puppet-dashboard/external_node</code>, change the <code>BASE="http://localhost:3000"</code> line to use your preferred port instead of port 3000. </li>
  <li>Allow access to the new port in your system&#8217;s firewall rules.</li>
</ul>

<p>After making these changes, start the <code>pe-httpd</code> service again.</p>

<h3 id="import-existing-reports-into-puppet-dashboard">Import Existing Reports Into Puppet Dashboard</h3>

<p>If you are upgrading to PE from a self-maintained Puppet environment, you can add value to your older reports by importing the reports into Puppet Dashboard. To run the report importer, first locate the reports directory on your previous puppet master (<code>puppet master --configprint reportdir</code>) and copy it to the server running Puppet Dashboard. Then, on the Dashboard server, run the following commands with root privileges: </p>

<p>included stored reports on the puppet master (that is, if agent nodes were configured with <code>report = true</code> and the master was configured with <code>reports = store</code>),  can add value to this existing knowledge. </p>

<pre><code>cd /opt/puppet/share/puppet-dashboard
PATH=/opt/puppet/bin:$PATH REPORT_DIR={old reports directory} rake reports:import
</code></pre>

<p>If you have a significant number of existing reports, this task can take some time, so plan accordingly.</p>


              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <div class="secondary-content">
                  <div id="subCol">
                      <h3 class="chapter">Contents</h3>

<ol class="toc">
  <li class="toc-lv2"><a href="#firewall-issues">Firewall Issues</a></li>
  <li class="toc-lv2"><a href="#certificate-issues">Certificate Issues</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#agent-node-was-installed-before-the-puppet-master">Agent Node Was Installed Before the Puppet Master</a></li>
   <li class="toc-lv3"><a href="#agent-nodes-refuse-to-trust-the-masters-certificate">Agent Nodes Refuse to Trust the Master&#8217;s Certificate</a></li>
   <li class="toc-lv3"><a href="#puppet-master-is-rejecting-an-agent-node-with-a-valid-certificate">Puppet master is rejecting an agent node with a valid certificate</a></li>
   <li class="toc-lv3"><a href="#an-agent-nodes-os-has-been-re-installed-and-the-master-will-no-longer-communicate-with-it">An agent node&#8217;s OS has been re-installed, and the master will no longer communicate with it</a></li>
   <li class="toc-lv3"><a href="#an-agents-hostname-has-changed-and-it-can-no-longer-contact-its-master">An agent&#8217;s hostname has changed, and it can no longer contact its master</a></li>
   <li class="toc-lv3"><a href="#dashboard-was-installed-before-the-puppet-master">Dashboard Was Installed Before the Puppet Master</a></li>
   <li class="toc-lv3"><a href="#puppet-master-server-was-replaced">Puppet Master Server Was Replaced</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#miscellaneous-issues-and-additional-tasks">Miscellaneous Issues and Additional Tasks</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#dashboard-has-a-very-large-number-of-pending-background-tasks">Dashboard Has a Very Large Number of Pending Background Tasks</a></li>
   <li class="toc-lv3"><a href="#change-the-port-used-by-puppet-dashboard">Change The Port Used By Puppet Dashboard</a></li>
   <li class="toc-lv3"><a href="#import-existing-reports-into-puppet-dashboard">Import Existing Reports Into Puppet Dashboard</a></li>
</ol></li>
</ol>
                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>
