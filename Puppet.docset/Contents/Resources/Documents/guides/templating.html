<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Using Puppet Templates — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../favicon.ico' />

  <meta name="description" content="Using Puppet TemplatesLearn how to template out configuration files with Puppet, filling in variableswith the managed node&#8217;s facts.Puppet sup...">




    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../files/javascripts/ampersands.js'></script>
    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/guides/templating.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/style_legacy.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>

            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Using Puppet Templates</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1 id="using-puppet-templates">Using Puppet Templates</h1>

<p>Learn how to template out configuration files with Puppet, filling in variables
with the managed node&#8217;s facts.</p>

<hr />

<p>Puppet supports templates written in the <a href="http://ruby-doc.org/stdlib-1.8.7/libdoc/erb/rdoc/ERB.html">ERB</a> templating language, which is part of the Ruby standard library.</p>

<p>Templates can be used to specify the contents of files.</p>

<p><strong>For a full introduction to using templates with Puppet, see <a href="./../learning/templates.html">the templates chapter of Learning Puppet</a>.</strong></p>

<h2 id="evaluating-templates">Evaluating Templates</h2>

<p>Templates are evaluated via a simple function:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$value</span> <span class="o">=</span> <span class="n">template</span><span class="p">(</span><span class="s2">&quot;my_module/mytemplate.erb&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>Template files should be stored in the <code>templates</code> directory of a <a href="./../puppet/latest/reference/modules_fundamentals.html">Puppet module</a>,</strong> which allows the <code>template</code> function to locate them with the simplified path format shown above. For example, the file referenced by <code>template("my_module/mytemplate.erb")</code> would be found on disk at <code>/etc/puppet/modules/my_module/templates/mytemplate.erb</code> (assuming the common <a href="/references/latest/configuration.html#modulepath"><code>modulepath</code></a> of <code>/etc/puppet/modules</code>).</p>

<p>(If a file cannot be located within any module, the <code>template</code> function will fall back to searching relative to the paths in Puppet&#8217;s <a href="./../references/latest/configuration.html#templatedir"><code>templatedir</code></a>. However, using this setting is no longer recommended.)</p>

<p>Templates are always evaluated by the parser, not by the client.
This means that if you are using a puppet master server, then the templates
only need to be on the server, and you never need to download them
to the client. The client sees no difference between using a
template and specifying all of the text of the file as a string.</p>

<h2 id="erb-template-syntax">ERB Template Syntax</h2>

<p>ERB is part of the Ruby standard library. Full information about its syntax and evaluation is <a href="http://ruby-doc.org/stdlib-1.8.7/libdoc/erb/rdoc/ERB.html">available in the Ruby documentation</a>. An abbreviated version is presented below.</p>

<h3 id="erb-is-plain-text-with-embedded-ruby">ERB is Plain Text With Embedded Ruby</h3>

<p>ERB templates may contain any kind of text; in the context of Puppet, this is usually some sort of config file. (Outside the context of Puppet, it is usually HTML.)</p>

<p>Literal text in an ERB file becomes literal text in the processed output. Ruby instructions and expressions can be embedded in <strong>tags;</strong> these will be interpreted to help create the processed output.</p>

<h3 id="tags">Tags</h3>

<p>The tags available in an ERB file depend on the way the ERB processor is configured. Puppet always uses the same configuration for its templates (see &#8220;trim mode&#8221; below), which makes the following tags available:</p>

<ul>
  <li><code>&lt;%= Ruby expression %&gt;</code> &#8212; This tag will be replaced with the value of the expression it contains.</li>
  <li><code>&lt;% Ruby code %&gt;</code> &#8212; This tag will execute the code it contains, but will not be replaced by a value. Useful for conditional or looping logic, setting variables, and manipulating data before printing it.</li>
  <li><code>&lt;%# comment %&gt;</code> &#8212; Anything in this tag will be suppressed in the final output.</li>
  <li><code>&lt;%%</code> or <code>%%&gt;</code> &#8212; A literal &lt;% or %&gt;, respectively.</li>
  <li><code>&lt;%-</code> &#8212; Same as <code>&lt;%</code>, but suppresses any leading whitespace in the final output. Useful when indenting blocks of code for readability.</li>
  <li><code>-%&gt;</code> &#8212; Same as <code>%&gt;</code>, but suppresses the subsequent line break in the final output. Useful with many lines of non-printing code in a row, which would otherwise appear as a long stretch of blank lines.</li>
</ul>

<h3 id="trim-mode">Trim Mode</h3>

<p>Puppet uses ERB&#8217;s undocumented <code>"-"</code> (explicit line trim) mode, which allows tags to suppress leading whitespace and trailing line breaks as described above, and disallows the <code>% line of code</code> shortcut. Although it unfortunately doesn&#8217;t appear in the ERB docs, you can read its effect in the Ruby source code starting in the <code>initialize</code> method of the <code>ERB::Compiler::TrimScanner</code> class.</p>

<h2 id="using-templates">Using Templates</h2>

<p>Here is an example for generating the Apache configuration for
<a href="http://trac.edgewall.org/">Trac</a> sites:</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># /etc/puppet/modules/trac/manifests/tracsite.pp</span>
    <span class="n">define</span> <span class="n">trac</span><span class="o">::</span><span class="n">tracsite</span><span class="p">(</span><span class="vg">$cgidir</span><span class="p">,</span> <span class="vg">$tracdir</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;trac-${name}&quot;</span><span class="p">:</span>
        <span class="n">path</span>    <span class="o">=&gt;</span> <span class="s2">&quot;/etc/apache2/trac/${name}.conf&quot;</span><span class="p">,</span>
        <span class="n">owner</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="n">group</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="n">mode</span>    <span class="o">=&gt;</span> <span class="s1">&#39;0644&#39;</span><span class="p">,</span>
        <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="n">apacheconf</span><span class="o">]</span><span class="p">,</span>
        <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;trac/tracsite.erb&#39;</span><span class="p">),</span>
        <span class="n">notify</span>  <span class="o">=&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="n">apache2</span><span class="o">]</span>
      <span class="p">}</span>

      <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;tracsym-${name}&quot;</span><span class="p">:</span>
        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">symlink</span><span class="p">,</span>
        <span class="n">path</span>   <span class="o">=&gt;</span> <span class="s2">&quot;${cgidir}/${name.cgi}&quot;</span><span class="p">,</span>
        <span class="n">target</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/share/trac/cgi-bin/trac.cgi&#39;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>And then here&#8217;s the template:</p>

<div class="highlight"><pre><code class="erb"><span class="x">    </span><span class="cp">&lt;%#</span><span class="c"> /etc/puppet/modules/trac/templates/tracsite.erb </span><span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;Location &quot;/cgi-bin/ </span><span class="cp">&lt;%=</span> <span class="vi">@name</span> <span class="cp">%&gt;</span><span class="x">.cgi&quot;&gt;</span>
<span class="x">        SetEnv TRAC_ENV &quot;/export/svn/trac/</span><span class="cp">&lt;%=</span> <span class="vi">@name</span> <span class="cp">%&gt;</span><span class="x">&quot;</span>
<span class="x">    &lt;/Location&gt;</span>

<span class="x">    </span><span class="cp">&lt;%#</span><span class="c"> You need something like this to authenticate users: </span><span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;Location &quot;/cgi-bin/</span><span class="cp">&lt;%=</span> <span class="vi">@name</span> <span class="cp">%&gt;</span><span class="x">.cgi/login&quot;&gt;</span>
<span class="x">        AuthType Basic</span>
<span class="x">        AuthName &quot;Trac&quot;</span>
<span class="x">        AuthUserFile /etc/apache2/auth/svn</span>
<span class="x">        Require valid-user</span>
<span class="x">    &lt;/Location&gt;</span>
</code></pre>
</div>

<p>This puts each Trac configuration into a separate
file, and then we just tell Apache to load all of these files:</p>

<pre><code># /etc/httpd/httpd.conf
Include /etc/apache2/trac/[^.#]*
</code></pre>

<p>Note that the <code>template</code> function simply returns a string, which can be used as a value anywhere &#8212; the most common use is to fill file contents, but templates can also provide values for variables:</p>

<pre><code>$myvariable = template('my_module/myvariable.erb')
</code></pre>

<h2 id="referencing-variables">Referencing Variables</h2>

<p>Puppet passes all of the currently set variables (including facts) to templates when they are evaluated. There are several ways to access these variables:</p>

<ul>
  <li>All of the variables visible <strong>in the current scope</strong> are available as Ruby instance variables &#8212; that is, <code>@fqdn, @memoryfree, @operatingsystem</code>, etc. This style of reference works identically to using short (local) variable names in a Puppet manifest: <code>@fqdn</code> is exactly equivalent to <code>$fqdn</code>.</li>
  <li>Historically, all of the variables visible <strong>in the current scope</strong> were also available as Ruby methods &#8212; that is, <code>fqdn, memoryfree, operatingsystem</code>, etc., without the prepended <code>@</code> sign. This style of reference caused problems when variable names collided with Ruby method names; its use emits deprecation warnings as of Puppet 3 and will be removed in Puppet 4. Please update any existing code which uses it and start any new code out with the <code>@fqdn</code> instance-variable syntax.</li>
  <li>Puppet passes an object named <code>scope</code> to the template. This contains <strong>all</strong> of the currently set variables, as well as some other data (<a href="#using-functions-within-templates">including functions</a>), and provides some methods for accessing them. You can use the scope object&#8217;s <code>lookupvar</code> method to find <strong>any</strong> variable, in any scope. See &#8220;Out-of-Scope Variables&#8221; below for more details.</li>
</ul>

<p><a href="./../guides/scope_and_puppet.html">Note that Puppet&#8217;s variable lookup rules changed for Puppet 3.0.</a></p>

<h3 id="out-of-scope-variables">Out-of-Scope Variables</h3>

<p>You can access variables in other scopes with the <code>scope.lookupvar</code> method:</p>

<pre><code>&lt;%= scope.lookupvar('apache::user') %&gt;
</code></pre>

<p>This can also be used to ensure that you are getting the top-scope value of a variable that may have been overridden in a local scope:</p>

<pre><code>&lt;%= scope.lookupvar('::domain') %&gt;
</code></pre>

<p>Puppet 3 introduces an easier syntax: you can use the square bracket operator (<code>[]</code>) on the scope object as though it were a hash.</p>

<pre><code>&lt;%= scope['::domain'] %&gt;
</code></pre>

<h3 id="testing-for-undefined-variables">Testing for Undefined variables</h3>

<p>Instance variables are not created for variables whose values are undefined, so you can easily test for undefined variables with <code>if @variable</code>:</p>

<pre><code>&lt;% if @myvar %&gt;
myvar has &lt;%= @myvar %&gt; value
&lt;% end %&gt;
</code></pre>

<p>Older templates often used the <code>has_variable?("myvar")</code> helper function, but this could yield odd results when variables were explicitly set to <code>undef</code>, and should usually be avoided.</p>

<p>If you need to test for a variable outside the current scope, you should copy it to a local variable in the manifest before evaluating the template:</p>

<pre><code># manifest:
$in_var = $outside_scope::outside_var

# template:
&lt;% if @in_var %&gt;
outside_var has &lt;%= @in_var %&gt; value
&lt;% end %&gt;
</code></pre>

<h3 id="getting-a-list-of-all-variables">Getting a List of All Variables</h3>

<p>If you use the scope object&#8217;s <code>to_hash</code> method, you can get a hash of every variable that is defined in the current scope. This hash uses the local name (<code>osfamily</code>) of each variable, rather than the qualified name (<code>::osfamily</code>).</p>

<p>This snippet will print all of the variable names defined in the current scope:</p>

<pre><code>&lt;% scope.to_hash.keys.each do |k| -%&gt;
&lt;%= k %&gt;
&lt;% end -%&gt;
</code></pre>

<h2 id="combining-templates">Combining Templates</h2>

<p>The template function can concatenate several templates together as follows:</p>

<pre><code> template('my_module/template1.erb','my_module/template2.erb')
</code></pre>

<p>This would be rendered as a single string with the content of both templates, in order.</p>

<h2 id="iteration">Iteration</h2>

<p>Puppet&#8217;s templates also support array iteration. If the variable you are
accessing is an array, you can iterate over it in a loop. Given Puppet manifest
code like this:</p>

<pre><code>$values = [val1, val2, otherval]
</code></pre>

<p>You could have a template like this:</p>

<pre><code>&lt;% @values.each do |val| -%&gt;
Some stuff with &lt;%= val %&gt;
&lt;% end -%&gt;
</code></pre>

<p>This would produce:</p>

<pre><code>Some stuff with val1
Some stuff with val2
Some stuff with otherval
</code></pre>

<p>Note that normally, ERB template lines that just have code on them
would get translated into blank lines.  This is because ERB generates
newlines by default.  To prevent this, we use the closing tag <code>-%&gt;</code> instead of <code>%&gt;</code>.</p>

<p>As we mentioned, erb is a Ruby system, but you don&#8217;t need to know Ruby
well to use ERB.   Internally, Puppet&#8217;s values get translated to real Ruby values,
including true and false, so you can be pretty confident that
variables will behave as you might expect.</p>

<h2 id="conditionals">Conditionals</h2>

<p>The ERB templating supports conditionals.  The following construct is
a quick and easy way to conditionally put content into a file:</p>

<pre><code>&lt;% if broadcast != "NONE" %&gt;        broadcast &lt;%= broadcast %&gt; &lt;% end %&gt;
</code></pre>

<h2 id="access-to-tags-and-declared-classes">Access to Tags and Declared Classes</h2>

<blockquote>
  <p><strong>Note:</strong> The lists of tags and declared classes are parse-order dependent &#8212; they are only safe to use if you know exactly when in the compilation process the template will be evaluated. Using these variables is not recommended.</p>
</blockquote>

<p>In version 0.24.6 and later, Puppet passes the following extra variables to a template:</p>

<ul>
  <li><code>classes</code> &#8212; an array of all of the classes that have been declared so far</li>
  <li><code>tags</code> &#8212; an array of all of the tags applied to the current container</li>
  <li><code>all_tags</code> &#8212; an array of all of the tags in use anywhere in the catalog</li>
</ul>

<p>You can iterate over these variables or access their members.</p>

<p>This snippet will print all the classes that have been declared so far:</p>

<pre><code>&lt;% classes.each do |klass| -%&gt;
The class &lt;%= klass %&gt; is defined
&lt;% end -%&gt;
</code></pre>

<p>This snippet will print all the tags applied to the current container:</p>

<pre><code>&lt;% tags.each do |tag| -%&gt;
The tag &lt;%= tag %&gt; is part of the current scope
&lt;% end -%&gt;
</code></pre>

<p>This snippet will print all of the tags in use so far:</p>

<pre><code>&lt;% all_tags.each do |tag| -%&gt;
The tag &lt;%= tag %&gt; is defined
&lt;% end -%&gt;
</code></pre>

<h2 id="using-functions-within-templates">Using Functions Within Templates</h2>

<p><a href="./../references/stable/function.html">Puppet functions</a> can be used inside templates, but their use is slightly different from their use in manifests:</p>

<ul>
  <li>All functions are methods on the <code>scope</code> object.</li>
  <li>You must prepend &#8220;<code>function_</code>&#8221; to the beginning of the function name.</li>
  <li>The arguments of the function must be provided <strong>as an array,</strong> even if there is only one argument. (This is mandatory in Puppet 3. Prior to Puppet 3, some functions would succeed when passed a string and some would fail.)</li>
</ul>

<p>For example, to include one template inside another:</p>

<pre><code>&lt;%= scope.function_template(["my_module/template2.erb"]) %&gt;
</code></pre>

<p>To log a warning using Puppet&#8217;s own logging system, so that it will appear in reports:</p>

<pre><code>&lt;%= scope.function_warning(["Template was missing some data; this config file may be malformed."]) %&gt;
</code></pre>

<h2 id="syntax-checking">Syntax Checking</h2>

<p>ERB files are easy to syntax check. For a file mytemplate.erb, run</p>

<pre><code>erb -P -x -T '-' mytemplate.erb | ruby -c
</code></pre>


              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <div class="secondary-content">
                  <div id="subCol">
                      <h3 class="chapter">Contents</h3>

<ol class="toc">
  <li class="toc-lv2"><a href="#evaluating-templates">Evaluating Templates</a></li>
  <li class="toc-lv2"><a href="#erb-template-syntax">ERB Template Syntax</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#erb-is-plain-text-with-embedded-ruby">ERB is Plain Text With Embedded Ruby</a></li>
   <li class="toc-lv3"><a href="#tags">Tags</a></li>
   <li class="toc-lv3"><a href="#trim-mode">Trim Mode</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#using-templates">Using Templates</a></li>
  <li class="toc-lv2"><a href="#referencing-variables">Referencing Variables</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#out-of-scope-variables">Out-of-Scope Variables</a></li>
   <li class="toc-lv3"><a href="#testing-for-undefined-variables">Testing for Undefined variables</a></li>
   <li class="toc-lv3"><a href="#getting-a-list-of-all-variables">Getting a List of All Variables</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#combining-templates">Combining Templates</a></li>
  <li class="toc-lv2"><a href="#iteration">Iteration</a></li>
  <li class="toc-lv2"><a href="#conditionals">Conditionals</a></li>
  <li class="toc-lv2"><a href="#access-to-tags-and-declared-classes">Access to Tags and Declared Classes</a></li>
  <li class="toc-lv2"><a href="#using-functions-within-templates">Using Functions Within Templates</a></li>
  <li class="toc-lv2"><a href="#syntax-checking">Syntax Checking</a></li>
</ol>
                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>
