<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Upgrading Puppet — Documentation — Puppet Labs</title>
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Documentation Updates" href="https://github.com/puppetlabs/puppet-docs/commits/master.atom">
    <link rel="alternate" type="application/atom+xml" title="Puppet Labs Blog Feed" href="http://puppetlabs.com/feed/atom/">
    <link rel='index' title='Puppet Labs Documentation' href='http://docs.puppetlabs.com' />
    <link rel='icon' href='./../favicon.ico' />


  <meta name="description" content="Since Puppet is likely managing your entire infrastructure, it should be upgraded with care. This page describes our recommendations for upgrading ...">



    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='./../files/javascripts/html5.js'></script>
    <script type='text/javascript' src='./../files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='./../files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='./../files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='./../files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='./../files/javascripts/ampersands.js'></script>
    <script type='text/javascript' src='./../files/javascripts/navigation-accordion.js'></script>

    <script type="text/javascript" src="http://puppetlabs.com/wp-content/themes/puppetlabs/javascripts/leadcapture.js"></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <!-- /all in one seo pack -->

    <!-- Give us the option of setting a canonical URL in yaml frontmatter -NF -->
    <link rel="canonical" href="http://docs.puppetlabs.com/guides/upgrading.html" />

    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/style.css" media="screen">
    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/syntax.css" media="screen"> <!-- index -->
    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/adbanner.css" media="screen">

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="./../files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->

    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="./../files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>




  <body id="puppetlabsdocs" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://puppetlabs.com/puppet/puppet-enterprise">
              <span>Products</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/what-is-puppet/">What is Puppet?</a>
                </ul>
              </li>
			       <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-enterprise/">Puppet Enterprise</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/whats-new/">What's New in 2.5</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/puppet-open-source/">Puppet Open Source</a>
                </ul>
              </li>
            <li>
                <ul>
                   <a href="http://puppetlabs.com/puppet/enterprise-vs-open-source/">Enterprise vs. Open Source</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://forge.puppetlabs.com">Puppet Forge</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/requirements/">Components &amp; Requirements</a>
                </ul>
              </li>
              <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/faq/">FAQ</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/puppet/how-to-buy/">How to Buy</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="solutions-tab" class="with-submenu">
            <a href="http://puppetlabs.com/solutions/">
              <span>Solutions</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-12296"><a href="http://puppetlabs.com/solutions/configuration-management/">Configuration Management</a></li>
<li class="page_item page-item-986"><a href="http://puppetlabs.com/solutions/virtualization-management/">Virtualization Management</a></li>
<li class="page_item page-item-993"><a href="http://puppetlabs.com/solutions/cloud-management/">Cloud Management</a></li>
<li class="page_item page-item-996"><a href="http://puppetlabs.com/solutions/it-compliance/">IT Compliance</a></li>
<li class="page_item page-item-9520"><a href="http://puppetlabs.com/solutions/devops/">DevOps</a></li>
<li class="page_item page-item-991"><a href="http://puppetlabs.com/solutions/manage-os-x-resources/">OS X Desktops</a></li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://puppetlabs.com/services/overview/">Overview</a></li>
<li class="page_item page-item-1052"><a href="http://puppetlabs.com/services/customer-support/">Customer Support</a></li>
<li class="page_item page-item-11022"><a href="http://puppetlabs.com/services/support-plans/">Support Plans</a></li>
<li class="page_item page-item-845"><a href="http://puppetlabs.com/services/training-workshops/">On-Site Education</a></li>
<li class="page_item page-item-4899"><a href="http://puppetlabs.com/services/consulting/">Professional Services</a></li>
<li class="page_item page-item-849"><a href="http://puppetlabs.com/category/events/upcoming/">Events &amp; Workshops</a></li>
<li class="page_item page-item-851"><a href="http://puppetlabs.com/services/partners/">Partners</a></li>
            </ul>
          </li>
                    <li id="resources-tab" class="with-submenu">
            <a href="http://puppetlabs.com/resources/">
              <span>Resources</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://puppetlabs.com/resources/overview-2/">Overview</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download">Downloads</a></li>
<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com">Puppet Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/download-whitepapers.html">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki">Wiki</a></li>
<li class="page_item page-item-7279"><a href="http://puppetlabs.com/resources/webinars/">Upcoming Webinars</a></li>
<li class="page_item page-item-10183"><a href="http://puppetlabs.com/resources/newsletter/">Newsletter</a></li>
<li class="page_item page-item-12263"><a href="http://puppetlabs.com/resources/tech-notes/">Tech Notes</a></li>
<li class="page_item page-item-10265"><a href="http://info.puppetlabs.com/pe2-webinar.html">Webinars</a></li>
            </ul>
          </li>

          <li id="customers-tab" class="with-submenu">
            <a href="http://puppetlabs.com/customers/companies/">
              <span>Customers</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/customers/companies/">Companies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/case-studies/">Case Studies</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/product-testimonials/">Product Testimonials</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/customers/what-customers-are-saying/">Service Testimonials</a>
                </ul>
              </li>
            </ul>
          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://puppetlabs.com/community/">
              <span>Community</span>
              <span class="drop-down-trigger"></span>
            </a>

 <ul>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/community/overview/">Overview</a>
                </ul>
              </li>
			<li>
                <ul>
                  <a href="http://puppetlabs.com/blog">Blog</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/puppet-camp/">Puppet Camp</a>
                </ul>
              </li>
			  <li>
                <ul>
                  <a href="http://puppetlabs.com/community/user-groups-and-devops-groups/">Puppet User Groups & DevOps Groups</a>
                </ul>
              </li>
	          <li>
                <ul>
                  <a href="http://puppetlabs.com/community/presentations/">Presentations</a>
                </ul>
              </li>
			    <li>
                <ul>
                  <a href="http://puppetlabs.com/community/videos/">Videos</a>
                </ul>
              </li>
            </ul>

          <li id="company-tab" class="with-submenu">
            <a href="http://puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2316"><a href="http://puppetlabs.com/company/overview/">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://puppetlabs.com/company/news/">News</a>
<ul class='children'>
	<li class="page_item page-item-2338"><a href="http://puppetlabs.com/company/news/press-releases/">Press Releases</a></li>
	<li class="page_item page-item-2383"><a href="http://puppetlabs.com/company/news/media-kit/">Media Kit</a></li>
</ul>
</li>
<li class="page_item page-item-1571"><a href="http://puppetlabs.com/company/careers/">Careers</a></li>
<li class="page_item page-item-10372"><a href="http://puppetlabs.com/company/management/">Management</a></li>
<li class="page_item page-item-10311"><a href="http://puppetlabs.com/company/board-and-advisors/">Board and Advisors</a></li>
<li class="page_item page-item-10367"><a href="http://puppetlabs.com/company/investors/">Investors</a></li>
<li class="page_item page-item-2313"><a href="http://puppetlabs.com/company/contact-us/">Contact Us</a></li>
<li class="page_item page-item-10579"><a href="http://puppetlabs.com/company/awards/">Awards</a></li>
            </ul>
          </li>
    		</ul>
          <div id="misc-navigation">
			  <ul>
				<li><a href="http://puppetlabs.com/security/">Security</a></li>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
			        <li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/contact/contact-us">Contact Us</a></li>
				<li><a href="http://info.puppetlabs.com/download-pe2.html" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">
			  <div>
				<input type="hidden" name="cx" value="017668764424496204839:ubligvgbenm" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" class="gsc-input" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>
          </div>
      </nav>
    	</div>
    </header>

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Upgrading Puppet</span></h1>
          <ul id="doc-navigation">
            <li><a href="./../index.html">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
                               <dl>
                  <dt>Puppet Documentation</dt>
                      <dd><a href="./../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></dd>
                      <dd><a href="./../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></dd>
                      <dd><a href="./../pe/latest/index.html">Puppet Enterprise User's Guide</a></dd>
                      <dd><a href="./../learning/index.html">Learning Puppet</a></dd>
                      <dd><a href="./../references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="./../references/latest/function.html">Functions</a></dd>
                      <dd><a href="./../references/latest/configuration.html">Configuration</a></dd>
                      <dd><a href="./../references/latest/developer/index.html">Developer</a></dd>
                      <dd><a href="./../references/glossary.html">Glossary of Puppet Terms</a></dd>
                      <dd><a href="./../references/index.html">Older References</a></dd>
                  <dt>Facter</dt>
                      <dd><a href="./../facter/latest/core_facts.html">Core Facts Reference</a></dd>
                  <dt>PuppetDB</dt>
                      <dd><a href="./../puppetdb/1/index.html">PuppetDB 1 Manual</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="./../mcollective/index.html">Index</a></dd>
                      <dd><a href="./../mcollective/reference/index.html">References</a></dd>
                      <dd><a href="./../mcollective/simplerpc/index.html">Writing Plugins</a></dd>
                      <dd><a href="./../mcollective/releasenotes.html">Release Notes</a></dd>
                </dl>

            </li>
            <li><a href="./../contribute.html">Contribute</a></li>
          </ul>
        </div>
        <br />
      </section>

      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1>Upgrading Puppet</h1>
              <nav class="in-page" id="page-nav">
<ol class="toc">
  <li class="toc-lv2"><a href="#upgrade-intentionally">Upgrade Intentionally</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#apt-pinning-example">Apt Pinning Example</a></li>
   <li class="toc-lv3"><a href="#yum-versionlock-example">Yum Versionlock Example</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#always-upgrade-the-puppet-master-first">Always Upgrade the Puppet Master First</a></li>
  <li class="toc-lv2"><a href="#use-more-care-with-major-releases">Use More Care With Major Releases</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#additional-precautions">Additional Precautions</a></li>
   <li class="toc-lv3"><a href="#versioning-in-puppet-3-and-later">Versioning in Puppet 3 and Later</a></li>
   <li class="toc-lv3"><a href="#versioning-in-puppet-2x">Versioning in Puppet 2.x</a></li>
</ol></li>
  <li class="toc-lv2"><a href="#roll-out-in-stages">Roll Out In Stages</a>
<ol class="toc">
   <li class="toc-lv3"><a href="#option-1-spin-up-temporary-puppet-master-or-cull-a-master-from-your-load-balancer-pool">Option 1: Spin Up Temporary Puppet Master, or Cull a Master From Your Load Balancer Pool</a></li>
   <li class="toc-lv3"><a href="#option-2-run-two-instances-of-puppet-master-at-once">Option 2: Run Two Instances of Puppet Master at Once</a></li>
   <li class="toc-lv3"><a href="#option-3-upgrade-master-and-roll-back-if-needed">Option 3: Upgrade Master and Roll Back if Needed</a></li>
</ol></li>
</ol></nav>

<p>Since Puppet is likely managing your entire infrastructure, it should be <strong>upgraded with care.</strong> This page describes our recommendations for upgrading Puppet.</p>

<h2 id="upgrade-intentionally">Upgrade Intentionally</h2>

<p>If you are using <code>ensure =&gt; latest</code> on the Puppet package or running large-scale package upgrade commands, you might receive a Puppet upgrade you were not expecting, especially if you subscribe to the <a href="./../guides/puppetlabs_package_repositories.html">Puppet Labs package repos</a>, which always contain the most recent version of Puppet. <strong>We highly recommend avoiding unintentional upgrades.</strong> Although we try our best not to break things, especially between minor releases, Puppet has a lot of surface area, and bugs can and do slip in.</p>

<p>We recommend doing one of the following:</p>

<ul>
  <li>Maintain your own package repositories, test new Puppet releases in a dev environment, and only introduce known-good versions into your production repo. Many sysadmins consider this to be best practice for <strong>any</strong> mission-critical packages.</li>
  <li>Use Apt&#8217;s pinning feature or Yum&#8217;s versionlock plugin to lock Puppet to a specific version, and only upgrade when you have a roll-out plan in place.</li>
</ul>

<h3 id="apt-pinning-example">Apt Pinning Example</h3>

<p>You can pin package versions by adding special .pref files to your system&#8217;s <code>/etc/apt/preferences.d/</code> directory:</p>

<pre><code># /etc/apt/preferences.d/00-puppet.pref
Package: puppet puppet-common
Pin: version 2.7*
Pin-Priority: 501
</code></pre>

<p>This pref file will lock puppet and puppet-common to the latest 2.7 release &#8212; they will be upgraded when new 2.7.x releases are added, but will not jump a major version. It will also downgrade a Puppet 3 to Puppet 2.7 if the pin-priority of the Puppet 3 is less than 501 (the default is 500). A separate file could be used to pin puppetmaster and puppetmaster-common, or they could be added to the package list.</p>

<h3 id="yum-versionlock-example">Yum Versionlock Example</h3>

<p>Unfortunately, Yum versionlock is less flexible than Apt pinning: it can&#8217;t allow bugfix upgrades, and can only lock specific versions. For this reason, maintaining your own repo is a more attractive option for RPM systems.</p>

<pre><code>$ sudo yum install yum-versionlock
$ sudo yum install puppet-2.7.19
$ sudo yum versionlock puppet
</code></pre>

<p>These commands will install the versionlock plugin and lock Puppet to version 2.7.19. When you want to upgrade, edit <code>/etc/yum/pluginconf.d/versionlock.list</code> and remove the Puppet lock, then run:</p>

<pre><code>$ sudo yum install puppet-&lt;desired version&gt;
$ sudo yum versionlock puppet
</code></pre>

<h2 id="always-upgrade-the-puppet-master-first">Always Upgrade the Puppet Master First</h2>

<p>Older agent nodes can get catalogs from a newer puppet master. The inverse is not always true.</p>

<h2 id="use-more-care-with-major-releases">Use More Care With Major Releases</h2>

<p>Upgrading to a new major release presents more possibility for things to go wrong, and we recommend extra caution.</p>

<h3 id="additional-precautions">Additional Precautions</h3>

<p>When upgrading to a new major release, we recommend the following:</p>

<ul>
  <li>Avoid jumping over a whole major release. If you are on Puppet 2.6, you should upgrade to Puppet 2.7 before going to 3.x, unless you are prepared to spend a lot of time fixing your manifests without a net.</li>
  <li><strong>Read the release notes,</strong> in particular any sections that refer to &#8220;backwards-incompatible changes.&#8221; Follow any specific recommendations for the new version. (<a href="./../puppet/3/reference/whats_new.html#backwards-incompatible-changes-in-3x">Backwards-incompatible changes for Puppet 3.0.</a>)</li>
  <li>If you tend to just upgrade everything for bug fix releases, use a more conservative roll-out plan for major ones.</li>
</ul>

<p>The definition of a &#8220;major release&#8221; has occasionally changed:</p>

<h3 id="versioning-in-puppet-3-and-later">Versioning in Puppet 3 and Later</h3>

<p>Starting with Puppet 3, there are three kinds of Puppet release:</p>

<ul>
  <li><strong>Bug fix</strong> releases increment the last segment of the version number. (E.g. 3.0.<strong>1</strong>.) They are intended to fix bugs without introducing new features or breaking backwards compatibility. These releases <strong>should</strong> be safe to upgrade to, but you should test them anyway.</li>
  <li><strong>Minor</strong> releases increment the middle segment of the version number. (E.g. 3.<strong>1</strong>.0.) They may introduce new features, but shouldn&#8217;t break backwards compatibility.</li>
  <li><strong>Major</strong> releases increment the first segment of the version number. (E.g. <strong>3</strong>.0.0.) They <strong>may intentionally break backwards compatibility</strong> with previous versions, in addition to adding features and fixing bugs.</li>
</ul>

<h3 id="versioning-in-puppet-2x">Versioning in Puppet 2.x</h3>

<p>In the 2.x series:</p>

<ul>
  <li><strong>Minor</strong> releases are not distinguished from bug fix releases. A release that increments the last segment of the version number (e.g. 2.7.<strong>18</strong>) may or may not add new features or break small areas of backwards compatibility, and you must check the <a href="http://projects.puppetlabs.com/projects/puppet/wiki/Release_Notes">release notes</a> to find out.</li>
  <li><strong>Major</strong> releases increment the second segment of the version number. (E.g. 2.<strong>7</strong>.0.) They <strong>may intentionally break backwards compatibility</strong> with previous versions, in addition to adding features and fixing bugs.</li>
</ul>

<h2 id="roll-out-in-stages">Roll Out In Stages</h2>

<p>When upgrading, especially between major versions, we recommend rolling out the upgrade in stages. Use one of the following three options:</p>

<h3 id="option-1-spin-up-temporary-puppet-master-or-cull-a-master-from-your-load-balancer-pool">Option 1: Spin Up Temporary Puppet Master, or Cull a Master From Your Load Balancer Pool</h3>

<p>The best approach is to spin up a temporary puppet master, then point a few test nodes at it.</p>

<ul>
  <li>If you run a multi-master site and can pull a puppet master out of the load balancer pool for temporary test duty, do that. Upgrade Puppet on it, and follow steps 5-10 below.</li>
  <li>If you run a multi-master site and use Puppet to configure new puppet masters, you can also spin up a new node and use Puppet to configure it. Upgrade Puppet on it, and follow steps 5-10 below.</li>
  <li>Otherwise, follow steps 1-10 below.</li>
</ul>

<ol>
  <li>Provision a new node and install Puppet on it.</li>
  <li>Set its <code>server</code> setting to the existing puppet master, and use <code>puppet agent --test</code> to request a certificate; sign the cert.</li>
  <li>Provision the new puppet master by checking out your latest modules, manifests, and data from version control. If you use an ENC and/or PuppetDB or storeconfigs, configure the master to talk to those services.</li>
  <li>In a terminal window, run <code>puppet master --no-daemonize --verbose</code>. This will run a puppet master in the foreground so you can easily see log messages and warnings. Use care to limit concurrent checkins on your test nodes; this WEBrick puppet master cannot handle sustained load.</li>
  <li>Choose a subset of your nodes to test with the new master, or spin up new nodes. Upgrade Puppet to the new version on them, and change their <code>server</code> setting to point to the temporary puppet master.</li>
  <li>Trigger a <code>puppet agent --test</code> run on every test node, so you can see log messages in the foreground. <strong>Look for changes to their resources;</strong> if you see anything you didn&#8217;t expect, investigate it. If something seems dangerous and you can&#8217;t figure it out, you may want to post to the <a href="https://groups.google.com/group/puppet-users/">Puppet users list</a> or ask other users in #puppet on Freenode.</li>
  <li>Check the log messages in the terminal window or log file on your puppet master. Look for warnings and deprecation notices.</li>
  <li>Check the actual configurations of your test nodes. Make sure everything is still working as expected.</li>
  <li>Repeat steps 5-8 with more test nodes if you&#8217;re still not sure.</li>
  <li>Revert the <code>server</code> setting on all test nodes. Decommission the temporary puppet master. Upgrade your production puppet master(s) by stopping their web server, upgrading the puppet package, and restarting their web server. Upgrade all your production nodes. (Most packaging systems allow you to use Puppet to upgrade Puppet.)</li>
</ol>

<h3 id="option-2-run-two-instances-of-puppet-master-at-once">Option 2: Run Two Instances of Puppet Master at Once</h3>

<p>You can also run a second instance of puppet master on your production puppet master server, using the same modules, manifests, data, ENC, and SSL configuration.</p>

<blockquote>
  <p><strong>Note:</strong> This is generally reliable, but has a small chance of yielding inaccurate results. (This problem would require a major version to remove a given code path but not fail hard when attempting to access the code path; we are not currently aware of a situation that would cause that.)</p>
</blockquote>

<ol>
  <li><a href="http://downloads.puppetlabs.com/puppet/">Download a tarball of the Puppet source code for the new version.</a> Unzip it somewhere <strong>other than your normal Ruby library directory.</strong> (<code>tar -xf puppet-&lt;version&gt;</code>)</li>
  <li>Open a root shell, which should stay open for the duration of this test. (<code>sudo -i</code>)</li>
  <li>Change directory into the source tarball. (<code>cd puppet-&lt;version&gt;</code>)</li>
  <li>Add the lib directory to your shell&#8217;s RUBYLIB. (<code>export RUBYLIB=$(pwd)/lib:$RUBYLIB</code>)</li>
  <li>Run <code>puppet master --no-daemonize --verbose --masterport 8141</code>. This will run a puppet master <strong>on a different port</strong> in the foreground so you can easily see log messages and warnings. Use care to limit concurrent checkins on your test nodes; this WEBrick puppet master cannot handle sustained load.</li>
  <li>Choose a subset of your nodes to test with the new master, or spin up new nodes. Upgrade Puppet to the new version on them, and change their <code>masterport</code> setting to point to 8141.</li>
  <li>Trigger a <code>puppet agent --test</code> run on every test node, so you can see log messages in the foreground. <strong>Look for changes to their resources;</strong> if you see anything you didn&#8217;t expect, investigate it. If something seems dangerous and you can&#8217;t figure it out, you may want to post to the <a href="https://groups.google.com/group/puppet-users/">Puppet users list</a> or ask other users in #puppet on Freenode.</li>
  <li>Check the log messages in the terminal window on your puppet master. Look for warnings and deprecation notices.</li>
  <li>Check the actual configurations of your test nodes. Make sure everything is still working as expected.</li>
  <li>Repeat steps 6-9 with more test nodes if you&#8217;re still not sure.</li>
  <li>Revert the <code>masterport</code> setting on all test nodes. Kill the temporary puppet master process, delete the temporary copy of the puppet source. Upgrade your production puppet master(s) by stopping their web server, upgrading the puppet package, and restarting their web server. Upgrade all of your production nodes. (Most packaging systems allow you to use Puppet to upgrade Puppet.)</li>
</ol>

<h3 id="option-3-upgrade-master-and-roll-back-if-needed">Option 3: Upgrade Master and Roll Back if Needed</h3>

<p>For <strong>minor and bug fix releases,</strong> you can often take a simpler path. This is not universally recommended, but many users do it and survive.</p>

<ol>
  <li>Disable puppet agent on all of your production nodes. This is best done with <a href="./../mcollective/index.html">MCollective</a> and the <a href="http://projects.puppetlabs.com/projects/mcollective-plugins/wiki/AgentPuppetd">puppetd plugin</a>, which can stop the agent on all nodes in a matter of seconds.</li>
  <li>Upgrade your puppet master(s) to the new version of Puppet by stopping their web server, upgrading the puppet package, and restarting their web server.</li>
  <li>Choose a subset of your nodes to test with the new master, or spin up new nodes. Upgrade Puppet to the new version on them.</li>
  <li>Trigger a <code>puppet agent --test</code> run on every test node, so you can see log messages in the foreground. <strong>Look for changes to their resources;</strong> if you see anything you didn&#8217;t expect, investigate it. If something seems dangerous and you can&#8217;t figure it out, you may want to post to the <a href="https://groups.google.com/group/puppet-users/">Puppet users list</a> or ask other users in #puppet on Freenode.</li>
  <li>Check your puppet master&#8217;s log files. Look for warnings and deprecation notices.</li>
  <li>Check the actual configurations of your test nodes. Make sure everything is still working as expected.</li>
  <li>Repeat steps 3-6 with more test nodes if you&#8217;re still not sure.</li>
  <li>Do one of the following:
    <ul>
      <li>Upgrade Puppet and reactivate puppet agent on all of your production nodes.</li>
      <li>Downgrade Puppet to a known-good version on your Puppet master and any test nodes.</li>
    </ul>
  </li>
</ol>


              <blockquote><p style="font-size: 1.3em; text-align: center;"><a href="#content">↑ Back to top</a></p></blockquote>
            </div>
            <nav class="main">
                  <div id="subCol">

<h3 id="general-puppet-info">General Puppet Info</h3>

<ul>
  <li><a href="./../guides/installation.html">Installing Puppet</a></li>
  <li><span class="currentpage">Upgrading Puppet</span></li>
  <li><a href="./../guides/language_history.html">History of Language Features</a></li>
</ul>

<h3 id="other-puppet-docs">Other Puppet Docs</h3>

<ul>
  <li><a href="./../puppet/3/reference/index.html">Puppet 3 Reference Manual</a></li>
  <li><a href="./../puppet/2.7/reference/index.html">Puppet 2.7 Reference Manual</a></li>
  <li><a href="./../learning/index.html">Learning Puppet</a></li>
  <li><a href="./../windows/index.html">Puppet on Windows</a></li>
</ul>

                      <div style="margin-top: 1.5em; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download the Docs</p>
                          <a href="http://info.puppetlabs.com/download-pdfs.html"><img src="./../images/smallbits_small_docs.png" alt="Puppet docs download"></a>
                      </div>
                      <div style="margin-top: 0; padding-bottom: 10px;">
                          <p style="font-family: 'Lucida Grande',Lucida,Verdana,sans-serif;font-size: 16px; font-weight: bold; line-height: 22px; margin-bottom: 10px;">Download Puppet Enterprise</p>
                          <a href="http://info.puppetlabs.com/download-pe.html"><img src="./../images/puppet_cert_home.jpg" alt="Puppet Enterprise promo"></a>
                      </div>
                  </div>
            </nav>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>

				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">

				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>

				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />

				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />

				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />

				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>

				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>

<a href="http://info.puppetlabs.com/puppet-enterprise" class="fbtn">Try Puppet Enterprise FREE</a>

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>

                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus">


			<li><a href="http://feeds.feedburner.com/PuppetLabs" target="_blank"><img src="http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png" border="0"></a></li>
			<li><a href="http://www.facebook.com/pages/Puppet-Labs/219089920711" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/facebook.png" border="0"></a></li>
			<li><a href="http://www.twitter.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/plugins/my-profiles/images/twitter.png" border="0"></a></li>
			<li><a href="http://www.linkedin.com/groups?about=&amp;gid=696467&amp;trk=anet_ug_grppro" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/LinkedIn_IN_Icon_32px.png" border="0"></a></li>    <li><a href="https://github.com/puppetlabs" target="_blank"><img src="http://www.puppetlabs.com//wp-content/uploads/2011/01/github_icon.png" border="0"></a></li>
			<li><a href="https://plus.google.com/112682055028218091774?rel=author" target="_blank"><img src="https://puppetlabs.com/wp-content/uploads/2013/05/google_plus32x32.png" alt="Find Us on Google+" border="0"></a></li>
					</ul>

              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>James Turnbull and Jeff McCune's book <a href="http://www.apress.com/9781430230571" rel="nofollow">Pro Puppet</a> is a comprehensive and up-to-date look at Puppet and MCollective. </p>
              <a href="http://www.apress.com/9781430230571" rel="nofollow"><img src="http://www.puppetlabs.com/wp-content/uploads/2011/05/propuppetthumb.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2011 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">926 NW 13th Avenue #210</span>
           /
           <span class="locality">Portland</span>,
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>
      </div>
    </div>

  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>


	</body>
</html>
